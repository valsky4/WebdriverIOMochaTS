"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _fs2 = _interopRequireDefault(require("fs"));
var _teen_process = require("teen_process");
var _path = _interopRequireDefault(require("path"));
var _logger = _interopRequireDefault(require("../logger.js"));
var _support = require("@appium/support");
var _lruCache = _interopRequireDefault(require("lru-cache"));
var _helpers = require("../helpers.js");
const DEFAULT_PRIVATE_KEY = _path.default.join('keys', 'testkey.pk8');
const DEFAULT_CERTIFICATE = _path.default.join('keys', 'testkey.x509.pem');
const BUNDLETOOL_TUTORIAL = 'https://developer.android.com/studio/command-line/bundletool';
const APKSIGNER_VERIFY_FAIL = 'DOES NOT VERIFY';
const SHA1 = 'sha1';
const SHA256 = 'sha256';
const SHA512 = 'sha512';
const MD5 = 'md5';
const DEFAULT_CERT_HASH = {
  [SHA256]: 'a40da80a59d170caa950cf15c18c454d47a39b26989d8b640ecd745ba71bf5dc'
};
const JAVA_PROPS_INIT_ERROR = 'java.lang.Error: Properties init';
const SIGNED_APPS_CACHE = new _lruCache.default({
  max: 30
});
const apkSigningMethods = {};
apkSigningMethods.executeApksigner = async function executeApksigner(args = []) {
  const apkSignerJar = await (0, _helpers.getApksignerForOs)(this);
  const fullCmd = [await (0, _helpers.getJavaForOs)(), '-Xmx1024M', '-Xss1m', '-jar', apkSignerJar, ...args];
  _logger.default.debug(`Starting apksigner: ${_support.util.quote(fullCmd)}`);
  const {
    stdout,
    stderr
  } = await (0, _teen_process.exec)(fullCmd[0], fullCmd.slice(1), {
    cwd: _path.default.dirname(apkSignerJar),
    windowsVerbatimArguments: _support.system.isWindows()
  });
  for (let [name, stream] of [['stdout', stdout], ['stderr', stderr]]) {
    if (!_lodash.default.trim(stream)) {
      continue;
    }
    if (name === 'stdout') {
      stream = stream.split('\n').filter(line => !line.includes('WARNING:')).join('\n');
    }
    _logger.default.debug(`apksigner ${name}: ${stream}`);
  }
  return stdout;
};
apkSigningMethods.signWithDefaultCert = async function signWithDefaultCert(apk) {
  _logger.default.debug(`Signing '${apk}' with default cert`);
  if (!(await _support.fs.exists(apk))) {
    throw new Error(`${apk} file doesn't exist.`);
  }
  const args = ['sign', '--key', await (0, _helpers.getResourcePath)(DEFAULT_PRIVATE_KEY), '--cert', await (0, _helpers.getResourcePath)(DEFAULT_CERTIFICATE), apk];
  try {
    await this.executeApksigner(args);
  } catch (e) {
    throw new Error(`Could not sign '${apk}' with the default certificate. ` + `Original error: ${e.stderr || e.stdout || e.message}`);
  }
};
apkSigningMethods.signWithCustomCert = async function signWithCustomCert(apk) {
  _logger.default.debug(`Signing '${apk}' with custom cert`);
  if (!(await _support.fs.exists(this.keystorePath))) {
    throw new Error(`Keystore: ${this.keystorePath} doesn't exist.`);
  }
  if (!(await _support.fs.exists(apk))) {
    throw new Error(`'${apk}' doesn't exist.`);
  }
  try {
    await this.executeApksigner(['sign', '--ks', this.keystorePath, '--ks-key-alias', this.keyAlias, '--ks-pass', `pass:${this.keystorePassword}`, '--key-pass', `pass:${this.keyPassword}`, apk]);
  } catch (err) {
    _logger.default.warn(`Cannot use apksigner tool for signing. Defaulting to jarsigner. ` + `Original error: ${err.stderr || err.stdout || err.message}`);
    try {
      if (await (0, _helpers.unsignApk)(apk)) {
        _logger.default.debug(`'${apk}' has been successfully unsigned`);
      } else {
        _logger.default.debug(`'${apk}' does not need to be unsigned`);
      }
      const jarsigner = _path.default.resolve(await (0, _helpers.getJavaHome)(), 'bin', `jarsigner${_support.system.isWindows() ? '.exe' : ''}`);
      const fullCmd = [jarsigner, '-sigalg', 'MD5withRSA', '-digestalg', 'SHA1', '-keystore', this.keystorePath, '-storepass', this.keystorePassword, '-keypass', this.keyPassword, apk, this.keyAlias];
      _logger.default.debug(`Starting jarsigner: ${_support.util.quote(fullCmd)}`);
      await (0, _teen_process.exec)(fullCmd[0], fullCmd.slice(1), {
        windowsVerbatimArguments: _support.system.isWindows()
      });
    } catch (e) {
      throw new Error(`Could not sign with custom certificate. ` + `Original error: ${e.stderr || e.message}`);
    }
  }
};
apkSigningMethods.sign = async function sign(appPath) {
  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    let message = 'Signing of .apks-files is not supported. ';
    if (this.useKeystore) {
      message += 'Consider manual application bundle signing with the custom keystore ' + `like it is described at ${BUNDLETOOL_TUTORIAL}`;
    } else {
      message += `Consider manual application bundle signing with the key at '${DEFAULT_PRIVATE_KEY}' ` + `and the certificate at '${DEFAULT_CERTIFICATE}'. Read ${BUNDLETOOL_TUTORIAL} for more details.`;
    }
    _logger.default.warn(message);
    return;
  }
  await this.zipAlignApk(appPath);
  if (this.useKeystore) {
    await this.signWithCustomCert(appPath);
  } else {
    await this.signWithDefaultCert(appPath);
  }
};
apkSigningMethods.zipAlignApk = async function zipAlignApk(apk) {
  await this.initZipAlign();
  try {
    await (0, _teen_process.exec)(this.binaries.zipalign, ['-c', '4', apk]);
    _logger.default.debug(`${apk}' is already zip-aligned. Doing nothing`);
    return false;
  } catch (e) {
    _logger.default.debug(`'${apk}' is not zip-aligned. Aligning`);
  }
  try {
    await _support.fs.access(apk, _fs2.default.W_OK);
  } catch (e) {
    throw new Error(`The file at '${apk}' is not writeable. ` + `Please grant write permissions to this file or to its parent folder '${_path.default.dirname(apk)}' ` + `for the Appium process, so it can zip-align the file`);
  }
  const alignedApk = await _support.tempDir.path({
    prefix: 'appium',
    suffix: '.tmp'
  });
  await (0, _support.mkdirp)(_path.default.dirname(alignedApk));
  try {
    await (0, _teen_process.exec)(this.binaries.zipalign, ['-f', '4', apk, alignedApk]);
    await _support.fs.mv(alignedApk, apk, {
      mkdirp: true
    });
    return true;
  } catch (e) {
    if (await _support.fs.exists(alignedApk)) {
      await _support.fs.unlink(alignedApk);
    }
    throw new Error(`zipAlignApk failed. Original error: ${e.stderr || e.message}`);
  }
};
apkSigningMethods.checkApkCert = async function checkApkCert(appPath, pkg, opts = {}) {
  _logger.default.debug(`Checking app cert for ${appPath}`);
  if (!(await _support.fs.exists(appPath))) {
    _logger.default.debug(`'${appPath}' does not exist`);
    return false;
  }
  if (_path.default.extname(appPath) === _helpers.APKS_EXTENSION) {
    appPath = await this.extractBaseApk(appPath);
  }
  const hashMatches = (apksignerOutput, expectedHashes) => {
    for (const [name, value] of _lodash.default.toPairs(expectedHashes)) {
      if (new RegExp(`digest:\\s+${value}\\b`, 'i').test(apksignerOutput)) {
        _logger.default.debug(`${name} hash did match for '${_path.default.basename(appPath)}'`);
        return true;
      }
    }
    return false;
  };
  const {
    requireDefaultCert = true
  } = opts;
  const appHash = await _support.fs.hash(appPath);
  if (SIGNED_APPS_CACHE.has(appHash)) {
    _logger.default.debug(`Using the previously cached signature entry for '${_path.default.basename(appPath)}'`);
    const {
      keystorePath,
      output,
      expected
    } = SIGNED_APPS_CACHE.get(appHash);
    if (this.useKeystore && this.keystorePath === keystorePath || !this.useKeystore) {
      return !this.useKeystore && !requireDefaultCert || hashMatches(output, expected);
    }
  }
  const expected = this.useKeystore ? await this.getKeystoreHash(appPath, pkg) : DEFAULT_CERT_HASH;
  try {
    await (0, _helpers.getApksignerForOs)(this);
    const output = await this.executeApksigner(['verify', '--print-certs', appPath]);
    const hasMatch = hashMatches(output, expected);
    if (hasMatch) {
      _logger.default.info(`'${appPath}' is signed with the ` + `${this.useKeystore ? 'keystore' : 'default'} certificate`);
    } else {
      _logger.default.info(`'${appPath}' is signed with a ` + `non-${this.useKeystore ? 'keystore' : 'default'} certificate`);
    }
    const isSigned = !this.useKeystore && !requireDefaultCert || hasMatch;
    if (isSigned) {
      SIGNED_APPS_CACHE.set(appHash, {
        output,
        expected,
        keystorePath: this.keystorePath
      });
    }
    return isSigned;
  } catch (err) {
    if (_lodash.default.includes(err.stderr, APKSIGNER_VERIFY_FAIL)) {
      _logger.default.info(`'${appPath}' is not signed`);
      return false;
    }
    const errMsg = err.stderr || err.stdout || err.message;
    if (_lodash.default.includes(errMsg, JAVA_PROPS_INIT_ERROR)) {
      _logger.default.warn(errMsg);
      _logger.default.warn(`Assuming '${appPath}' is already signed and continuing anyway`);
      return true;
    }
    throw new Error(`Cannot verify the signature of '${appPath}'. ` + `Original error: ${errMsg}`);
  }
};
apkSigningMethods.getKeystoreHash = async function getKeystoreHash() {
  _logger.default.debug(`Getting hash of the '${this.keystorePath}' keystore`);
  const keytool = _path.default.resolve(await (0, _helpers.getJavaHome)(), 'bin', `keytool${_support.system.isWindows() ? '.exe' : ''}`);
  if (!(await _support.fs.exists(keytool))) {
    throw new Error(`The keytool utility cannot be found at '${keytool}'`);
  }
  const args = ['-v', '-list', '-alias', this.keyAlias, '-keystore', this.keystorePath, '-storepass', this.keystorePassword];
  _logger.default.info(`Running '${keytool}' with arguments: ${_support.util.quote(args)}`);
  try {
    const {
      stdout
    } = await (0, _teen_process.exec)(keytool, args, {
      windowsVerbatimArguments: _support.system.isWindows()
    });
    const result = {};
    for (const hashName of [SHA512, SHA256, SHA1, MD5]) {
      const hashRe = new RegExp(`^\\s*${hashName}:\\s*([a-f0-9:]+)`, 'mi');
      const match = hashRe.exec(stdout);
      if (!match) {
        continue;
      }
      result[hashName] = match[1].replace(/:/g, '').toLowerCase();
    }
    if (_lodash.default.isEmpty(result)) {
      _logger.default.debug(stdout);
      throw new Error('Cannot parse the hash value from the keytool output');
    }
    _logger.default.debug(`Keystore hash: ${JSON.stringify(result)}`);
    return result;
  } catch (e) {
    throw new Error(`Cannot get the hash of '${this.keystorePath}' keystore. ` + `Original error: ${e.stderr || e.message}`);
  }
};
var _default = apkSigningMethods;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJERUZBVUxUX1BSSVZBVEVfS0VZIiwicGF0aCIsImpvaW4iLCJERUZBVUxUX0NFUlRJRklDQVRFIiwiQlVORExFVE9PTF9UVVRPUklBTCIsIkFQS1NJR05FUl9WRVJJRllfRkFJTCIsIlNIQTEiLCJTSEEyNTYiLCJTSEE1MTIiLCJNRDUiLCJERUZBVUxUX0NFUlRfSEFTSCIsIkpBVkFfUFJPUFNfSU5JVF9FUlJPUiIsIlNJR05FRF9BUFBTX0NBQ0hFIiwiTFJVIiwibWF4IiwiYXBrU2lnbmluZ01ldGhvZHMiLCJleGVjdXRlQXBrc2lnbmVyIiwiYXJncyIsImFwa1NpZ25lckphciIsImdldEFwa3NpZ25lckZvck9zIiwiZnVsbENtZCIsImdldEphdmFGb3JPcyIsImxvZyIsImRlYnVnIiwidXRpbCIsInF1b3RlIiwic3Rkb3V0Iiwic3RkZXJyIiwiZXhlYyIsInNsaWNlIiwiY3dkIiwiZGlybmFtZSIsIndpbmRvd3NWZXJiYXRpbUFyZ3VtZW50cyIsInN5c3RlbSIsImlzV2luZG93cyIsIm5hbWUiLCJzdHJlYW0iLCJfIiwidHJpbSIsInNwbGl0IiwiZmlsdGVyIiwibGluZSIsImluY2x1ZGVzIiwic2lnbldpdGhEZWZhdWx0Q2VydCIsImFwayIsImZzIiwiZXhpc3RzIiwiRXJyb3IiLCJnZXRSZXNvdXJjZVBhdGgiLCJlIiwibWVzc2FnZSIsInNpZ25XaXRoQ3VzdG9tQ2VydCIsImtleXN0b3JlUGF0aCIsImtleUFsaWFzIiwia2V5c3RvcmVQYXNzd29yZCIsImtleVBhc3N3b3JkIiwiZXJyIiwid2FybiIsInVuc2lnbkFwayIsImphcnNpZ25lciIsInJlc29sdmUiLCJnZXRKYXZhSG9tZSIsInNpZ24iLCJhcHBQYXRoIiwiZW5kc1dpdGgiLCJBUEtTX0VYVEVOU0lPTiIsInVzZUtleXN0b3JlIiwiemlwQWxpZ25BcGsiLCJpbml0WmlwQWxpZ24iLCJiaW5hcmllcyIsInppcGFsaWduIiwiYWNjZXNzIiwiX2ZzIiwiV19PSyIsImFsaWduZWRBcGsiLCJ0ZW1wRGlyIiwicHJlZml4Iiwic3VmZml4IiwibWtkaXJwIiwibXYiLCJ1bmxpbmsiLCJjaGVja0Fwa0NlcnQiLCJwa2ciLCJvcHRzIiwiZXh0bmFtZSIsImV4dHJhY3RCYXNlQXBrIiwiaGFzaE1hdGNoZXMiLCJhcGtzaWduZXJPdXRwdXQiLCJleHBlY3RlZEhhc2hlcyIsInZhbHVlIiwidG9QYWlycyIsIlJlZ0V4cCIsInRlc3QiLCJiYXNlbmFtZSIsInJlcXVpcmVEZWZhdWx0Q2VydCIsImFwcEhhc2giLCJoYXNoIiwiaGFzIiwib3V0cHV0IiwiZXhwZWN0ZWQiLCJnZXQiLCJnZXRLZXlzdG9yZUhhc2giLCJoYXNNYXRjaCIsImluZm8iLCJpc1NpZ25lZCIsInNldCIsImVyck1zZyIsImtleXRvb2wiLCJyZXN1bHQiLCJoYXNoTmFtZSIsImhhc2hSZSIsIm1hdGNoIiwicmVwbGFjZSIsInRvTG93ZXJDYXNlIiwiaXNFbXB0eSIsIkpTT04iLCJzdHJpbmdpZnkiXSwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvdG9vbHMvYXBrLXNpZ25pbmcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBfZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyLmpzJztcbmltcG9ydCB7IHRlbXBEaXIsIHN5c3RlbSwgbWtkaXJwLCBmcywgdXRpbCB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgTFJVIGZyb20gJ2xydS1jYWNoZSc7XG5pbXBvcnQge1xuICBnZXRKYXZhRm9yT3MsIGdldEFwa3NpZ25lckZvck9zLCBnZXRKYXZhSG9tZSwgZ2V0UmVzb3VyY2VQYXRoLCBBUEtTX0VYVEVOU0lPTiwgdW5zaWduQXBrLFxufSBmcm9tICcuLi9oZWxwZXJzLmpzJztcblxuY29uc3QgREVGQVVMVF9QUklWQVRFX0tFWSA9IHBhdGguam9pbigna2V5cycsICd0ZXN0a2V5LnBrOCcpO1xuY29uc3QgREVGQVVMVF9DRVJUSUZJQ0FURSA9IHBhdGguam9pbigna2V5cycsICd0ZXN0a2V5Lng1MDkucGVtJyk7XG5jb25zdCBCVU5ETEVUT09MX1RVVE9SSUFMID0gJ2h0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3N0dWRpby9jb21tYW5kLWxpbmUvYnVuZGxldG9vbCc7XG5jb25zdCBBUEtTSUdORVJfVkVSSUZZX0ZBSUwgPSAnRE9FUyBOT1QgVkVSSUZZJztcbmNvbnN0IFNIQTEgPSAnc2hhMSc7XG5jb25zdCBTSEEyNTYgPSAnc2hhMjU2JztcbmNvbnN0IFNIQTUxMiA9ICdzaGE1MTInO1xuY29uc3QgTUQ1ID0gJ21kNSc7XG5jb25zdCBERUZBVUxUX0NFUlRfSEFTSCA9IHtcbiAgW1NIQTI1Nl06ICdhNDBkYTgwYTU5ZDE3MGNhYTk1MGNmMTVjMThjNDU0ZDQ3YTM5YjI2OTg5ZDhiNjQwZWNkNzQ1YmE3MWJmNWRjJ1xufTtcbmNvbnN0IEpBVkFfUFJPUFNfSU5JVF9FUlJPUiA9ICdqYXZhLmxhbmcuRXJyb3I6IFByb3BlcnRpZXMgaW5pdCc7XG5jb25zdCBTSUdORURfQVBQU19DQUNIRSA9IG5ldyBMUlUoe1xuICBtYXg6IDMwLFxufSk7XG5cblxuY29uc3QgYXBrU2lnbmluZ01ldGhvZHMgPSB7fTtcblxuLyoqXG4gKiBFeGVjdXRlIGFwa3NpZ25lciB1dGlsaXR5IHdpdGggZ2l2ZW4gYXJndW1lbnRzLlxuICpcbiAqIEBwYXJhbSB7P0FycmF5PFN0cmluZz59IGFyZ3MgLSBUaGUgbGlzdCBvZiB0b29sIGFyZ3VtZW50cy5cbiAqIEByZXR1cm4ge3N0cmluZ30gLSBDb21tYW5kIHN0ZG91dFxuICogQHRocm93cyB7RXJyb3J9IElmIGFwa3NpZ25lciBiaW5hcnkgaXMgbm90IHByZXNlbnQgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtXG4gKiAgICAgICAgICAgICAgICAgb3IgdGhlIHJldHVybiBjb2RlIGlzIG5vdCBlcXVhbCB0byB6ZXJvLlxuICovXG5hcGtTaWduaW5nTWV0aG9kcy5leGVjdXRlQXBrc2lnbmVyID0gYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUFwa3NpZ25lciAoYXJncyA9IFtdKSB7XG4gIGNvbnN0IGFwa1NpZ25lckphciA9IGF3YWl0IGdldEFwa3NpZ25lckZvck9zKHRoaXMpO1xuICBjb25zdCBmdWxsQ21kID0gW1xuICAgIGF3YWl0IGdldEphdmFGb3JPcygpLCAnLVhteDEwMjRNJywgJy1Yc3MxbScsXG4gICAgJy1qYXInLCBhcGtTaWduZXJKYXIsXG4gICAgLi4uYXJnc1xuICBdO1xuICBsb2cuZGVidWcoYFN0YXJ0aW5nIGFwa3NpZ25lcjogJHt1dGlsLnF1b3RlKGZ1bGxDbWQpfWApO1xuICAvLyBJdCBpcyBuZWNlc3NhcnkgdG8gc3BlY2lmeSBDV0QgZXhwbGljaXRseTsgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2lzc3Vlcy8xNDcyNCNpc3N1ZWNvbW1lbnQtNzM3NDQ2NzE1XG4gIGNvbnN0IHtzdGRvdXQsIHN0ZGVycn0gPSBhd2FpdCBleGVjKGZ1bGxDbWRbMF0sIGZ1bGxDbWQuc2xpY2UoMSksIHtcbiAgICBjd2Q6IHBhdGguZGlybmFtZShhcGtTaWduZXJKYXIpLCB3aW5kb3dzVmVyYmF0aW1Bcmd1bWVudHM6IHN5c3RlbS5pc1dpbmRvd3MoKVxuICB9KTtcbiAgZm9yIChsZXQgW25hbWUsIHN0cmVhbV0gb2YgW1snc3Rkb3V0Jywgc3Rkb3V0XSwgWydzdGRlcnInLCBzdGRlcnJdXSkge1xuICAgIGlmICghXy50cmltKHN0cmVhbSkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmIChuYW1lID09PSAnc3Rkb3V0Jykge1xuICAgICAgLy8gTWFrZSB0aGUgb3V0cHV0IGxlc3MgdGFsa2F0aXZlXG4gICAgICBzdHJlYW0gPSBzdHJlYW0uc3BsaXQoJ1xcbicpXG4gICAgICAgIC5maWx0ZXIoKGxpbmUpID0+ICFsaW5lLmluY2x1ZGVzKCdXQVJOSU5HOicpKVxuICAgICAgICAuam9pbignXFxuJyk7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgYXBrc2lnbmVyICR7bmFtZX06ICR7c3RyZWFtfWApO1xuICB9XG4gIHJldHVybiBzdGRvdXQ7XG59O1xuXG4vKipcbiAqIChSZSlzaWduIHRoZSBnaXZlbiBhcGsgZmlsZSBvbiB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0gd2l0aCB0aGUgZGVmYXVsdCBjZXJ0aWZpY2F0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgYXBrIGZpbGUuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgc2lnbmluZyBmYWlscy5cbiAqL1xuYXBrU2lnbmluZ01ldGhvZHMuc2lnbldpdGhEZWZhdWx0Q2VydCA9IGFzeW5jIGZ1bmN0aW9uIHNpZ25XaXRoRGVmYXVsdENlcnQgKGFwaykge1xuICBsb2cuZGVidWcoYFNpZ25pbmcgJyR7YXBrfScgd2l0aCBkZWZhdWx0IGNlcnRgKTtcbiAgaWYgKCEoYXdhaXQgZnMuZXhpc3RzKGFwaykpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke2Fwa30gZmlsZSBkb2Vzbid0IGV4aXN0LmApO1xuICB9XG5cbiAgY29uc3QgYXJncyA9IFtcbiAgICAnc2lnbicsXG4gICAgJy0ta2V5JywgYXdhaXQgZ2V0UmVzb3VyY2VQYXRoKERFRkFVTFRfUFJJVkFURV9LRVkpLFxuICAgICctLWNlcnQnLCBhd2FpdCBnZXRSZXNvdXJjZVBhdGgoREVGQVVMVF9DRVJUSUZJQ0FURSksXG4gICAgYXBrLFxuICBdO1xuICB0cnkge1xuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZUFwa3NpZ25lcihhcmdzKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IHNpZ24gJyR7YXBrfScgd2l0aCB0aGUgZGVmYXVsdCBjZXJ0aWZpY2F0ZS4gYCArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5zdGRlcnIgfHwgZS5zdGRvdXQgfHwgZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIChSZSlzaWduIHRoZSBnaXZlbiBhcGsgZmlsZSBvbiB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0gd2l0aCBhIGN1c3RvbSBjZXJ0aWZpY2F0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgYXBrIGZpbGUuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgc2lnbmluZyBmYWlscy5cbiAqL1xuYXBrU2lnbmluZ01ldGhvZHMuc2lnbldpdGhDdXN0b21DZXJ0ID0gYXN5bmMgZnVuY3Rpb24gc2lnbldpdGhDdXN0b21DZXJ0IChhcGspIHtcbiAgbG9nLmRlYnVnKGBTaWduaW5nICcke2Fwa30nIHdpdGggY3VzdG9tIGNlcnRgKTtcbiAgaWYgKCEoYXdhaXQgZnMuZXhpc3RzKHRoaXMua2V5c3RvcmVQYXRoKSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEtleXN0b3JlOiAke3RoaXMua2V5c3RvcmVQYXRofSBkb2Vzbid0IGV4aXN0LmApO1xuICB9XG4gIGlmICghKGF3YWl0IGZzLmV4aXN0cyhhcGspKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJyR7YXBrfScgZG9lc24ndCBleGlzdC5gKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlQXBrc2lnbmVyKFsnc2lnbicsXG4gICAgICAnLS1rcycsIHRoaXMua2V5c3RvcmVQYXRoLFxuICAgICAgJy0ta3Mta2V5LWFsaWFzJywgdGhpcy5rZXlBbGlhcyxcbiAgICAgICctLWtzLXBhc3MnLCBgcGFzczoke3RoaXMua2V5c3RvcmVQYXNzd29yZH1gLFxuICAgICAgJy0ta2V5LXBhc3MnLCBgcGFzczoke3RoaXMua2V5UGFzc3dvcmR9YCxcbiAgICAgIGFwa10pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cud2FybihgQ2Fubm90IHVzZSBhcGtzaWduZXIgdG9vbCBmb3Igc2lnbmluZy4gRGVmYXVsdGluZyB0byBqYXJzaWduZXIuIGAgK1xuICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Vyci5zdGRlcnIgfHwgZXJyLnN0ZG91dCB8fCBlcnIubWVzc2FnZX1gKTtcbiAgICB0cnkge1xuICAgICAgaWYgKGF3YWl0IHVuc2lnbkFwayhhcGspKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgJyR7YXBrfScgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IHVuc2lnbmVkYCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2cuZGVidWcoYCcke2Fwa30nIGRvZXMgbm90IG5lZWQgdG8gYmUgdW5zaWduZWRgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGphcnNpZ25lciA9IHBhdGgucmVzb2x2ZShhd2FpdCBnZXRKYXZhSG9tZSgpLCAnYmluJyxcbiAgICAgICAgYGphcnNpZ25lciR7c3lzdGVtLmlzV2luZG93cygpID8gJy5leGUnIDogJyd9YCk7XG4gICAgICBjb25zdCBmdWxsQ21kID0gW2phcnNpZ25lcixcbiAgICAgICAgJy1zaWdhbGcnLCAnTUQ1d2l0aFJTQScsXG4gICAgICAgICctZGlnZXN0YWxnJywgJ1NIQTEnLFxuICAgICAgICAnLWtleXN0b3JlJywgdGhpcy5rZXlzdG9yZVBhdGgsXG4gICAgICAgICctc3RvcmVwYXNzJywgdGhpcy5rZXlzdG9yZVBhc3N3b3JkLFxuICAgICAgICAnLWtleXBhc3MnLCB0aGlzLmtleVBhc3N3b3JkLFxuICAgICAgICBhcGssIHRoaXMua2V5QWxpYXNdO1xuICAgICAgbG9nLmRlYnVnKGBTdGFydGluZyBqYXJzaWduZXI6ICR7dXRpbC5xdW90ZShmdWxsQ21kKX1gKTtcbiAgICAgIGF3YWl0IGV4ZWMoZnVsbENtZFswXSwgZnVsbENtZC5zbGljZSgxKSwgeyB3aW5kb3dzVmVyYmF0aW1Bcmd1bWVudHM6IHN5c3RlbS5pc1dpbmRvd3MoKSB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBzaWduIHdpdGggY3VzdG9tIGNlcnRpZmljYXRlLiBgICtcbiAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyIHx8IGUubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cbn07XG5cbi8qKlxuICogKFJlKXNpZ24gdGhlIGdpdmVuIGFwayBmaWxlIG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbSB3aXRoIGVpdGhlclxuICogY3VzdG9tIG9yIGRlZmF1bHQgY2VydGlmaWNhdGUgYmFzZWQgb24gX3RoaXMudXNlS2V5c3RvcmVfIHByb3BlcnR5IHZhbHVlXG4gKiBhbmQgWmlwLWFsaWducyBpdCBhZnRlciBzaWduaW5nLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgLmFwayhzKSBmaWxlLlxuICogQHRocm93cyB7RXJyb3J9IElmIHNpZ25pbmcgZmFpbHMuXG4gKi9cbmFwa1NpZ25pbmdNZXRob2RzLnNpZ24gPSBhc3luYyBmdW5jdGlvbiBzaWduIChhcHBQYXRoKSB7XG4gIGlmIChhcHBQYXRoLmVuZHNXaXRoKEFQS1NfRVhURU5TSU9OKSkge1xuICAgIGxldCBtZXNzYWdlID0gJ1NpZ25pbmcgb2YgLmFwa3MtZmlsZXMgaXMgbm90IHN1cHBvcnRlZC4gJztcbiAgICBpZiAodGhpcy51c2VLZXlzdG9yZSkge1xuICAgICAgbWVzc2FnZSArPSAnQ29uc2lkZXIgbWFudWFsIGFwcGxpY2F0aW9uIGJ1bmRsZSBzaWduaW5nIHdpdGggdGhlIGN1c3RvbSBrZXlzdG9yZSAnICtcbiAgICAgICAgYGxpa2UgaXQgaXMgZGVzY3JpYmVkIGF0ICR7QlVORExFVE9PTF9UVVRPUklBTH1gO1xuICAgIH0gZWxzZSB7XG4gICAgICBtZXNzYWdlICs9IGBDb25zaWRlciBtYW51YWwgYXBwbGljYXRpb24gYnVuZGxlIHNpZ25pbmcgd2l0aCB0aGUga2V5IGF0ICcke0RFRkFVTFRfUFJJVkFURV9LRVl9JyBgICtcbiAgICAgICAgYGFuZCB0aGUgY2VydGlmaWNhdGUgYXQgJyR7REVGQVVMVF9DRVJUSUZJQ0FURX0nLiBSZWFkICR7QlVORExFVE9PTF9UVVRPUklBTH0gZm9yIG1vcmUgZGV0YWlscy5gO1xuICAgIH1cbiAgICBsb2cud2FybihtZXNzYWdlKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBpdCBpcyBuZWNlc3NhcnkgdG8gYXBwbHkgemlwYWxpZ24gb25seSBiZWZvcmUgc2lnbmluZ1xuICAvLyBpZiBhcGtzaWduZXIgaXMgdXNlZFxuICBhd2FpdCB0aGlzLnppcEFsaWduQXBrKGFwcFBhdGgpO1xuXG4gIGlmICh0aGlzLnVzZUtleXN0b3JlKSB7XG4gICAgYXdhaXQgdGhpcy5zaWduV2l0aEN1c3RvbUNlcnQoYXBwUGF0aCk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgdGhpcy5zaWduV2l0aERlZmF1bHRDZXJ0KGFwcFBhdGgpO1xuICB9XG59O1xuXG4vKipcbiAqIFBlcmZvcm0gemlwLWFsaWduaW5nIHRvIHRoZSBnaXZlbiBsb2NhbCBhcGsgZmlsZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgYXBrIGZpbGUuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgYXBrIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBhbGlnbmVkXG4gKiBvciBmYWxzZSBpZiB0aGUgYXBrIGhhcyBiZWVuIGFscmVhZHkgYWxpZ25lZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB6aXAtYWxpZ24gZmFpbHMuXG4gKi9cbmFwa1NpZ25pbmdNZXRob2RzLnppcEFsaWduQXBrID0gYXN5bmMgZnVuY3Rpb24gemlwQWxpZ25BcGsgKGFwaykge1xuICBhd2FpdCB0aGlzLmluaXRaaXBBbGlnbigpO1xuICB0cnkge1xuICAgIGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy56aXBhbGlnbiwgWyctYycsICc0JywgYXBrXSk7XG4gICAgbG9nLmRlYnVnKGAke2Fwa30nIGlzIGFscmVhZHkgemlwLWFsaWduZWQuIERvaW5nIG5vdGhpbmdgKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBsb2cuZGVidWcoYCcke2Fwa30nIGlzIG5vdCB6aXAtYWxpZ25lZC4gQWxpZ25pbmdgKTtcbiAgfVxuICB0cnkge1xuICAgIGF3YWl0IGZzLmFjY2VzcyhhcGssIF9mcy5XX09LKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGZpbGUgYXQgJyR7YXBrfScgaXMgbm90IHdyaXRlYWJsZS4gYCArXG4gICAgICBgUGxlYXNlIGdyYW50IHdyaXRlIHBlcm1pc3Npb25zIHRvIHRoaXMgZmlsZSBvciB0byBpdHMgcGFyZW50IGZvbGRlciAnJHtwYXRoLmRpcm5hbWUoYXBrKX0nIGAgK1xuICAgICAgYGZvciB0aGUgQXBwaXVtIHByb2Nlc3MsIHNvIGl0IGNhbiB6aXAtYWxpZ24gdGhlIGZpbGVgKTtcbiAgfVxuICBjb25zdCBhbGlnbmVkQXBrID0gYXdhaXQgdGVtcERpci5wYXRoKHtwcmVmaXg6ICdhcHBpdW0nLCBzdWZmaXg6ICcudG1wJ30pO1xuICBhd2FpdCBta2RpcnAocGF0aC5kaXJuYW1lKGFsaWduZWRBcGspKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuemlwYWxpZ24sIFsnLWYnLCAnNCcsIGFwaywgYWxpZ25lZEFwa10pO1xuICAgIGF3YWl0IGZzLm12KGFsaWduZWRBcGssIGFwaywgeyBta2RpcnA6IHRydWUgfSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKGFsaWduZWRBcGspKSB7XG4gICAgICBhd2FpdCBmcy51bmxpbmsoYWxpZ25lZEFwayk7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihgemlwQWxpZ25BcGsgZmFpbGVkLiBPcmlnaW5hbCBlcnJvcjogJHtlLnN0ZGVyciB8fCBlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gQ2VydENoZWNrT3B0aW9uc1xuICogQHByb3BlcnR5IHtib29sZWFufSByZXF1aXJlRGVmYXVsdENlcnQgW3RydWVdIFdoZXRoZXIgdG8gcmVxdWlyZSB0aGF0IHRoZSBkZXN0aW5hdGlvbiBBUEtcbiAqIGlzIHNpZ25lZCB3aXRoIHRoZSBkZWZhdWx0IEFwcGl1bSBjZXJ0aWZpY2F0ZSBvciBhbnkgdmFsaWQgY2VydGlmaWNhdGUuIFRoaXMgb3B0aW9uXG4gKiBvbmx5IGhhcyBlZmZlY3QgaWYgYHVzZUtleXN0b3JlYCBwcm9wZXJ0eSBpcyB1bnNldC5cbiAqL1xuXG4vKipcbiAqIENoZWNrIGlmIHRoZSBhcHAgaXMgYWxyZWFkeSBzaWduZWQgd2l0aCB0aGUgZGVmYXVsdCBBcHBpdW0gY2VydGlmaWNhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBsb2NhbCAuYXBrKHMpIGZpbGUuXG4gKiBAcGFyYW0ge3N0cmluZ30gcGdrIC0gVGhlIG5hbWUgb2YgYXBwbGljYXRpb24gcGFja2FnZS5cbiAqIEBwYXJhbSB7Q2VydENoZWNrT3B0aW9uc30gb3B0cyAtIENlcnRpZmljYXRlIGNoZWNraW5nIG9wdGlvbnNcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgZ2l2ZW4gYXBwbGljYXRpb24gaXMgYWxyZWFkeSBzaWduZWQuXG4gKi9cbmFwa1NpZ25pbmdNZXRob2RzLmNoZWNrQXBrQ2VydCA9IGFzeW5jIGZ1bmN0aW9uIGNoZWNrQXBrQ2VydCAoYXBwUGF0aCwgcGtnLCBvcHRzID0ge30pIHtcbiAgbG9nLmRlYnVnKGBDaGVja2luZyBhcHAgY2VydCBmb3IgJHthcHBQYXRofWApO1xuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhhcHBQYXRoKSkge1xuICAgIGxvZy5kZWJ1ZyhgJyR7YXBwUGF0aH0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKHBhdGguZXh0bmFtZShhcHBQYXRoKSA9PT0gQVBLU19FWFRFTlNJT04pIHtcbiAgICBhcHBQYXRoID0gYXdhaXQgdGhpcy5leHRyYWN0QmFzZUFwayhhcHBQYXRoKTtcbiAgfVxuXG4gIGNvbnN0IGhhc2hNYXRjaGVzID0gKGFwa3NpZ25lck91dHB1dCwgZXhwZWN0ZWRIYXNoZXMpID0+IHtcbiAgICBmb3IgKGNvbnN0IFtuYW1lLCB2YWx1ZV0gb2YgXy50b1BhaXJzKGV4cGVjdGVkSGFzaGVzKSkge1xuICAgICAgaWYgKG5ldyBSZWdFeHAoYGRpZ2VzdDpcXFxccyske3ZhbHVlfVxcXFxiYCwgJ2knKS50ZXN0KGFwa3NpZ25lck91dHB1dCkpIHtcbiAgICAgICAgbG9nLmRlYnVnKGAke25hbWV9IGhhc2ggZGlkIG1hdGNoIGZvciAnJHtwYXRoLmJhc2VuYW1lKGFwcFBhdGgpfSdgKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBjb25zdCB7XG4gICAgcmVxdWlyZURlZmF1bHRDZXJ0ID0gdHJ1ZSxcbiAgfSA9IG9wdHM7XG5cbiAgY29uc3QgYXBwSGFzaCA9IGF3YWl0IGZzLmhhc2goYXBwUGF0aCk7XG4gIGlmIChTSUdORURfQVBQU19DQUNIRS5oYXMoYXBwSGFzaCkpIHtcbiAgICBsb2cuZGVidWcoYFVzaW5nIHRoZSBwcmV2aW91c2x5IGNhY2hlZCBzaWduYXR1cmUgZW50cnkgZm9yICcke3BhdGguYmFzZW5hbWUoYXBwUGF0aCl9J2ApO1xuICAgIGNvbnN0IHtrZXlzdG9yZVBhdGgsIG91dHB1dCwgZXhwZWN0ZWR9ID0gU0lHTkVEX0FQUFNfQ0FDSEUuZ2V0KGFwcEhhc2gpO1xuICAgIGlmICh0aGlzLnVzZUtleXN0b3JlICYmIHRoaXMua2V5c3RvcmVQYXRoID09PSBrZXlzdG9yZVBhdGggfHwgIXRoaXMudXNlS2V5c3RvcmUpIHtcbiAgICAgIHJldHVybiAoIXRoaXMudXNlS2V5c3RvcmUgJiYgIXJlcXVpcmVEZWZhdWx0Q2VydCkgfHwgaGFzaE1hdGNoZXMob3V0cHV0LCBleHBlY3RlZCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgZXhwZWN0ZWQgPSB0aGlzLnVzZUtleXN0b3JlXG4gICAgPyBhd2FpdCB0aGlzLmdldEtleXN0b3JlSGFzaChhcHBQYXRoLCBwa2cpXG4gICAgOiBERUZBVUxUX0NFUlRfSEFTSDtcbiAgdHJ5IHtcbiAgICBhd2FpdCBnZXRBcGtzaWduZXJGb3JPcyh0aGlzKTtcbiAgICBjb25zdCBvdXRwdXQgPSBhd2FpdCB0aGlzLmV4ZWN1dGVBcGtzaWduZXIoWyd2ZXJpZnknLCAnLS1wcmludC1jZXJ0cycsIGFwcFBhdGhdKTtcbiAgICBjb25zdCBoYXNNYXRjaCA9IGhhc2hNYXRjaGVzKG91dHB1dCwgZXhwZWN0ZWQpO1xuICAgIGlmIChoYXNNYXRjaCkge1xuICAgICAgbG9nLmluZm8oYCcke2FwcFBhdGh9JyBpcyBzaWduZWQgd2l0aCB0aGUgYCArXG4gICAgICAgIGAke3RoaXMudXNlS2V5c3RvcmUgPyAna2V5c3RvcmUnIDogJ2RlZmF1bHQnfSBjZXJ0aWZpY2F0ZWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2cuaW5mbyhgJyR7YXBwUGF0aH0nIGlzIHNpZ25lZCB3aXRoIGEgYCArXG4gICAgICAgIGBub24tJHt0aGlzLnVzZUtleXN0b3JlID8gJ2tleXN0b3JlJyA6ICdkZWZhdWx0J30gY2VydGlmaWNhdGVgKTtcbiAgICB9XG4gICAgY29uc3QgaXNTaWduZWQgPSAoIXRoaXMudXNlS2V5c3RvcmUgJiYgIXJlcXVpcmVEZWZhdWx0Q2VydCkgfHwgaGFzTWF0Y2g7XG4gICAgaWYgKGlzU2lnbmVkKSB7XG4gICAgICBTSUdORURfQVBQU19DQUNIRS5zZXQoYXBwSGFzaCwge1xuICAgICAgICBvdXRwdXQsXG4gICAgICAgIGV4cGVjdGVkLFxuICAgICAgICBrZXlzdG9yZVBhdGg6IHRoaXMua2V5c3RvcmVQYXRoLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBpc1NpZ25lZDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgLy8gY2hlY2sgaWYgdGhlcmUgaXMgbm8gc2lnbmF0dXJlXG4gICAgaWYgKF8uaW5jbHVkZXMoZXJyLnN0ZGVyciwgQVBLU0lHTkVSX1ZFUklGWV9GQUlMKSkge1xuICAgICAgbG9nLmluZm8oYCcke2FwcFBhdGh9JyBpcyBub3Qgc2lnbmVkYCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGVyck1zZyA9IGVyci5zdGRlcnIgfHwgZXJyLnN0ZG91dCB8fCBlcnIubWVzc2FnZTtcbiAgICBpZiAoXy5pbmNsdWRlcyhlcnJNc2csIEpBVkFfUFJPUFNfSU5JVF9FUlJPUikpIHtcbiAgICAgIC8vIFRoaXMgZXJyb3IgcG9wcyB1cCByYW5kb21seSBhbmQgd2UgYXJlIG5vdCBxdWl0ZSBzdXJlIHdoeS5cbiAgICAgIC8vIE15IGd1ZXNzIC0gYSByYWNlIGNvbmRpdGlvbiBpbiBqYXZhIHZtIGluaXRpYWxpemF0aW9uLlxuICAgICAgLy8gTmV2ZXJ0aGVsZXNzLCBsZXRzIG1ha2UgQXBwaXVtIHRvIGJlbGlldmUgdGhlIGZpbGUgaXMgYWxyZWFkeSBzaWduZWQsXG4gICAgICAvLyBiZWNhdXNlIGl0IHdvdWxkIGJlIHRydWUgZm9yIDk5JSBvZiBVSUF1dG9tYXRvcjItYmFzZWRcbiAgICAgIC8vIHRlc3RzLCB3aGVyZSB3ZSBwcmVzaWduIHNlcnZlciBiaW5hcmllcyB3aGlsZSBwdWJsaXNoaW5nIHRoZWlyIE5QTSBtb2R1bGUuXG4gICAgICAvLyBJZiB0aGVzZSBhcmUgbm90IHNpZ25lZCwgZS5nLiBpbiBjYXNlIG9mIEVzcHJlc3NvLCB0aGVuIHRoZSBuZXh0IHN0ZXAocylcbiAgICAgIC8vIHdvdWxkIGFueXdheSBmYWlsLlxuICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2lzc3Vlcy8xNDcyNCBmb3IgbW9yZSBkZXRhaWxzLlxuICAgICAgbG9nLndhcm4oZXJyTXNnKTtcbiAgICAgIGxvZy53YXJuKGBBc3N1bWluZyAnJHthcHBQYXRofScgaXMgYWxyZWFkeSBzaWduZWQgYW5kIGNvbnRpbnVpbmcgYW55d2F5YCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgdmVyaWZ5IHRoZSBzaWduYXR1cmUgb2YgJyR7YXBwUGF0aH0nLiBgICtcbiAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlcnJNc2d9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gS2V5c3RvcmVIYXNoXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IG1kNSB0aGUgbWQ1IGhhc2ggdmFsdWUgb2YgdGhlIGtleXN0b3JlXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHNoYTEgdGhlIHNoYTEgaGFzaCB2YWx1ZSBvZiB0aGUga2V5c3RvcmVcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gc2hhMjU2IHRoZSBzaGEyNTYgaGFzaCB2YWx1ZSBvZiB0aGUga2V5c3RvcmVcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gc2hhNTEyIHRoZSBzaGE1MTIgaGFzaCB2YWx1ZSBvZiB0aGUga2V5c3RvcmVcbiAqL1xuXG4vKipcbiAqIFJldHJpZXZlIHRoZSB0aGUgaGFzaCBvZiB0aGUgZ2l2ZW4ga2V5c3RvcmUuXG4gKlxuICogQHJldHVybiB7S2V5c3RvcmVIYXNofVxuICogQHRocm93cyB7RXJyb3J9IElmIGdldHRpbmcga2V5c3RvcmUgaGFzaCBmYWlscy5cbiAqL1xuYXBrU2lnbmluZ01ldGhvZHMuZ2V0S2V5c3RvcmVIYXNoID0gYXN5bmMgZnVuY3Rpb24gZ2V0S2V5c3RvcmVIYXNoICgpIHtcbiAgbG9nLmRlYnVnKGBHZXR0aW5nIGhhc2ggb2YgdGhlICcke3RoaXMua2V5c3RvcmVQYXRofScga2V5c3RvcmVgKTtcbiAgY29uc3Qga2V5dG9vbCA9IHBhdGgucmVzb2x2ZShhd2FpdCBnZXRKYXZhSG9tZSgpLCAnYmluJyxcbiAgICBga2V5dG9vbCR7c3lzdGVtLmlzV2luZG93cygpID8gJy5leGUnIDogJyd9YCk7XG4gIGlmICghYXdhaXQgZnMuZXhpc3RzKGtleXRvb2wpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUga2V5dG9vbCB1dGlsaXR5IGNhbm5vdCBiZSBmb3VuZCBhdCAnJHtrZXl0b29sfSdgKTtcbiAgfVxuICBjb25zdCBhcmdzID0gW1xuICAgICctdicsICctbGlzdCcsXG4gICAgJy1hbGlhcycsIHRoaXMua2V5QWxpYXMsXG4gICAgJy1rZXlzdG9yZScsIHRoaXMua2V5c3RvcmVQYXRoLFxuICAgICctc3RvcmVwYXNzJywgdGhpcy5rZXlzdG9yZVBhc3N3b3JkXG4gIF07XG4gIGxvZy5pbmZvKGBSdW5uaW5nICcke2tleXRvb2x9JyB3aXRoIGFyZ3VtZW50czogJHt1dGlsLnF1b3RlKGFyZ3MpfWApO1xuICB0cnkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYyhrZXl0b29sLCBhcmdzLCB7IHdpbmRvd3NWZXJiYXRpbUFyZ3VtZW50czogc3lzdGVtLmlzV2luZG93cygpIH0pO1xuICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuICAgIGZvciAoY29uc3QgaGFzaE5hbWUgb2YgW1NIQTUxMiwgU0hBMjU2LCBTSEExLCBNRDVdKSB7XG4gICAgICBjb25zdCBoYXNoUmUgPSBuZXcgUmVnRXhwKGBeXFxcXHMqJHtoYXNoTmFtZX06XFxcXHMqKFthLWYwLTk6XSspYCwgJ21pJyk7XG4gICAgICBjb25zdCBtYXRjaCA9IGhhc2hSZS5leGVjKHN0ZG91dCk7XG4gICAgICBpZiAoIW1hdGNoKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgcmVzdWx0W2hhc2hOYW1lXSA9IG1hdGNoWzFdLnJlcGxhY2UoLzovZywgJycpLnRvTG93ZXJDYXNlKCk7XG4gICAgfVxuICAgIGlmIChfLmlzRW1wdHkocmVzdWx0KSkge1xuICAgICAgbG9nLmRlYnVnKHN0ZG91dCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBwYXJzZSB0aGUgaGFzaCB2YWx1ZSBmcm9tIHRoZSBrZXl0b29sIG91dHB1dCcpO1xuICAgIH1cbiAgICBsb2cuZGVidWcoYEtleXN0b3JlIGhhc2g6ICR7SlNPTi5zdHJpbmdpZnkocmVzdWx0KX1gKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZ2V0IHRoZSBoYXNoIG9mICcke3RoaXMua2V5c3RvcmVQYXRofScga2V5c3RvcmUuIGAgK1xuICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyIHx8IGUubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgYXBrU2lnbmluZ01ldGhvZHM7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBLE1BQU1BLG1CQUFtQixHQUFHQyxhQUFJLENBQUNDLElBQUksQ0FBQyxNQUFNLEVBQUUsYUFBYSxDQUFDO0FBQzVELE1BQU1DLG1CQUFtQixHQUFHRixhQUFJLENBQUNDLElBQUksQ0FBQyxNQUFNLEVBQUUsa0JBQWtCLENBQUM7QUFDakUsTUFBTUUsbUJBQW1CLEdBQUcsOERBQThEO0FBQzFGLE1BQU1DLHFCQUFxQixHQUFHLGlCQUFpQjtBQUMvQyxNQUFNQyxJQUFJLEdBQUcsTUFBTTtBQUNuQixNQUFNQyxNQUFNLEdBQUcsUUFBUTtBQUN2QixNQUFNQyxNQUFNLEdBQUcsUUFBUTtBQUN2QixNQUFNQyxHQUFHLEdBQUcsS0FBSztBQUNqQixNQUFNQyxpQkFBaUIsR0FBRztFQUN4QixDQUFDSCxNQUFNLEdBQUc7QUFDWixDQUFDO0FBQ0QsTUFBTUkscUJBQXFCLEdBQUcsa0NBQWtDO0FBQ2hFLE1BQU1DLGlCQUFpQixHQUFHLElBQUlDLGlCQUFHLENBQUM7RUFDaENDLEdBQUcsRUFBRTtBQUNQLENBQUMsQ0FBQztBQUdGLE1BQU1DLGlCQUFpQixHQUFHLENBQUMsQ0FBQztBQVU1QkEsaUJBQWlCLENBQUNDLGdCQUFnQixHQUFHLGVBQWVBLGdCQUFnQixDQUFFQyxJ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