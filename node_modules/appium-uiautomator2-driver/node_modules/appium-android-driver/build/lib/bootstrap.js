"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.COMMAND_TYPES = exports.AndroidBootstrap = void 0;
require("source-map-support/register");
var _uiautomator = _interopRequireDefault(require("./uiautomator"));
var _net = _interopRequireDefault(require("net"));
var _path = _interopRequireDefault(require("path"));
var _lodash = _interopRequireDefault(require("lodash"));
var _driver = require("appium/driver");
var _bluebird = _interopRequireDefault(require("bluebird"));
var _support = require("@appium/support");
const log = _support.logger.getLogger('AndroidBootstrap');
const COMMAND_TYPES = {
  ACTION: 'action',
  SHUTDOWN: 'shutdown'
};
exports.COMMAND_TYPES = COMMAND_TYPES;
const SEND_COMMAND_TIMEOUT = 1 * 60 * 1000;
const getModuleRoot = _lodash.default.memoize(async function getModuleRoot() {
  let currentDir = _path.default.dirname(_path.default.resolve(__filename));
  let isAtFsRoot = false;
  while (!isAtFsRoot) {
    const manifestPath = _path.default.join(currentDir, 'package.json');
    try {
      if ((await _support.fs.exists(manifestPath)) && JSON.parse(await _support.fs.readFile(manifestPath, 'utf8')).name === 'appium-android-driver') {
        return currentDir;
      }
    } catch (ign) {}
    currentDir = _path.default.dirname(currentDir);
    isAtFsRoot = currentDir.length <= _path.default.dirname(currentDir).length;
  }
  throw new Error('Cannot find the root folder of the appium-android-driver Node.js module');
});
class AndroidBootstrap {
  constructor(adb, systemPort = 4724, webSocket = undefined) {
    this.adb = adb;
    this.systemPort = systemPort;
    this.webSocket = webSocket;
    this.ignoreUnexpectedShutdown = false;
  }
  get onUnexpectedShutdown() {
    if (!this._onUnexpectedShutdownPromise) {
      let reject;
      this._onUnexpectedShutdownPromise = new _bluebird.default(function _onUnexpectedShutdownPromise(_resolve, _reject) {
        reject = _reject;
      });
      this._onUnexpectedShutdownPromise.cancel = reject;
    }
    return this._onUnexpectedShutdownPromise;
  }
  async start(appPackage, disableAndroidWatchers = false, acceptSslCerts = false) {
    try {
      const startDetector = s => /Appium Socket Server Ready/.test(s);
      const bootstrapJar = _path.default.resolve(await getModuleRoot(), 'bootstrap', 'bin', 'AppiumBootstrap.jar');
      await this.init();
      await this.adb.forwardPort(this.systemPort, 4724);
      this.process = await this.uiAutomator.start(bootstrapJar, 'io.appium.android.bootstrap.Bootstrap', startDetector, '-e', 'pkg', appPackage, '-e', 'disableAndroidWatchers', disableAndroidWatchers, '-e', 'acceptSslCerts', acceptSslCerts);
      this.process.on('output', (stdout, stderr) => {
        const alertRe = /Emitting system alert message/;
        if (alertRe.test(stdout)) {
          log.debug('Emitting alert message...');
          if (this.webSocket) {
            this.webSocket.sockets.emit('alert', {
              message: stdout
            });
          }
        }
        let stdoutLines = (stdout || '').split('\n');
        const uiautoLog = /\[APPIUM-UIAUTO\](.+)\[\/APPIUM-UIAUTO\]/;
        for (let line of stdoutLines) {
          if (line.trim()) {
            if (uiautoLog.test(line)) {
              let innerLine = uiautoLog.exec(line)[1].trim();
              let logMethod = log.info.bind(log);
              if (/\[debug\]/.test(innerLine)) {
                logMethod = log.debug.bind(log);
              }
              logMethod(`[BOOTSTRAP LOG] ${innerLine}`);
            } else {
              log.debug(`[UIAUTO STDOUT] ${line}`);
            }
          }
        }
        let stderrLines = (stderr || '').split('\n');
        for (let line of stderrLines) {
          if (line.trim()) {
            log.debug(`[UIAUTO STDERR] ${line}`);
          }
        }
      });
      return await new _bluebird.default((resolve, reject) => {
        try {
          this.socketClient = _net.default.connect(this.systemPort, '127.0.0.1');
          this.socketClient.on('error', err => {
            if (!this.ignoreUnexpectedShutdown) {
              throw new Error(`Android bootstrap socket crashed: ${err}`);
            }
          });
          this.socketClient.once('connect', () => {
            log.info('Android bootstrap socket is now connected');
            resolve();
          });
        } catch (err) {
          reject(err);
        }
      });
    } catch (err) {
      log.errorAndThrow(`Error occured while starting AndroidBootstrap. Original error: ${err}`);
    }
  }
  async sendCommand(type, extra = {}) {
    if (!this.socketClient) {
      throw new Error('Socket connection closed unexpectedly');
    }
    return await new _bluebird.default((resolve, reject) => {
      let cmd = Object.assign({
        cmd: type
      }, extra);
      let cmdJson = `${JSON.stringify(cmd)} \n`;
      log.debug(`Sending command to android: ${_lodash.default.truncate(cmdJson, {
        length: 1000
      }).trim()}`);
      this.socketClient.write(cmdJson);
      this.socketClient.setEncoding('utf8');
      let streamData = '';
      let sendCommandTimeoutHandler = null;
      this.socketClient.on('data', data => {
        if (sendCommandTimeoutHandler) {
          clearTimeout(sendCommandTimeoutHandler);
        }
        log.debug('Received command result from bootstrap');
        try {
          streamData = JSON.parse(streamData + data);
          this.socketClient.removeAllListeners('data');
          if (streamData.status === 0) {
            return resolve(streamData.value);
          }
          reject((0, _driver.errorFromCode)(streamData.status, streamData.value));
        } catch (err) {
          if (!_lodash.default.isString(streamData)) {
            log.error('Got an unexpected error inside socket listener');
            log.error(err.stack);
            return reject((0, _driver.errorFromCode)(13, err.message));
          }
          log.debug(`Stream still not complete, waiting up to ${SEND_COMMAND_TIMEOUT}ms for the data to arrive`);
          streamData += data;
          sendCommandTimeoutHandler = setTimeout(() => {
            const errMsg = `Server socket stopped responding. The recent response was '${streamData}'`;
            log.error(errMsg);
            this.socketClient.removeAllListeners('data');
            reject((0, _driver.errorFromCode)(13, errMsg));
          }, SEND_COMMAND_TIMEOUT);
        }
      });
    });
  }
  async sendAction(action, params = {}) {
    let extra = {
      action,
      params
    };
    return await this.sendCommand(COMMAND_TYPES.ACTION, extra);
  }
  async shutdown() {
    if (!this.uiAutomator) {
      log.warn('Cannot shut down Android bootstrap; it has already shut down');
      return;
    }
    this.uiAutomator.removeAllListeners(_uiautomator.default.EVENT_CHANGED);
    if (this.socketClient) {
      await this.sendCommand(COMMAND_TYPES.SHUTDOWN);
    }
    await this.uiAutomator.shutdown();
    this.uiAutomator = null;
  }
  async init() {
    this.uiAutomator = new _uiautomator.default(this.adb);
    this.uiAutomator.on(_uiautomator.default.EVENT_CHANGED, msg => {
      if (msg.state === _uiautomator.default.STATE_STOPPED) {
        this.uiAutomator = null;
        this.onUnexpectedShutdown.cancel(new Error('UiAUtomator shut down unexpectedly'));
      }
    });
  }
  set ignoreUnexpectedShutdown(ignore) {
    log.debug(`${ignore ? 'Ignoring' : 'Watching for'} bootstrap disconnect`);
    this._ignoreUnexpectedShutdown = ignore;
  }
  get ignoreUnexpectedShutdown() {
    return this._ignoreUnexpectedShutdown;
  }
}
exports.AndroidBootstrap = AndroidBootstrap;
var _default = AndroidBootstrap;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfdWlhdXRvbWF0b3IiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9uZXQiLCJfcGF0aCIsIl9sb2Rhc2giLCJfZHJpdmVyIiwiX2JsdWViaXJkIiwiX3N1cHBvcnQiLCJsb2ciLCJsb2dnZXIiLCJnZXRMb2dnZXIiLCJDT01NQU5EX1RZUEVTIiwiQUNUSU9OIiwiU0hVVERPV04iLCJleHBvcnRzIiwiU0VORF9DT01NQU5EX1RJTUVPVVQiLCJnZXRNb2R1bGVSb290IiwiXyIsIm1lbW9pemUiLCJjdXJyZW50RGlyIiwicGF0aCIsImRpcm5hbWUiLCJyZXNvbHZlIiwiX19maWxlbmFtZSIsImlzQXRGc1Jvb3QiLCJtYW5pZmVzdFBhdGgiLCJqb2luIiwiZnMiLCJleGlzdHMiLCJKU09OIiwicGFyc2UiLCJyZWFkRmlsZSIsIm5hbWUiLCJpZ24iLCJsZW5ndGgiLCJFcnJvciIsIkFuZHJvaWRCb290c3RyYXAiLCJjb25zdHJ1Y3RvciIsImFkYiIsInN5c3RlbVBvcnQiLCJ3ZWJTb2NrZXQiLCJ1bmRlZmluZWQiLCJpZ25vcmVVbmV4cGVjdGVkU2h1dGRvd24iLCJvblVuZXhwZWN0ZWRTaHV0ZG93biIsIl9vblVuZXhwZWN0ZWRTaHV0ZG93blByb21pc2UiLCJyZWplY3QiLCJCIiwiX3Jlc29sdmUiLCJfcmVqZWN0IiwiY2FuY2VsIiwic3RhcnQiLCJhcHBQYWNrYWdlIiwiZGlzYWJsZUFuZHJvaWRXYXRjaGVycyIsImFjY2VwdFNzbENlcnRzIiwic3RhcnREZXRlY3RvciIsInMiLCJ0ZXN0IiwiYm9vdHN0cmFwSmFyIiwiaW5pdCIsImZvcndhcmRQb3J0IiwicHJvY2VzcyIsInVpQXV0b21hdG9yIiwib24iLCJzdGRvdXQiLCJzdGRlcnIiLCJhbGVydFJlIiwiZGVidWciLCJzb2NrZXRzIiwiZW1pdCIsIm1lc3NhZ2UiLCJzdGRvdXRMaW5lcyIsInNwbGl0IiwidWlhdXRvTG9nIiwibGluZSIsInRyaW0iLCJpbm5lckxpbmUiLCJleGVjIiwibG9nTWV0aG9kIiwiaW5mbyIsImJpbmQiLCJzdGRlcnJMaW5lcyIsInNvY2tldENsaWVudCIsIm5ldCIsImNvbm5lY3QiLCJlcnIiLCJvbmNlIiwiZXJyb3JBbmRUaHJvdyIsInNlbmRDb21tYW5kIiwidHlwZSIsImV4dHJhIiwiY21kIiwiT2JqZWN0IiwiYXNzaWduIiwiY21kSnNvbiIsInN0cmluZ2lmeSIsInRydW5jYXRlIiwid3JpdGUiLCJzZXRFbmNvZGluZyIsInN0cmVhbURhdGEiLCJzZW5kQ29tbWFuZFRpbWVvdXRIYW5kbGVyIiwiZGF0YSIsImNsZWFyVGltZW91dCIsInJlbW92ZUFsbExpc3RlbmVycyIsInN0YXR1cyIsInZhbHVlIiwiZXJyb3JGcm9tQ29kZSIsImlzU3RyaW5nIiwiZXJyb3IiLCJzdGFjayIsInNldFRpbWVvdXQiLCJlcnJNc2ciLCJzZW5kQWN0aW9uIiwiYWN0aW9uIiwicGFyYW1zIiwic2h1dGRvd24iLCJ3YXJuIiwiVWlBdXRvbWF0b3IiLCJFVkVOVF9DSEFOR0VEIiwibXNnIiwic3RhdGUiLCJTVEFURV9TVE9QUEVEIiwiaWdub3JlIiwiX2lnbm9yZVVuZXhwZWN0ZWRTaHV0ZG93biIsIl9kZWZhdWx0IiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9ib290c3RyYXAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFVpQXV0b21hdG9yIGZyb20gJy4vdWlhdXRvbWF0b3InO1xuaW1wb3J0IG5ldCBmcm9tICduZXQnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZXJyb3JGcm9tQ29kZSB9IGZyb20gJ2FwcGl1bS9kcml2ZXInO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgbG9nZ2VyLCBmcyB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5cblxuY29uc3QgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignQW5kcm9pZEJvb3RzdHJhcCcpO1xuY29uc3QgQ09NTUFORF9UWVBFUyA9IHtcbiAgQUNUSU9OOiAnYWN0aW9uJyxcbiAgU0hVVERPV046ICdzaHV0ZG93bidcbn07XG5jb25zdCBTRU5EX0NPTU1BTkRfVElNRU9VVCA9IDEgKiA2MCAqIDEwMDA7XG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgcGF0aCB0byB0aGUgY3VycmVudCBtb2R1bGUncyByb290IGZvbGRlclxuICpcbiAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBmdWxsIHBhdGggdG8gbW9kdWxlIHJvb3RcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY3VycmVudCBtb2R1bGUgcm9vdCBmb2xkZXIgY2Fubm90IGJlIGRldGVybWluZWRcbiAqL1xuY29uc3QgZ2V0TW9kdWxlUm9vdCA9IF8ubWVtb2l6ZShhc3luYyBmdW5jdGlvbiBnZXRNb2R1bGVSb290ICgpIHtcbiAgbGV0IGN1cnJlbnREaXIgPSBwYXRoLmRpcm5hbWUocGF0aC5yZXNvbHZlKF9fZmlsZW5hbWUpKTtcbiAgbGV0IGlzQXRGc1Jvb3QgPSBmYWxzZTtcbiAgd2hpbGUgKCFpc0F0RnNSb290KSB7XG4gICAgY29uc3QgbWFuaWZlc3RQYXRoID0gcGF0aC5qb2luKGN1cnJlbnREaXIsICdwYWNrYWdlLmpzb24nKTtcbiAgICB0cnkge1xuICAgICAgaWYgKGF3YWl0IGZzLmV4aXN0cyhtYW5pZmVzdFBhdGgpICYmXG4gICAgICAgICAgSlNPTi5wYXJzZShhd2FpdCBmcy5yZWFkRmlsZShtYW5pZmVzdFBhdGgsICd1dGY4JykpLm5hbWUgPT09ICdhcHBpdW0tYW5kcm9pZC1kcml2ZXInKSB7XG4gICAgICAgIHJldHVybiBjdXJyZW50RGlyO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGlnbikge31cbiAgICBjdXJyZW50RGlyID0gcGF0aC5kaXJuYW1lKGN1cnJlbnREaXIpO1xuICAgIGlzQXRGc1Jvb3QgPSBjdXJyZW50RGlyLmxlbmd0aCA8PSBwYXRoLmRpcm5hbWUoY3VycmVudERpcikubGVuZ3RoO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGZpbmQgdGhlIHJvb3QgZm9sZGVyIG9mIHRoZSBhcHBpdW0tYW5kcm9pZC1kcml2ZXIgTm9kZS5qcyBtb2R1bGUnKTtcbn0pO1xuXG5jbGFzcyBBbmRyb2lkQm9vdHN0cmFwIHtcbiAgY29uc3RydWN0b3IgKGFkYiwgc3lzdGVtUG9ydCA9IDQ3MjQsIHdlYlNvY2tldCA9IHVuZGVmaW5lZCkge1xuICAgIHRoaXMuYWRiID0gYWRiO1xuICAgIHRoaXMuc3lzdGVtUG9ydCA9IHN5c3RlbVBvcnQ7XG4gICAgdGhpcy53ZWJTb2NrZXQgPSB3ZWJTb2NrZXQ7XG4gICAgdGhpcy5pZ25vcmVVbmV4cGVjdGVkU2h1dGRvd24gPSBmYWxzZTtcbiAgfVxuXG4gIGdldCBvblVuZXhwZWN0ZWRTaHV0ZG93biAoKSB7XG4gICAgaWYgKCF0aGlzLl9vblVuZXhwZWN0ZWRTaHV0ZG93blByb21pc2UpIHtcbiAgICAgIGxldCByZWplY3Q7XG4gICAgICB0aGlzLl9vblVuZXhwZWN0ZWRTaHV0ZG93blByb21pc2UgPSBuZXcgQihmdW5jdGlvbiBfb25VbmV4cGVjdGVkU2h1dGRvd25Qcm9taXNlIChfcmVzb2x2ZSwgX3JlamVjdCkge1xuICAgICAgICByZWplY3QgPSBfcmVqZWN0O1xuICAgICAgfSk7XG4gICAgICB0aGlzLl9vblVuZXhwZWN0ZWRTaHV0ZG93blByb21pc2UuY2FuY2VsID0gcmVqZWN0O1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fb25VbmV4cGVjdGVkU2h1dGRvd25Qcm9taXNlO1xuICB9XG5cbiAgYXN5bmMgc3RhcnQgKGFwcFBhY2thZ2UsIGRpc2FibGVBbmRyb2lkV2F0Y2hlcnMgPSBmYWxzZSwgYWNjZXB0U3NsQ2VydHMgPSBmYWxzZSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdGFydERldGVjdG9yID0gKHMpID0+IC9BcHBpdW0gU29ja2V0IFNlcnZlciBSZWFkeS8udGVzdChzKTtcbiAgICAgIGNvbnN0IGJvb3RzdHJhcEphciA9IHBhdGgucmVzb2x2ZShhd2FpdCBnZXRNb2R1bGVSb290KCksICdib290c3RyYXAnLCAnYmluJywgJ0FwcGl1bUJvb3RzdHJhcC5qYXInKTtcblxuICAgICAgYXdhaXQgdGhpcy5pbml0KCk7XG4gICAgICBhd2FpdCB0aGlzLmFkYi5mb3J3YXJkUG9ydCh0aGlzLnN5c3RlbVBvcnQsIDQ3MjQpO1xuICAgICAgdGhpcy5wcm9jZXNzID0gYXdhaXQgdGhpcy51aUF1dG9tYXRvci5zdGFydChcbiAgICAgICAgYm9vdHN0cmFwSmFyLCAnaW8uYXBwaXVtLmFuZHJvaWQuYm9vdHN0cmFwLkJvb3RzdHJhcCcsXG4gICAgICAgIHN0YXJ0RGV0ZWN0b3IsXG4gICAgICAgICctZScsICdwa2cnLCBhcHBQYWNrYWdlLFxuICAgICAgICAnLWUnLCAnZGlzYWJsZUFuZHJvaWRXYXRjaGVycycsIGRpc2FibGVBbmRyb2lkV2F0Y2hlcnMsXG4gICAgICAgICctZScsICdhY2NlcHRTc2xDZXJ0cycsIGFjY2VwdFNzbENlcnRzXG4gICAgICApO1xuXG4gICAgICAvLyBwcm9jZXNzIHRoZSBvdXRwdXRcbiAgICAgIHRoaXMucHJvY2Vzcy5vbignb3V0cHV0JywgKHN0ZG91dCwgc3RkZXJyKSA9PiB7XG4gICAgICAgIGNvbnN0IGFsZXJ0UmUgPSAvRW1pdHRpbmcgc3lzdGVtIGFsZXJ0IG1lc3NhZ2UvO1xuICAgICAgICBpZiAoYWxlcnRSZS50ZXN0KHN0ZG91dCkpIHtcbiAgICAgICAgICBsb2cuZGVidWcoJ0VtaXR0aW5nIGFsZXJ0IG1lc3NhZ2UuLi4nKTtcbiAgICAgICAgICBpZiAodGhpcy53ZWJTb2NrZXQpIHtcbiAgICAgICAgICAgIHRoaXMud2ViU29ja2V0LnNvY2tldHMuZW1pdCgnYWxlcnQnLCB7bWVzc2FnZTogc3Rkb3V0fSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gdGhlIGJvb3RzdHJhcCBsb2dnZXIgd3JhcHMgaXRzIG93biBsb2cgbGluZXMgd2l0aFxuICAgICAgICAvLyBbQVBQSVVNLVVJQVVUT10gLi4uIFtBUFBJVU0tVUlBVVRPXVxuICAgICAgICAvLyBhbmQgbGVhdmVzIGFjdHVhbCBVaUF1dG9tYXRvciBsb2dzIGFzIHRoZXkgYXJlXG4gICAgICAgIGxldCBzdGRvdXRMaW5lcyA9IChzdGRvdXQgfHwgJycpLnNwbGl0KCdcXG4nKTtcbiAgICAgICAgY29uc3QgdWlhdXRvTG9nID0gL1xcW0FQUElVTS1VSUFVVE9cXF0oLispXFxbXFwvQVBQSVVNLVVJQVVUT1xcXS87XG4gICAgICAgIGZvciAobGV0IGxpbmUgb2Ygc3Rkb3V0TGluZXMpIHtcbiAgICAgICAgICBpZiAobGluZS50cmltKCkpIHtcbiAgICAgICAgICAgIGlmICh1aWF1dG9Mb2cudGVzdChsaW5lKSkge1xuICAgICAgICAgICAgICBsZXQgaW5uZXJMaW5lID0gdWlhdXRvTG9nLmV4ZWMobGluZSlbMV0udHJpbSgpO1xuICAgICAgICAgICAgICBsZXQgbG9nTWV0aG9kID0gbG9nLmluZm8uYmluZChsb2cpO1xuICAgICAgICAgICAgICAvLyBpZiB0aGUgYm9vdHN0cmFwIGxvZyBjb25zaWRlcnMgc29tZXRoaW5nIGRlYnVnLCBsb2cgdGhhdCBhc1xuICAgICAgICAgICAgICAvLyBkZWJ1ZyBhbmQgbm90IGluZm9cbiAgICAgICAgICAgICAgaWYgKC9cXFtkZWJ1Z1xcXS8udGVzdChpbm5lckxpbmUpKSB7XG4gICAgICAgICAgICAgICAgbG9nTWV0aG9kID0gbG9nLmRlYnVnLmJpbmQobG9nKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBsb2dNZXRob2QoYFtCT09UU1RSQVAgTE9HXSAke2lubmVyTGluZX1gKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGxvZy5kZWJ1ZyhgW1VJQVVUTyBTVERPVVRdICR7bGluZX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgc3RkZXJyTGluZXMgPSAoc3RkZXJyIHx8ICcnKS5zcGxpdCgnXFxuJyk7XG4gICAgICAgIGZvciAobGV0IGxpbmUgb2Ygc3RkZXJyTGluZXMpIHtcbiAgICAgICAgICBpZiAobGluZS50cmltKCkpIHtcbiAgICAgICAgICAgIGxvZy5kZWJ1ZyhgW1VJQVVUTyBTVERFUlJdICR7bGluZX1gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBvbmx5IHJldHVybiB3aGVuIHRoZSBzb2NrZXQgY2xpZW50IGhhcyBjb25uZWN0ZWRcbiAgICAgIHJldHVybiBhd2FpdCBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdGhpcy5zb2NrZXRDbGllbnQgPSBuZXQuY29ubmVjdCh0aGlzLnN5c3RlbVBvcnQsICcxMjcuMC4wLjEnKTtcbiAgICAgICAgICAvLyBXaW5kb3dzOiB0aGUgc29ja2V0IGVycm9ycyBvdXQgd2hlbiBBREIgcmVzdGFydHMuIExldCdzIGNhdGNoIGl0IHRvIGF2b2lkIGNyYXNoaW5nLlxuICAgICAgICAgIHRoaXMuc29ja2V0Q2xpZW50Lm9uKCdlcnJvcicsIChlcnIpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pZ25vcmVVbmV4cGVjdGVkU2h1dGRvd24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBBbmRyb2lkIGJvb3RzdHJhcCBzb2NrZXQgY3Jhc2hlZDogJHtlcnJ9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhpcy5zb2NrZXRDbGllbnQub25jZSgnY29ubmVjdCcsICgpID0+IHtcbiAgICAgICAgICAgIGxvZy5pbmZvKCdBbmRyb2lkIGJvb3RzdHJhcCBzb2NrZXQgaXMgbm93IGNvbm5lY3RlZCcpO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgRXJyb3Igb2NjdXJlZCB3aGlsZSBzdGFydGluZyBBbmRyb2lkQm9vdHN0cmFwLiBPcmlnaW5hbCBlcnJvcjogJHtlcnJ9YCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VuZENvbW1hbmQgKHR5cGUsIGV4dHJhID0ge30pIHtcbiAgICBpZiAoIXRoaXMuc29ja2V0Q2xpZW50KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NvY2tldCBjb25uZWN0aW9uIGNsb3NlZCB1bmV4cGVjdGVkbHknKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYXdhaXQgbmV3IEIoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgbGV0IGNtZCA9IE9iamVjdC5hc3NpZ24oe2NtZDogdHlwZX0sIGV4dHJhKTtcbiAgICAgIGxldCBjbWRKc29uID0gYCR7SlNPTi5zdHJpbmdpZnkoY21kKX0gXFxuYDtcbiAgICAgIGxvZy5kZWJ1ZyhgU2VuZGluZyBjb21tYW5kIHRvIGFuZHJvaWQ6ICR7Xy50cnVuY2F0ZShjbWRKc29uLCB7bGVuZ3RoOiAxMDAwfSkudHJpbSgpfWApO1xuICAgICAgdGhpcy5zb2NrZXRDbGllbnQud3JpdGUoY21kSnNvbik7XG4gICAgICB0aGlzLnNvY2tldENsaWVudC5zZXRFbmNvZGluZygndXRmOCcpO1xuICAgICAgbGV0IHN0cmVhbURhdGEgPSAnJztcbiAgICAgIGxldCBzZW5kQ29tbWFuZFRpbWVvdXRIYW5kbGVyID0gbnVsbDtcbiAgICAgIHRoaXMuc29ja2V0Q2xpZW50Lm9uKCdkYXRhJywgKGRhdGEpID0+IHtcbiAgICAgICAgaWYgKHNlbmRDb21tYW5kVGltZW91dEhhbmRsZXIpIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQoc2VuZENvbW1hbmRUaW1lb3V0SGFuZGxlcik7XG4gICAgICAgIH1cbiAgICAgICAgbG9nLmRlYnVnKCdSZWNlaXZlZCBjb21tYW5kIHJlc3VsdCBmcm9tIGJvb3RzdHJhcCcpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHN0cmVhbURhdGEgPSBKU09OLnBhcnNlKHN0cmVhbURhdGEgKyBkYXRhKTtcbiAgICAgICAgICAvLyB3ZSBzdWNjZXNzZnVsbHkgcGFyc2VkIEpTT04gc28gd2UndmUgZ290IGFsbCB0aGUgZGF0YSxcbiAgICAgICAgICAvLyByZW1vdmUgdGhlIHNvY2tldCBsaXN0ZW5lciBhbmQgZXZhbHVhdGVcbiAgICAgICAgICB0aGlzLnNvY2tldENsaWVudC5yZW1vdmVBbGxMaXN0ZW5lcnMoJ2RhdGEnKTtcbiAgICAgICAgICBpZiAoc3RyZWFtRGF0YS5zdGF0dXMgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHN0cmVhbURhdGEudmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZWplY3QoZXJyb3JGcm9tQ29kZShzdHJlYW1EYXRhLnN0YXR1cywgc3RyZWFtRGF0YS52YWx1ZSkpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBpZiAoIV8uaXNTdHJpbmcoc3RyZWFtRGF0YSkpIHtcbiAgICAgICAgICAgIGxvZy5lcnJvcignR290IGFuIHVuZXhwZWN0ZWQgZXJyb3IgaW5zaWRlIHNvY2tldCBsaXN0ZW5lcicpO1xuICAgICAgICAgICAgbG9nLmVycm9yKGVyci5zdGFjayk7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yRnJvbUNvZGUoMTMsIGVyci5tZXNzYWdlKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxvZy5kZWJ1ZyhgU3RyZWFtIHN0aWxsIG5vdCBjb21wbGV0ZSwgd2FpdGluZyB1cCB0byAke1NFTkRfQ09NTUFORF9USU1FT1VUfW1zIGZvciB0aGUgZGF0YSB0byBhcnJpdmVgKTtcbiAgICAgICAgICBzdHJlYW1EYXRhICs9IGRhdGE7XG4gICAgICAgICAgc2VuZENvbW1hbmRUaW1lb3V0SGFuZGxlciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyTXNnID0gYFNlcnZlciBzb2NrZXQgc3RvcHBlZCByZXNwb25kaW5nLiBUaGUgcmVjZW50IHJlc3BvbnNlIHdhcyAnJHtzdHJlYW1EYXRhfSdgO1xuICAgICAgICAgICAgbG9nLmVycm9yKGVyck1zZyk7XG4gICAgICAgICAgICB0aGlzLnNvY2tldENsaWVudC5yZW1vdmVBbGxMaXN0ZW5lcnMoJ2RhdGEnKTtcbiAgICAgICAgICAgIHJlamVjdChlcnJvckZyb21Db2RlKDEzLCBlcnJNc2cpKTtcbiAgICAgICAgICB9LCBTRU5EX0NPTU1BTkRfVElNRU9VVCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc2VuZEFjdGlvbiAoYWN0aW9uLCBwYXJhbXMgPSB7fSkge1xuICAgIGxldCBleHRyYSA9IHthY3Rpb24sIHBhcmFtc307XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuc2VuZENvbW1hbmQoQ09NTUFORF9UWVBFUy5BQ1RJT04sIGV4dHJhKTtcbiAgfVxuXG4gIGFzeW5jIHNodXRkb3duICgpIHtcbiAgICBpZiAoIXRoaXMudWlBdXRvbWF0b3IpIHtcbiAgICAgIGxvZy53YXJuKCdDYW5ub3Qgc2h1dCBkb3duIEFuZHJvaWQgYm9vdHN0cmFwOyBpdCBoYXMgYWxyZWFkeSBzaHV0IGRvd24nKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyByZW1vdmUgbGlzdG5lcnMgc28gd2UgZG9uJ3QgdHJpZ2dlciB1bmV4cGVjdGVkIHNodXRkb3duXG4gICAgdGhpcy51aUF1dG9tYXRvci5yZW1vdmVBbGxMaXN0ZW5lcnMoVWlBdXRvbWF0b3IuRVZFTlRfQ0hBTkdFRCk7XG4gICAgaWYgKHRoaXMuc29ja2V0Q2xpZW50KSB7XG4gICAgICBhd2FpdCB0aGlzLnNlbmRDb21tYW5kKENPTU1BTkRfVFlQRVMuU0hVVERPV04pO1xuICAgIH1cbiAgICBhd2FpdCB0aGlzLnVpQXV0b21hdG9yLnNodXRkb3duKCk7XG4gICAgdGhpcy51aUF1dG9tYXRvciA9IG51bGw7XG4gIH1cblxuICAvLyB0aGlzIGhlbHBlciBmdW5jdGlvbiBtYWtlcyB1bml0IHRlc3RpbmcgZWFzaWVyLlxuICBhc3luYyBpbml0ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhpcy51aUF1dG9tYXRvciA9IG5ldyBVaUF1dG9tYXRvcih0aGlzLmFkYik7XG5cbiAgICAvLyBIYW5kbGUgdW5leHBlY3RlZCBVaUF1dG9tYXRvciBzaHV0ZG93blxuICAgIHRoaXMudWlBdXRvbWF0b3Iub24oVWlBdXRvbWF0b3IuRVZFTlRfQ0hBTkdFRCwgKG1zZykgPT4ge1xuICAgICAgaWYgKG1zZy5zdGF0ZSA9PT0gVWlBdXRvbWF0b3IuU1RBVEVfU1RPUFBFRCkge1xuICAgICAgICB0aGlzLnVpQXV0b21hdG9yID0gbnVsbDtcbiAgICAgICAgdGhpcy5vblVuZXhwZWN0ZWRTaHV0ZG93bi5jYW5jZWwobmV3IEVycm9yKCdVaUFVdG9tYXRvciBzaHV0IGRvd24gdW5leHBlY3RlZGx5JykpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgc2V0IGlnbm9yZVVuZXhwZWN0ZWRTaHV0ZG93biAoaWdub3JlKSB7XG4gICAgbG9nLmRlYnVnKGAke2lnbm9yZSA/ICdJZ25vcmluZycgOiAnV2F0Y2hpbmcgZm9yJ30gYm9vdHN0cmFwIGRpc2Nvbm5lY3RgKTtcbiAgICB0aGlzLl9pZ25vcmVVbmV4cGVjdGVkU2h1dGRvd24gPSBpZ25vcmU7XG4gIH1cblxuICBnZXQgaWdub3JlVW5leHBlY3RlZFNodXRkb3duICgpIHtcbiAgICByZXR1cm4gdGhpcy5faWdub3JlVW5leHBlY3RlZFNodXRkb3duO1xuICB9XG59XG5cbmV4cG9ydCB7IEFuZHJvaWRCb290c3RyYXAsIENPTU1BTkRfVFlQRVMgfTtcbmV4cG9ydCBkZWZhdWx0IEFuZHJvaWRCb290c3RyYXA7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsSUFBQUEsWUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMs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