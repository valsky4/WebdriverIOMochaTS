"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SAFARI_BUNDLE_ID = exports.IPA_EXT = exports.APP_EXT = void 0;
exports.extractBundleId = extractBundleId;
exports.extractBundleVersion = extractBundleVersion;
exports.fetchSupportedAppPlatforms = fetchSupportedAppPlatforms;
exports.findApps = findApps;
exports.isAppBundle = isAppBundle;
exports.isolateAppBundle = isolateAppBundle;
exports.parseLocalizableStrings = parseLocalizableStrings;
exports.verifyApplicationPlatform = verifyApplicationPlatform;
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _path = _interopRequireDefault(require("path"));
var _support = require("appium/support");
var _logger = _interopRequireDefault(require("./logger.js"));
const STRINGSDICT_RESOURCE = '.stringsdict';
const STRINGS_RESOURCE = '.strings';
const SAFARI_BUNDLE_ID = 'com.apple.mobilesafari';
exports.SAFARI_BUNDLE_ID = SAFARI_BUNDLE_ID;
const APP_EXT = '.app';
exports.APP_EXT = APP_EXT;
const IPA_EXT = '.ipa';
exports.IPA_EXT = IPA_EXT;
const PLIST_CACHE = new WeakMap();
async function extractPlistEntry(app, entryName) {
  const plistPath = _path.default.resolve(app, 'Info.plist');
  const parseFile = async () => {
    try {
      return await _support.plist.parsePlistFile(plistPath);
    } catch (err) {
      throw new Error(`Could not extract Info.plist from '${_path.default.basename(app)}': ${err.message}`);
    }
  };
  let plistObj;
  if (_lodash.default.isNil(this)) {
    plistObj = await parseFile();
  } else {
    var _PLIST_CACHE$get;
    plistObj = (_PLIST_CACHE$get = PLIST_CACHE.get(this)) === null || _PLIST_CACHE$get === void 0 ? void 0 : _PLIST_CACHE$get[app];
    if (!plistObj) {
      plistObj = await parseFile();
      PLIST_CACHE.set(this, {
        ...(PLIST_CACHE.get(this) || {}),
        [app]: plistObj
      });
    }
  }
  return plistObj[entryName];
}
async function extractBundleId(app) {
  const bundleId = await extractPlistEntry.bind(this)(app, 'CFBundleIdentifier');
  _logger.default.debug(`Getting bundle ID from app '${app}': '${bundleId}'`);
  return bundleId;
}
async function extractBundleVersion(app) {
  return await extractPlistEntry.bind(this)(app, 'CFBundleVersion');
}
async function fetchSupportedAppPlatforms(app) {
  try {
    const result = await extractPlistEntry.bind(this)(app, 'CFBundleSupportedPlatforms');
    if (!_lodash.default.isArray(result)) {
      _logger.default.warn(`${_path.default.basename(app)}': CFBundleSupportedPlatforms is not a valid list`);
      return [];
    }
    return result;
  } catch (err) {
    _logger.default.warn(`Cannot extract the list of supported platforms from '${_path.default.basename(app)}': ${err.message}`);
    return [];
  }
}
async function verifyApplicationPlatform(app, expectedPlatform) {
  _logger.default.debug('Verifying application platform');
  const supportedPlatforms = await fetchSupportedAppPlatforms.bind(this)(app);
  _logger.default.debug(`CFBundleSupportedPlatforms: ${JSON.stringify(supportedPlatforms)}`);
  const {
    isSimulator,
    isTvOS
  } = expectedPlatform;
  const prefix = isTvOS ? 'AppleTV' : 'iPhone';
  const suffix = isSimulator ? 'Simulator' : 'OS';
  const dstPlatform = `${prefix}${suffix}`;
  if (!supportedPlatforms.includes(dstPlatform)) {
    throw new Error(`${isSimulator ? 'Simulator' : 'Real device'} architecture is unsupported by the '${app}' application. ` + `Make sure the correct deployment target has been selected for its compilation in Xcode.`);
  }
}
async function readResource(resourcePath) {
  const data = await _support.plist.parsePlistFile(resourcePath);
  const result = {};
  for (const [key, value] of _lodash.default.toPairs(data)) {
    result[key] = _lodash.default.isString(value) ? value : JSON.stringify(value);
  }
  return result;
}
async function parseLocalizableStrings(opts) {
  const {
    app,
    language = 'en',
    localizableStringsDir,
    stringFile,
    strictMode
  } = opts;
  if (!app) {
    const message = `Strings extraction is not supported if 'app' capability is not set`;
    if (strictMode) {
      throw new Error(message);
    }
    _logger.default.info(message);
    return {};
  }
  let lprojRoot;
  for (const subfolder of [`${language}.lproj`, localizableStringsDir, '']) {
    lprojRoot = _path.default.resolve(app, subfolder);
    if (await _support.fs.exists(lprojRoot)) {
      break;
    }
    const message = `No '${lprojRoot}' resources folder has been found`;
    if (strictMode) {
      throw new Error(message);
    }
    _logger.default.debug(message);
  }
  _logger.default.info(`Will extract resource strings from '${lprojRoot}'`);
  const resourcePaths = [];
  if (stringFile) {
    const dstPath = _path.default.resolve(lprojRoot, stringFile);
    if (await _support.fs.exists(dstPath)) {
      resourcePaths.push(dstPath);
    } else {
      const message = `No '${dstPath}' resource file has been found for '${app}'`;
      if (strictMode) {
        throw new Error(message);
      }
      _logger.default.info(message);
      _logger.default.info(`Getting all the available strings from '${lprojRoot}'`);
    }
  }
  if (_lodash.default.isEmpty(resourcePaths) && (await _support.fs.exists(lprojRoot))) {
    const resourceFiles = (await _support.fs.readdir(lprojRoot)).filter(name => _lodash.default.some([STRINGS_RESOURCE, STRINGSDICT_RESOURCE], x => name.endsWith(x))).map(name => _path.default.resolve(lprojRoot, name));
    resourcePaths.push(...resourceFiles);
  }
  _logger.default.info(`Got ${resourcePaths.length} resource file(s) in '${lprojRoot}'`);
  if (_lodash.default.isEmpty(resourcePaths)) {
    return {};
  }
  const resultStrings = {};
  const toAbsolutePath = function (p) {
    return _path.default.isAbsolute(p) ? p : _path.default.resolve(process.cwd(), p);
  };
  for (const resourcePath of resourcePaths) {
    if (!_support.util.isSubPath(toAbsolutePath(resourcePath), toAbsolutePath(app))) {
      throw new Error(`'${resourcePath}' is expected to be located under '${app}'`);
    }
    try {
      const data = await readResource(resourcePath);
      _logger.default.debug(`Parsed ${_lodash.default.keys(data).length} string(s) from '${resourcePath}'`);
      _lodash.default.merge(resultStrings, data);
    } catch (e) {
      _logger.default.warn(`Cannot parse '${resourcePath}' resource. Original error: ${e.message}`);
    }
  }
  _logger.default.info(`Got ${_lodash.default.keys(resultStrings).length} string(s) from '${lprojRoot}'`);
  return resultStrings;
}
async function isAppBundle(appPath) {
  return _lodash.default.endsWith(_lodash.default.toLower(appPath), APP_EXT) && (await _support.fs.stat(appPath)).isDirectory() && (await _support.fs.exists(_path.default.join(appPath, 'Info.plist')));
}
async function findApps(archivePath, appExtensions) {
  const useSystemUnzipEnv = process.env.APPIUM_PREFER_SYSTEM_UNZIP;
  const useSystemUnzip = _lodash.default.isEmpty(useSystemUnzipEnv) || !['0', 'false'].includes(_lodash.default.toLower(useSystemUnzipEnv));
  const tmpRoot = await _support.tempDir.openDir();
  await _support.zip.extractAllTo(archivePath, tmpRoot, {
    useSystemUnzip
  });
  const globPattern = `**/*.+(${appExtensions.map(ext => ext.replace(/^\./, '')).join('|')})`;
  const sortedBundleItems = (await _support.fs.glob(globPattern, {
    cwd: tmpRoot,
    strict: false
  })).sort((a, b) => a.split(_path.default.sep).length - b.split(_path.default.sep).length);
  return [tmpRoot, sortedBundleItems];
}
async function isolateAppBundle(appRoot) {
  const tmpRoot = await _support.tempDir.openDir();
  const dstRoot = _path.default.join(tmpRoot, _path.default.basename(appRoot));
  await _support.fs.mv(appRoot, dstRoot, {
    mkdirp: true
  });
  return dstRoot;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfcGF0aCIsIl9zdXBwb3J0IiwiX2xvZ2dlciIsIlNUUklOR1NESUNUX1JFU09VUkNFIiwiU1RSSU5HU19SRVNPVVJDRSIsIlNBRkFSSV9CVU5ETEVfSUQiLCJleHBvcnRzIiwiQVBQX0VYVCIsIklQQV9FWFQiLCJQTElTVF9DQUNIRSIsIldlYWtNYXAiLCJleHRyYWN0UGxpc3RFbnRyeSIsImFwcCIsImVudHJ5TmFtZSIsInBsaXN0UGF0aCIsInBhdGgiLCJyZXNvbHZlIiwicGFyc2VGaWxlIiwicGxpc3QiLCJwYXJzZVBsaXN0RmlsZSIsImVyciIsIkVycm9yIiwiYmFzZW5hbWUiLCJtZXNzYWdlIiwicGxpc3RPYmoiLCJfIiwiaXNOaWwiLCJfUExJU1RfQ0FDSEUkZ2V0IiwiZ2V0Iiwic2V0IiwiZXh0cmFjdEJ1bmRsZUlkIiwiYnVuZGxlSWQiLCJiaW5kIiwibG9nIiwiZGVidWciLCJleHRyYWN0QnVuZGxlVmVyc2lvbiIsImZldGNoU3VwcG9ydGVkQXBwUGxhdGZvcm1zIiwicmVzdWx0IiwiaXNBcnJheSIsIndhcm4iLCJ2ZXJpZnlBcHBsaWNhdGlvblBsYXRmb3JtIiwiZXhwZWN0ZWRQbGF0Zm9ybSIsInN1cHBvcnRlZFBsYXRmb3JtcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJpc1NpbXVsYXRvciIsImlzVHZPUyIsInByZWZpeCIsInN1ZmZpeCIsImRzdFBsYXRmb3JtIiwiaW5jbHVkZXMiLCJyZWFkUmVzb3VyY2UiLCJyZXNvdXJjZVBhdGgiLCJkYXRhIiwia2V5IiwidmFsdWUiLCJ0b1BhaXJzIiwiaXNTdHJpbmciLCJwYXJzZUxvY2FsaXphYmxlU3RyaW5ncyIsIm9wdHMiLCJsYW5ndWFnZSIsImxvY2FsaXphYmxlU3RyaW5nc0RpciIsInN0cmluZ0ZpbGUiLCJzdHJpY3RNb2RlIiwiaW5mbyIsImxwcm9qUm9vdCIsInN1YmZvbGRlciIsImZzIiwiZXhpc3RzIiwicmVzb3VyY2VQYXRocyIsImRzdFBhdGgiLCJwdXNoIiwiaXNFbXB0eSIsInJlc291cmNlRmlsZXMiLCJyZWFkZGlyIiwiZmlsdGVyIiwibmFtZSIsInNvbWUiLCJ4IiwiZW5kc1dpdGgiLCJtYXAiLCJsZW5ndGgiLCJyZXN1bHRTdHJpbmdzIiwidG9BYnNvbHV0ZVBhdGgiLCJwIiwiaXNBYnNvbHV0ZSIsInByb2Nlc3MiLCJjd2QiLCJ1dGlsIiwiaXNTdWJQYXRoIiwia2V5cyIsIm1lcmdlIiwiZSIsImlzQXBwQnVuZGxlIiwiYXBwUGF0aCIsInRvTG93ZXIiLCJzdGF0IiwiaXNEaXJlY3RvcnkiLCJqb2luIiwiZmluZEFwcHMiLCJhcmNoaXZlUGF0aCIsImFwcEV4dGVuc2lvbnMiLCJ1c2VTeXN0ZW1VbnppcEVudiIsImVudiIsIkFQUElVTV9QUkVGRVJfU1lTVEVNX1VOWklQIiwidXNlU3lzdGVtVW56aXAiLCJ0bXBSb290IiwidGVtcERpciIsIm9wZW5EaXIiLCJ6aXAiLCJleHRyYWN0QWxsVG8iLCJnbG9iUGF0dGVybiIsImV4dCIsInJlcGxhY2UiLCJzb3J0ZWRCdW5kbGVJdGVtcyIsImdsb2IiLCJzdHJpY3QiLCJzb3J0IiwiYSIsImIiLCJzcGxpdCIsInNlcCIsImlzb2xhdGVBcHBCdW5kbGUiLCJhcHBSb290IiwiZHN0Um9vdCIsIm12IiwibWtkaXJwIl0sInNvdXJjZXMiOlsiLi4vLi4vbGliL2FwcC11dGlscy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBwbGlzdCwgZnMsIHV0aWwsIHRlbXBEaXIsIHppcCB9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXIuanMnO1xuXG5jb25zdCBTVFJJTkdTRElDVF9SRVNPVVJDRSA9ICcuc3RyaW5nc2RpY3QnO1xuY29uc3QgU1RSSU5HU19SRVNPVVJDRSA9ICcuc3RyaW5ncyc7XG5jb25zdCBTQUZBUklfQlVORExFX0lEID0gJ2NvbS5hcHBsZS5tb2JpbGVzYWZhcmknO1xuY29uc3QgQVBQX0VYVCA9ICcuYXBwJztcbmNvbnN0IElQQV9FWFQgPSAnLmlwYSc7XG5jb25zdCBQTElTVF9DQUNIRSA9IG5ldyBXZWFrTWFwKCk7XG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZW50cnkgbmFtZSBmcm9tIHRoZSBhcHBsaWNhdGlvbidzIEluZm8ucGxpc3QuXG4gKlxuICogQHRoaXMge09iamVjdH0gT3B0aW5hbCBpbnN0YW5jZSB1c2VkIGZvciBjYWNoaW5nLiBVc3VzYWxseSB0aGUgZHJpdmVyIGluc3RhbmNlLlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcCBGdWxsIHBhdGggdG8gdGhlIGFwcCBidW5kbGUgcm9vdC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBlbnRyeU5hbWUgS2V5IG5hbWUgaW4gdGhlIHBsaXN0LlxuICogQHJldHVybnMge1Byb21pc2U8QW55IHwgdW5kZWZpbmVkPn0gRWl0aGVyIHRoZSBleHRyYWN0ZWQgdmFsdWUgb3IgdW5kZWZpbmVkIGlmIG5vIHN1Y2gga2V5IGhhcyBiZWVuIGZvdW5kIGluIHRoZSBwbGlzdC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgYXBwbGljYXRpb24ncyBJbmZvLnBsaXN0IGNhbm5vdCBiZSBwYXJzZWQuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RQbGlzdEVudHJ5IChhcHAsIGVudHJ5TmFtZSkge1xuICBjb25zdCBwbGlzdFBhdGggPSBwYXRoLnJlc29sdmUoYXBwLCAnSW5mby5wbGlzdCcpO1xuXG4gIGNvbnN0IHBhcnNlRmlsZSA9IGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHBsaXN0LnBhcnNlUGxpc3RGaWxlKHBsaXN0UGF0aCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBleHRyYWN0IEluZm8ucGxpc3QgZnJvbSAnJHtwYXRoLmJhc2VuYW1lKGFwcCl9JzogJHtlcnIubWVzc2FnZX1gKTtcbiAgICB9XG4gIH07XG5cbiAgbGV0IHBsaXN0T2JqO1xuICBpZiAoXy5pc05pbCh0aGlzKSkge1xuICAgIHBsaXN0T2JqID0gYXdhaXQgcGFyc2VGaWxlKCk7XG4gIH0gZWxzZSB7XG4gICAgcGxpc3RPYmogPSBQTElTVF9DQUNIRS5nZXQodGhpcyk/LlthcHBdO1xuICAgIGlmICghcGxpc3RPYmopIHtcbiAgICAgIHBsaXN0T2JqID0gYXdhaXQgcGFyc2VGaWxlKCk7XG4gICAgICBQTElTVF9DQUNIRS5zZXQodGhpcywge1xuICAgICAgICAuLi4oUExJU1RfQ0FDSEUuZ2V0KHRoaXMpIHx8IHt9KSxcbiAgICAgICAgW2FwcF06IHBsaXN0T2JqLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHBsaXN0T2JqW2VudHJ5TmFtZV07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RCdW5kbGVJZCAoYXBwKSB7XG4gIGNvbnN0IGJ1bmRsZUlkID0gYXdhaXQgZXh0cmFjdFBsaXN0RW50cnkuYmluZCh0aGlzKShhcHAsICdDRkJ1bmRsZUlkZW50aWZpZXInKTtcbiAgbG9nLmRlYnVnKGBHZXR0aW5nIGJ1bmRsZSBJRCBmcm9tIGFwcCAnJHthcHB9JzogJyR7YnVuZGxlSWR9J2ApO1xuICByZXR1cm4gYnVuZGxlSWQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RCdW5kbGVWZXJzaW9uIChhcHApIHtcbiAgcmV0dXJuIGF3YWl0IGV4dHJhY3RQbGlzdEVudHJ5LmJpbmQodGhpcykoYXBwLCAnQ0ZCdW5kbGVWZXJzaW9uJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZldGNoU3VwcG9ydGVkQXBwUGxhdGZvcm1zIChhcHApIHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBleHRyYWN0UGxpc3RFbnRyeS5iaW5kKHRoaXMpKGFwcCwgJ0NGQnVuZGxlU3VwcG9ydGVkUGxhdGZvcm1zJyk7XG4gICAgaWYgKCFfLmlzQXJyYXkocmVzdWx0KSkge1xuICAgICAgbG9nLndhcm4oYCR7cGF0aC5iYXNlbmFtZShhcHApfSc6IENGQnVuZGxlU3VwcG9ydGVkUGxhdGZvcm1zIGlzIG5vdCBhIHZhbGlkIGxpc3RgKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLndhcm4oXG4gICAgICBgQ2Fubm90IGV4dHJhY3QgdGhlIGxpc3Qgb2Ygc3VwcG9ydGVkIHBsYXRmb3JtcyBmcm9tICcke3BhdGguYmFzZW5hbWUoYXBwKX0nOiAke2Vyci5tZXNzYWdlfWBcbiAgICApO1xuICAgIHJldHVybiBbXTtcbiAgfVxufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFBsYXRmb3JtT3B0c1xuICpcbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gaXNTaW11bGF0b3IgLSBXaGV0aGVyIHRoZSBkZXN0aW5hdGlvbiBwbGF0Zm9ybSBpcyBhIFNpbXVsYXRvclxuICogQHByb3BlcnR5IHtib29sZWFufSBpc1R2T1MgLSBXaGV0aGVyIHRoZSBkZXN0aW5hdGlvbiBwbGF0Zm9ybSBpcyBhIFNpbXVsYXRvclxuICovXG5cbi8qKlxuICogVmVyaWZ5IHdoZXRoZXIgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGlzIGNvbXBhdGlibGUgdG8gdGhlXG4gKiBwbGF0Zm9ybSB3aGVyZSBpdCBpcyBnb2luZyB0byBiZSBpbnN0YWxsZWQgYW5kIHRlc3RlZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwIC0gVGhlIGFjdHVhbCBwYXRoIHRvIHRoZSBhcHBsaWNhdGlvbiBidW5kbGVcbiAqIEBwYXJhbSB7UGxhdGZvcm1PcHRzfSBleHBlY3RlZFBsYXRmb3JtXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgYnVuZGxlIGFyY2hpdGVjdHVyZSBkb2VzIG5vdCBtYXRjaCB0aGUgZXhwZWN0ZWQgZGV2aWNlIGFyY2hpdGVjdHVyZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5QXBwbGljYXRpb25QbGF0Zm9ybSAoYXBwLCBleHBlY3RlZFBsYXRmb3JtKSB7XG4gIGxvZy5kZWJ1ZygnVmVyaWZ5aW5nIGFwcGxpY2F0aW9uIHBsYXRmb3JtJyk7XG5cbiAgY29uc3Qgc3VwcG9ydGVkUGxhdGZvcm1zID0gYXdhaXQgZmV0Y2hTdXBwb3J0ZWRBcHBQbGF0Zm9ybXMuYmluZCh0aGlzKShhcHApO1xuICBsb2cuZGVidWcoYENGQnVuZGxlU3VwcG9ydGVkUGxhdGZvcm1zOiAke0pTT04uc3RyaW5naWZ5KHN1cHBvcnRlZFBsYXRmb3Jtcyl9YCk7XG5cbiAgY29uc3Qge1xuICAgIGlzU2ltdWxhdG9yLFxuICAgIGlzVHZPUyxcbiAgfSA9IGV4cGVjdGVkUGxhdGZvcm07XG4gIGNvbnN0IHByZWZpeCA9IGlzVHZPUyA/ICdBcHBsZVRWJyA6ICdpUGhvbmUnO1xuICBjb25zdCBzdWZmaXggPSBpc1NpbXVsYXRvciA/ICdTaW11bGF0b3InIDogJ09TJztcbiAgY29uc3QgZHN0UGxhdGZvcm0gPSBgJHtwcmVmaXh9JHtzdWZmaXh9YDtcbiAgaWYgKCFzdXBwb3J0ZWRQbGF0Zm9ybXMuaW5jbHVkZXMoZHN0UGxhdGZvcm0pKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke2lzU2ltdWxhdG9yID8gJ1NpbXVsYXRvcicgOiAnUmVhbCBkZXZpY2UnfSBhcmNoaXRlY3R1cmUgaXMgdW5zdXBwb3J0ZWQgYnkgdGhlICcke2FwcH0nIGFwcGxpY2F0aW9uLiBgICtcbiAgICAgIGBNYWtlIHN1cmUgdGhlIGNvcnJlY3QgZGVwbG95bWVudCB0YXJnZXQgaGFzIGJlZW4gc2VsZWN0ZWQgZm9yIGl0cyBjb21waWxhdGlvbiBpbiBYY29kZS5gKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiByZWFkUmVzb3VyY2UgKHJlc291cmNlUGF0aCkge1xuICBjb25zdCBkYXRhID0gYXdhaXQgcGxpc3QucGFyc2VQbGlzdEZpbGUocmVzb3VyY2VQYXRoKTtcbiAgY29uc3QgcmVzdWx0ID0ge307XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIF8udG9QYWlycyhkYXRhKSkge1xuICAgIHJlc3VsdFtrZXldID0gXy5pc1N0cmluZyh2YWx1ZSkgPyB2YWx1ZSA6IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5hc3luYyBmdW5jdGlvbiBwYXJzZUxvY2FsaXphYmxlU3RyaW5ncyAob3B0cykge1xuICBjb25zdCB7XG4gICAgYXBwLFxuICAgIGxhbmd1YWdlID0gJ2VuJyxcbiAgICBsb2NhbGl6YWJsZVN0cmluZ3NEaXIsXG4gICAgc3RyaW5nRmlsZSxcbiAgICBzdHJpY3RNb2RlLFxuICB9ID0gb3B0cztcblxuICBpZiAoIWFwcCkge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBgU3RyaW5ncyBleHRyYWN0aW9uIGlzIG5vdCBzdXBwb3J0ZWQgaWYgJ2FwcCcgY2FwYWJpbGl0eSBpcyBub3Qgc2V0YDtcbiAgICBpZiAoc3RyaWN0TW9kZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBsb2cuaW5mbyhtZXNzYWdlKTtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICBsZXQgbHByb2pSb290O1xuICBmb3IgKGNvbnN0IHN1YmZvbGRlciBvZiBbYCR7bGFuZ3VhZ2V9Lmxwcm9qYCwgbG9jYWxpemFibGVTdHJpbmdzRGlyLCAnJ10pIHtcbiAgICBscHJvalJvb3QgPSBwYXRoLnJlc29sdmUoYXBwLCBzdWJmb2xkZXIpO1xuICAgIGlmIChhd2FpdCBmcy5leGlzdHMobHByb2pSb290KSkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNvbnN0IG1lc3NhZ2UgPSBgTm8gJyR7bHByb2pSb290fScgcmVzb3VyY2VzIGZvbGRlciBoYXMgYmVlbiBmb3VuZGA7XG4gICAgaWYgKHN0cmljdE1vZGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICB9XG4gICAgbG9nLmRlYnVnKG1lc3NhZ2UpO1xuICB9XG4gIGxvZy5pbmZvKGBXaWxsIGV4dHJhY3QgcmVzb3VyY2Ugc3RyaW5ncyBmcm9tICcke2xwcm9qUm9vdH0nYCk7XG5cbiAgY29uc3QgcmVzb3VyY2VQYXRocyA9IFtdO1xuICBpZiAoc3RyaW5nRmlsZSkge1xuICAgIGNvbnN0IGRzdFBhdGggPSBwYXRoLnJlc29sdmUobHByb2pSb290LCBzdHJpbmdGaWxlKTtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKGRzdFBhdGgpKSB7XG4gICAgICByZXNvdXJjZVBhdGhzLnB1c2goZHN0UGF0aCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBgTm8gJyR7ZHN0UGF0aH0nIHJlc291cmNlIGZpbGUgaGFzIGJlZW4gZm91bmQgZm9yICcke2FwcH0nYDtcbiAgICAgIGlmIChzdHJpY3RNb2RlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIGxvZy5pbmZvKG1lc3NhZ2UpO1xuICAgICAgbG9nLmluZm8oYEdldHRpbmcgYWxsIHRoZSBhdmFpbGFibGUgc3RyaW5ncyBmcm9tICcke2xwcm9qUm9vdH0nYCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKF8uaXNFbXB0eShyZXNvdXJjZVBhdGhzKSAmJiBhd2FpdCBmcy5leGlzdHMobHByb2pSb290KSkge1xuICAgIGNvbnN0IHJlc291cmNlRmlsZXMgPSAoYXdhaXQgZnMucmVhZGRpcihscHJvalJvb3QpKVxuICAgICAgLmZpbHRlcigobmFtZSkgPT4gXy5zb21lKFtTVFJJTkdTX1JFU09VUkNFLCBTVFJJTkdTRElDVF9SRVNPVVJDRV0sICh4KSA9PiBuYW1lLmVuZHNXaXRoKHgpKSlcbiAgICAgIC5tYXAoKG5hbWUpID0+IHBhdGgucmVzb2x2ZShscHJvalJvb3QsIG5hbWUpKTtcbiAgICByZXNvdXJjZVBhdGhzLnB1c2goLi4ucmVzb3VyY2VGaWxlcyk7XG4gIH1cbiAgbG9nLmluZm8oYEdvdCAke3Jlc291cmNlUGF0aHMubGVuZ3RofSByZXNvdXJjZSBmaWxlKHMpIGluICcke2xwcm9qUm9vdH0nYCk7XG5cbiAgaWYgKF8uaXNFbXB0eShyZXNvdXJjZVBhdGhzKSkge1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGNvbnN0IHJlc3VsdFN0cmluZ3MgPSB7fTtcbiAgY29uc3QgdG9BYnNvbHV0ZVBhdGggPSBmdW5jdGlvbiAocCkge1xuICAgIHJldHVybiBwYXRoLmlzQWJzb2x1dGUocCkgPyBwIDogcGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksIHApO1xuICB9O1xuICBmb3IgKGNvbnN0IHJlc291cmNlUGF0aCBvZiByZXNvdXJjZVBhdGhzKSB7XG4gICAgaWYgKCF1dGlsLmlzU3ViUGF0aCh0b0Fic29sdXRlUGF0aChyZXNvdXJjZVBhdGgpLCB0b0Fic29sdXRlUGF0aChhcHApKSkge1xuICAgICAgLy8gc2VjdXJpdHkgcHJlY2F1dGlvblxuICAgICAgdGhyb3cgbmV3IEVycm9yKGAnJHtyZXNvdXJjZVBhdGh9JyBpcyBleHBlY3RlZCB0byBiZSBsb2NhdGVkIHVuZGVyICcke2FwcH0nYCk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVhZFJlc291cmNlKHJlc291cmNlUGF0aCk7XG4gICAgICBsb2cuZGVidWcoYFBhcnNlZCAke18ua2V5cyhkYXRhKS5sZW5ndGh9IHN0cmluZyhzKSBmcm9tICcke3Jlc291cmNlUGF0aH0nYCk7XG4gICAgICBfLm1lcmdlKHJlc3VsdFN0cmluZ3MsIGRhdGEpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy53YXJuKGBDYW5ub3QgcGFyc2UgJyR7cmVzb3VyY2VQYXRofScgcmVzb3VyY2UuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICBsb2cuaW5mbyhgR290ICR7Xy5rZXlzKHJlc3VsdFN0cmluZ3MpLmxlbmd0aH0gc3RyaW5nKHMpIGZyb20gJyR7bHByb2pSb290fSdgKTtcbiAgcmV0dXJuIHJlc3VsdFN0cmluZ3M7XG59XG5cbi8qKlxuICogQ2hlY2sgd2hldGhlciB0aGUgZ2l2ZW4gcGF0aCBvbiB0aGUgZmlsZSBzeXN0ZW0gcG9pbnRzIHRvIHRoZSAuYXBwIGJ1bmRsZSByb290XG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggUG9zc2libGUgLmFwcCBidW5kbGUgcm9vdFxuICogQHJldHVybnMge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGdpdmVuIHBhdGggcG9pbnRzIHRvIGFuIC5hcHAgYnVuZGxlXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGlzQXBwQnVuZGxlIChhcHBQYXRoKSB7XG4gIHJldHVybiBfLmVuZHNXaXRoKF8udG9Mb3dlcihhcHBQYXRoKSwgQVBQX0VYVClcbiAgICAmJiAoYXdhaXQgZnMuc3RhdChhcHBQYXRoKSkuaXNEaXJlY3RvcnkoKVxuICAgICYmIGF3YWl0IGZzLmV4aXN0cyhwYXRoLmpvaW4oYXBwUGF0aCwgJ0luZm8ucGxpc3QnKSk7XG59XG5cbi8qKlxuICogRXh0cmFjdCB0aGUgZ2l2ZW4gYXJjaGl2ZSBhbmQgbG9va3MgZm9yIGl0ZW1zIHdpdGggZ2l2ZW4gZXh0ZW5zaW9ucyBpbiBpdFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcmNoaXZlUGF0aCBGdWxsIHBhdGggdG8gYSAuemlwIGFyY2hpdmVcbiAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gYXBwRXh0ZW5zaW9ucyBMaXN0IG9mIG1hdGNoaW5nIGl0ZW0gZXh0ZW5zaW9uc1xuICogQHJldHVybnMge1Byb21pc2U8W3N0cmluZywgc3RyaW5nW11dPn0gVHVwbGUsIHdoZXJlIHRoZSBmaXJzdCBlbGVtZW50IHBvaW50cyB0b1xuICogYSB0ZW1wb3JhcnkgZm9sZGVyIHJvb3Qgd2hlcmUgdGhlIGFyY2hpdmUgaGFzIGJlZW4gZXh0cmFjdGVkIGFuZCB0aGUgc2Vjb25kIGl0ZW1cbiAqIGNvbnRhaW5zIGEgbGlzdCBvZiByZWxhdGl2ZSBwYXRocyB0byBtYXRjaGVkIGl0ZW1zXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGZpbmRBcHBzIChhcmNoaXZlUGF0aCwgYXBwRXh0ZW5zaW9ucykge1xuICBjb25zdCB1c2VTeXN0ZW1VbnppcEVudiA9IHByb2Nlc3MuZW52LkFQUElVTV9QUkVGRVJfU1lTVEVNX1VOWklQO1xuICBjb25zdCB1c2VTeXN0ZW1VbnppcCA9IF8uaXNFbXB0eSh1c2VTeXN0ZW1VbnppcEVudilcbiAgICB8fCAhWycwJywgJ2ZhbHNlJ10uaW5jbHVkZXMoXy50b0xvd2VyKHVzZVN5c3RlbVVuemlwRW52KSk7XG4gIGNvbnN0IHRtcFJvb3QgPSBhd2FpdCB0ZW1wRGlyLm9wZW5EaXIoKTtcbiAgYXdhaXQgemlwLmV4dHJhY3RBbGxUbyhhcmNoaXZlUGF0aCwgdG1wUm9vdCwge3VzZVN5c3RlbVVuemlwfSk7XG4gIGNvbnN0IGdsb2JQYXR0ZXJuID0gYCoqLyouKygke2FwcEV4dGVuc2lvbnMubWFwKChleHQpID0+IGV4dC5yZXBsYWNlKC9eXFwuLywgJycpKS5qb2luKCd8Jyl9KWA7XG4gIGNvbnN0IHNvcnRlZEJ1bmRsZUl0ZW1zID0gKGF3YWl0IGZzLmdsb2IoZ2xvYlBhdHRlcm4sIHtcbiAgICBjd2Q6IHRtcFJvb3QsXG4gICAgc3RyaWN0OiBmYWxzZSxcbiAgfSkpLnNvcnQoKGEsIGIpID0+IGEuc3BsaXQocGF0aC5zZXApLmxlbmd0aCAtIGIuc3BsaXQocGF0aC5zZXApLmxlbmd0aCk7XG4gIHJldHVybiBbdG1wUm9vdCwgc29ydGVkQnVuZGxlSXRlbXNdO1xufVxuXG4vKipcbiAqIE1vdmVzIHRoZSBhcHBsaWNhdGlvbiBidW5kbGUgdG8gYSBuZXdseSBjcmVhdGVkIHRlbXBvcmFyeSBmb2xkZXJcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwUm9vdCBGdWxsIHBhdGggdG8gdGhlIC5hcHAgYnVuZGxlXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSBUaGUgbmV3IHBhdGggdG8gdGhlIGFwcCBidW5kbGUuXG4gKiBUaGUgbmFtZSBvZiB0aGUgYXBwIGJ1bmRsZSByZW1haW5zIHRob3VnaFxuICovXG5hc3luYyBmdW5jdGlvbiBpc29sYXRlQXBwQnVuZGxlIChhcHBSb290KSB7XG4gIGNvbnN0IHRtcFJvb3QgPSBhd2FpdCB0ZW1wRGlyLm9wZW5EaXIoKTtcbiAgY29uc3QgZHN0Um9vdCA9IHBhdGguam9pbih0bXBSb290LCBwYXRoLmJhc2VuYW1lKGFwcFJvb3QpKTtcbiAgYXdhaXQgZnMubXYoYXBwUm9vdCwgZHN0Um9vdCwge21rZGlycDogdHJ1ZX0pO1xuICByZXR1cm4gZHN0Um9vdDtcbn1cblxuZXhwb3J0IHtcbiAgZXh0cmFjdEJ1bmRsZUlkLCB2ZXJpZnlBcHBsaWNhdGlvblBsYXRmb3JtLCBwYXJzZUxvY2FsaXphYmxlU3RyaW5ncyxcbiAgU0FGQVJJX0JVTkRMRV9JRCwgZmV0Y2hTdXBwb3J0ZWRBcHBQbGF0Zm9ybXMsIEFQUF9FWFQsIElQQV9FWFQsXG4gIGlzQXBwQnVuZGxlLCBmaW5kQXBwcywgaXNvbGF0ZUFwcEJ1bmRsZSwgZXh0cmFjdEJ1bmRsZVZlcnNpb24sXG59O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBQUEsT0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsS0FBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsUUFBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsT0FBQSxHQUFBSixzQkFBQSxDQUFBQyxPQUFBO0FBRUEsTUFBTUksb0JBQW9CLEdBQUcsY0FBYztBQUMzQyxNQUFNQyxnQkFBZ0IsR0FBRyxVQUFVO0FBQ25DLE1BQU1DLGdCQUFnQixHQUFHLHdCQUF3QjtBQUFDQyxPQUFBLENBQUFELGdCQUFBLEdBQUFBLGdCQUFBO0FBQ2xELE1BQU1FLE9BQU8sR0FBRyxNQUFNO0FBQUNELE9BQUEsQ0FBQUMsT0FBQSxHQUFBQSxPQUFBO0FBQ3ZCLE1BQU1DLE9BQU8sR0FBRyxNQUFNO0FBQUNGLE9BQUEsQ0FBQUUsT0FBQSxHQUFBQSxPQUFBO0FBQ3ZCLE1BQU1DLFdBQVcsR0FBRyxJQUFJQyxP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