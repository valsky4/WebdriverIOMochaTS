"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _support = require("appium/support");
var _driver = require("appium/driver");
var _appiumIosDevice = require("appium-ios-device");
const commands = {};
function requireOptions(opts = {}, reqKeys = []) {
  for (const key of reqKeys) {
    if (!_lodash.default.isString(opts[key]) || _lodash.default.isEmpty(opts[key])) {
      throw new _driver.errors.InvalidArgumentError(`'${key}' is expected to be a valid string. '${opts[key]}' is given instead`);
    }
  }
  return opts;
}
commands.mobileInstallApp = async function mobileInstallApp(opts = {}) {
  const {
    app,
    timeoutMs,
    strategy
  } = requireOptions(opts, ['app']);
  const srcAppPath = await this.helpers.configureApp(app, '.app');
  this.log.info(`Installing '${srcAppPath}' to the ${this.isRealDevice() ? 'real device' : 'Simulator'} ` + `with UDID '${this.opts.device.udid}'`);
  if (!(await _support.fs.exists(srcAppPath))) {
    this.log.errorAndThrow(`The application at '${srcAppPath}' does not exist or is not accessible`);
  }
  await this.opts.device.installApp(srcAppPath, timeoutMs ?? this.opts.appPushTimeout, strategy ?? this.opts.appInstallStrategy);
  this.log.info(`Installation of '${srcAppPath}' succeeded`);
};
commands.mobileIsAppInstalled = async function mobileIsAppInstalled(opts = {}) {
  const {
    bundleId
  } = requireOptions(opts, ['bundleId']);
  const installed = await this.opts.device.isAppInstalled(bundleId);
  this.log.info(`App '${bundleId}' is${installed ? '' : ' not'} installed`);
  return installed;
};
commands.mobileRemoveApp = async function mobileRemoveApp(opts = {}) {
  const {
    bundleId
  } = requireOptions(opts, ['bundleId']);
  this.log.info(`Uninstalling the application with bundle identifier '${bundleId}' ` + `from the ${this.isRealDevice() ? 'real device' : 'Simulator'} with UDID '${this.opts.device.udid}'`);
  try {
    await this.opts.device.removeApp(bundleId);
    this.log.info(`Removal of '${bundleId}' succeeded`);
    return true;
  } catch (err) {
    this.log.warn(`Cannot remove '${bundleId}'. Original error: ${err.message}`);
    return false;
  }
};
commands.mobileLaunchApp = async function mobileLaunchApp(opts = {}) {
  const launchOptions = requireOptions(opts, ['bundleId']);
  if (opts.arguments) {
    launchOptions.arguments = _lodash.default.isArray(opts.arguments) ? opts.arguments : [opts.arguments];
  }
  if (opts.environment) {
    launchOptions.environment = opts.environment;
  }
  return await this.proxyCommand('/wda/apps/launch', 'POST', launchOptions);
};
commands.mobileTerminateApp = async function mobileTerminateApp(opts = {}) {
  return await this.proxyCommand('/wda/apps/terminate', 'POST', requireOptions(opts, ['bundleId']));
};
commands.mobileActivateApp = async function mobileActivateApp(opts = {}) {
  return await this.proxyCommand('/wda/apps/activate', 'POST', requireOptions(opts, ['bundleId']));
};
commands.mobileKillApp = async function mobileKillApp(opts = {}) {
  if (!this.isRealDevice()) {
    throw new _driver.errors.UnsupportedOperationError('A real device is required');
  }
  const {
    bundleId
  } = requireOptions(opts, ['bundleId']);
  return await this.opts.device.terminateApp(bundleId);
};
commands.mobileQueryAppState = async function mobileQueryAppState(opts = {}) {
  return await this.proxyCommand('/wda/apps/state', 'POST', requireOptions(opts, ['bundleId']));
};
commands.installApp = async function installApp(appPath, opts = {}) {
  await this.mobileInstallApp({
    ...(_lodash.default.isPlainObject(opts) ? opts : {}),
    app: appPath
  });
};
commands.activateApp = async function activateApp(bundleId, opts = {}) {
  return await this.mobileLaunchApp(Object.assign({}, opts, {
    bundleId
  }));
};
commands.isAppInstalled = async function isAppInstalled(bundleId) {
  return await this.mobileIsAppInstalled({
    bundleId
  });
};
commands.terminateApp = async function terminateApp(bundleId) {
  return await this.mobileTerminateApp({
    bundleId
  });
};
commands.queryAppState = async function queryAppState(bundleId) {
  return await this.mobileQueryAppState({
    bundleId
  });
};
commands.mobileListApps = async function mobileListApps(opts = {}) {
  if (!this.isRealDevice()) {
    throw new _driver.errors.NotImplementedError(`This extension is only supported on real devices`);
  }
  const {
    applicationType = 'User'
  } = opts;
  const service = await _appiumIosDevice.services.startInstallationProxyService(this.opts.device.udid);
  try {
    return await service.listApplications({
      applicationType
    });
  } finally {
    service.close();
  }
};
var _default = commands;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfc3VwcG9ydCIsIl9kcml2ZXIiLCJfYXBwaXVtSW9zRGV2aWNlIiwiY29tbWFuZHMiLCJyZXF1aXJlT3B0aW9ucyIsIm9wdHMiLCJyZXFLZXlzIiwia2V5IiwiXyIsImlzU3RyaW5nIiwiaXNFbXB0eSIsImVycm9ycyIsIkludmFsaWRBcmd1bWVudEVycm9yIiwibW9iaWxlSW5zdGFsbEFwcCIsImFwcCIsInRpbWVvdXRNcyIsInN0cmF0ZWd5Iiwic3JjQXBwUGF0aCIsImhlbHBlcnMiLCJjb25maWd1cmVBcHAiLCJsb2ciLCJpbmZvIiwiaXNSZWFsRGV2aWNlIiwiZGV2aWNlIiwidWRpZCIsImZzIiwiZXhpc3RzIiwiZXJyb3JBbmRUaHJvdyIsImluc3RhbGxBcHAiLCJhcHBQdXNoVGltZW91dCIsImFwcEluc3RhbGxTdHJhdGVneSIsIm1vYmlsZUlzQXBwSW5zdGFsbGVkIiwiYnVuZGxlSWQiLCJpbnN0YWxsZWQiLCJpc0FwcEluc3RhbGxlZCIsIm1vYmlsZVJlbW92ZUFwcCIsInJlbW92ZUFwcCIsImVyciIsIndhcm4iLCJtZXNzYWdlIiwibW9iaWxlTGF1bmNoQXBwIiwibGF1bmNoT3B0aW9ucyIsImFyZ3VtZW50cyIsImlzQXJyYXkiLCJlbnZpcm9ubWVudCIsInByb3h5Q29tbWFuZCIsIm1vYmlsZVRlcm1pbmF0ZUFwcCIsIm1vYmlsZUFjdGl2YXRlQXBwIiwibW9iaWxlS2lsbEFwcCIsIlVuc3VwcG9ydGVkT3BlcmF0aW9uRXJyb3IiLCJ0ZXJtaW5hdGVBcHAiLCJtb2JpbGVRdWVyeUFwcFN0YXRlIiwiYXBwUGF0aCIsImlzUGxhaW5PYmplY3QiLCJhY3RpdmF0ZUFwcCIsIk9iamVjdCIsImFzc2lnbiIsInF1ZXJ5QXBwU3RhdGUiLCJtb2JpbGVMaXN0QXBwcyIsIk5vdEltcGxlbWVudGVkRXJyb3IiLCJhcHBsaWNhdGlvblR5cGUiLCJzZXJ2aWNlIiwic2VydmljZXMiLCJzdGFydEluc3RhbGxhdGlvblByb3h5U2VydmljZSIsImxpc3RBcHBsaWNhdGlvbnMiLCJjbG9zZSIsIl9kZWZhdWx0IiwiZXhwb3J0cyIsImRlZmF1bHQiXSwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvY29tbWFuZHMvYXBwLW1hbmFnZW1lbnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGZzIH0gZnJvbSAnYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtL2RyaXZlcic7XG5pbXBvcnQgeyBzZXJ2aWNlcyB9IGZyb20gJ2FwcGl1bS1pb3MtZGV2aWNlJztcblxuY29uc3QgY29tbWFuZHMgPSB7fTtcblxuZnVuY3Rpb24gcmVxdWlyZU9wdGlvbnMgKG9wdHMgPSB7fSwgcmVxS2V5cyA9IFtdKSB7XG4gIGZvciAoY29uc3Qga2V5IG9mIHJlcUtleXMpIHtcbiAgICBpZiAoIV8uaXNTdHJpbmcob3B0c1trZXldKSB8fCBfLmlzRW1wdHkob3B0c1trZXldKSkge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5JbnZhbGlkQXJndW1lbnRFcnJvcihcbiAgICAgICAgYCcke2tleX0nIGlzIGV4cGVjdGVkIHRvIGJlIGEgdmFsaWQgc3RyaW5nLiAnJHtvcHRzW2tleV19JyBpcyBnaXZlbiBpbnN0ZWFkYFxuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG9wdHM7XG59XG5cbmNvbW1hbmRzLm1vYmlsZUluc3RhbGxBcHAgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVJbnN0YWxsQXBwIChvcHRzID0ge30pIHtcbiAgY29uc3QgeyBhcHAsIHRpbWVvdXRNcywgc3RyYXRlZ3kgfSA9IHJlcXVpcmVPcHRpb25zKG9wdHMsIFsnYXBwJ10pO1xuICBjb25zdCBzcmNBcHBQYXRoID0gYXdhaXQgdGhpcy5oZWxwZXJzLmNvbmZpZ3VyZUFwcChhcHAsICcuYXBwJyk7XG4gIHRoaXMubG9nLmluZm8oYEluc3RhbGxpbmcgJyR7c3JjQXBwUGF0aH0nIHRvIHRoZSAke3RoaXMuaXNSZWFsRGV2aWNlKCkgPyAncmVhbCBkZXZpY2UnIDogJ1NpbXVsYXRvcid9IGAgK1xuICAgIGB3aXRoIFVESUQgJyR7dGhpcy5vcHRzLmRldmljZS51ZGlkfSdgKTtcbiAgaWYgKCFhd2FpdCBmcy5leGlzdHMoc3JjQXBwUGF0aCkpIHtcbiAgICB0aGlzLmxvZy5lcnJvckFuZFRocm93KGBUaGUgYXBwbGljYXRpb24gYXQgJyR7c3JjQXBwUGF0aH0nIGRvZXMgbm90IGV4aXN0IG9yIGlzIG5vdCBhY2Nlc3NpYmxlYCk7XG4gIH1cbiAgYXdhaXQgdGhpcy5vcHRzLmRldmljZS5pbnN0YWxsQXBwKFxuICAgIHNyY0FwcFBhdGgsIHRpbWVvdXRNcyA/PyB0aGlzLm9wdHMuYXBwUHVzaFRpbWVvdXQsIHN0cmF0ZWd5ID8/IHRoaXMub3B0cy5hcHBJbnN0YWxsU3RyYXRlZ3lcbiAgKTtcbiAgdGhpcy5sb2cuaW5mbyhgSW5zdGFsbGF0aW9uIG9mICcke3NyY0FwcFBhdGh9JyBzdWNjZWVkZWRgKTtcbn07XG5cbmNvbW1hbmRzLm1vYmlsZUlzQXBwSW5zdGFsbGVkID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlSXNBcHBJbnN0YWxsZWQgKG9wdHMgPSB7fSkge1xuICBjb25zdCB7YnVuZGxlSWR9ID0gcmVxdWlyZU9wdGlvbnMob3B0cywgWydidW5kbGVJZCddKTtcbiAgY29uc3QgaW5zdGFsbGVkID0gYXdhaXQgdGhpcy5vcHRzLmRldmljZS5pc0FwcEluc3RhbGxlZChidW5kbGVJZCk7XG4gIHRoaXMubG9nLmluZm8oYEFwcCAnJHtidW5kbGVJZH0nIGlzJHtpbnN0YWxsZWQgPyAnJyA6ICcgbm90J30gaW5zdGFsbGVkYCk7XG4gIHJldHVybiBpbnN0YWxsZWQ7XG59O1xuXG5jb21tYW5kcy5tb2JpbGVSZW1vdmVBcHAgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVSZW1vdmVBcHAgKG9wdHMgPSB7fSkge1xuICBjb25zdCB7YnVuZGxlSWR9ID0gcmVxdWlyZU9wdGlvbnMob3B0cywgWydidW5kbGVJZCddKTtcbiAgdGhpcy5sb2cuaW5mbyhgVW5pbnN0YWxsaW5nIHRoZSBhcHBsaWNhdGlvbiB3aXRoIGJ1bmRsZSBpZGVudGlmaWVyICcke2J1bmRsZUlkfScgYCArXG4gICAgYGZyb20gdGhlICR7dGhpcy5pc1JlYWxEZXZpY2UoKSA/ICdyZWFsIGRldmljZScgOiAnU2ltdWxhdG9yJ30gd2l0aCBVRElEICcke3RoaXMub3B0cy5kZXZpY2UudWRpZH0nYCk7XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5vcHRzLmRldmljZS5yZW1vdmVBcHAoYnVuZGxlSWQpO1xuICAgIHRoaXMubG9nLmluZm8oYFJlbW92YWwgb2YgJyR7YnVuZGxlSWR9JyBzdWNjZWVkZWRgKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgdGhpcy5sb2cud2FybihgQ2Fubm90IHJlbW92ZSAnJHtidW5kbGVJZH0nLiBPcmlnaW5hbCBlcnJvcjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5cbmNvbW1hbmRzLm1vYmlsZUxhdW5jaEFwcCA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZUxhdW5jaEFwcCAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IGxhdW5jaE9wdGlvbnMgPSByZXF1aXJlT3B0aW9ucyhvcHRzLCBbJ2J1bmRsZUlkJ10pO1xuICBpZiAob3B0cy5hcmd1bWVudHMpIHtcbiAgICBsYXVuY2hPcHRpb25zLmFyZ3VtZW50cyA9IF8uaXNBcnJheShvcHRzLmFyZ3VtZW50cykgPyBvcHRzLmFyZ3VtZW50cyA6IFtvcHRzLmFyZ3VtZW50c107XG4gIH1cbiAgaWYgKG9wdHMuZW52aXJvbm1lbnQpIHtcbiAgICBsYXVuY2hPcHRpb25zLmVudmlyb25tZW50ID0gb3B0cy5lbnZpcm9ubWVudDtcbiAgfVxuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvYXBwcy9sYXVuY2gnLCAnUE9TVCcsIGxhdW5jaE9wdGlvbnMpO1xufTtcblxuY29tbWFuZHMubW9iaWxlVGVybWluYXRlQXBwID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlVGVybWluYXRlQXBwIChvcHRzID0ge30pIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL2FwcHMvdGVybWluYXRlJywgJ1BPU1QnLCByZXF1aXJlT3B0aW9ucyhvcHRzLCBbJ2J1bmRsZUlkJ10pKTtcbn07XG5cbmNvbW1hbmRzLm1vYmlsZUFjdGl2YXRlQXBwID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlQWN0aXZhdGVBcHAgKG9wdHMgPSB7fSkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvYXBwcy9hY3RpdmF0ZScsICdQT1NUJywgcmVxdWlyZU9wdGlvbnMob3B0cywgWydidW5kbGVJZCddKSk7XG59O1xuXG4vKipcbiAqIEtpbGwgdGhlIGdpdmVuIGJ1bmRsZSBpZCBwcm9jZXNzIHZpYSBpbnN0cnVtZW50cyBzZXJ2aWNlLlxuICogaHR0cHM6Ly9naXRodWIuY29tL1l1ZUNoZW4tQy9weS1pb3MtZGV2aWNlL2Jsb2IvNTFmNDY4M2M1YzNjMzg1YTAxNTg1OGFkYTA3YTVmMWM2MmQzY2Y1Ny9pb3NfZGV2aWNlL2NsaS9iYXNlLnB5I0wyMjBcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyAtIE9wdGlvbnMgc2V0LCB3aGljaCBtdXN0IGNvbnRhaW4gYGJ1bmRsZUlkYCBwcm9wZXJ0eVxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgdHJ1ZSBpZiB0aGUgYnVuZGxlIGlkIHByb2Nlc3Mgd2FzIGtpbGxlZC4gT3RoZXJ3aXNlIGZhbHNlLlxuICovXG5jb21tYW5kcy5tb2JpbGVLaWxsQXBwID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlS2lsbEFwcCAob3B0cyA9IHt9KSB7XG4gIGlmICghdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuVW5zdXBwb3J0ZWRPcGVyYXRpb25FcnJvcignQSByZWFsIGRldmljZSBpcyByZXF1aXJlZCcpO1xuICB9XG5cbiAgY29uc3Qge2J1bmRsZUlkfSA9IHJlcXVpcmVPcHRpb25zKG9wdHMsIFsnYnVuZGxlSWQnXSk7XG4gIHJldHVybiBhd2FpdCB0aGlzLm9wdHMuZGV2aWNlLnRlcm1pbmF0ZUFwcChidW5kbGVJZCk7XG59O1xuXG4vKipcbiAqIFJldHVybnMgdGhlIGN1cnJlbnQgYXBwbGljYXRpb24gc3RhdGVcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyAtIE9wdGlvbnMgc2V0LCB3aGljaCBtdXN0IGNvbnRhaW4gYGJ1bmRsZUlkYCBwcm9wZXJ0eVxuICogQHJldHVybnMge251bWJlcn0gVGhlIGFjdHVhbCBhcHBsaWNhdGlvbiBzdGF0ZSBjb2RlLiBTZWVcbiAqIGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9kb2N1bWVudGF0aW9uL3hjdGVzdC94Y3VpYXBwbGljYXRpb25zdGF0ZT9sYW5ndWFnZT1vYmpjXG4gKiB0byBnZXQgdGhlIGxpc3Qgb2YgcG9zc2libGUgdmFsdWVzLlxuICovXG5jb21tYW5kcy5tb2JpbGVRdWVyeUFwcFN0YXRlID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlUXVlcnlBcHBTdGF0ZSAob3B0cyA9IHt9KSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZCgnL3dkYS9hcHBzL3N0YXRlJywgJ1BPU1QnLCByZXF1aXJlT3B0aW9ucyhvcHRzLCBbJ2J1bmRsZUlkJ10pKTtcbn07XG5cbmNvbW1hbmRzLmluc3RhbGxBcHAgPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsQXBwIChhcHBQYXRoLCBvcHRzID0ge30pIHtcbiAgYXdhaXQgdGhpcy5tb2JpbGVJbnN0YWxsQXBwKHtcbiAgICAuLi4oXy5pc1BsYWluT2JqZWN0KG9wdHMpID8gb3B0cyA6IHt9KSxcbiAgICBhcHA6IGFwcFBhdGgsXG4gIH0pO1xufTtcblxuY29tbWFuZHMuYWN0aXZhdGVBcHAgPSBhc3luYyBmdW5jdGlvbiBhY3RpdmF0ZUFwcCAoYnVuZGxlSWQsIG9wdHMgPSB7fSkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5tb2JpbGVMYXVuY2hBcHAoT2JqZWN0LmFzc2lnbih7fSwgb3B0cywge2J1bmRsZUlkfSkpO1xufTtcblxuY29tbWFuZHMuaXNBcHBJbnN0YWxsZWQgPSBhc3luYyBmdW5jdGlvbiBpc0FwcEluc3RhbGxlZCAoYnVuZGxlSWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMubW9iaWxlSXNBcHBJbnN0YWxsZWQoe2J1bmRsZUlkfSk7XG59O1xuXG5jb21tYW5kcy50ZXJtaW5hdGVBcHAgPSBhc3luYyBmdW5jdGlvbiB0ZXJtaW5hdGVBcHAgKGJ1bmRsZUlkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLm1vYmlsZVRlcm1pbmF0ZUFwcCh7YnVuZGxlSWR9KTtcbn07XG5cbmNvbW1hbmRzLnF1ZXJ5QXBwU3RhdGUgPSBhc3luYyBmdW5jdGlvbiBxdWVyeUFwcFN0YXRlIChidW5kbGVJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5tb2JpbGVRdWVyeUFwcFN0YXRlKHtidW5kbGVJZH0pO1xufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBMaXN0QXBwc09wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7J1N5c3RlbSd8J1VzZXInfSBhcHBsaWNhdGlvblR5cGUgW1VzZXJdIFRoZSB0eXBlIG9mIGFwcGxpY2F0aW9ucyB0byBsaXN0XG4gKi9cblxuLyoqXG4gKiBMaXN0IGFwcGxpY2F0aW9ucyBpbnN0YWxsZWQgb24gdGhlIHJlYWwgZGV2aWNlIHVuZGVyIHRlc3RcbiAqXG4gKiBAcGFyYW0ge0xpc3RBcHBzT3B0aW9uc30gb3B0c1xuICogQHJldHVybnMge0FycmF5PE9iamVjdD59IEEgbGlzdCBvZiBhcHBzLCB3aGVyZSBlYWNoIGl0ZW0gaXMgYSBtYXAgd2hlcmUga2V5cyBhcmVcbiAqIGJ1bmRsZSBpZGVudGlmaWVycyBhbmQgdmFsdWVzIGFyZSBtYXBzIG9mIHBsYXRmb3JtLXNwZWNpZmljIGFwcCBwcm9wZXJ0aWVzLlxuICovXG5jb21tYW5kcy5tb2JpbGVMaXN0QXBwcyA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZUxpc3RBcHBzIChvcHRzID0ge30pIHtcbiAgaWYgKCF0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKGBUaGlzIGV4dGVuc2lvbiBpcyBvbmx5IHN1cHBvcnRlZCBvbiByZWFsIGRldmljZXNgKTtcbiAgfVxuXG4gIGNvbnN0IHtcbiAgICBhcHBsaWNhdGlvblR5cGUgPSAnVXNlcicsXG4gIH0gPSBvcHRzO1xuICBjb25zdCBzZXJ2aWNlID0gYXdhaXQgc2VydmljZXMuc3RhcnRJbnN0YWxsYXRpb25Qcm94eVNlcnZpY2UodGhpcy5vcHRzLmRldmljZS51ZGlkKTtcbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgc2VydmljZS5saXN0QXBwbGljYXRpb25zKHthcHBsaWNhdGlvblR5cGV9KTtcbiAgfSBmaW5hbGx5IHtcbiAgICBzZXJ2aWNlLmNsb3NlKCk7XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNvbW1hbmRzO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBLElBQUFBLE9BQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFFBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLE9BQUEsR0FBQUYsT0FBQTtBQUNBLElBQUFHLGdCQUFBLEdBQUFILE9BQUE7QUFFQSxNQUFNSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO0FBRW5CLFNBQVNDLGNBQWNBLENBQUVDLElBQUksR0FBRyxDQUFDLENBQUMsRUFBRUMsT0FBTyxHQUFHLEVBQUUsRUFBRTtFQUNoRCxLQUFLLE1BQU1DLEdBQUcsSUFBSUQsT0FBTyxFQUFFO0lBQ3pCLElBQUksQ0FBQ0UsZUFBQyxDQUFDQyxRQUFRLENBQUNKLElBQUksQ0FBQ0UsR0FBRyxDQUFDLENBQUMsSUFBSUMsZUFBQyxDQUFDRSxPQUFPLENBQUNMLElBQUksQ0FBQ0UsR0FBRyxDQUFDLENB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