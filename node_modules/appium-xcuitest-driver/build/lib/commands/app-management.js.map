{"version":3,"file":"app-management.js","names":["_lodash","_interopRequireDefault","require","_support","_driver","_appiumIosDevice","commands","requireOptions","opts","reqKeys","key","_","isString","isEmpty","errors","InvalidArgumentError","mobileInstallApp","app","timeoutMs","strategy","srcAppPath","helpers","configureApp","log","info","isRealDevice","device","udid","fs","exists","errorAndThrow","installApp","appPushTimeout","appInstallStrategy","mobileIsAppInstalled","bundleId","installed","isAppInstalled","mobileRemoveApp","removeApp","err","warn","message","mobileLaunchApp","launchOptions","arguments","isArray","environment","proxyCommand","mobileTerminateApp","mobileActivateApp","mobileKillApp","UnsupportedOperationError","terminateApp","mobileQueryAppState","appPath","isPlainObject","activateApp","Object","assign","queryAppState","mobileListApps","NotImplementedError","applicationType","service","services","startInstallationProxyService","listApplications","close","_default","exports","default"],"sources":["../../../lib/commands/app-management.js"],"sourcesContent":["import _ from 'lodash';\nimport { fs } from 'appium/support';\nimport { errors } from 'appium/driver';\nimport { services } from 'appium-ios-device';\n\nconst commands = {};\n\nfunction requireOptions (opts = {}, reqKeys = []) {\n  for (const key of reqKeys) {\n    if (!_.isString(opts[key]) || _.isEmpty(opts[key])) {\n      throw new errors.InvalidArgumentError(\n        `'${key}' is expected to be a valid string. '${opts[key]}' is given instead`\n      );\n    }\n  }\n  return opts;\n}\n\ncommands.mobileInstallApp = async function mobileInstallApp (opts = {}) {\n  const { app, timeoutMs, strategy } = requireOptions(opts, ['app']);\n  const srcAppPath = await this.helpers.configureApp(app, '.app');\n  this.log.info(`Installing '${srcAppPath}' to the ${this.isRealDevice() ? 'real device' : 'Simulator'} ` +\n    `with UDID '${this.opts.device.udid}'`);\n  if (!await fs.exists(srcAppPath)) {\n    this.log.errorAndThrow(`The application at '${srcAppPath}' does not exist or is not accessible`);\n  }\n  await this.opts.device.installApp(\n    srcAppPath, timeoutMs ?? this.opts.appPushTimeout, strategy ?? this.opts.appInstallStrategy\n  );\n  this.log.info(`Installation of '${srcAppPath}' succeeded`);\n};\n\ncommands.mobileIsAppInstalled = async function mobileIsAppInstalled (opts = {}) {\n  const {bundleId} = requireOptions(opts, ['bundleId']);\n  const installed = await this.opts.device.isAppInstalled(bundleId);\n  this.log.info(`App '${bundleId}' is${installed ? '' : ' not'} installed`);\n  return installed;\n};\n\ncommands.mobileRemoveApp = async function mobileRemoveApp (opts = {}) {\n  const {bundleId} = requireOptions(opts, ['bundleId']);\n  this.log.info(`Uninstalling the application with bundle identifier '${bundleId}' ` +\n    `from the ${this.isRealDevice() ? 'real device' : 'Simulator'} with UDID '${this.opts.device.udid}'`);\n  try {\n    await this.opts.device.removeApp(bundleId);\n    this.log.info(`Removal of '${bundleId}' succeeded`);\n    return true;\n  } catch (err) {\n    this.log.warn(`Cannot remove '${bundleId}'. Original error: ${err.message}`);\n    return false;\n  }\n};\n\ncommands.mobileLaunchApp = async function mobileLaunchApp (opts = {}) {\n  const launchOptions = requireOptions(opts, ['bundleId']);\n  if (opts.arguments) {\n    launchOptions.arguments = _.isArray(opts.arguments) ? opts.arguments : [opts.arguments];\n  }\n  if (opts.environment) {\n    launchOptions.environment = opts.environment;\n  }\n  return await this.proxyCommand('/wda/apps/launch', 'POST', launchOptions);\n};\n\ncommands.mobileTerminateApp = async function mobileTerminateApp (opts = {}) {\n  return await this.proxyCommand('/wda/apps/terminate', 'POST', requireOptions(opts, ['bundleId']));\n};\n\ncommands.mobileActivateApp = async function mobileActivateApp (opts = {}) {\n  return await this.proxyCommand('/wda/apps/activate', 'POST', requireOptions(opts, ['bundleId']));\n};\n\n/**\n * Kill the given bundle id process via instruments service.\n * https://github.com/YueChen-C/py-ios-device/blob/51f4683c5c3c385a015858ada07a5f1c62d3cf57/ios_device/cli/base.py#L220\n *\n * @param {Object} opts - Options set, which must contain `bundleId` property\n * @returns {boolean} Returns true if the bundle id process was killed. Otherwise false.\n */\ncommands.mobileKillApp = async function mobileKillApp (opts = {}) {\n  if (!this.isRealDevice()) {\n    throw new errors.UnsupportedOperationError('A real device is required');\n  }\n\n  const {bundleId} = requireOptions(opts, ['bundleId']);\n  return await this.opts.device.terminateApp(bundleId);\n};\n\n/**\n * Returns the current application state\n *\n * @param {Object} opts - Options set, which must contain `bundleId` property\n * @returns {number} The actual application state code. See\n * https://developer.apple.com/documentation/xctest/xcuiapplicationstate?language=objc\n * to get the list of possible values.\n */\ncommands.mobileQueryAppState = async function mobileQueryAppState (opts = {}) {\n  return await this.proxyCommand('/wda/apps/state', 'POST', requireOptions(opts, ['bundleId']));\n};\n\ncommands.installApp = async function installApp (appPath, opts = {}) {\n  await this.mobileInstallApp({\n    ...(_.isPlainObject(opts) ? opts : {}),\n    app: appPath,\n  });\n};\n\ncommands.activateApp = async function activateApp (bundleId, opts = {}) {\n  return await this.mobileLaunchApp(Object.assign({}, opts, {bundleId}));\n};\n\ncommands.isAppInstalled = async function isAppInstalled (bundleId) {\n  return await this.mobileIsAppInstalled({bundleId});\n};\n\ncommands.terminateApp = async function terminateApp (bundleId) {\n  return await this.mobileTerminateApp({bundleId});\n};\n\ncommands.queryAppState = async function queryAppState (bundleId) {\n  return await this.mobileQueryAppState({bundleId});\n};\n\n/**\n * @typedef {Object} ListAppsOptions\n * @property {'System'|'User'} applicationType [User] The type of applications to list\n */\n\n/**\n * List applications installed on the real device under test\n *\n * @param {ListAppsOptions} opts\n * @returns {Array<Object>} A list of apps, where each item is a map where keys are\n * bundle identifiers and values are maps of platform-specific app properties.\n */\ncommands.mobileListApps = async function mobileListApps (opts = {}) {\n  if (!this.isRealDevice()) {\n    throw new errors.NotImplementedError(`This extension is only supported on real devices`);\n  }\n\n  const {\n    applicationType = 'User',\n  } = opts;\n  const service = await services.startInstallationProxyService(this.opts.device.udid);\n  try {\n    return await service.listApplications({applicationType});\n  } finally {\n    service.close();\n  }\n};\n\nexport default commands;\n"],"mappings":"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"}