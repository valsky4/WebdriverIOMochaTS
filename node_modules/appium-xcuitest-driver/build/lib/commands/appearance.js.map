{"version":3,"file":"appearance.js","names":["_lodash","_interopRequireDefault","require","_support","commands","exports","mobileSetAppearance","opts","style","includes","_","toLower","Error","util","compareVersions","platformVersion","isSimulator","device","setAppearance","e","log","debug","stack","proxyCommand","name","mobileSiriCommand","text","mobileGetAppearance","getAppearance","ign","userInterfaceStyle","_default","default"],"sources":["../../../lib/commands/appearance.js"],"sourcesContent":["import _ from 'lodash';\nimport { util } from 'appium/support';\n\n\nconst commands = {};\n\n/**\n * @typedef {Object} SetAppearanceOptions\n *\n * @property {string} style - Currently two styles are supported:\n * - dark\n * - light\n */\n\n/**\n * Set the device's UI appearance style\n *\n * @since iOS 12.0\n * @param {SetAppearanceOptions} opts\n * @throws {Error} if the current platform does not support UI\n * appearance changes\n */\ncommands.mobileSetAppearance = async function mobileSetAppearance (opts = {}) {\n  const {\n    style,\n  } = opts;\n  if (!['light', 'dark'].includes(_.toLower(style))) {\n    throw new Error(`The 'style' value is expected to equal either 'light' or 'dark'`);\n  }\n  if (util.compareVersions(this.opts.platformVersion, '<', '12.0')) {\n    throw new Error('Changing appearance is only supported since iOS 12');\n  }\n\n  if (this.isSimulator()) {\n    try {\n      return void (await this.opts.device.setAppearance(style));\n    } catch (e) {\n      this.log.debug(e.stack);\n    }\n  }\n  try {\n    return void (await this.proxyCommand('/wda/device/appearance', 'POST', {name: style}, false));\n  } catch (e) {\n    this.log.debug(e.stack);\n  }\n  // Fall back to the ugly Siri workaround if the current SDK is too old\n  await this.mobileSiriCommand({\n    text: `Turn ${_.toLower(style) === 'dark' ? 'on' : 'off'} dark mode`,\n  });\n};\n\n/**\n * @typedef {Object} Appearance\n * @property {string} style - The device's UI appearance value.\n * This could be one of:\n * - `light`\n * - `dark`\n * - `unknown`\n * - `unsupported`\n */\n\n/**\n * Get the device's UI appearance style.\n *\n * @since Xcode SDK 11\n * @returns {Appearance}\n */\ncommands.mobileGetAppearance = async function mobileGetAppearance () {\n  if (util.compareVersions(this.opts.platformVersion, '<', '12.0')) {\n    return 'unsupported';\n  }\n\n  let style;\n  if (this.isSimulator()) {\n    try {\n      style = await this.opts.device.getAppearance();\n    } catch (ign) {}\n  }\n  if (!style) {\n    style = (await this.proxyCommand('/wda/device/info', 'GET')).userInterfaceStyle || 'unknown';\n  }\n  return {\n    style,\n  };\n};\n\n\nexport { commands };\nexport default commands;\n"],"mappings":";;;;;;;;AAAA,IAAAA,OAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,QAAA,GAAAD,OAAA;AAGA,MAAME,QAAQ,GAAG,CAAC,CAAC;AAACC,OAAA,CAAAD,QAAA,GAAAA,QAAA;AAkBpBA,QAAQ,CAACE,mBAAmB,GAAG,eAAeA,mBAAmBA,CAAEC,IAAI,GAAG,CAAC,CAAC,EAAE;EAC5E,MAAM;IACJC;EACF,CAAC,GAAGD,IAAI;EACR,IAAI,CAAC,CAAC,OAAO,EAAE,MAAM,CAAC,CAACE,QAAQ,CAACC,eAAC,CAACC,OAAO,CAACH,KAAK,CAAC,CAAC,EAAE;IACjD,MAAM,IAAII,KAAK,CAAE,iEAAgE,CAAC;EACpF;EACA,IAAIC,aAAI,CAACC,eAAe,CAAC,IAAI,CAACP,IAAI,CAACQ,eAAe,EAAE,GAAG,EAAE,MAAM,CAAC,EAAE;IAChE,MAAM,IAAIH,KAAK,CAAC,oDAAoD,CAAC;EACvE;EAEA,IAAI,IAAI,CAACI,WAAW,EAAE,EAAE;IACtB,IAAI;MACF,OAAO,MAAM,MAAM,IAAI,CAACT,IAAI,CAACU,MAAM,CAACC,aAAa,CAACV,KAAK,CAAC,CAAC;IAC3D,CAAC,CAAC,OAAOW,CAAC,EAAE;MACV,IAAI,CAACC,GAAG,CAACC,KAAK,CAACF,CAAC,CAACG,KAAK,CAAC;IACzB;EACF;EACA,IAAI;IACF,OAAO,MAAM,MAAM,IAAI,CAACC,YAAY,CAAC,wBAAwB,EAAE,MAAM,EAAE;MAACC,IAAI,EAAEhB;IAAK,CAAC,EAAE,KAAK,CAAC,CAAC;EAC/F,CAAC,CAAC,OAAOW,CAAC,EAAE;IACV,IAAI,CAACC,GAAG,CAACC,KAAK,CAACF,CAAC,CAACG,KAAK,CAAC;EACzB;EAEA,MAAM,IAAI,CAACG,iBAAiB,CAAC;IAC3BC,IAAI,EAAG,QAAOhB,eAAC,CAACC,OAAO,CAACH,KAAK,CAAC,KAAK,MAAM,GAAG,IAAI,GAAG,KAAM;EAC3D,CAAC,CAAC;AACJ,CAAC;AAkBDJ,QAAQ,CAACuB,mBAAmB,GAAG,eAAeA,mBAAmBA,CAAA,EAAI;EACnE,IAAId,aAAI,CAACC,eAAe,CAAC,IAAI,CAACP,IAAI,CAACQ,eAAe,EAAE,GAAG,EAAE,MAAM,CAAC,EAAE;IAChE,OAAO,aAAa;EACtB;EAEA,IAAIP,KAAK;EACT,IAAI,IAAI,CAACQ,WAAW,EAAE,EAAE;IACtB,IAAI;MACFR,KAAK,GAAG,MAAM,IAAI,CAACD,IAAI,CAACU,MAAM,CAACW,aAAa,EAAE;IAChD,CAAC,CAAC,OAAOC,GAAG,EAAE,CAAC;EACjB;EACA,IAAI,CAACrB,KAAK,EAAE;IACVA,KAAK,GAAG,CAAC,MAAM,IAAI,CAACe,YAAY,CAAC,kBAAkB,EAAE,KAAK,CAAC,EAAEO,kBAAkB,IAAI,SAAS;EAC9F;EACA,OAAO;IACLtB;EACF,CAAC;AACH,CAAC;AAAC,IAAAuB,QAAA,GAIa3B,QAAQ;AAAAC,OAAA,CAAA2B,OAAA,GAAAD,QAAA"}