"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _appiumRemoteDebugger = require("appium-remote-debugger");
var _driver = require("appium/driver");
var _support = require("appium/support");
var _bluebird = _interopRequireDefault(require("bluebird"));
var _iosPerformanceLog = _interopRequireDefault(require("../device-log/ios-performance-log"));
var _lodash = _interopRequireDefault(require("lodash"));
const NATIVE_WIN = 'NATIVE_APP';
const WEBVIEW_WIN = 'WEBVIEW';
const WEBVIEW_BASE = `${WEBVIEW_WIN}_`;
const RECENT_WEBVIEW_DETECTION_TIMEOUT_MS = 90000;
const commands = {},
  helpers = {},
  extensions = {};
commands.getCurrentContext = async function getCurrentContext() {
  if (this.curContext && this.curContext !== NATIVE_WIN) {
    return `${WEBVIEW_BASE}${this.curContext}`;
  }
  return NATIVE_WIN;
};
extensions.getContextsAndViews = async function getContextsAndViews(useUrl = true) {
  this.log.debug('Retrieving contexts and views');
  let webviews = await this.listWebFrames(useUrl);
  let ctxs = [{
    id: NATIVE_WIN,
    view: {}
  }];
  this.contexts = [NATIVE_WIN];
  for (let view of webviews) {
    ctxs.push({
      id: `${WEBVIEW_BASE}${view.id}`,
      view
    });
    this.contexts.push(view.id.toString());
  }
  return ctxs;
};
extensions.useNewSafari = function useNewSafari() {
  return !this.isRealDevice() && this.opts.safari;
};
extensions.activateRecentWebview = async function activateRecentWebview() {
  this.log.debug('Activating a recent webview');
  const timer = new _support.timing.Timer().start();
  const spinTimeMs = 500;
  const spinHandles = async () => {
    let contextId;
    try {
      contextId = await this.getRecentWebviewContextId(/.*/, /.*/);
    } catch (err) {
      if (!err.message.includes('Could not connect to a valid app after')) {
        const error = new Error(`Could not navigate to webview! Err: ${err.message}`);
        error.stack += `\nCaused by: ${err.stack}`;
        throw error;
      }
      this.log.debug('Could not navigate to webview. Retrying if possible.');
    }
    if (contextId) {
      this.log.debug(`Picking webview '${contextId}'`);
      await this.setContext(contextId);
      await this.remote.cancelPageLoad();
      return;
    }
    if (timer.getDuration().asMilliSeconds >= RECENT_WEBVIEW_DETECTION_TIMEOUT_MS) {
      throw new Error('Could not navigate to webview; there are none!');
    }
    this.log.warn('Could not find any webviews yet, refreshing/retrying');
    if (this.isRealDevice() || !this.opts.safari) {
      await _bluebird.default.delay(spinTimeMs);
      return await spinHandles();
    }
    let element;
    try {
      this.log.debug('Finding and tapping reload button');
      element = await this.findUIElementOrElements('accessibility id', 'ReloadButton', '', false);
      await this.nativeClick(element);
    } catch (err) {
      this.log.warn(`Error finding and tapping reload button: ${err.message}`);
      this.log.warn('Retrying.');
      await _bluebird.default.delay(spinTimeMs);
    }
    return await spinHandles();
  };
  await spinHandles();
};
helpers.stopRemote = async function stopRemote(closeWindowBeforeDisconnecting = false) {
  if (!this.remote) {
    this.log.errorAndThrow('Tried to leave a web frame but were not in one');
  }
  if (closeWindowBeforeDisconnecting) {
    await this.closeWindow();
  }
  await this.remote.disconnect();
  this.curContext = null;
  this.curWebFrames = [];
  this.curWebCoords = null;
  this.remote = null;
};
helpers.setCurrentUrl = function setCurrentUrl(url) {
  this._currentUrl = url;
};
helpers.getCurrentUrl = function getCurrentUrl() {
  return this._currentUrl;
};
extensions.getRecentWebviewContextId = async function getRecentWebviewContextId(titleRegExp, urlRegExp) {
  var _contexts$find;
  if (!_lodash.default.isRegExp(titleRegExp) && !_lodash.default.isRegExp(urlRegExp)) {
    throw new _driver.errors.InvalidArgumentError('A regular expression for either web view title or url must be provided');
  }
  const currentUrl = this.getCurrentUrl();
  const contexts = _lodash.default.filter(await this.getContextsAndViews(false), 'view');
  if (currentUrl) {
    const ctx = contexts.find(({
      view
    }) => (view.url || '') === currentUrl);
    if (ctx) {
      return ctx.id;
    }
  }
  return (_contexts$find = contexts.find(({
    view
  }) => view.title && (titleRegExp === null || titleRegExp === void 0 ? void 0 : titleRegExp.test(view.title)) || view.url && (urlRegExp === null || urlRegExp === void 0 ? void 0 : urlRegExp.test(view.url)))) === null || _contexts$find === void 0 ? void 0 : _contexts$find.id;
};
extensions.isWebContext = function isWebContext() {
  return !!this.curContext && this.curContext !== NATIVE_WIN;
};
extensions.isWebview = function isWebview() {
  return this.isWebContext();
};
extensions.getNewRemoteDebugger = async function getNewRemoteDebugger() {
  let socketPath;
  if (!this.isRealDevice()) {
    socketPath = await this.opts.device.getWebInspectorSocket();
  }
  return (0, _appiumRemoteDebugger.createRemoteDebugger)({
    bundleId: this.opts.bundleId,
    additionalBundleIds: this.opts.additionalWebviewBundleIds,
    isSafari: this.isSafari(),
    includeSafari: this.opts.includeSafariInWebviews,
    useNewSafari: this.useNewSafari(),
    pageLoadMs: this.pageLoadMs,
    platformVersion: this.opts.platformVersion,
    socketPath,
    remoteDebugProxy: this.opts.remoteDebugProxy,
    garbageCollectOnExecute: _support.util.hasValue(this.opts.safariGarbageCollect) ? !!this.opts.safariGarbageCollect : false,
    udid: this.opts.udid,
    logAllCommunication: this.opts.safariLogAllCommunication,
    logAllCommunicationHexDump: this.opts.safariLogAllCommunicationHexDump,
    socketChunkSize: this.opts.safariSocketChunkSize,
    webInspectorMaxFrameLength: this.opts.safariWebInspectorMaxFrameLength
  }, this.isRealDevice());
};
commands.setContext = async function setContext(name, callback, skipReadyCheck) {
  function alreadyInContext(desired, current) {
    return desired === current || desired === null && current === NATIVE_WIN || desired === NATIVE_WIN && current === null;
  }
  function isNativeContext(context) {
    return context === NATIVE_WIN || context === null;
  }
  if (name && name.id) {
    name = name.id;
  }
  this.log.debug(`Attempting to set context to '${name || NATIVE_WIN}' from '${this.curContext ? this.curContext : NATIVE_WIN}'`);
  if (alreadyInContext(name, this.curContext) || alreadyInContext(_lodash.default.replace(name, WEBVIEW_BASE, ''), this.curContext)) {
    this.log.debug(`Already in '${name || NATIVE_WIN}' context. Doing nothing.`);
    return;
  }
  if (isNativeContext(name)) {
    this.curContext = null;
    return;
  }
  if (_lodash.default.isUndefined(this.contexts)) {
    await this.getContexts();
  }
  let contextId = _lodash.default.replace(name, WEBVIEW_BASE, '');
  if (contextId === '') {
    contextId = this.contexts[1];
  }
  if (!_lodash.default.includes(this.contexts, contextId)) {
    throw new _driver.errors.NoSuchContextError();
  }
  const oldContext = this.curContext;
  this.curContext = this.curWindowHandle = contextId;
  const [appIdKey, pageIdKey] = _lodash.default.map(contextId.split('.'), id => parseInt(id, 10));
  try {
    this.selectingNewPage = true;
    await this.remote.selectPage(appIdKey, pageIdKey, skipReadyCheck);
  } catch (err) {
    this.curContext = this.curWindowHandle = oldContext;
    throw err;
  } finally {
    this.selectingNewPage = false;
  }
  if (this.opts.enablePerformanceLogging && this.remote) {
    this.log.debug(`Starting performance log on '${this.curContext}'`);
    this.logs.performance = new _iosPerformanceLog.default(this.remote);
    await this.logs.performance.startCapture();
  }
  if (name && name !== NATIVE_WIN && this.logs) {
    if (this.logs.safariConsole) {
      await this.remote.startConsole(this.logs.safariConsole.addLogLine.bind(this.logs.safariConsole));
    }
    if (this.logs.safariNetwork) {
      await this.remote.startNetwork(this.logs.safariNetwork.addLogLine.bind(this.logs.safariNetwork));
    }
  }
};
extensions.connectToRemoteDebugger = async function connectToRemoteDebugger() {
  this.remote = await this.getNewRemoteDebugger();
  this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_PAGE_CHANGE, this.onPageChange.bind(this));
  this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_FRAMES_DETACHED, () => {
    if (!_lodash.default.isEmpty(this.curWebFrames)) {
      this.log.debug(`Clearing ${_support.util.pluralize('frame', this.curWebFrames.length, true)}: ${this.curWebFrames.join(', ')}`);
    }
    this.curWebFrames = [];
  });
  await this.remote.connect(this.opts.webviewConnectTimeout);
};
extensions.listWebFrames = async function listWebFrames(useUrl = true) {
  useUrl = useUrl && !this.isRealDevice() && !!this.getCurrentUrl();
  this.log.debug(`Selecting by url: ${useUrl}${useUrl ? ` (expected url: '${this.getCurrentUrl()}')` : ''}`);
  if (!this.remote) {
    await this.connectToRemoteDebugger();
    if (!this.remote.appIdKey) {
      await this.remote.setConnectionKey();
    }
  }
  const getWebviewPages = async () => {
    try {
      return await this.remote.selectApp(useUrl ? this.getCurrentUrl() : undefined, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
    } catch (err) {
      this.log.debug(`No available web pages: ${err.message}`);
      return [];
    }
  };
  const pageArray = await getWebviewPages();
  if (_lodash.default.isEmpty(pageArray)) {
    this.log.debug('No web frames found.');
  }
  return pageArray;
};
commands.getContexts = async function getContexts() {
  this.log.debug('Getting list of available contexts');
  const contexts = await this.getContextsAndViews(false);
  const mapFn = this.opts.fullContextList ? function (context) {
    return {
      id: context.id.toString(),
      title: context.view.title,
      url: context.view.url,
      bundleId: context.view.bundleId
    };
  } : context => context.id.toString();
  return contexts.map(mapFn);
};
extensions.mobileGetContexts = async function mobileGetContexts(opts = {}) {
  let {
    waitForWebviewMs = 0
  } = opts;
  if (!_lodash.default.isNumber(waitForWebviewMs)) {
    waitForWebviewMs = parseInt(waitForWebviewMs, 10);
    if (isNaN(waitForWebviewMs)) {
      waitForWebviewMs = 0;
    }
  }
  const curOpt = this.opts.fullContextList;
  this.opts.fullContextList = true;
  const timer = new _support.timing.Timer().start();
  try {
    let contexts;
    do {
      contexts = await this.getContexts();
      if (contexts.length >= 2) {
        this.log.debug(`Found webview context after ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
        return contexts;
      }
      this.log.debug(`No webviews found in ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
    } while (timer.getDuration().asMilliSeconds < waitForWebviewMs);
    return contexts;
  } finally {
    this.opts.fullContextList = curOpt;
  }
};
commands.setWindow = async function setWindow(name, skipReadyCheck) {
  try {
    await this.setContext(name, _lodash.default.noop, skipReadyCheck);
  } catch (err) {
    throw (0, _driver.isErrorType)(err, _driver.errors.NoSuchContextError) ? new _driver.errors.NoSuchWindowError() : err;
  }
};
commands.getWindowHandle = async function getWindowHandle() {
  if (!this.isWebContext()) {
    throw new _driver.errors.NotImplementedError();
  }
  this.log.debug(`Getting current window handle`);
  return this.curContext;
};
commands.getWindowHandles = async function getWindowHandles() {
  if (!this.isWebContext()) {
    throw new _driver.errors.NotImplementedError();
  }
  this.log.debug('Getting list of available window handles');
  const contexts = await this.getContextsAndViews(false);
  return contexts.filter(context => context.id !== NATIVE_WIN).map(context => context.view.id.toString());
};
extensions.onPageChange = async function onPageChange(pageChangeNotification) {
  this.log.debug(`Remote debugger notified us of a new page listing: ${JSON.stringify(pageChangeNotification)}`);
  if (this.selectingNewPage) {
    this.log.debug('We are in the middle of selecting a page, ignoring');
    return;
  }
  if (!this.remote || !this.remote.isConnected) {
    this.log.debug('We have not yet connected, ignoring');
    return;
  }
  const {
    appIdKey,
    pageArray
  } = pageChangeNotification;
  let newIds = [];
  let newPages = [];
  let keyId = null;
  function isUrlIgnored(url, safariIgnoreWebHostnames) {
    const ignoredHosts = (safariIgnoreWebHostnames || '').split(',').map(b => b.trim()).filter(b => !_lodash.default.isEmpty(b));
    for (const ignoredHost of ignoredHosts) {
      if (ignoredHost === 'about:blank' && url === 'about:blank') {
        return true;
      } else {
        try {
          const hostname = new URL(url).hostname;
          if (hostname === ignoredHost) {
            return true;
          }
        } catch (ign) {}
      }
    }
    return false;
  }
  for (const page of pageArray) {
    const id = page.id.toString();
    newIds.push(id);
    if (page.isKey) {
      keyId = id;
    }
    const contextId = `${appIdKey}.${id}`;
    if (!_lodash.default.includes(this.contexts, contextId)) {
      if (isUrlIgnored(page.url, this.opts.safariIgnoreWebHostnames)) {
        this.log.info(`Not tracking '${page.url}' page because it is blacklisted. ` + `'safariIgnoreWebHostnames'=${this.opts.safariIgnoreWebHostnames}`);
      } else {
        newPages.push(id);
        this.contexts.push(contextId);
      }
    }
  }
  if (!keyId) {
    this.log.debug('No key id found. Choosing first id from page array');
    keyId = newIds[0] || null;
  }
  if (!_support.util.hasValue(this.curContext)) {
    this.log.debug('We do not appear to have window set yet, ignoring');
    return;
  }
  const [curAppIdKey, curPageIdKey] = this.curContext.split('.');
  if (curAppIdKey !== appIdKey) {
    this.log.debug('Page change not referring to currently selected app, ignoring.');
    return;
  }
  let newPage = null;
  if (newPages.length) {
    newPage = _lodash.default.last(newPages);
    this.log.debug(`We have new pages, selecting page '${newPage}'`);
  } else if (!_lodash.default.includes(newIds, curPageIdKey)) {
    this.log.debug('New page listing from remote debugger does not contain ' + 'current window; assuming it is closed');
    if (!_support.util.hasValue(keyId)) {
      this.log.error('Do not have our current window anymore, and there ' + 'are not any more to load! Doing nothing...');
      this.setCurrentUrl(undefined);
      return;
    }
    this.log.debug(`Debugger already selected page '${keyId}', ` + `confirming that choice.`);
    this.curContext = `${appIdKey}.${keyId}`;
    newPage = keyId;
  } else {
    this.log.debug('Checking if page needs to load');
    const needsPageLoad = (() => {
      const contextArray = _lodash.default.map(pageArray, page => `${appIdKey}.${page.id}`);
      return !_lodash.default.isEqual(_lodash.default.find(this.contexts, this.curContext), _lodash.default.find(contextArray, this.curContext));
    })();
    if (needsPageLoad) {
      this.log.debug('Page load needed. Loading...');
      await this.remote.pageLoad();
    }
    this.log.debug('New page listing is same as old, doing nothing');
  }
  if (_support.util.hasValue(this.curContext)) {
    let currentPageId = parseInt(_lodash.default.last(this.curContext.split('.')), 10);
    let page = _lodash.default.find(pageArray, p => parseInt(p.id, 10) === currentPageId);
    if (page && page.url !== this.getCurrentUrl()) {
      this.log.debug(`Redirected from '${this.getCurrentUrl()}' to '${page.url}'`);
      this.setCurrentUrl(page.url);
    }
  }
  if (_support.util.hasValue(newPage)) {
    this.selectingNewPage = true;
    const oldContext = this.curContext;
    this.curContext = `${appIdKey}.${newPage}`;
    this.remote.selectPage(appIdKey, parseInt(newPage, 10)).catch(err => {
      this.log.warn(`Failed to select page: ${err.message}`);
      this.curContext = oldContext;
    });
    this.selectingNewPage = false;
  }
  this.windowHandleCache = pageArray;
};
Object.assign(commands, extensions, helpers);
var _default = commands;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXBwaXVtUmVtb3RlRGVidWdnZXIiLCJyZXF1aXJlIiwiX2RyaXZlciIsIl9zdXBwb3J0IiwiX2JsdWViaXJkIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9pb3NQZXJmb3JtYW5jZUxvZyIsIl9sb2Rhc2giLCJOQVRJVkVfV0lOIiwiV0VCVklFV19XSU4iLCJXRUJWSUVXX0JBU0UiLCJSRUNFTlRfV0VCVklFV19ERVRFQ1RJT05fVElNRU9VVF9NUyIsImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRDdXJyZW50Q29udGV4dCIsImN1ckNvbnRleHQiLCJnZXRDb250ZXh0c0FuZFZpZXdzIiwidXNlVXJsIiwibG9nIiwiZGVidWciLCJ3ZWJ2aWV3cyIsImxpc3RXZWJGcmFtZXMiLCJjdHhzIiwiaWQiLCJ2aWV3IiwiY29udGV4dHMiLCJwdXNoIiwidG9TdHJpbmciLCJ1c2VOZXdTYWZhcmkiLCJpc1JlYWxEZXZpY2UiLCJvcHRzIiwic2FmYXJpIiwiYWN0aXZhdGVSZWNlbnRXZWJ2aWV3IiwidGltZXIiLCJ0aW1pbmciLCJUaW1lciIsInN0YXJ0Iiwic3BpblRpbWVNcyIsInNwaW5IYW5kbGVzIiwiY29udGV4dElkIiwiZ2V0UmVjZW50V2Vidmlld0NvbnRleHRJZCIsImVyciIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsImVycm9yIiwiRXJyb3IiLCJzdGFjayIsInNldENvbnRleHQiLCJyZW1vdGUiLCJjYW5jZWxQYWdlTG9hZCIsImdldER1cmF0aW9uIiwiYXNNaWxsaVNlY29uZHMiLCJ3YXJuIiwiQiIsImRlbGF5IiwiZWxlbWVudCIsImZpbmRVSUVsZW1lbnRPckVsZW1lbnRzIiwibmF0aXZlQ2xpY2siLCJzdG9wUmVtb3RlIiwiY2xvc2VXaW5kb3dCZWZvcmVEaXNjb25uZWN0aW5nIiwiZXJyb3JBbmRUaHJvdyIsImNsb3NlV2luZG93IiwiZGlzY29ubmVjdCIsImN1cldlYkZyYW1lcyIsImN1cldlYkNvb3JkcyIsInNldEN1cnJlbnRVcmwiLCJ1cmwiLCJfY3VycmVudFVybCIsImdldEN1cnJlbnRVcmwiLCJ0aXRsZVJlZ0V4cCIsInVybFJlZ0V4cCIsIl9jb250ZXh0cyRmaW5kIiwiXyIsImlzUmVnRXhwIiwiZXJyb3JzIiwiSW52YWxpZEFyZ3VtZW50RXJyb3IiLCJjdXJyZW50VXJsIiwiZmlsdGVyIiwiY3R4IiwiZmluZCIsInRpdGxlIiwidGVzdCIsImlzV2ViQ29udGV4dCIsImlzV2VidmlldyIsImdldE5ld1JlbW90ZURlYnVnZ2VyIiwic29ja2V0UGF0aCIsImRldmljZSIsImdldFdlYkluc3BlY3RvclNvY2tldCIsImNyZWF0ZVJlbW90ZURlYnVnZ2VyIiwiYnVuZGxlSWQiLCJhZGRpdGlvbmFsQnVuZGxlSWRzIiwiYWRkaXRpb25hbFdlYnZpZXdCdW5kbGVJZHMiLCJpc1NhZmFyaSIsImluY2x1ZGVTYWZhcmkiLCJpbmNsdWRlU2FmYXJpSW5XZWJ2aWV3cyIsInBhZ2VMb2FkTXMiLCJwbGF0Zm9ybVZlcnNpb24iLCJyZW1vdGVEZWJ1Z1Byb3h5IiwiZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUiLCJ1dGlsIiwiaGFzVmFsdWUiLCJzYWZhcmlHYXJiYWdlQ29sbGVjdCIsInVkaWQiLCJsb2dBbGxDb21tdW5pY2F0aW9uIiwic2FmYXJpTG9nQWxsQ29tbXVuaWNhdGlvbiIsImxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wIiwic2FmYXJpTG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXAiLCJzb2NrZXRDaHVua1NpemUiLCJzYWZhcmlTb2NrZXRDaHVua1NpemUiLCJ3ZWJJbnNwZWN0b3JNYXhGcmFtZUxlbmd0aCIsInNhZmFyaVdlYkluc3BlY3Rvck1heEZyYW1lTGVuZ3RoIiwibmFtZSIsImNhbGxiYWNrIiwic2tpcFJlYWR5Q2hlY2siLCJhbHJlYWR5SW5Db250ZXh0IiwiZGVzaXJlZCIsImN1cnJlbnQiLCJpc05hdGl2ZUNvbnRleHQiLCJjb250ZXh0IiwicmVwbGFjZSIsImlzVW5kZWZpbmVkIiwiZ2V0Q29udGV4dHMiLCJOb1N1Y2hDb250ZXh0RXJyb3IiLCJvbGRDb250ZXh0IiwiY3VyV2luZG93SGFuZGxlIiwiYXBwSWRLZXkiLCJwYWdlSWRLZXkiLCJtYXAiLCJzcGxpdCIsInBhcnNlSW50Iiwic2VsZWN0aW5nTmV3UGFnZSIsInNlbGVjdFBhZ2UiLCJlbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmciLCJsb2dzIiwicGVyZm9ybWFuY2UiLCJJT1NQZXJmb3JtYW5jZUxvZyIsInN0YXJ0Q2FwdHVyZSIsInNhZmFyaUNvbnNvbGUiLCJzdGFydENvbnNvbGUiLCJhZGRMb2dMaW5lIiwiYmluZCIsInNhZmFyaU5ldHdvcmsiLCJzdGFydE5ldHdvcmsiLCJjb25uZWN0VG9SZW1vdGVEZWJ1Z2dlciIsIm9uIiwiUmVtb3RlRGVidWdnZXIiLCJFVkVOVF9QQUdFX0NIQU5HRSIsIm9uUGFnZUNoYW5nZSIsIkVWRU5UX0ZSQU1FU19ERVRBQ0hFRCIsImlzRW1wdHkiLCJwbHVyYWxpemUiLCJsZW5ndGgiLCJqb2luIiwiY29ubmVjdCIsIndlYnZpZXdDb25uZWN0VGltZW91dCIsInNldENvbm5lY3Rpb25LZXkiLCJnZXRXZWJ2aWV3UGFnZXMiLCJzZWxlY3RBcHAiLCJ1bmRlZmluZWQiLCJ3ZWJ2aWV3Q29ubmVjdFJldHJpZXMiLCJpZ25vcmVBYm91dEJsYW5rVXJsIiwicGFnZUFycmF5IiwibWFwRm4iLCJmdWxsQ29udGV4dExpc3QiLCJtb2JpbGVHZXRDb250ZXh0cyIsIndhaXRGb3JXZWJ2aWV3TXMiLCJpc051bWJlciIsImlzTmFOIiwiY3VyT3B0IiwidG9GaXhlZCIsInNldFdpbmRvdyIsIm5vb3AiLCJpc0Vycm9yVHlwZSIsIk5vU3VjaFdpbmRvd0Vycm9yIiwiZ2V0V2luZG93SGFuZGxlIiwiTm90SW1wbGVtZW50ZWRFcnJvciIsImdldFdpbmRvd0hhbmRsZXMiLCJwYWdlQ2hhbmdlTm90aWZpY2F0aW9uIiwiSlNPTiIsInN0cmluZ2lmeSIsImlzQ29ubmVjdGVkIiwibmV3SWRzIiwibmV3UGFnZXMiLCJrZXlJZCIsImlzVXJsSWdub3JlZCIsInNhZmFyaUlnbm9yZVdlYkhvc3RuYW1lcyIsImlnbm9yZWRIb3N0cyIsImIiLCJ0cmltIiwiaWdub3JlZEhvc3QiLCJob3N0bmFtZSIsIlVSTCIsImlnbiIsInBhZ2UiLCJpc0tleSIsImluZm8iLCJjdXJBcHBJZEtleSIsImN1clBhZ2VJZEtleSIsIm5ld1BhZ2UiLCJsYXN0IiwibmVlZHNQYWdlTG9hZCIsImNvbnRleHRBcnJheSIsImlzRXF1YWwiLCJwYWdlTG9hZCIsImN1cnJlbnRQYWdlSWQiLCJwIiwiY2F0Y2giLCJ3aW5kb3dIYW5kbGVDYWNoZSIsIk9iamVjdCIsImFzc2lnbiIsIl9kZWZhdWx0IiwiZXhwb3J0cyIsImRlZmF1bHQiXSwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvY29tbWFuZHMvY29udGV4dC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVSZW1vdGVEZWJ1Z2dlciwgUmVtb3RlRGVidWdnZXIgfSBmcm9tICdhcHBpdW0tcmVtb3RlLWRlYnVnZ2VyJztcbmltcG9ydCB7IGVycm9ycywgaXNFcnJvclR5cGUgfSBmcm9tICdhcHBpdW0vZHJpdmVyJztcbmltcG9ydCB7IHV0aWwsIHRpbWluZyB9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBJT1NQZXJmb3JtYW5jZUxvZyBmcm9tICcuLi9kZXZpY2UtbG9nL2lvcy1wZXJmb3JtYW5jZS1sb2cnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuY29uc3QgTkFUSVZFX1dJTiA9ICdOQVRJVkVfQVBQJztcbmNvbnN0IFdFQlZJRVdfV0lOID0gJ1dFQlZJRVcnO1xuY29uc3QgV0VCVklFV19CQVNFID0gYCR7V0VCVklFV19XSU59X2A7XG5jb25zdCBSRUNFTlRfV0VCVklFV19ERVRFQ1RJT05fVElNRU9VVF9NUyA9IDkwMDAwO1xuXG5jb25zdCBjb21tYW5kcyA9IHt9LCBoZWxwZXJzID0ge30sIGV4dGVuc2lvbnMgPSB7fTtcblxuXG5jb21tYW5kcy5nZXRDdXJyZW50Q29udGV4dCA9IGFzeW5jIGZ1bmN0aW9uIGdldEN1cnJlbnRDb250ZXh0ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gIGlmICh0aGlzLmN1ckNvbnRleHQgJiYgdGhpcy5jdXJDb250ZXh0ICE9PSBOQVRJVkVfV0lOKSB7XG4gICAgcmV0dXJuIGAke1dFQlZJRVdfQkFTRX0ke3RoaXMuY3VyQ29udGV4dH1gO1xuICB9XG4gIHJldHVybiBOQVRJVkVfV0lOO1xufTtcblxuZXh0ZW5zaW9ucy5nZXRDb250ZXh0c0FuZFZpZXdzID0gYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGV4dHNBbmRWaWV3cyAodXNlVXJsID0gdHJ1ZSkge1xuICB0aGlzLmxvZy5kZWJ1ZygnUmV0cmlldmluZyBjb250ZXh0cyBhbmQgdmlld3MnKTtcbiAgbGV0IHdlYnZpZXdzID0gYXdhaXQgdGhpcy5saXN0V2ViRnJhbWVzKHVzZVVybCk7XG5cbiAgbGV0IGN0eHMgPSBbe2lkOiBOQVRJVkVfV0lOLCB2aWV3OiB7fX1dO1xuICB0aGlzLmNvbnRleHRzID0gW05BVElWRV9XSU5dO1xuICBmb3IgKGxldCB2aWV3IG9mIHdlYnZpZXdzKSB7XG4gICAgY3R4cy5wdXNoKHtpZDogYCR7V0VCVklFV19CQVNFfSR7dmlldy5pZH1gLCB2aWV3fSk7XG4gICAgdGhpcy5jb250ZXh0cy5wdXNoKHZpZXcuaWQudG9TdHJpbmcoKSk7XG4gIH1cbiAgcmV0dXJuIGN0eHM7XG59O1xuXG4vLyBSaWdodCBub3cgd2UgZG9uJ3QgbmVjZXNzYXJpbHkgd2FpdCBmb3Igd2Vidmlld1xuLy8gYW5kIGZyYW1lIHRvIGxvYWQsIHdoaWNoIGxlYWRzIHRvIHJhY2UgY29uZGl0aW9ucyBhbmQgZmxha2luZXNzLFxuLy8gbGV0J3Mgc2VlIGlmIHdlIGNhbiB0cmFuc2l0aW9uIHRvIHNvbWV0aGluZyBiZXR0ZXJcbmV4dGVuc2lvbnMudXNlTmV3U2FmYXJpID0gZnVuY3Rpb24gdXNlTmV3U2FmYXJpICgpIHtcbiAgcmV0dXJuICF0aGlzLmlzUmVhbERldmljZSgpICYmIHRoaXMub3B0cy5zYWZhcmk7XG59O1xuXG5leHRlbnNpb25zLmFjdGl2YXRlUmVjZW50V2VidmlldyA9IGFzeW5jIGZ1bmN0aW9uIGFjdGl2YXRlUmVjZW50V2VidmlldyAoKSB7XG4gIHRoaXMubG9nLmRlYnVnKCdBY3RpdmF0aW5nIGEgcmVjZW50IHdlYnZpZXcnKTtcbiAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgY29uc3Qgc3BpblRpbWVNcyA9IDUwMDtcbiAgY29uc3Qgc3BpbkhhbmRsZXMgPSBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGNvbnRleHRJZDtcbiAgICB0cnkge1xuICAgICAgY29udGV4dElkID0gYXdhaXQgdGhpcy5nZXRSZWNlbnRXZWJ2aWV3Q29udGV4dElkKC8uKi8sIC8uKi8pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKCFlcnIubWVzc2FnZS5pbmNsdWRlcygnQ291bGQgbm90IGNvbm5lY3QgdG8gYSB2YWxpZCBhcHAgYWZ0ZXInKSkge1xuICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihgQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXchIEVycjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgICAgZXJyb3Iuc3RhY2sgKz0gYFxcbkNhdXNlZCBieTogJHtlcnIuc3RhY2t9YDtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgICB0aGlzLmxvZy5kZWJ1ZygnQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXcuIFJldHJ5aW5nIGlmIHBvc3NpYmxlLicpO1xuICAgIH1cbiAgICBpZiAoY29udGV4dElkKSB7XG4gICAgICB0aGlzLmxvZy5kZWJ1ZyhgUGlja2luZyB3ZWJ2aWV3ICcke2NvbnRleHRJZH0nYCk7XG4gICAgICBhd2FpdCB0aGlzLnNldENvbnRleHQoY29udGV4dElkKTtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmNhbmNlbFBhZ2VMb2FkKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gbm8gd2VidmlldyB3YXMgZm91bmRcbiAgICBpZiAodGltZXIuZ2V0RHVyYXRpb24oKS5hc01pbGxpU2Vjb25kcyA+PSBSRUNFTlRfV0VCVklFV19ERVRFQ1RJT05fVElNRU9VVF9NUykge1xuICAgICAgLy8gdG9vIHNsb3csIGdldCBvdXRcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXc7IHRoZXJlIGFyZSBub25lIScpO1xuICAgIH1cblxuICAgIHRoaXMubG9nLndhcm4oJ0NvdWxkIG5vdCBmaW5kIGFueSB3ZWJ2aWV3cyB5ZXQsIHJlZnJlc2hpbmcvcmV0cnlpbmcnKTtcbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSB8fCAhdGhpcy5vcHRzLnNhZmFyaSkge1xuICAgICAgLy8gb24gYSByZWFsIGRldmljZSwgd2hlbiBub3QgdXNpbmcgU2FmYXJpLCB3ZSBqdXN0IHdhbnQgdG8gdHJ5IGFnYWluXG4gICAgICBhd2FpdCBCLmRlbGF5KHNwaW5UaW1lTXMpO1xuICAgICAgcmV0dXJuIGF3YWl0IHNwaW5IYW5kbGVzKCk7XG4gICAgfVxuXG4gICAgLy8gZmluZCB0aGUgcmVsb2FkIGJ1dHRvbiBhbmQgdGFwIGl0LCBpZiBwb3NzaWJsZVxuICAgIGxldCBlbGVtZW50O1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmxvZy5kZWJ1ZygnRmluZGluZyBhbmQgdGFwcGluZyByZWxvYWQgYnV0dG9uJyk7XG4gICAgICBlbGVtZW50ID0gYXdhaXQgdGhpcy5maW5kVUlFbGVtZW50T3JFbGVtZW50cygnYWNjZXNzaWJpbGl0eSBpZCcsICdSZWxvYWRCdXR0b24nLCAnJywgZmFsc2UpO1xuICAgICAgYXdhaXQgdGhpcy5uYXRpdmVDbGljayhlbGVtZW50KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHRoaXMubG9nLndhcm4oYEVycm9yIGZpbmRpbmcgYW5kIHRhcHBpbmcgcmVsb2FkIGJ1dHRvbjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIHRoaXMubG9nLndhcm4oJ1JldHJ5aW5nLicpO1xuICAgICAgYXdhaXQgQi5kZWxheShzcGluVGltZU1zKTtcbiAgICB9XG5cbiAgICAvLyB0cnkgaXQgYWxsIGFnYWluXG4gICAgcmV0dXJuIGF3YWl0IHNwaW5IYW5kbGVzKCk7XG4gIH07XG4gIGF3YWl0IHNwaW5IYW5kbGVzKCk7XG59O1xuXG5oZWxwZXJzLnN0b3BSZW1vdGUgPSBhc3luYyBmdW5jdGlvbiBzdG9wUmVtb3RlIChjbG9zZVdpbmRvd0JlZm9yZURpc2Nvbm5lY3RpbmcgPSBmYWxzZSkge1xuICBpZiAoIXRoaXMucmVtb3RlKSB7XG4gICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdygnVHJpZWQgdG8gbGVhdmUgYSB3ZWIgZnJhbWUgYnV0IHdlcmUgbm90IGluIG9uZScpO1xuICB9XG5cbiAgaWYgKGNsb3NlV2luZG93QmVmb3JlRGlzY29ubmVjdGluZykge1xuICAgIGF3YWl0IHRoaXMuY2xvc2VXaW5kb3coKTtcbiAgfVxuICBhd2FpdCB0aGlzLnJlbW90ZS5kaXNjb25uZWN0KCk7XG4gIHRoaXMuY3VyQ29udGV4dCA9IG51bGw7XG4gIHRoaXMuY3VyV2ViRnJhbWVzID0gW107XG4gIHRoaXMuY3VyV2ViQ29vcmRzID0gbnVsbDtcbiAgdGhpcy5yZW1vdGUgPSBudWxsO1xufTtcblxuaGVscGVycy5zZXRDdXJyZW50VXJsID0gZnVuY3Rpb24gc2V0Q3VycmVudFVybCAodXJsKSB7XG4gIHRoaXMuX2N1cnJlbnRVcmwgPSB1cmw7XG59O1xuXG5oZWxwZXJzLmdldEN1cnJlbnRVcmwgPSBmdW5jdGlvbiBnZXRDdXJyZW50VXJsICgpIHtcbiAgcmV0dXJuIHRoaXMuX2N1cnJlbnRVcmw7XG59O1xuXG5leHRlbnNpb25zLmdldFJlY2VudFdlYnZpZXdDb250ZXh0SWQgPSBhc3luYyBmdW5jdGlvbiBnZXRSZWNlbnRXZWJ2aWV3Q29udGV4dElkICh0aXRsZVJlZ0V4cCwgdXJsUmVnRXhwKSB7XG4gIGlmICghXy5pc1JlZ0V4cCh0aXRsZVJlZ0V4cCkgJiYgIV8uaXNSZWdFeHAodXJsUmVnRXhwKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZEFyZ3VtZW50RXJyb3IoXG4gICAgICAnQSByZWd1bGFyIGV4cHJlc3Npb24gZm9yIGVpdGhlciB3ZWIgdmlldyB0aXRsZSBvciB1cmwgbXVzdCBiZSBwcm92aWRlZCdcbiAgICApO1xuICB9XG5cbiAgY29uc3QgY3VycmVudFVybCA9IHRoaXMuZ2V0Q3VycmVudFVybCgpO1xuICBjb25zdCBjb250ZXh0cyA9IF8uZmlsdGVyKGF3YWl0IHRoaXMuZ2V0Q29udGV4dHNBbmRWaWV3cyhmYWxzZSksICd2aWV3Jyk7XG4gIC8vIGZpcnN0IHRyeSB0byBtYXRjaCBieSBjdXJyZW50IHVybFxuICBpZiAoY3VycmVudFVybCkge1xuICAgIGNvbnN0IGN0eCA9IGNvbnRleHRzLmZpbmQoKHt2aWV3fSkgPT4gKHZpZXcudXJsIHx8ICcnKSA9PT0gY3VycmVudFVybCk7XG4gICAgaWYgKGN0eCkge1xuICAgICAgcmV0dXJuIGN0eC5pZDtcbiAgICB9XG4gIH1cbiAgLy8gaWYgbm90LCB0cnkgdG8gbWF0Y2ggYnkgcmVndWxhciBleHByZXNzaW9uXG4gIHJldHVybiAoY29udGV4dHMuZmluZCgoe3ZpZXd9KSA9PlxuICAgIHZpZXcudGl0bGUgJiYgdGl0bGVSZWdFeHA/LnRlc3Qodmlldy50aXRsZSkgfHwgdmlldy51cmwgJiYgdXJsUmVnRXhwPy50ZXN0KHZpZXcudXJsKVxuICApKT8uaWQ7XG59O1xuXG5leHRlbnNpb25zLmlzV2ViQ29udGV4dCA9IGZ1bmN0aW9uIGlzV2ViQ29udGV4dCAoKSB7XG4gIHJldHVybiAhIXRoaXMuY3VyQ29udGV4dCAmJiB0aGlzLmN1ckNvbnRleHQgIT09IE5BVElWRV9XSU47XG59O1xuXG5leHRlbnNpb25zLmlzV2VidmlldyA9IGZ1bmN0aW9uIGlzV2VidmlldyAoKSB7XG4gIHJldHVybiB0aGlzLmlzV2ViQ29udGV4dCgpO1xufTtcblxuZXh0ZW5zaW9ucy5nZXROZXdSZW1vdGVEZWJ1Z2dlciA9IGFzeW5jIGZ1bmN0aW9uIGdldE5ld1JlbW90ZURlYnVnZ2VyICgpIHtcbiAgbGV0IHNvY2tldFBhdGg7XG4gIGlmICghdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgIHNvY2tldFBhdGggPSBhd2FpdCB0aGlzLm9wdHMuZGV2aWNlLmdldFdlYkluc3BlY3RvclNvY2tldCgpO1xuICB9XG4gIHJldHVybiBjcmVhdGVSZW1vdGVEZWJ1Z2dlcih7XG4gICAgYnVuZGxlSWQ6IHRoaXMub3B0cy5idW5kbGVJZCxcbiAgICBhZGRpdGlvbmFsQnVuZGxlSWRzOiB0aGlzLm9wdHMuYWRkaXRpb25hbFdlYnZpZXdCdW5kbGVJZHMsXG4gICAgaXNTYWZhcmk6IHRoaXMuaXNTYWZhcmkoKSxcbiAgICBpbmNsdWRlU2FmYXJpOiB0aGlzLm9wdHMuaW5jbHVkZVNhZmFyaUluV2Vidmlld3MsXG4gICAgdXNlTmV3U2FmYXJpOiB0aGlzLnVzZU5ld1NhZmFyaSgpLFxuICAgIHBhZ2VMb2FkTXM6IHRoaXMucGFnZUxvYWRNcyxcbiAgICBwbGF0Zm9ybVZlcnNpb246IHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24sXG4gICAgc29ja2V0UGF0aCxcbiAgICByZW1vdGVEZWJ1Z1Byb3h5OiB0aGlzLm9wdHMucmVtb3RlRGVidWdQcm94eSxcbiAgICBnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZTogdXRpbC5oYXNWYWx1ZSh0aGlzLm9wdHMuc2FmYXJpR2FyYmFnZUNvbGxlY3QpXG4gICAgICA/ICEhdGhpcy5vcHRzLnNhZmFyaUdhcmJhZ2VDb2xsZWN0XG4gICAgICA6IGZhbHNlLFxuICAgIHVkaWQ6IHRoaXMub3B0cy51ZGlkLFxuICAgIGxvZ0FsbENvbW11bmljYXRpb246IHRoaXMub3B0cy5zYWZhcmlMb2dBbGxDb21tdW5pY2F0aW9uLFxuICAgIGxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wOiB0aGlzLm9wdHMuc2FmYXJpTG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXAsXG4gICAgc29ja2V0Q2h1bmtTaXplOiB0aGlzLm9wdHMuc2FmYXJpU29ja2V0Q2h1bmtTaXplLFxuICAgIHdlYkluc3BlY3Rvck1heEZyYW1lTGVuZ3RoOiB0aGlzLm9wdHMuc2FmYXJpV2ViSW5zcGVjdG9yTWF4RnJhbWVMZW5ndGhcbiAgfSwgdGhpcy5pc1JlYWxEZXZpY2UoKSk7XG59O1xuXG4vKipcbiAqIFNldCBjb250ZXh0XG4gKlxuICogQHBhcmFtIHs/c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgY29udGV4dCB0byBzZXQuIEl0IGNvdWxkIGJlICdudWxsJyBhcyBOQVRJVkVfV0lOLlxuICogQHBhcmFtIHtjYWxsYmFja30gY2FsbGJhY2sgVGhlIGNhbGxiYWNrLiAoSXQgaXMgbm90IGNhbGxlZCBpbiB0aGlzIG1ldGhvZClcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gc2tpcFJlYWR5Q2hlY2sgLSBXaGV0aGVyIGl0IHdhaXRzIGZvciB0aGUgbmV3IGNvbnRleHQgaXMgcmVhZHlcbiAqL1xuY29tbWFuZHMuc2V0Q29udGV4dCA9IGFzeW5jIGZ1bmN0aW9uIHNldENvbnRleHQgKG5hbWUsIGNhbGxiYWNrLCBza2lwUmVhZHlDaGVjaykge1xuICBmdW5jdGlvbiBhbHJlYWR5SW5Db250ZXh0IChkZXNpcmVkLCBjdXJyZW50KSB7XG4gICAgcmV0dXJuIChkZXNpcmVkID09PSBjdXJyZW50IHx8XG4gICAgICAoZGVzaXJlZCA9PT0gbnVsbCAmJiBjdXJyZW50ID09PSBOQVRJVkVfV0lOKSB8fFxuICAgICAgKGRlc2lyZWQgPT09IE5BVElWRV9XSU4gJiYgY3VycmVudCA9PT0gbnVsbCkpO1xuICB9XG4gIGZ1bmN0aW9uIGlzTmF0aXZlQ29udGV4dCAoY29udGV4dCkge1xuICAgIHJldHVybiBjb250ZXh0ID09PSBOQVRJVkVfV0lOIHx8IGNvbnRleHQgPT09IG51bGw7XG4gIH1cblxuICAvLyBhbGxvdyB0aGUgZnVsbCBjb250ZXh0IGxpc3QgdG8gYmUgcGFzc2VkIGluXG4gIGlmIChuYW1lICYmIG5hbWUuaWQpIHtcbiAgICBuYW1lID0gbmFtZS5pZDtcbiAgfVxuXG4gIHRoaXMubG9nLmRlYnVnKGBBdHRlbXB0aW5nIHRvIHNldCBjb250ZXh0IHRvICcke25hbWUgfHwgTkFUSVZFX1dJTn0nIGZyb20gJyR7dGhpcy5jdXJDb250ZXh0ID8gdGhpcy5jdXJDb250ZXh0IDogTkFUSVZFX1dJTn0nYCk7XG5cbiAgaWYgKGFscmVhZHlJbkNvbnRleHQobmFtZSwgdGhpcy5jdXJDb250ZXh0KSB8fCBhbHJlYWR5SW5Db250ZXh0KF8ucmVwbGFjZShuYW1lLCBXRUJWSUVXX0JBU0UsICcnKSwgdGhpcy5jdXJDb250ZXh0KSkge1xuICAgIC8vIGFscmVhZHkgaW4gdGhlIG5hbWVkIGNvbnRleHQsIG5vIG5lZWQgdG8gZG8gYW55dGhpbmdcbiAgICB0aGlzLmxvZy5kZWJ1ZyhgQWxyZWFkeSBpbiAnJHtuYW1lIHx8IE5BVElWRV9XSU59JyBjb250ZXh0LiBEb2luZyBub3RoaW5nLmApO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoaXNOYXRpdmVDb250ZXh0KG5hbWUpKSB7XG4gICAgLy8gc3dpdGNoaW5nIGludG8gdGhlIG5hdGl2ZSBjb250ZXh0XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gbnVsbDtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBzd2l0Y2hpbmcgaW50byBhIHdlYnZpZXcgY29udGV4dFxuXG4gIC8vIGlmIGNvbnRleHRzIGhhdmUgbm90IGFscmVhZHkgYmVlbiByZXRyaWV2ZWQsIGdldCB0aGVtXG4gIGlmIChfLmlzVW5kZWZpbmVkKHRoaXMuY29udGV4dHMpKSB7XG4gICAgYXdhaXQgdGhpcy5nZXRDb250ZXh0cygpO1xuICB9XG5cbiAgbGV0IGNvbnRleHRJZCA9IF8ucmVwbGFjZShuYW1lLCBXRUJWSUVXX0JBU0UsICcnKTtcbiAgaWYgKGNvbnRleHRJZCA9PT0gJycpIHtcbiAgICAvLyBhbGxvdyB1c2VyIHRvIHBhc3MgaW4gXCJXRUJWSUVXXCIgd2l0aG91dCBhbiBpbmRleFxuICAgIC8vIHRoZSBzZWNvbmQgY29udGV4dCB3aWxsIGJlIHRoZSBmaXJzdCB3ZWJ2aWV3IGFzXG4gICAgLy8gdGhlIGZpcnN0IGlzIGFsd2F5cyBOQVRJVkVfQVBQXG4gICAgY29udGV4dElkID0gdGhpcy5jb250ZXh0c1sxXTtcbiAgfVxuICBpZiAoIV8uaW5jbHVkZXModGhpcy5jb250ZXh0cywgY29udGV4dElkKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoQ29udGV4dEVycm9yKCk7XG4gIH1cblxuICBjb25zdCBvbGRDb250ZXh0ID0gdGhpcy5jdXJDb250ZXh0O1xuICB0aGlzLmN1ckNvbnRleHQgPSB0aGlzLmN1cldpbmRvd0hhbmRsZSA9IGNvbnRleHRJZDtcblxuICAvLyBgY29udGV4dElkYCB3aWxsIGJlIGluIHRoZSBmb3JtIG9mIGBhcHBJZC5wYWdlSWRgIGluIHRoaXMgY2FzZVxuICBjb25zdCBbYXBwSWRLZXksIHBhZ2VJZEtleV0gPSBfLm1hcChjb250ZXh0SWQuc3BsaXQoJy4nKSwgKGlkKSA9PiBwYXJzZUludChpZCwgMTApKTtcbiAgdHJ5IHtcbiAgICB0aGlzLnNlbGVjdGluZ05ld1BhZ2UgPSB0cnVlO1xuICAgIGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UoYXBwSWRLZXksIHBhZ2VJZEtleSwgc2tpcFJlYWR5Q2hlY2spO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICB0aGlzLmN1ckNvbnRleHQgPSB0aGlzLmN1cldpbmRvd0hhbmRsZSA9IG9sZENvbnRleHQ7XG4gICAgdGhyb3cgZXJyO1xuICB9IGZpbmFsbHkge1xuICAgIHRoaXMuc2VsZWN0aW5nTmV3UGFnZSA9IGZhbHNlO1xuICB9XG5cbiAgLy8gYXR0ZW1wdCB0byBzdGFydCBwZXJmb3JtYW5jZSBsb2dnaW5nLCBpZiByZXF1ZXN0ZWRcbiAgaWYgKHRoaXMub3B0cy5lbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmcgJiYgdGhpcy5yZW1vdGUpIHtcbiAgICB0aGlzLmxvZy5kZWJ1ZyhgU3RhcnRpbmcgcGVyZm9ybWFuY2UgbG9nIG9uICcke3RoaXMuY3VyQ29udGV4dH0nYCk7XG4gICAgdGhpcy5sb2dzLnBlcmZvcm1hbmNlID0gbmV3IElPU1BlcmZvcm1hbmNlTG9nKHRoaXMucmVtb3RlKTtcbiAgICBhd2FpdCB0aGlzLmxvZ3MucGVyZm9ybWFuY2Uuc3RhcnRDYXB0dXJlKCk7XG4gIH1cblxuICAvLyBzdGFydCBzYWZhcmkgbG9nZ2luZyBpZiB0aGUgbG9ncyBoYW5kbGVycyBhcmUgYWN0aXZlXG4gIGlmIChuYW1lICYmIG5hbWUgIT09IE5BVElWRV9XSU4gJiYgdGhpcy5sb2dzKSB7XG4gICAgaWYgKHRoaXMubG9ncy5zYWZhcmlDb25zb2xlKSB7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5zdGFydENvbnNvbGUodGhpcy5sb2dzLnNhZmFyaUNvbnNvbGUuYWRkTG9nTGluZS5iaW5kKHRoaXMubG9ncy5zYWZhcmlDb25zb2xlKSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmxvZ3Muc2FmYXJpTmV0d29yaykge1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuc3RhcnROZXR3b3JrKHRoaXMubG9ncy5zYWZhcmlOZXR3b3JrLmFkZExvZ0xpbmUuYmluZCh0aGlzLmxvZ3Muc2FmYXJpTmV0d29yaykpO1xuICAgIH1cbiAgfVxufTtcblxuZXh0ZW5zaW9ucy5jb25uZWN0VG9SZW1vdGVEZWJ1Z2dlciA9IGFzeW5jIGZ1bmN0aW9uIGNvbm5lY3RUb1JlbW90ZURlYnVnZ2VyICgpIHtcbiAgdGhpcy5yZW1vdGUgPSBhd2FpdCB0aGlzLmdldE5ld1JlbW90ZURlYnVnZ2VyKCk7XG5cbiAgdGhpcy5yZW1vdGUub24oUmVtb3RlRGVidWdnZXIuRVZFTlRfUEFHRV9DSEFOR0UsIHRoaXMub25QYWdlQ2hhbmdlLmJpbmQodGhpcykpO1xuICB0aGlzLnJlbW90ZS5vbihSZW1vdGVEZWJ1Z2dlci5FVkVOVF9GUkFNRVNfREVUQUNIRUQsICgpID0+IHtcbiAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmN1cldlYkZyYW1lcykpIHtcbiAgICAgIHRoaXMubG9nLmRlYnVnKGBDbGVhcmluZyAke3V0aWwucGx1cmFsaXplKCdmcmFtZScsIHRoaXMuY3VyV2ViRnJhbWVzLmxlbmd0aCwgdHJ1ZSl9OiAke3RoaXMuY3VyV2ViRnJhbWVzLmpvaW4oJywgJyl9YCk7XG4gICAgfVxuICAgIHRoaXMuY3VyV2ViRnJhbWVzID0gW107XG4gIH0pO1xuXG4gIGF3YWl0IHRoaXMucmVtb3RlLmNvbm5lY3QodGhpcy5vcHRzLndlYnZpZXdDb25uZWN0VGltZW91dCk7XG59O1xuXG5leHRlbnNpb25zLmxpc3RXZWJGcmFtZXMgPSBhc3luYyBmdW5jdGlvbiBsaXN0V2ViRnJhbWVzICh1c2VVcmwgPSB0cnVlKSB7XG4gIHVzZVVybCA9IHVzZVVybCAmJiAhdGhpcy5pc1JlYWxEZXZpY2UoKSAmJiAhIXRoaXMuZ2V0Q3VycmVudFVybCgpO1xuICB0aGlzLmxvZy5kZWJ1ZyhgU2VsZWN0aW5nIGJ5IHVybDogJHt1c2VVcmx9JHt1c2VVcmwgPyBgIChleHBlY3RlZCB1cmw6ICcke3RoaXMuZ2V0Q3VycmVudFVybCgpfScpYCA6ICcnfWApO1xuXG4gIGlmICghdGhpcy5yZW1vdGUpIHtcbiAgICBhd2FpdCB0aGlzLmNvbm5lY3RUb1JlbW90ZURlYnVnZ2VyKCk7XG4gICAgaWYgKCF0aGlzLnJlbW90ZS5hcHBJZEtleSkge1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuc2V0Q29ubmVjdGlvbktleSgpO1xuICAgIH1cbiAgfVxuICBjb25zdCBnZXRXZWJ2aWV3UGFnZXMgPSBhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnJlbW90ZS5zZWxlY3RBcHAoXG4gICAgICAgIHVzZVVybCA/IHRoaXMuZ2V0Q3VycmVudFVybCgpIDogdW5kZWZpbmVkLFxuICAgICAgICB0aGlzLm9wdHMud2Vidmlld0Nvbm5lY3RSZXRyaWVzLFxuICAgICAgICB0aGlzLm9wdHMuaWdub3JlQWJvdXRCbGFua1VybFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHRoaXMubG9nLmRlYnVnKGBObyBhdmFpbGFibGUgd2ViIHBhZ2VzOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgcGFnZUFycmF5ID0gYXdhaXQgZ2V0V2Vidmlld1BhZ2VzKCk7XG4gIGlmIChfLmlzRW1wdHkocGFnZUFycmF5KSkge1xuICAgIC8vIHdlIGhhdmUgbm8gd2ViIGZyYW1lcywgYnV0IGNvbnRpbnVlIGFueXdheVxuICAgIHRoaXMubG9nLmRlYnVnKCdObyB3ZWIgZnJhbWVzIGZvdW5kLicpO1xuICB9XG4gIHJldHVybiBwYWdlQXJyYXk7XG59O1xuXG5jb21tYW5kcy5nZXRDb250ZXh0cyA9IGFzeW5jIGZ1bmN0aW9uIGdldENvbnRleHRzICgpIHtcbiAgdGhpcy5sb2cuZGVidWcoJ0dldHRpbmcgbGlzdCBvZiBhdmFpbGFibGUgY29udGV4dHMnKTtcbiAgY29uc3QgY29udGV4dHMgPSBhd2FpdCB0aGlzLmdldENvbnRleHRzQW5kVmlld3MoZmFsc2UpO1xuXG4gIGNvbnN0IG1hcEZuID0gdGhpcy5vcHRzLmZ1bGxDb250ZXh0TGlzdFxuICAgID8gZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBjb250ZXh0LmlkLnRvU3RyaW5nKCksXG4gICAgICAgIHRpdGxlOiBjb250ZXh0LnZpZXcudGl0bGUsXG4gICAgICAgIHVybDogY29udGV4dC52aWV3LnVybCxcbiAgICAgICAgYnVuZGxlSWQ6IGNvbnRleHQudmlldy5idW5kbGVJZCxcbiAgICAgIH07XG4gICAgfVxuICAgIDogKGNvbnRleHQpID0+IGNvbnRleHQuaWQudG9TdHJpbmcoKTtcbiAgcmV0dXJuIGNvbnRleHRzLm1hcChtYXBGbik7XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IENvbnRleHRcbiAqXG4gKiBAcHJvcGVydHkge3N0cmluZ30gaWQgLSBUaGUgaWRlbnRpZmllciBvZiB0aGUgY29udGV4dC4gVGhlIG5hdGl2ZSBjb250ZXh0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgd2lsbCBiZSAnTkFUSVZFX0FQUCcgYW5kIHRoZSB3ZWJ2aWV3cyB3aWxsIGJlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgJ1dFQlZJRVdfeHh4J1xuICogQHByb3BlcnR5IHs/c3RyaW5nfSB0aXRsZSAtIFRoZSB0aXRsZSBhc3NvY2lhdGVkIHdpdGggdGhlIHdlYnZpZXcgY29udGVudFxuICogQHByb3BlcnR5IHs/c3RyaW5nfSB1cmwgLSBUaGUgdXJsIGFzc29jaWF0ZWQgd2l0aCB0aGUgd2VidmlldyBjb250ZW50XG4gKi9cblxuLyoqXG4gKiBHZXQgdGhlIGNvbnRleHRzIGF2YWlsYWJsZSwgd2l0aCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdXJsIGFuZCB0aXRsZSBvZiBlYWNoXG4gKiB3ZWJ2aWV3XG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9wdHMgLSBPcHRpb25zIHNldCwgd2hpY2ggY2FuIGluY2x1ZGUgYHdhaXRGb3JXZWJ2aWV3TXNgIHRvXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWNpZnkgdGhlIHBlcmlvZCB0byBwb2xsIGZvciBhdmFpbGFibGUgd2Vidmlld3NcbiAqIEByZXR1cm5zIHtBcnJheX0gTGlzdCBvZiBDb250ZXh0IG9iamVjdHNcbiAqL1xuZXh0ZW5zaW9ucy5tb2JpbGVHZXRDb250ZXh0cyA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZUdldENvbnRleHRzIChvcHRzID0ge30pIHtcbiAgbGV0IHtcbiAgICB3YWl0Rm9yV2Vidmlld01zID0gMCxcbiAgfSA9IG9wdHM7XG5cbiAgLy8gbWFrZSBzdXJlIGl0IGlzIGEgbnVtYmVyLCBzbyB0aGUgZHVyYXRpb24gY2hlY2sgd29ya3MgcHJvcGVybHlcbiAgaWYgKCFfLmlzTnVtYmVyKHdhaXRGb3JXZWJ2aWV3TXMpKSB7XG4gICAgd2FpdEZvcldlYnZpZXdNcyA9IHBhcnNlSW50KHdhaXRGb3JXZWJ2aWV3TXMsIDEwKTtcbiAgICBpZiAoaXNOYU4od2FpdEZvcldlYnZpZXdNcykpIHtcbiAgICAgIHdhaXRGb3JXZWJ2aWV3TXMgPSAwO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGN1ck9wdCA9IHRoaXMub3B0cy5mdWxsQ29udGV4dExpc3Q7XG4gIHRoaXMub3B0cy5mdWxsQ29udGV4dExpc3QgPSB0cnVlO1xuXG4gIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG4gIHRyeSB7XG4gICAgbGV0IGNvbnRleHRzO1xuICAgIGRvIHtcbiAgICAgIGNvbnRleHRzID0gYXdhaXQgdGhpcy5nZXRDb250ZXh0cygpO1xuXG4gICAgICBpZiAoY29udGV4dHMubGVuZ3RoID49IDIpIHtcbiAgICAgICAgdGhpcy5sb2cuZGVidWcoYEZvdW5kIHdlYnZpZXcgY29udGV4dCBhZnRlciAke3RpbWVyLmdldER1cmF0aW9uKCkuYXNNaWxsaVNlY29uZHMudG9GaXhlZCgwKX1tc2ApO1xuICAgICAgICByZXR1cm4gY29udGV4dHM7XG4gICAgICB9XG4gICAgICB0aGlzLmxvZy5kZWJ1ZyhgTm8gd2Vidmlld3MgZm91bmQgaW4gJHt0aW1lci5nZXREdXJhdGlvbigpLmFzTWlsbGlTZWNvbmRzLnRvRml4ZWQoMCl9bXNgKTtcbiAgICB9IHdoaWxlICh0aW1lci5nZXREdXJhdGlvbigpLmFzTWlsbGlTZWNvbmRzIDwgd2FpdEZvcldlYnZpZXdNcyk7XG4gICAgcmV0dXJuIGNvbnRleHRzO1xuICB9IGZpbmFsbHkge1xuICAgIC8vIHJlc2V0IHRoZSBvcHRpb24gc28gdGhlcmUgYXJlIG5vIHNpZGUgZWZmZWN0c1xuICAgIHRoaXMub3B0cy5mdWxsQ29udGV4dExpc3QgPSBjdXJPcHQ7XG4gIH1cbn07XG5cbmNvbW1hbmRzLnNldFdpbmRvdyA9IGFzeW5jIGZ1bmN0aW9uIHNldFdpbmRvdyAobmFtZSwgc2tpcFJlYWR5Q2hlY2spIHtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLnNldENvbnRleHQobmFtZSwgXy5ub29wLCBza2lwUmVhZHlDaGVjayk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIC8vIHRyYW5zbGF0ZSB0aGUgZXJyb3IgaW4gdGVybXMgb2Ygd2luZG93c1xuICAgIHRocm93IGlzRXJyb3JUeXBlKGVyciwgZXJyb3JzLk5vU3VjaENvbnRleHRFcnJvcilcbiAgICAgID8gbmV3IGVycm9ycy5Ob1N1Y2hXaW5kb3dFcnJvcigpXG4gICAgICA6IGVycjtcbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0V2luZG93SGFuZGxlID0gYXN5bmMgZnVuY3Rpb24gZ2V0V2luZG93SGFuZGxlICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9XG4gIHRoaXMubG9nLmRlYnVnKGBHZXR0aW5nIGN1cnJlbnQgd2luZG93IGhhbmRsZWApO1xuICByZXR1cm4gdGhpcy5jdXJDb250ZXh0O1xufTtcblxuY29tbWFuZHMuZ2V0V2luZG93SGFuZGxlcyA9IGFzeW5jIGZ1bmN0aW9uIGdldFdpbmRvd0hhbmRsZXMgKCkge1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuICB0aGlzLmxvZy5kZWJ1ZygnR2V0dGluZyBsaXN0IG9mIGF2YWlsYWJsZSB3aW5kb3cgaGFuZGxlcycpO1xuICBjb25zdCBjb250ZXh0cyA9IGF3YWl0IHRoaXMuZ2V0Q29udGV4dHNBbmRWaWV3cyhmYWxzZSk7XG4gIHJldHVybiBjb250ZXh0c1xuICAgIC8vIGdldCByaWQgb2YgdGhlIG5hdGl2ZSBhcHAgY29udGV4dFxuICAgIC5maWx0ZXIoKGNvbnRleHQpID0+IGNvbnRleHQuaWQgIT09IE5BVElWRV9XSU4pXG4gICAgLy8gZ2V0IHRoZSBgYXBwLmlkYCBmb3JtYXQgZXhwZWN0ZWRcbiAgICAubWFwKChjb250ZXh0KSA9PiBjb250ZXh0LnZpZXcuaWQudG9TdHJpbmcoKSk7XG59O1xuXG5leHRlbnNpb25zLm9uUGFnZUNoYW5nZSA9IGFzeW5jIGZ1bmN0aW9uIG9uUGFnZUNoYW5nZSAocGFnZUNoYW5nZU5vdGlmaWNhdGlvbikge1xuICB0aGlzLmxvZy5kZWJ1ZyhgUmVtb3RlIGRlYnVnZ2VyIG5vdGlmaWVkIHVzIG9mIGEgbmV3IHBhZ2UgbGlzdGluZzogJHtKU09OLnN0cmluZ2lmeShwYWdlQ2hhbmdlTm90aWZpY2F0aW9uKX1gKTtcbiAgaWYgKHRoaXMuc2VsZWN0aW5nTmV3UGFnZSkge1xuICAgIHRoaXMubG9nLmRlYnVnKCdXZSBhcmUgaW4gdGhlIG1pZGRsZSBvZiBzZWxlY3RpbmcgYSBwYWdlLCBpZ25vcmluZycpO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoIXRoaXMucmVtb3RlIHx8ICF0aGlzLnJlbW90ZS5pc0Nvbm5lY3RlZCkge1xuICAgIHRoaXMubG9nLmRlYnVnKCdXZSBoYXZlIG5vdCB5ZXQgY29ubmVjdGVkLCBpZ25vcmluZycpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHthcHBJZEtleSwgcGFnZUFycmF5fSA9IHBhZ2VDaGFuZ2VOb3RpZmljYXRpb247XG5cbiAgbGV0IG5ld0lkcyA9IFtdO1xuICBsZXQgbmV3UGFnZXMgPSBbXTtcbiAgbGV0IGtleUlkID0gbnVsbDtcblxuICAvLyBDaGVja3MgaWYgYSBVUkwgaXMgYmxhY2tsaXN0ZWQgaW4gdGhlICdzYWZhcmlJZ25vcmVXZWJIb3N0bmFtZXMnIGNhcGFiaWxpdHlcbiAgZnVuY3Rpb24gaXNVcmxJZ25vcmVkICh1cmwsIHNhZmFyaUlnbm9yZVdlYkhvc3RuYW1lcykge1xuICAgIGNvbnN0IGlnbm9yZWRIb3N0cyA9IChzYWZhcmlJZ25vcmVXZWJIb3N0bmFtZXMgfHwgJycpXG4gICAgICAuc3BsaXQoJywnKVxuICAgICAgLm1hcCgoYikgPT4gYi50cmltKCkpXG4gICAgICAuZmlsdGVyKChiKSA9PiAhXy5pc0VtcHR5KGIpKTtcbiAgICBmb3IgKGNvbnN0IGlnbm9yZWRIb3N0IG9mIGlnbm9yZWRIb3N0cykge1xuICAgICAgaWYgKGlnbm9yZWRIb3N0ID09PSAnYWJvdXQ6YmxhbmsnICYmIHVybCA9PT0gJ2Fib3V0OmJsYW5rJykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgaG9zdG5hbWUgPSBuZXcgVVJMKHVybCkuaG9zdG5hbWU7XG4gICAgICAgICAgaWYgKGhvc3RuYW1lID09PSBpZ25vcmVkSG9zdCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChpZ24pIHtcbiAgICAgICAgICAvLyBkbyBub3RoaW5nIGlmIGludmFsaWQgVVJMXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZm9yIChjb25zdCBwYWdlIG9mIHBhZ2VBcnJheSkge1xuICAgIGNvbnN0IGlkID0gcGFnZS5pZC50b1N0cmluZygpO1xuICAgIG5ld0lkcy5wdXNoKGlkKTtcbiAgICBpZiAocGFnZS5pc0tleSkge1xuICAgICAga2V5SWQgPSBpZDtcbiAgICB9XG4gICAgY29uc3QgY29udGV4dElkID0gYCR7YXBwSWRLZXl9LiR7aWR9YDtcblxuICAgIC8vIGFkZCBpZiB0aGlzIGlzIGEgbmV3IHBhZ2VcbiAgICBpZiAoIV8uaW5jbHVkZXModGhpcy5jb250ZXh0cywgY29udGV4dElkKSkge1xuICAgICAgaWYgKGlzVXJsSWdub3JlZChwYWdlLnVybCwgdGhpcy5vcHRzLnNhZmFyaUlnbm9yZVdlYkhvc3RuYW1lcykpIHtcbiAgICAgICAgdGhpcy5sb2cuaW5mbyhgTm90IHRyYWNraW5nICcke3BhZ2UudXJsfScgcGFnZSBiZWNhdXNlIGl0IGlzIGJsYWNrbGlzdGVkLiBgICtcbiAgICAgICAgICBgJ3NhZmFyaUlnbm9yZVdlYkhvc3RuYW1lcyc9JHt0aGlzLm9wdHMuc2FmYXJpSWdub3JlV2ViSG9zdG5hbWVzfWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3UGFnZXMucHVzaChpZCk7XG4gICAgICAgIHRoaXMuY29udGV4dHMucHVzaChjb250ZXh0SWQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmICgha2V5SWQpIHtcbiAgICAvLyBpZiB0aGVyZSBpcyBubyBrZXkgaWQsIHB1bGwgdGhlIGZpcnN0IGlkIGZyb20gdGhlIHBhZ2UgYXJyYXkgYW5kIHVzZSB0aGF0XG4gICAgLy8gYXMgYSBzdGFuZCBpblxuICAgIHRoaXMubG9nLmRlYnVnKCdObyBrZXkgaWQgZm91bmQuIENob29zaW5nIGZpcnN0IGlkIGZyb20gcGFnZSBhcnJheScpO1xuICAgIGtleUlkID0gbmV3SWRzWzBdIHx8IG51bGw7XG4gIH1cblxuICBpZiAoIXV0aWwuaGFzVmFsdWUodGhpcy5jdXJDb250ZXh0KSkge1xuICAgIHRoaXMubG9nLmRlYnVnKCdXZSBkbyBub3QgYXBwZWFyIHRvIGhhdmUgd2luZG93IHNldCB5ZXQsIGlnbm9yaW5nJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgW2N1ckFwcElkS2V5LCBjdXJQYWdlSWRLZXldID0gdGhpcy5jdXJDb250ZXh0LnNwbGl0KCcuJyk7XG5cbiAgaWYgKGN1ckFwcElkS2V5ICE9PSBhcHBJZEtleSkge1xuICAgIHRoaXMubG9nLmRlYnVnKCdQYWdlIGNoYW5nZSBub3QgcmVmZXJyaW5nIHRvIGN1cnJlbnRseSBzZWxlY3RlZCBhcHAsIGlnbm9yaW5nLicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBuZXdQYWdlID0gbnVsbDtcbiAgaWYgKG5ld1BhZ2VzLmxlbmd0aCkge1xuICAgIG5ld1BhZ2UgPSBfLmxhc3QobmV3UGFnZXMpO1xuICAgIHRoaXMubG9nLmRlYnVnKGBXZSBoYXZlIG5ldyBwYWdlcywgc2VsZWN0aW5nIHBhZ2UgJyR7bmV3UGFnZX0nYCk7XG4gIH0gZWxzZSBpZiAoIV8uaW5jbHVkZXMobmV3SWRzLCBjdXJQYWdlSWRLZXkpKSB7XG4gICAgdGhpcy5sb2cuZGVidWcoJ05ldyBwYWdlIGxpc3RpbmcgZnJvbSByZW1vdGUgZGVidWdnZXIgZG9lcyBub3QgY29udGFpbiAnICtcbiAgICAgICAgICAgICAgICAgJ2N1cnJlbnQgd2luZG93OyBhc3N1bWluZyBpdCBpcyBjbG9zZWQnKTtcbiAgICBpZiAoIXV0aWwuaGFzVmFsdWUoa2V5SWQpKSB7XG4gICAgICB0aGlzLmxvZy5lcnJvcignRG8gbm90IGhhdmUgb3VyIGN1cnJlbnQgd2luZG93IGFueW1vcmUsIGFuZCB0aGVyZSAnICtcbiAgICAgICAgICAgICAgICAgICAnYXJlIG5vdCBhbnkgbW9yZSB0byBsb2FkISBEb2luZyBub3RoaW5nLi4uJyk7XG4gICAgICB0aGlzLnNldEN1cnJlbnRVcmwodW5kZWZpbmVkKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmxvZy5kZWJ1ZyhgRGVidWdnZXIgYWxyZWFkeSBzZWxlY3RlZCBwYWdlICcke2tleUlkfScsIGAgK1xuICAgICAgICAgICAgICAgICBgY29uZmlybWluZyB0aGF0IGNob2ljZS5gKTtcbiAgICB0aGlzLmN1ckNvbnRleHQgPSBgJHthcHBJZEtleX0uJHtrZXlJZH1gO1xuICAgIG5ld1BhZ2UgPSBrZXlJZDtcbiAgfSBlbHNlIHtcbiAgICAvLyBhdCB0aGlzIHBvaW50LCB0aGVyZSBhcmUgbm8gbmV3IHBhZ2VzLCBhbmQgdGhlIGN1cnJlbnQgcGFnZSBzdGlsbCBleGlzdHNcbiAgICB0aGlzLmxvZy5kZWJ1ZygnQ2hlY2tpbmcgaWYgcGFnZSBuZWVkcyB0byBsb2FkJyk7XG4gICAgLy8gSWYgYSB3aW5kb3cgbmF2aWdhdGVzIHRvIGFuIGFuY2hvciBpdCBkb2Vzbid0IGFsd2F5cyBmaXJlIGEgcGFnZVxuICAgIC8vIGNhbGxiYWNrIGV2ZW50LiBMZXQncyBjaGVjayBpZiB3ZSB3b3VuZCB1cCBpbiBzdWNoIGEgc2l0dWF0aW9uLlxuICAgIGNvbnN0IG5lZWRzUGFnZUxvYWQgPSAoKCkgPT4ge1xuICAgICAgLy8gbmVlZCB0byBtYXAgdGhlIHBhZ2UgaWRzIHRvIGNvbnRleHQgaWRzXG4gICAgICBjb25zdCBjb250ZXh0QXJyYXkgPSBfLm1hcChwYWdlQXJyYXksIChwYWdlKSA9PiBgJHthcHBJZEtleX0uJHtwYWdlLmlkfWApO1xuICAgICAgLy8gY2hlY2sgaWYgdGhlIGN1cnJlbnQgY29udGV4dCBleGlzdHMgaW4gYm90aCBvdXIgcmVjb3JkZWQgY29udGV4dHMsXG4gICAgICAvLyBhbmQgdGhlIHBhZ2UgYXJyYXlcbiAgICAgIHJldHVybiAhXy5pc0VxdWFsKF8uZmluZCh0aGlzLmNvbnRleHRzLCB0aGlzLmN1ckNvbnRleHQpLCBfLmZpbmQoY29udGV4dEFycmF5LCB0aGlzLmN1ckNvbnRleHQpKTtcbiAgICB9KSgpO1xuXG4gICAgaWYgKG5lZWRzUGFnZUxvYWQpIHtcbiAgICAgIHRoaXMubG9nLmRlYnVnKCdQYWdlIGxvYWQgbmVlZGVkLiBMb2FkaW5nLi4uJyk7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5wYWdlTG9hZCgpO1xuICAgIH1cblxuICAgIHRoaXMubG9nLmRlYnVnKCdOZXcgcGFnZSBsaXN0aW5nIGlzIHNhbWUgYXMgb2xkLCBkb2luZyBub3RoaW5nJyk7XG4gIH1cblxuICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgcGFnZSBsaXN0aW5nIGlzbid0IGluZGljYXRpbmcgYSByZWRpcmVjdFxuICBpZiAodXRpbC5oYXNWYWx1ZSh0aGlzLmN1ckNvbnRleHQpKSB7XG4gICAgbGV0IGN1cnJlbnRQYWdlSWQgPSBwYXJzZUludChfLmxhc3QodGhpcy5jdXJDb250ZXh0LnNwbGl0KCcuJykpLCAxMCk7XG4gICAgbGV0IHBhZ2UgPSBfLmZpbmQocGFnZUFycmF5LCAocCkgPT4gcGFyc2VJbnQocC5pZCwgMTApID09PSBjdXJyZW50UGFnZUlkKTtcbiAgICBpZiAocGFnZSAmJiBwYWdlLnVybCAhPT0gdGhpcy5nZXRDdXJyZW50VXJsKCkpIHtcbiAgICAgIHRoaXMubG9nLmRlYnVnKGBSZWRpcmVjdGVkIGZyb20gJyR7dGhpcy5nZXRDdXJyZW50VXJsKCl9JyB0byAnJHtwYWdlLnVybH0nYCk7XG4gICAgICB0aGlzLnNldEN1cnJlbnRVcmwocGFnZS51cmwpO1xuICAgIH1cbiAgfVxuXG4gIGlmICh1dGlsLmhhc1ZhbHVlKG5ld1BhZ2UpKSB7XG4gICAgdGhpcy5zZWxlY3RpbmdOZXdQYWdlID0gdHJ1ZTtcbiAgICBjb25zdCBvbGRDb250ZXh0ID0gdGhpcy5jdXJDb250ZXh0O1xuICAgIHRoaXMuY3VyQ29udGV4dCA9IGAke2FwcElkS2V5fS4ke25ld1BhZ2V9YDtcbiAgICAvLyBkbyBub3Qgd2FpdCwgYXMgdGhpcyBjYW4gdGFrZSBhIGxvbmcgdGltZSwgYW5kIHRoZSByZXNwb25zZSBpcyBub3QgbmVjZXNzYXJ5XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrcywgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tdGhlblxuICAgIHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UoYXBwSWRLZXksIHBhcnNlSW50KG5ld1BhZ2UsIDEwKSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgdGhpcy5sb2cud2FybihgRmFpbGVkIHRvIHNlbGVjdCBwYWdlOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgdGhpcy5jdXJDb250ZXh0ID0gb2xkQ29udGV4dDtcbiAgICB9KTtcbiAgICB0aGlzLnNlbGVjdGluZ05ld1BhZ2UgPSBmYWxzZTtcbiAgfVxuICB0aGlzLndpbmRvd0hhbmRsZUNhY2hlID0gcGFnZUFycmF5O1xufTtcblxuXG5PYmplY3QuYXNzaWduKGNvbW1hbmRzLCBleHRlbnNpb25zLCBoZWxwZXJzKTtcbmV4cG9ydCBkZWZhdWx0IGNv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