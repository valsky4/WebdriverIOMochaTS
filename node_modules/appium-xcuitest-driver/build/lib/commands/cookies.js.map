{"version":3,"file":"cookies.js","names":["_lodash","_interopRequireDefault","require","_driver","commands","helpers","extensions","exports","getCookies","isWebContext","errors","NotImplementedError","cookies","remote","decodedCookieValues","map","cookie","decodeURI","value","error","log","debug","name","warn","undefined","_","zip","filter","isUndefined","Object","assign","deleteCookie","cookieName","find","_deleteCookie","deleteCookies","url","secure","domain","path","_default","default"],"sources":["../../../lib/commands/cookies.js"],"sourcesContent":["import _ from 'lodash';\nimport { errors } from 'appium/driver';\n\n\nlet commands = {}, helpers = {}, extensions = {};\n\ncommands.getCookies = async function getCookies () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  // get the cookies from the remote debugger, or an empty object\n  const cookies = await this.remote.getCookies() || {cookies: []};\n\n  // the value is URI encoded, so decode it safely\n  const decodedCookieValues = cookies.cookies.map((cookie) => {\n    try {\n      return decodeURI(cookie.value);\n    } catch (error) {\n      this.log.debug(`Cookie ${cookie.name} was not decoded successfully. Cookie value: ${cookie.value}`);\n      this.log.warn(error);\n      return undefined;\n    }\n  });\n\n  // zip cookes with decoded value, removing undefined cookie values\n  return _.zip(cookies.cookies, decodedCookieValues)\n    .filter(([, value]) => !_.isUndefined(value))\n    .map(([cookie, value]) => Object.assign({}, cookie, {value}));\n};\n\ncommands.deleteCookie = async function deleteCookie (cookieName) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  const cookies = await this.getCookies();\n  const cookie = cookies.find((cookie) => cookie.name === cookieName);\n  if (!cookie) {\n    this.log.debug(`Cookie '${cookieName}' not found. Ignoring.`);\n    return true;\n  }\n\n  await this._deleteCookie(cookie);\n  return true;\n};\n\ncommands.deleteCookies = async function deleteCookies () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  const cookies = await this.getCookies();\n  for (const cookie of cookies) {\n    await this._deleteCookie(cookie);\n  }\n  return true;\n};\n\nhelpers._deleteCookie = async function _deleteCookie (cookie) {\n  const url = `http${cookie.secure ? 's' : ''}://${cookie.domain}${cookie.path}`;\n  return await this.remote.deleteCookie(cookie.name, url);\n};\n\nObject.assign(extensions, commands, helpers);\nexport { commands, helpers };\nexport default extensions;\n"],"mappings":"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"}