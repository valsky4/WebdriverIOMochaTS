{"version":3,"file":"location.js","names":["_driver","require","_appiumIosDevice","_support","commands","exports","getGeoLocation","authorizationStatus","latitude","longitude","altitude","proxyCommand","log","errorAndThrow","setGeoLocation","location","util","hasValue","errors","InvalidArgumentError","isSimulator","opts","device","setGeolocation","service","services","startSimulateLocationService","udid","setLocation","e","message","close","mobileResetLocationService","NotImplementedError","resetLocation","err","_default","default"],"sources":["../../../lib/commands/location.js"],"sourcesContent":["import { errors } from 'appium/driver';\nimport { services } from 'appium-ios-device';\nimport { util } from 'appium/support';\n\nconst commands = {};\n\n/**\n * @typedef {Object} LocationObject\n *\n * @property {number} latitude - The latitude of the device under test\n * @property {number} longitude - The longitude of the device under test\n * @property {number} altitude - The altitude of the device under test\n */\n\n/**\n * Returns location of the device under test.\n * The device under test must allow the location services for WDA\n * as 'Always' to get the location data correctly.\n *\n * The 'latitude', 'longitude' and 'altitude' could be zero even\n * if the Location Services are set to 'Always', because the device\n * needs some time to update the location data.\n *\n * @returns {LocationObject}\n * @throws {Error} If the device under test returns an error message.\n *                 i.e.: tvOS returns unsupported error\n */\ncommands.getGeoLocation = async function getGeoLocation () {\n  const {\n    authorizationStatus,\n    latitude,\n    longitude,\n    altitude\n  } = await this.proxyCommand('/wda/device/location', 'GET');\n\n  // '3' is 'Always' in the privacy\n  // https://developer.apple.com/documentation/corelocation/clauthorizationstatus\n  if (authorizationStatus !== 3) {\n    this.log.errorAndThrow(`Location service must be set to 'Always' in order to ` +\n      `retrive the current geolocation data. Please set it up manually via ` +\n      `'Settings > Privacy > Location Services -> WebDriverAgentRunner-Runner'`);\n  }\n\n  return {latitude, longitude, altitude};\n};\n\ncommands.setGeoLocation = async function setGeoLocation (location) {\n  let {latitude, longitude} = location;\n\n  if (!util.hasValue(latitude) || !util.hasValue(longitude)) {\n    throw new errors.InvalidArgumentError(`Both latitude and longitude should be set`);\n  }\n\n  if (this.isSimulator()) {\n    await this.opts.device.setGeolocation(`${latitude}`, `${longitude}`);\n    return;\n  }\n\n  const service = await services.startSimulateLocationService(this.opts.udid);\n  try {\n    service.setLocation(latitude, longitude);\n  } catch (e) {\n    this.log.errorAndThrow(`Can't set the location on device '${this.opts.udid}'. Original error: ${e.message}`);\n  } finally {\n    service.close();\n  }\n};\n\n/**\n * Reset the location service on real device.\n * Raises not implemented error for simulator.\n * @throws {Error} If the device is simulator, or 'resetLocation' raises an error.\n */\ncommands.mobileResetLocationService = async function mobileResetLocationService () {\n  if (this.isSimulator()) {\n    throw new errors.NotImplementedError();\n  }\n\n  const service = await services.startSimulateLocationService(this.opts.udid);\n  try {\n    service.resetLocation();\n  } catch (err) {\n    this.log.errorAndThrow(`Failed to reset the location on the device on device '${this.opts.udid}'. ` +\n      `Origianl error: ${err.message}`);\n  } finally {\n    service.close();\n  }\n};\n\nexport { commands };\nexport default commands;\n"],"mappings":";;;;;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,gBAAA,GAAAD,OAAA;AACA,IAAAE,QAAA,GAAAF,OAAA;AAEA,MAAMG,QAAQ,GAAG,CAAC,CAAC;AAACC,OAAA,CAAAD,QAAA,GAAAA,QAAA;AAuBpBA,QAAQ,CAACE,cAAc,GAAG,eAAeA,cAAcA,CAAA,EAAI;EACzD,MAAM;IACJC,mBAAmB;IACnBC,QAAQ;IACRC,SAAS;IACTC;EACF,CAAC,GAAG,MAAM,IAAI,CAACC,YAAY,CAAC,sBAAsB,EAAE,KAAK,CAAC;EAI1D,IAAIJ,mBAAmB,KAAK,CAAC,EAAE;IAC7B,IAAI,CAACK,GAAG,CAACC,aAAa,CAAE,uDAAsD,GAC3E,sEAAqE,GACrE,yEAAwE,CAAC;EAC9E;EAEA,OAAO;IAACL,QAAQ;IAAEC,SAAS;IAAEC;EAAQ,CAAC;AACxC,CAAC;AAEDN,QAAQ,CAACU,cAAc,GAAG,eAAeA,cAAcA,CAAEC,QAAQ,EAAE;EACjE,IAAI;IAACP,QAAQ;IAAEC;EAAS,CAAC,GAAGM,QAAQ;EAEpC,IAAI,CAACC,aAAI,CAACC,QAAQ,CAACT,QAAQ,CAAC,IAAI,CAACQ,aAAI,CAACC,QAAQ,CAACR,SAAS,CAAC,EAAE;IACzD,MAAM,IAAIS,cAAM,CAACC,oBAAoB,CAAE,2CAA0C,CAAC;EACpF;EAEA,IAAI,IAAI,CAACC,WAAW,EAAE,EAAE;IACtB,MAAM,IAAI,CAACC,IAAI,CAACC,MAAM,CAACC,cAAc,CAAE,GAAEf,QAAS,EAAC,EAAG,GAAEC,SAAU,EAAC,CAAC;IACpE;EACF;EAEA,MAAMe,OAAO,GAAG,MAAMC,yBAAQ,CAACC,4BAA4B,CAAC,IAAI,CAACL,IAAI,CAACM,IAAI,CAAC;EAC3E,IAAI;IACFH,OAAO,CAACI,WAAW,CAACpB,QAAQ,EAAEC,SAAS,CAAC;EAC1C,CAAC,CAAC,OAAOoB,CAAC,EAAE;IACV,IAAI,CAACjB,GAAG,CAACC,aAAa,CAAE,qCAAoC,IAAI,CAACQ,IAAI,CAACM,IAAK,sBAAqBE,CAAC,CAACC,OAAQ,EAAC,CAAC;EAC9G,CAAC,SAAS;IACRN,OAAO,CAACO,KAAK,EAAE;EACjB;AACF,CAAC;AAOD3B,QAAQ,CAAC4B,0BAA0B,GAAG,eAAeA,0BAA0BA,CAAA,EAAI;EACjF,IAAI,IAAI,CAACZ,WAAW,EAAE,EAAE;IACtB,MAAM,IAAIF,cAAM,CAACe,mBAAmB,EAAE;EACxC;EAEA,MAAMT,OAAO,GAAG,MAAMC,yBAAQ,CAACC,4BAA4B,CAAC,IAAI,CAACL,IAAI,CAACM,IAAI,CAAC;EAC3E,IAAI;IACFH,OAAO,CAACU,aAAa,EAAE;EACzB,CAAC,CAAC,OAAOC,GAAG,EAAE;IACZ,IAAI,CAACvB,GAAG,CAACC,aAAa,CAAE,yDAAwD,IAAI,CAACQ,IAAI,CAACM,IAAK,KAAI,GAChG,mBAAkBQ,GAAG,CAACL,OAAQ,EAAC,CAAC;EACrC,CAAC,SAAS;IACRN,OAAO,CAACO,KAAK,EAAE;EACjB;AACF,CAAC;AAAC,IAAAK,QAAA,GAGahC,QAAQ;AAAAC,OAAA,CAAAgC,OAAA,GAAAD,QAAA"}