{"version":3,"file":"navigation.js","names":["_driver","require","_lodash","_interopRequireDefault","_asyncbox","_utils","commands","helpers","extensions","exports","CLOSE_WINDOW_TIMEOUT","CLOSE_WINDOW_INTERVAL","back","isWebContext","nativeBack","mobileWebNav","navBar","findNativeElementOrElements","buttons","length","Error","backButton","_","filter","value","label","log","debug","nativeClick","err","error","message","forward","closeWindow","errors","NotImplementedError","script","context","curContext","executeAtom","waitForCondition","waitMs","intervalMs","ign","mobileDeepLink","opts","url","bundleId","requireArgs","proxyCommand","Object","assign","_default","default"],"sources":["../../../lib/commands/navigation.js"],"sourcesContent":["import { errors } from 'appium/driver';\nimport _ from 'lodash';\nimport { waitForCondition } from 'asyncbox';\nimport { requireArgs } from '../utils';\n\nlet commands = {}, helpers = {}, extensions = {};\n\n// these two constitute the wait after closing a window\nconst CLOSE_WINDOW_TIMEOUT = 5000;\nconst CLOSE_WINDOW_INTERVAL = 100;\n\ncommands.back = async function back () {\n  if (!this.isWebContext()) {\n    await this.nativeBack();\n  } else {\n    await this.mobileWebNav('back');\n  }\n};\n\nhelpers.nativeBack = async function nativeBack () {\n  try {\n    let navBar = await this.findNativeElementOrElements('class name', 'XCUIElementTypeNavigationBar', false);\n    let buttons = await this.findNativeElementOrElements('class name', 'XCUIElementTypeButton', true, navBar);\n    if (buttons.length === 0) {\n      throw new Error('No buttons found in navigation bar');\n    }\n\n    let backButton = _.filter(buttons, (value) => value.label === 'Back')[0];\n    if (backButton) {\n      this.log.debug(`Found navigation bar 'back' button. Clicking.`);\n    } else {\n      this.log.debug(`Unable to find 'Back' button. Trying first button in navigation bar`);\n      backButton = buttons[0];\n    }\n    await this.nativeClick(backButton);\n  } catch (err) {\n    this.log.error(`Unable to find navigation bar and back button: ${err.message}`);\n  }\n};\n\ncommands.forward = async function forward () {\n  if (!this.isWebContext()) {\n  }\n  await this.mobileWebNav('forward');\n};\n\ncommands.closeWindow = async function closeWindow () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  // since the window will be closed and the execution context gone, return\n  // first before closing. Waiting for close will happen in the finally block\n  const script = `setTimeout(function () {window.open('','_self').close();}, 0); return true;`;\n  const context = this.curContext;\n  try {\n    return await this.executeAtom('execute_script', [script, []], true);\n  } finally {\n    // wait for the window to successfully change...\n    try {\n      await waitForCondition(() => this.curContext !== context, {\n        waitMs: CLOSE_WINDOW_TIMEOUT,\n        intervalMs: CLOSE_WINDOW_INTERVAL,\n      });\n    } catch (ign) {\n      this.log.debug('Context has not yet been changed after closing window. Continuing...');\n    }\n  }\n};\n\n/**\n * @typedef {Object} DeepLinkOptions\n * @property {string} url The URL to be opened. This parameter is manadatory\n * @property {string?} bundleId The bundle identifier of an application to open the\n * given url with. If not provided then the default application for the given url scheme\n * is going to be used.\n */\n\n/**\n * Opens the given URL with the default or the given application\n *\n * @param {DeepLinkOptions} opts\n */\ncommands.mobileDeepLink = async function mobileDeepLink (opts = {}) {\n  const {\n    url,\n    bundleId,\n  } = requireArgs('url', opts);\n\n  return await this.proxyCommand('/url', 'POST', {\n    url,\n    bundleId,\n  });\n};\n\nObject.assign(extensions, commands, helpers);\nexport { commands, helpers };\nexport default extensions;\n"],"mappings":"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"}