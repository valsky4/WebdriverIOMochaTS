"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;
require("source-map-support/register");
var _pyIosDeviceClient = _interopRequireDefault(require("../py-ios-device-client"));
var _support = require("appium/support");
var _utils = require("../utils");
var _driver = require("appium/driver");
const MAX_CAPTURE_TIME_SEC = 60 * 60 * 12;
const DEFAULT_CAPTURE_TIME_SEC = 60 * 5;
const DEFAULT_EXT = '.pcap';
const pcapLogger = _support.logger.getLogger('pcapd');
const commands = {};
exports.commands = commands;
class TrafficCapture {
  constructor(udid, log, resultPath) {
    this.udid = udid;
    this.log = log;
    this.resultPath = resultPath;
    this.mainProcess = null;
  }
  async start(timeoutSeconds) {
    this.mainProcess = await new _pyIosDeviceClient.default(this.udid).collectPcap(this.resultPath);
    this.mainProcess.on('output', (stdout, stderr) => {
      if (stderr) {
        pcapLogger.info(`${stderr}`);
      }
    });
    this.log.info(`Starting network traffic capture session on the device '${this.udid}'. ` + `Will timeout in ${timeoutSeconds}s`);
    setTimeout(async () => await this.interrupt(), timeoutSeconds * 1000);
    this.mainProcess.once('exit', (code, signal) => {
      this.log.debug(`The traffic capture session on the device '${this.udid}' has exited ` + `with code ${code}, signal ${signal}`);
    });
  }
  isCapturing() {
    var _this$mainProcess;
    return !!((_this$mainProcess = this.mainProcess) !== null && _this$mainProcess !== void 0 && _this$mainProcess.isRunning);
  }
  async interrupt(force = false) {
    if (this.isCapturing()) {
      const interruptPromise = this.mainProcess.stop(force ? 'SIGTERM' : 'SIGINT');
      this.mainProcess = null;
      try {
        await interruptPromise;
      } catch (e) {
        this.log.warn(`Cannot ${force ? 'terminate' : 'interrupt'} the traffic capture session. ` + `Original error: ${e.message}`);
        return false;
      }
    }
    return true;
  }
  async finish() {
    await this.interrupt();
    return this.resultPath;
  }
  async cleanup() {
    if (await _support.fs.exists(this.resultPath)) {
      await _support.fs.rimraf(this.resultPath);
    }
  }
}
commands.mobileStartPcap = async function mobileStartPcap(options = {}) {
  var _this$_trafficCapture;
  if (this.isSimulator()) {
    this.log.errorAndThrow('Network traffic capture only works on real devices');
  }
  const {
    timeLimitSec = DEFAULT_CAPTURE_TIME_SEC,
    forceRestart
  } = options;
  if ((_this$_trafficCapture = this._trafficCapture) !== null && _this$_trafficCapture !== void 0 && _this$_trafficCapture.isCapturing()) {
    this.log.info(`There is an active traffic capture process`);
    if (forceRestart) {
      this.log.info(`Stopping it because 'forceRestart' option is set to true`);
      await this._trafficCapture.interrupt(true);
    } else {
      this.log.info(`Doing nothing. ` + `Set 'forceRestart' option to true if you'd like to start a new traffic capture session`);
      return;
    }
  }
  if (this._trafficCapture) {
    await this._trafficCapture.cleanup();
    this._trafficCapture = null;
  }
  const resultPath = await _support.tempDir.path({
    prefix: `appium_${_support.util.uuidV4().substring(0, 8)}`,
    suffix: DEFAULT_EXT
  });
  const trafficCollector = new TrafficCapture(this.opts.device.udid, this.log, resultPath);
  const timeoutSeconds = parseInt(timeLimitSec, 10);
  if (isNaN(timeoutSeconds) || timeoutSeconds > MAX_CAPTURE_TIME_SEC || timeoutSeconds <= 0) {
    throw new _driver.errors.InvalidArgumentError(`The timeLimitSec value must be in range [1, ${MAX_CAPTURE_TIME_SEC}] seconds. ` + `The value of '${timeLimitSec}' has been passed instead.`);
  }
  try {
    await trafficCollector.start(timeoutSeconds);
  } catch (e) {
    await trafficCollector.interrupt(true);
    await trafficCollector.cleanup();
    throw e;
  }
  this._trafficCapture = trafficCollector;
};
commands.mobileStopPcap = async function mobileStopPcap() {
  if (!this._trafficCapture) {
    this.log.info('Network traffic collector has not been started. There is nothing to stop');
    return '';
  }
  let resultPath;
  try {
    resultPath = await this._trafficCapture.finish();
    if (!(await _support.fs.exists(resultPath))) {
      this.log.errorAndThrow(`The network traffic capture utility has failed ` + `to store the actual traffic capture at '${resultPath}'`);
    }
  } catch (e) {
    await this._trafficCapture.interrupt(true);
    await this._trafficCapture.cleanup();
    this._trafficCapture = null;
    throw e;
  }
  return await (0, _utils.encodeBase64OrUpload)(resultPath);
};
var _default = commands;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcHlJb3NEZXZpY2VDbGllbnQiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9zdXBwb3J0IiwiX3V0aWxzIiwiX2RyaXZlciIsIk1BWF9DQVBUVVJFX1RJTUVfU0VDIiwiREVGQVVMVF9DQVBUVVJFX1RJTUVfU0VDIiwiREVGQVVMVF9FWFQiLCJwY2FwTG9nZ2VyIiwibG9nZ2VyIiwiZ2V0TG9nZ2VyIiwiY29tbWFuZHMiLCJleHBvcnRzIiwiVHJhZmZpY0NhcHR1cmUiLCJjb25zdHJ1Y3RvciIsInVkaWQiLCJsb2ciLCJyZXN1bHRQYXRoIiwibWFpblByb2Nlc3MiLCJzdGFydCIsInRpbWVvdXRTZWNvbmRzIiwiUHlpZGV2aWNlIiwiY29sbGVjdFBjYXAiLCJvbiIsInN0ZG91dCIsInN0ZGVyciIsImluZm8iLCJzZXRUaW1lb3V0IiwiaW50ZXJydXB0Iiwib25jZSIsImNvZGUiLCJzaWduYWwiLCJkZWJ1ZyIsImlzQ2FwdHVyaW5nIiwiX3RoaXMkbWFpblByb2Nlc3MiLCJpc1J1bm5pbmciLCJmb3JjZSIsImludGVycnVwdFByb21pc2UiLCJzdG9wIiwiZSIsIndhcm4iLCJtZXNzYWdlIiwiZmluaXNoIiwiY2xlYW51cCIsImZzIiwiZXhpc3RzIiwicmltcmFmIiwibW9iaWxlU3RhcnRQY2FwIiwib3B0aW9ucyIsIl90aGlzJF90cmFmZmljQ2FwdHVyZSIsImlzU2ltdWxhdG9yIiwiZXJyb3JBbmRUaHJvdyIsInRpbWVMaW1pdFNlYyIsImZvcmNlUmVzdGFydCIsIl90cmFmZmljQ2FwdHVyZSIsInRlbXBEaXIiLCJwYXRoIiwicHJlZml4IiwidXRpbCIsInV1aWRWNCIsInN1YnN0cmluZyIsInN1ZmZpeCIsInRyYWZmaWNDb2xsZWN0b3IiLCJvcHRzIiwiZGV2aWNlIiwicGFyc2VJbnQiLCJpc05hTiIsImVycm9ycyIsIkludmFsaWRBcmd1bWVudEVycm9yIiwibW9iaWxlU3RvcFBjYXAiLCJlbmNvZGVCYXNlNjRPclVwbG9hZCIsIl9kZWZhdWx0IiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9jb21tYW5kcy9wY2FwLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQeWlkZXZpY2UgZnJvbSAnLi4vcHktaW9zLWRldmljZS1jbGllbnQnO1xuaW1wb3J0IHsgZnMsIHRlbXBEaXIsIGxvZ2dlciwgdXRpbCB9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcbmltcG9ydCB7IGVuY29kZUJhc2U2NE9yVXBsb2FkIH0gZnJvbSAnLi4vdXRpbHMnO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtL2RyaXZlcic7XG5cblxuY29uc3QgTUFYX0NBUFRVUkVfVElNRV9TRUMgPSA2MCAqIDYwICogMTI7XG5jb25zdCBERUZBVUxUX0NBUFRVUkVfVElNRV9TRUMgPSA2MCAqIDU7XG5jb25zdCBERUZBVUxUX0VYVCA9ICcucGNhcCc7XG5jb25zdCBwY2FwTG9nZ2VyID0gbG9nZ2VyLmdldExvZ2dlcigncGNhcGQnKTtcblxuY29uc3QgY29tbWFuZHMgPSB7fTtcblxuXG5jbGFzcyBUcmFmZmljQ2FwdHVyZSB7XG4gIGNvbnN0cnVjdG9yICh1ZGlkLCBsb2csIHJlc3VsdFBhdGgpIHtcbiAgICB0aGlzLnVkaWQgPSB1ZGlkO1xuICAgIHRoaXMubG9nID0gbG9nO1xuICAgIHRoaXMucmVzdWx0UGF0aCA9IHJlc3VsdFBhdGg7XG4gICAgdGhpcy5tYWluUHJvY2VzcyA9IG51bGw7XG4gIH1cblxuICBhc3luYyBzdGFydCAodGltZW91dFNlY29uZHMpIHtcbiAgICB0aGlzLm1haW5Qcm9jZXNzID0gYXdhaXQgbmV3IFB5aWRldmljZSh0aGlzLnVkaWQpLmNvbGxlY3RQY2FwKHRoaXMucmVzdWx0UGF0aCk7XG4gICAgdGhpcy5tYWluUHJvY2Vzcy5vbignb3V0cHV0JywgKHN0ZG91dCwgc3RkZXJyKSA9PiB7XG4gICAgICBpZiAoc3RkZXJyKSB7XG4gICAgICAgIHBjYXBMb2dnZXIuaW5mbyhgJHtzdGRlcnJ9YCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5sb2cuaW5mbyhgU3RhcnRpbmcgbmV0d29yayB0cmFmZmljIGNhcHR1cmUgc2Vzc2lvbiBvbiB0aGUgZGV2aWNlICcke3RoaXMudWRpZH0nLiBgICtcbiAgICAgIGBXaWxsIHRpbWVvdXQgaW4gJHt0aW1lb3V0U2Vjb25kc31zYCk7XG4gICAgc2V0VGltZW91dChhc3luYyAoKSA9PiBhd2FpdCB0aGlzLmludGVycnVwdCgpLCB0aW1lb3V0U2Vjb25kcyAqIDEwMDApO1xuICAgIHRoaXMubWFpblByb2Nlc3Mub25jZSgnZXhpdCcsIChjb2RlLCBzaWduYWwpID0+IHtcbiAgICAgIHRoaXMubG9nLmRlYnVnKGBUaGUgdHJhZmZpYyBjYXB0dXJlIHNlc3Npb24gb24gdGhlIGRldmljZSAnJHt0aGlzLnVkaWR9JyBoYXMgZXhpdGVkIGAgK1xuICAgICAgICBgd2l0aCBjb2RlICR7Y29kZX0sIHNpZ25hbCAke3NpZ25hbH1gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGlzQ2FwdHVyaW5nICgpIHtcbiAgICByZXR1cm4gISEodGhpcy5tYWluUHJvY2Vzcz8uaXNSdW5uaW5nKTtcbiAgfVxuXG4gIGFzeW5jIGludGVycnVwdCAoZm9yY2UgPSBmYWxzZSkge1xuICAgIGlmICh0aGlzLmlzQ2FwdHVyaW5nKCkpIHtcbiAgICAgIGNvbnN0IGludGVycnVwdFByb21pc2UgPSB0aGlzLm1haW5Qcm9jZXNzLnN0b3AoZm9yY2UgPyAnU0lHVEVSTScgOiAnU0lHSU5UJyk7XG4gICAgICB0aGlzLm1haW5Qcm9jZXNzID0gbnVsbDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGludGVycnVwdFByb21pc2U7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRoaXMubG9nLndhcm4oYENhbm5vdCAke2ZvcmNlID8gJ3Rlcm1pbmF0ZScgOiAnaW50ZXJydXB0J30gdGhlIHRyYWZmaWMgY2FwdHVyZSBzZXNzaW9uLiBgICtcbiAgICAgICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBhc3luYyBmaW5pc2ggKCkge1xuICAgIGF3YWl0IHRoaXMuaW50ZXJydXB0KCk7XG4gICAgcmV0dXJuIHRoaXMucmVzdWx0UGF0aDtcbiAgfVxuXG4gIGFzeW5jIGNsZWFudXAgKCkge1xuICAgIGlmIChhd2FpdCBmcy5leGlzdHModGhpcy5yZXN1bHRQYXRoKSkge1xuICAgICAgYXdhaXQgZnMucmltcmFmKHRoaXMucmVzdWx0UGF0aCk7XG4gICAgfVxuICB9XG59XG5cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBTdGFydENhcHR1cmVPcHRpb25zXG4gKlxuICogQHByb3BlcnR5IHs/c3RyaW5nfG51bWJlcn0gdGltZUxpbWl0U2VjIFsxODBdIC0gVGhlIG1heGltdW0gdHJhZmZpYyBjYXB0dXJlIHRpbWUsIGluIHNlY29uZHMuXG4gKiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyAxODAsIHRoZSBtYXhpbXVtIHZhbHVlIGlzIDQzMjAwICgxMiBob3VycykuXG4gKiBAcHJvcGVydHkgez9ib29sZWFufSBmb3JjZVJlc3RhcnQgW2ZhbHNlXSAtIFdoZXRoZXIgdG8gcmVzdGFydCBhdWRpbyBjYXB0dXJlIHByb2Nlc3MgZm9yY2VmdWxseSB3aGVuXG4gKiBzdGFydFBjYXAgaXMgY2FsbGVkIChgdHJ1ZWApIG9yIGlnbm9yZSB0aGUgY2FsbCB1bnRpbCB0aGUgY3VycmVudCBuZXR3b3JrIHRyYWZmaWMgY2FwdHVyZSBpcyBjb21wbGV0ZWQuXG4gKi9cblxuLyoqXG4gKiBSZWNvcmRzIHRoZSBnaXZlbiBuZXR3b3JrIHRyYWZmaWMgY2FwdHVyZSBpbnRvIGEgLnBjYXAgZmlsZS5cbiAqXG4gKiBAcGFyYW0gez9TdGFydENhcHR1cmVPcHRpb25zfSBvcHRpb25zIC0gVGhlIGF2YWlsYWJsZSBvcHRpb25zLlxuICogQHRocm93cyB7RXJyb3J9IElmIG5ldHdvcmsgdHJhZmZpYyBjYXB0dXJlIGhhcyBmYWlsZWQgdG8gc3RhcnQuXG4gKi9cbmNvbW1hbmRzLm1vYmlsZVN0YXJ0UGNhcCA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVN0YXJ0UGNhcCAob3B0aW9ucyA9IHt9KSB7XG4gIGlmICh0aGlzLmlzU2ltdWxhdG9yKCkpIHtcbiAgICB0aGlzLmxvZy5lcnJvckFuZFRocm93KCdOZXR3b3JrIHRyYWZmaWMgY2FwdHVyZSBvbmx5IHdvcmtzIG9uIHJlYWwgZGV2aWNlcycpO1xuICB9XG5cbiAgY29uc3Qge1xuICAgIHRpbWVMaW1pdFNlYyA9IERFRkFVTFRfQ0FQVFVSRV9USU1FX1NFQyxcbiAgICBmb3JjZVJlc3RhcnQsXG4gIH0gPSBvcHRpb25zO1xuXG4gIGlmICh0aGlzLl90cmFmZmljQ2FwdHVyZT8uaXNDYXB0dXJpbmcoKSkge1xuICAgIHRoaXMubG9nLmluZm8oYFRoZXJlIGlzIGFuIGFjdGl2ZSB0cmFmZmljIGNhcHR1cmUgcHJvY2Vzc2ApO1xuICAgIGlmIChmb3JjZVJlc3RhcnQpIHtcbiAgICAgIHRoaXMubG9nLmluZm8oYFN0b3BwaW5nIGl0IGJlY2F1c2UgJ2ZvcmNlUmVzdGFydCcgb3B0aW9uIGlzIHNldCB0byB0cnVlYCk7XG4gICAgICBhd2FpdCB0aGlzLl90cmFmZmljQ2FwdHVyZS5pbnRlcnJ1cHQodHJ1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubG9nLmluZm8oYERvaW5nIG5vdGhpbmcuIGAgK1xuICAgICAgICBgU2V0ICdmb3JjZVJlc3RhcnQnIG9wdGlvbiB0byB0cnVlIGlmIHlvdSdkIGxpa2UgdG8gc3RhcnQgYSBuZXcgdHJhZmZpYyBjYXB0dXJlIHNlc3Npb25gKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgaWYgKHRoaXMuX3RyYWZmaWNDYXB0dXJlKSB7XG4gICAgYXdhaXQgdGhpcy5fdHJhZmZpY0NhcHR1cmUuY2xlYW51cCgpO1xuICAgIHRoaXMuX3RyYWZmaWNDYXB0dXJlID0gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IHJlc3VsdFBhdGggPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe1xuICAgIHByZWZpeDogYGFwcGl1bV8ke3V0aWwudXVpZFY0KCkuc3Vic3RyaW5nKDAsIDgpfWAsXG4gICAgc3VmZml4OiBERUZBVUxUX0VYVCxcbiAgfSk7XG5cbiAgY29uc3QgdHJhZmZpY0NvbGxlY3RvciA9IG5ldyBUcmFmZmljQ2FwdHVyZSh0aGlzLm9wdHMuZGV2aWNlLnVkaWQsIHRoaXMubG9nLCByZXN1bHRQYXRoKTtcblxuICBjb25zdCB0aW1lb3V0U2Vjb25kcyA9IHBhcnNlSW50KHRpbWVMaW1pdFNlYywgMTApO1xuICBpZiAoaXNOYU4odGltZW91dFNlY29uZHMpIHx8IHRpbWVvdXRTZWNvbmRzID4gTUFYX0NBUFRVUkVfVElNRV9TRUMgfHwgdGltZW91dFNlY29uZHMgPD0gMCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZEFyZ3VtZW50RXJyb3IoYFRoZSB0aW1lTGltaXRTZWMgdmFsdWUgbXVzdCBiZSBpbiByYW5nZSBbMSwgJHtNQVhfQ0FQVFVSRV9USU1FX1NFQ31dIHNlY29uZHMuIGAgK1xuICAgICAgYFRoZSB2YWx1ZSBvZiAnJHt0aW1lTGltaXRTZWN9JyBoYXMgYmVlbiBwYXNzZWQgaW5zdGVhZC5gKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgYXdhaXQgdHJhZmZpY0NvbGxlY3Rvci5zdGFydCh0aW1lb3V0U2Vjb25kcyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBhd2FpdCB0cmFmZmljQ29sbGVjdG9yLmludGVycnVwdCh0cnVlKTtcbiAgICBhd2FpdCB0cmFmZmljQ29sbGVjdG9yLmNsZWFudXAoKTtcbiAgICB0aHJvdyBlO1xuICB9XG4gIHRoaXMuX3RyYWZmaWNDYXB0dXJlID0gdHJhZmZpY0NvbGxlY3Rvcjtcbn07XG5cbi8qKlxuICogU3RvcCBjYXB0dXJlIG9mIHRoZSBkZXZpY2UgbmV0d29yayB0cmFmZmljLiBJZiBubyB0cmFmZmljIGNhcHR1cmUgcHJvY2VzcyBpcyBydW5uaW5nIHRoZW5cbiAqIHRoZSBlbmRwb2ludCB3aWxsIHRyeSB0byBnZXQgdGhlIHJlY2VudGx5IHJlY29yZGVkIGZpbGUuXG4gKiBJZiBubyBwcmV2aW91c2x5IHJlY29yZGVkIGZpbGUgaXMgZm91bmQgYW5kIG5vIGFjdGl2ZSB0cmFmZmljIGNhcHR1cmVcbiAqIHByb2Nlc3NlcyBhcmUgcnVubmluZyB0aGVuIHRoZSBtZXRob2QgcmV0dXJucyBhbiBlbXB0eSBzdHJpbmcuXG4gKlxuICogQHJldHVybnMge3N0cmluZ30gQmFzZTY0LWVuY29kZWQgY29udGVudCBvZiB0aGUgcmVjb3JkZWQgcGNhcCBmaWxlIG9yIGFuXG4gKiBlbXB0eSBzdHJpbmcgaWYgbm8gdHJhZmZpYyBjYXB0dXJlIGhhcyBiZWVuIHN0YXJ0ZWQgYmVmb3JlLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBnZXR0aW5nIHRoZSBjYXB0dXJlIGZpbGUuXG4gKi9cbmNvbW1hbmRzLm1vYmlsZVN0b3BQY2FwID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlU3RvcFBjYXAgKCkge1xuICBpZiAoIXRoaXMuX3RyYWZmaWNDYXB0dXJlKSB7XG4gICAgdGhpcy5sb2cuaW5mbygnTmV0d29yayB0cmFmZmljIGNvbGxlY3RvciBoYXMgbm90IGJlZW4gc3RhcnRlZC4gVGhlcmUgaXMgbm90aGluZyB0byBzdG9wJyk7XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgbGV0IHJlc3VsdFBhdGg7XG4gIHRyeSB7XG4gICAgcmVzdWx0UGF0aCA9IGF3YWl0IHRoaXMuX3RyYWZmaWNDYXB0dXJlLmZpbmlzaCgpO1xuICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHJlc3VsdFBhdGgpKSB7XG4gICAgICB0aGlzLmxvZy5lcnJvckFuZFRocm93KGBUaGUgbmV0d29yayB0cmFmZmljIGNhcHR1cmUgdXRpbGl0eSBoYXMgZmFpbGVkIGAgK1xuICAgICAgICBgdG8gc3RvcmUgdGhlIGFjdHVhbCB0cmFmZmljIGNhcHR1cmUgYXQgJyR7cmVzdWx0UGF0aH0nYCk7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgYXdhaXQgdGhpcy5fdHJhZmZpY0NhcHR1cmUuaW50ZXJydXB0KHRydWUpO1xuICAgIGF3YWl0IHRoaXMuX3RyYWZmaWNDYXB0dXJlLmNsZWFudXAoKTtcbiAgICB0aGlzLl90cmFmZmljQ2FwdHVyZSA9IG51bGw7XG4gICAgdGhyb3cgZTtcbiAgfVxuICByZXR1cm4gYXdhaXQgZW5jb2RlQmFzZTY0T3JVcGxvYWQocmVzdWx0UGF0aCk7XG59O1xuXG5leHBvcnQgeyBjb21tYW5kcyB9O1xuZXhwb3J0IGRlZmF1bHQgY29tbWFuZHM7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsSUFBQUEsa0JBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFFBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLE1BQUEsR0FBQUYsT0FBQTtBQUNBLElBQUFHLE9BQUEsR0FBQUgsT0FBQTtBQUdBLE1BQU1JLG9CQUFvQixHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRTtBQUN6QyxNQUFNQyx3QkFBd0IsR0FBRyxFQUFFLEdBQUcsQ0FBQztBQUN2QyxNQUFNQyxXQUFXLEdBQUcsT0FBTztBQUMzQixNQUFNQyxVQUFVLEdBQUdDLGVBQU0sQ0FBQ0MsU0FBUyxDQUFDLE9BQU8sQ0FBQztBQUU1QyxNQUFNQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO0FBQUNDLE9BQUEsQ0FBQUQsUUFBQSxHQUFBQSxRQUFBO0FBR3BCLE1BQU1FLGNBQWMsQ0FBQztFQUNuQkMsV0FBV0EsQ0FBRUMsSUFBSSxFQUFFQyxHQUFHLEVBQUVDLFVBQVUsRUFBRTtJQUNsQyxJQUFJLENBQUNGLElBQUksR0FBR0EsSUFBSTtJQUNoQixJQUFJLENBQUNDLEdBQUcsR0FBR0EsR0FBRztJQUNkLElBQUksQ0FBQ0MsVUFBVSxHQUFHQSxVQUFVO0lBQzVCLElBQUksQ0FBQ0MsV0FBVyxHQUFHLElBQUk7RUFDekI7RUFFQSxNQUFNQyxLQUFLQSxD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