{"version":3,"file":"web.js","names":["_asyncbox","require","_support","_lodash","_interopRequireDefault","_bluebird","_driver","_cookies","_events","IPHONE_TOP_BAR_HEIGHT","IPHONE_SCROLLED_TOP_BAR_HEIGHT","IPHONE_X_SCROLLED_OFFSET","IPHONE_X_NOTCH_OFFSET_IOS","IPHONE_X_NOTCH_OFFSET_IOS_13","IPHONE_LANDSCAPE_TOP_BAR_HEIGHT","IPHONE_BOTTOM_BAR_OFFSET","TAB_BAR_OFFSET","IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET","IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET","NOTCHED_DEVICE_SIZES","w","h","W3C_WEB_ELEMENT_IDENTIFIER","util","ATOM_WAIT_TIMEOUT_MS","ATOM_INITIAL_WAIT_MS","ON_OBSTRUCTING_ALERT_EVENT","ON_APP_CRASH_EVENT","VISIBLE","INVISIBLE","DETECT","VISIBILITIES","TAB_BAR_POSITION_TOP","TAB_BAR_POSITION_BOTTOM","TAB_BAR_POSSITIONS","commands","helpers","extensions","isValidElementIdentifier","id","_","isString","isNumber","isEmpty","isNaN","setFrame","frame","isWebContext","errors","NotImplementedError","isNull","curWebFrames","log","debug","hasElementId","atomsElement","getAtomsElement","value","executeAtom","WINDOW","unshift","atom","isUndefined","NoSuchFrameError","getCssProperty","propertyName","el","submit","refresh","getUrl","remote","execute","title","setCookie","cookie","clone","path","jsCookie","cookieUtils","createJSCookie","name","expires","expiry","Date","toUTCString","domain","httpOnly","secure","script","JSON","stringify","cacheWebElement","isPlainObject","elId","unwrapElement","cacheId","includes","uuidV4","webElementsCache","set","wrapElement","cacheWebElements","response","toCached","v","isArray","map","result","toPairs","reduce","acc","key","findWebElementOrElements","strategy","selector","many","ctx","contextElement","isNil","element","doFind","implicitWaitForCondition","err","message","isFunction","match","NoSuchElementError","clickWebCoords","coords","translateWebCoords","curWebCoords","clickCoords","args","alwaysDefaultFrame","frames","promise","waitForAtom","executeAtomAsync","responseUrl","B","resolve","reject","asyncPromise","elOrId","has","StaleElementReferenceError","ELEMENT","get","convertElementsForAtoms","arg","isErrorType","getElementId","hasValue","getSafariIsIphone","isBoolean","_isSafariIphone","userAgent","toLowerCase","warn","getSafariDeviceSize","width","height","normHeight","normWidth","getSafariIsNotched","_isSafariNotched","device","getExtraTranslateWebCoordsOffset","wvPos","realDims","topOffset","bottomOffset","isIphone","nativeWebTapTabBarVisibility","nativeWebTapSmartAppBannerVisibility","safariTabBarPosition","compareVersions","opts","platformVersion","settings","getSettings","tabBarVisibility","lowerCase","bannerVisibility","tabBarPosition","InvalidArgumentError","isNotched","orientation","notchOffset","isScrolled","contextsAndViews","getContextsAndViews","tabs","filter","startsWith","length","getExtraNativeWebTapOffset","y","offset","banners","findNativeElementOrElements","tapWebElementNatively","driver","text","els","rect","proxyCommand","el2","rect2","x","Math","round","nativeWebTap","nativeWebTapStrict","Promise","all","size","coordinates","performTouch","action","options","webview","retryInterval","ign","Error","cmd","wvDims","implicitWaitMs","setImplicitWait","xRatio","yRatio","newCoords","checkForAlert","getAlertText","timer","timing","Timer","start","timedAtomPromise","timeout","handlePromiseError","p","originalError","AggregateError","TimeoutError","getDuration","asMilliSeconds","toFixed","any","delay","isFulfilled","_waitingAtoms","count","alertNotifier","EventEmitter","alertMonitor","onAlertCallback","onAppCrashCallback","isResolved","emit","InvalidElementStateError","UnexpectedAlertOpenError","once","then","catch","removeListener","mobileWebNav","navType","allowNavigationWithoutReload","mobileUpdateSafariPreferences","isSimulator","preferences","updateSafariSettings","Object","assign","_default","exports","default"],"sources":["../../../lib/commands/web.js"],"sourcesContent":["import { retryInterval } from 'asyncbox';\nimport { util, timing } from 'appium/support';\nimport _ from 'lodash';\nimport B from 'bluebird';\nimport { errors, isErrorType } from 'appium/driver';\nimport cookieUtils from '../cookies';\nimport { EventEmitter } from 'events';\n\nconst IPHONE_TOP_BAR_HEIGHT = 71;\nconst IPHONE_SCROLLED_TOP_BAR_HEIGHT = 41;\nconst IPHONE_X_SCROLLED_OFFSET = 55;\nconst IPHONE_X_NOTCH_OFFSET_IOS = 24;\nconst IPHONE_X_NOTCH_OFFSET_IOS_13 = 20;\n\nconst IPHONE_LANDSCAPE_TOP_BAR_HEIGHT = 51;\nconst IPHONE_BOTTOM_BAR_OFFSET = 49;\nconst TAB_BAR_OFFSET = 33;\nconst IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET = 84;\nconst IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET = 95;\n\nconst NOTCHED_DEVICE_SIZES = [\n  {w: 1125, h: 2436}, // 11 Pro, X, Xs\n  {w: 828, h: 1792}, // 11, Xr\n  {w: 1242, h: 2688}, // 11 Pro Max, Xs Max\n  {w: 1080, h: 2340}, // 13 mini, 12 mini\n  {w: 1170, h: 2532}, // 14, 13, 13 Pro, 12, 12 Pro\n  {w: 1284, h: 2778}, // 14 Plus, 13 Pro Max, 12 Pro Max\n  {w: 1179, h: 2556}, // 14 Pro\n  {w: 1290, h: 2796}, // 14 Pro Max\n];\n\nconst { W3C_WEB_ELEMENT_IDENTIFIER } = util;\n\nconst ATOM_WAIT_TIMEOUT_MS = 2 * 60000;\nconst ATOM_INITIAL_WAIT_MS = 1000;\n\nconst ON_OBSTRUCTING_ALERT_EVENT = 'alert';\nconst ON_APP_CRASH_EVENT = 'app_crash';\n\nconst VISIBLE = 'visible';\nconst INVISIBLE = 'invisible';\nconst DETECT = 'detect';\nconst VISIBILITIES = [VISIBLE, INVISIBLE, DETECT];\n\n// The position of Safari's tab (search bar).\n// Since iOS 15, the bar is the bottom by default.\nconst TAB_BAR_POSITION_TOP = 'top';\nconst TAB_BAR_POSITION_BOTTOM = 'bottom';\nconst TAB_BAR_POSSITIONS = [TAB_BAR_POSITION_TOP, TAB_BAR_POSITION_BOTTOM];\n\nconst commands = {}, helpers = {}, extensions = {};\n\nfunction isValidElementIdentifier (id) {\n  if (!_.isString(id) && !_.isNumber(id)) {\n    return false;\n  }\n  if (_.isString(id) && _.isEmpty(id)) {\n    return false;\n  }\n  if (_.isNumber(id) && isNaN(id)) {\n    return false;\n  }\n  return true;\n}\n\ncommands.setFrame = async function setFrame (frame) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  if (_.isNull(frame)) {\n    this.curWebFrames = [];\n    this.log.debug('Leaving web frame and going back to default content');\n    return;\n  }\n\n  if (helpers.hasElementId(frame)) {\n    const atomsElement = this.getAtomsElement(frame);\n    const value = await this.executeAtom('get_frame_window', [atomsElement]);\n    this.log.debug(`Entering new web frame: '${value.WINDOW}'`);\n    this.curWebFrames.unshift(value.WINDOW);\n  } else {\n    const atom = _.isNumber(frame) ? 'frame_by_index' : 'frame_by_id_or_name';\n    const value = await this.executeAtom(atom, [frame]);\n    if (_.isNull(value) || _.isUndefined(value.WINDOW)) {\n      throw new errors.NoSuchFrameError();\n    }\n    this.log.debug(`Entering new web frame: '${value.WINDOW}'`);\n    this.curWebFrames.unshift(value.WINDOW);\n  }\n};\n\ncommands.getCssProperty = async function getCssProperty (propertyName, el) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  const atomsElement = this.getAtomsElement(el);\n  return await this.executeAtom('get_value_of_css_property', [atomsElement, propertyName]);\n};\n\ncommands.submit = async function submit (el) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  const atomsElement = this.getAtomsElement(el);\n  await this.executeAtom('submit', [atomsElement]);\n};\n\ncommands.refresh = async function refresh () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  await this.executeAtom('refresh', []);\n};\n\ncommands.getUrl = async function getUrl () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  return await this.remote.execute('window.location.href');\n};\n\ncommands.title = async function title () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  return await this.executeAtom('title', [], true);\n};\n\ncommands.setCookie = async function setCookie (cookie) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  cookie = _.clone(cookie);\n\n  // if `path` field is not specified, Safari will not update cookies as expected; eg issue #1708\n  if (!cookie.path) {\n    cookie.path = '/';\n  }\n\n  const jsCookie = cookieUtils.createJSCookie(cookie.name, cookie.value, {\n    expires: _.isNumber(cookie.expiry) ? (new Date(cookie.expiry * 1000)).toUTCString() :\n      cookie.expiry,\n    path: cookie.path,\n    domain: cookie.domain,\n    httpOnly: cookie.httpOnly,\n    secure: cookie.secure\n  });\n  let script = `document.cookie = ${JSON.stringify(jsCookie)}`;\n  await this.executeAtom('execute_script', [script, []]);\n};\n\nhelpers.cacheWebElement = function cacheWebElement (el) {\n  if (!_.isPlainObject(el)) {\n    return el;\n  }\n  const elId = util.unwrapElement(el);\n  if (!isValidElementIdentifier(elId)) {\n    return el;\n  }\n  // In newer debugger releases element identifiers look like `:wdc:1628151649325`\n  // We assume it is safe to use these to identify cached elements\n  const cacheId = _.includes(elId, ':') ? elId : util.uuidV4();\n  this.webElementsCache.set(cacheId, elId);\n  return util.wrapElement(cacheId);\n};\n\nhelpers.cacheWebElements = function cacheWebElements (response) {\n  const toCached = (v) => _.isArray(v) || _.isPlainObject(v)\n    ? this.cacheWebElements(v)\n    : v;\n\n  if (_.isArray(response)) {\n    return response.map(toCached);\n  } else if (_.isPlainObject(response)) {\n    const result = {...response, ...(this.cacheWebElement(response))};\n    return _.toPairs(result).reduce(\n      (acc, [key, value]) => {\n        acc[key] = toCached(value);\n        return acc;\n      }, {}\n    );\n  }\n  return response;\n};\n\nextensions.findWebElementOrElements = async function findWebElementOrElements (strategy, selector, many, ctx) {\n  const contextElement = _.isNil(ctx) ? null : this.getAtomsElement(ctx);\n  let element;\n  let doFind = async () => {\n    element = await this.executeAtom(`find_element${many ? 's' : ''}`, [strategy, selector, contextElement]);\n    return !_.isNull(element);\n  };\n  try {\n    await this.implicitWaitForCondition(doFind);\n  } catch (err) {\n    if (err.message && _.isFunction(err.message.match) && err.message.match(/Condition unmet/)) {\n      // condition was not met setting res to empty array\n      element = [];\n    } else {\n      throw err;\n    }\n  }\n\n  if (many) {\n    return this.cacheWebElements(element);\n  }\n  if (_.isEmpty(element)) {\n    throw new errors.NoSuchElementError();\n  }\n  return this.cacheWebElements(element);\n};\n\nextensions.clickWebCoords = async function clickWebCoords () {\n  let coords = await this.translateWebCoords(this.curWebCoords);\n  await this.clickCoords(coords);\n};\n\nhelpers.executeAtom = async function executeAtom (atom, args, alwaysDefaultFrame = false) {\n  let frames = alwaysDefaultFrame === true ? [] : this.curWebFrames;\n  let promise = this.remote.executeAtom(atom, args, frames);\n  return await this.waitForAtom(promise);\n};\n\nhelpers.executeAtomAsync = async function executeAtomAsync (atom, args, responseUrl) {\n  // save the resolve and reject methods of the promise to be waited for\n  let promise = new B((resolve, reject) => {\n    this.asyncPromise = {resolve, reject};\n  });\n  await this.remote.executeAtomAsync(atom, args, this.curWebFrames, responseUrl);\n  return await this.waitForAtom(promise);\n};\n\nhelpers.getAtomsElement = function getAtomsElement (elOrId) {\n  const elId = util.unwrapElement(elOrId);\n  if (!this.webElementsCache.has(elId)) {\n    throw new errors.StaleElementReferenceError();\n  }\n  return {ELEMENT: this.webElementsCache.get(elId)};\n};\n\nhelpers.convertElementsForAtoms = function convertElementsForAtoms (args = []) {\n  return args.map((arg) => {\n    if (helpers.hasElementId(arg)) {\n      try {\n        return this.getAtomsElement(arg);\n      } catch (err) {\n        if (!isErrorType(err, errors.StaleElementReferenceError)) {\n          throw err;\n        }\n      }\n      return arg;\n    }\n    return _.isArray(arg) ? this.convertElementsForAtoms(arg) : arg;\n  });\n};\n\nhelpers.getElementId = function getElementId (element) {\n  return element.ELEMENT || element[W3C_WEB_ELEMENT_IDENTIFIER];\n};\n\nhelpers.hasElementId = function hasElementId (element) {\n  return util.hasValue(element) && (util.hasValue(element.ELEMENT) || util.hasValue(element[W3C_WEB_ELEMENT_IDENTIFIER]));\n};\n\nextensions.getSafariIsIphone = async function getSafariIsIphone () {\n  if (_.isBoolean(this._isSafariIphone)) {\n    return this._isSafariIphone;\n  }\n  try {\n    const userAgent = await this.execute('return navigator.userAgent');\n    this._isSafariIphone = userAgent.toLowerCase().includes('iphone');\n  } catch (err) {\n    this.log.warn(`Unable to find device type from useragent. Assuming iPhone`);\n    this.log.debug(`Error: ${err.message}`);\n  }\n  return this._isSafariIphone ?? true;\n};\n\nextensions.getSafariDeviceSize = async function getSafariDeviceSize () {\n  const script = 'return {height: window.screen.availHeight * window.devicePixelRatio, width: window.screen.availWidth * window.devicePixelRatio};';\n  const {width, height} = await this.execute(script);\n  const [normHeight, normWidth] = height > width ? [height, width] : [width, height];\n  return {\n    width: normWidth,\n    height: normHeight,\n  };\n};\n\nextensions.getSafariIsNotched = async function getSafariIsNotched () {\n  if (_.isBoolean(this._isSafariNotched)) {\n    return this._isSafariNotched;\n  }\n\n  try {\n    const {width, height} = await this.getSafariDeviceSize();\n    for (const device of NOTCHED_DEVICE_SIZES) {\n      if (device.w === width && device.h === height) {\n        this._isSafariNotched = true;\n      }\n    }\n  } catch (err) {\n    this.log.warn(`Unable to find device type from dimensions. Assuming the device is not notched`);\n    this.log.debug(`Error: ${err.message}`);\n  }\n  return this._isSafariNotched ?? false;\n};\n\nextensions.getExtraTranslateWebCoordsOffset = async function getExtraTranslateWebCoordsOffset (wvPos, realDims) {\n  let topOffset = 0;\n  let bottomOffset = 0;\n\n  const isIphone = await this.getSafariIsIphone();\n\n  // No need to check whether the Smart App Banner or Tab Bar is visible or not\n  // if already defined by nativeWebTapTabBarVisibility or nativeWebTapSmartAppBannerVisibility in settings.\n  const {\n    nativeWebTapTabBarVisibility,\n    nativeWebTapSmartAppBannerVisibility,\n    safariTabBarPosition = util.compareVersions(this.opts.platformVersion, '>=', '15.0') && isIphone\n      ? TAB_BAR_POSITION_BOTTOM : TAB_BAR_POSITION_TOP,\n  } = await this.settings.getSettings();\n  let tabBarVisibility = _.lowerCase(nativeWebTapTabBarVisibility);\n  let bannerVisibility = _.lowerCase(nativeWebTapSmartAppBannerVisibility);\n  const tabBarPosition = _.lowerCase(safariTabBarPosition);\n\n  if (!VISIBILITIES.includes(tabBarVisibility)) {\n    tabBarVisibility = DETECT;\n  }\n  if (!VISIBILITIES.includes(bannerVisibility)) {\n    bannerVisibility = DETECT;\n  }\n\n  if (!TAB_BAR_POSSITIONS.includes(tabBarPosition)) {\n    throw new errors.InvalidArgumentError(\n      `${safariTabBarPosition} is invalid as Safari tab bar position. Available positions are ${TAB_BAR_POSSITIONS}.`);\n  }\n\n  const isNotched = isIphone && await this.getSafariIsNotched();\n\n  const orientation = realDims.h > realDims.w ? 'PORTRAIT' : 'LANDSCAPE';\n\n  const notchOffset = isNotched\n    ? util.compareVersions(this.opts.platformVersion, '=', '13.0')\n      ? IPHONE_X_NOTCH_OFFSET_IOS_13\n      : IPHONE_X_NOTCH_OFFSET_IOS\n    : 0;\n\n  const isScrolled = await this.execute('return document.documentElement.scrollTop > 0');\n  if (isScrolled) {\n    topOffset = IPHONE_SCROLLED_TOP_BAR_HEIGHT + notchOffset;\n\n    if (isNotched) {\n      topOffset -= IPHONE_X_SCROLLED_OFFSET;\n    }\n\n    // If the iPhone is landscape then there is no top bar\n    if (orientation === 'LANDSCAPE' && isIphone) {\n      topOffset = 0;\n    }\n  } else {\n    topOffset = tabBarPosition === TAB_BAR_POSITION_BOTTOM ? 0 : IPHONE_TOP_BAR_HEIGHT;\n    topOffset += notchOffset;\n    this.log.debug(`tabBarPosition and topOffset: ${tabBarPosition}, ${topOffset}`);\n\n    if (isIphone) {\n      if (orientation === 'PORTRAIT') {\n        // The bottom bar is only visible when portrait\n        bottomOffset = IPHONE_BOTTOM_BAR_OFFSET;\n      } else {\n        topOffset = IPHONE_LANDSCAPE_TOP_BAR_HEIGHT;\n      }\n    }\n\n    if (orientation === 'LANDSCAPE' || !isIphone) {\n      if (tabBarVisibility === VISIBLE) {\n        topOffset += TAB_BAR_OFFSET;\n      } else if (tabBarVisibility === DETECT) {\n        // Tabs only appear if the device is landscape or if it's an iPad so we only check visibility in this case\n        // Assume that each tab bar is a WebView\n        const contextsAndViews = await this.getContextsAndViews();\n        const tabs = contextsAndViews.filter((ctx) => ctx.id.startsWith('WEBVIEW_'));\n\n        if (tabs.length > 1) {\n          this.log.debug(`Found ${tabs.length} tabs. Assuming the tab bar is visible`);\n          topOffset += TAB_BAR_OFFSET;\n        }\n      }\n    }\n  }\n\n  topOffset += await this.getExtraNativeWebTapOffset(isIphone, bannerVisibility);\n\n  wvPos.y += topOffset;\n  realDims.h -= (topOffset + bottomOffset);\n};\n\nextensions.getExtraNativeWebTapOffset = async function getExtraNativeWebTapOffset (isIphone, bannerVisibility) {\n  let offset = 0;\n\n  if (bannerVisibility === VISIBLE) {\n    offset += isIphone ?\n      IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET :\n      IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET;\n  } else if (bannerVisibility === DETECT) {\n    // try to see if there is an Smart App Banner\n    const banners = await this.findNativeElementOrElements('accessibility id', 'Close app download offer', true);\n    if (banners.length > 0) {\n      offset += isIphone ?\n        IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET :\n        IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET;\n    }\n  }\n\n  this.log.debug(`Additional native web tap offset computed: ${offset}`);\n  return offset;\n};\n\nasync function tapWebElementNatively (driver, atomsElement) {\n  // try to get the text of the element, which will be accessible in the\n  // native context\n  try {\n    let text = await driver.executeAtom('get_text', [atomsElement]);\n    if (!text) {\n      text = await driver.executeAtom('get_attribute_value', [atomsElement, 'value']);\n    }\n\n    if (text) {\n      const els = await driver.findNativeElementOrElements('accessibility id', text, true);\n      if (els.length === 1 || els.length === 2) {\n        const el = els[0];\n        // use tap because on iOS 11.2 and below `nativeClick` crashes WDA\n        const rect = await driver.proxyCommand(`/element/${util.unwrapElement(el)}/rect`, 'GET');\n        if (els.length === 2) {\n          const el2 = els[1];\n          const rect2 = await driver.proxyCommand(`/element/${util.unwrapElement(el2)}/rect`, 'GET');\n\n          if ((rect.x !== rect2.x || rect.y !== rect2.y) ||\n          (rect.width !== rect2.width || rect.height !== rect2.height)) {\n            // These 2 native elements are not referring to the same web element\n            return false;\n          }\n        }\n        const coords = {\n          x: Math.round(rect.x + rect.width / 2),\n          y: Math.round(rect.y + rect.height / 2),\n        };\n        await driver.clickCoords(coords);\n        return true;\n      }\n    }\n  } catch (err) {\n    // any failure should fall through and trigger the more elaborate\n    // method of clicking\n    driver.log.warn(`Error attempting to click: ${err.message}`);\n  }\n  return false;\n}\n\nextensions.nativeWebTap = async function nativeWebTap (el) {\n  const atomsElement = this.getAtomsElement(el);\n\n  // if strict native tap, do not try to do it with WDA directly\n  if (!(await this.settings.getSettings()).nativeWebTapStrict && await tapWebElementNatively(this, atomsElement)) {\n    return;\n  }\n  this.log.warn('Unable to do simple native web tap. Attempting to convert coordinates');\n\n  // `get_top_left_coordinates` returns the wrong value sometimes,\n  // unless we pre-call both of these functions before the actual calls\n  await B.Promise.all([\n    this.executeAtom('get_size', [atomsElement]),\n    this.executeAtom('get_top_left_coordinates', [atomsElement]),\n  ]);\n\n  const [size, coordinates] = await B.Promise.all([\n    this.executeAtom('get_size', [atomsElement]),\n    this.executeAtom('get_top_left_coordinates', [atomsElement]),\n  ]);\n  const {width, height} = size;\n  let {x, y} = coordinates;\n  x += width / 2;\n  y += height / 2;\n\n  this.curWebCoords = {x, y};\n  await this.clickWebCoords();\n};\n\nextensions.clickCoords = async function clickCoords (coords) {\n  await this.performTouch([\n    {\n      action: 'tap',\n      options: coords,\n    },\n  ]);\n};\n\nextensions.translateWebCoords = async function translateWebCoords (coords) {\n  this.log.debug(`Translating coordinates (${JSON.stringify(coords)}) to web coordinates`);\n\n  // absolutize web coords\n  let webview;\n  try {\n    webview = await retryInterval(5, 100, async () => await this.findNativeElementOrElements('class name', 'XCUIElementTypeWebView', false));\n  } catch (ign) {}\n\n  if (!webview) {\n    throw new Error(`No WebView found. Unable to translate web coordinates for native web tap.`);\n  }\n\n  webview = util.unwrapElement(webview);\n\n  const rect = await this.proxyCommand(`/element/${webview}/rect`, 'GET');\n  const wvPos = {x: rect.x, y: rect.y};\n  const realDims = {w: rect.width, h: rect.height};\n\n  const cmd = '(function () { return {w: window.innerWidth, h: window.innerHeight}; })()';\n  const wvDims = await this.remote.execute(cmd);\n\n  // keep track of implicit wait, and set locally to 0\n  // https://github.com/appium/appium/issues/14988\n  const implicitWaitMs = this.implicitWaitMs;\n  await this.setImplicitWait(0);\n  try {\n    await this.getExtraTranslateWebCoordsOffset(wvPos, realDims);\n  } finally {\n    await this.setImplicitWait(implicitWaitMs);\n  }\n\n  if (wvDims && realDims && wvPos) {\n    let xRatio = realDims.w / wvDims.w;\n    let yRatio = realDims.h / wvDims.h;\n    let newCoords = {\n      x: wvPos.x + Math.round(xRatio * coords.x),\n      y: wvPos.y + Math.round(yRatio * coords.y),\n    };\n\n    // additional logging for coordinates, since it is sometimes broken\n    //   see https://github.com/appium/appium/issues/9159\n    this.log.debug(`Converted coordinates: ${JSON.stringify(newCoords)}`);\n    this.log.debug(`    rect: ${JSON.stringify(rect)}`);\n    this.log.debug(`    wvPos: ${JSON.stringify(wvPos)}`);\n    this.log.debug(`    realDims: ${JSON.stringify(realDims)}`);\n    this.log.debug(`    wvDims: ${JSON.stringify(wvDims)}`);\n    this.log.debug(`    xRatio: ${JSON.stringify(xRatio)}`);\n    this.log.debug(`    yRatio: ${JSON.stringify(yRatio)}`);\n\n    this.log.debug(`Converted web coords ${JSON.stringify(coords)} ` +\n      `into real coords ${JSON.stringify(newCoords)}`);\n    return newCoords;\n  }\n};\n\nextensions.checkForAlert = async function checkForAlert () {\n  return _.isString(await this.getAlertText());\n};\n\nextensions.waitForAtom = async function waitForAtom (promise) {\n  const timer = new timing.Timer().start();\n\n  // need to check for alert while the atom is being executed.\n  // so notify ourselves when it happens\n  const timedAtomPromise = B.resolve(promise).timeout(ATOM_WAIT_TIMEOUT_MS);\n  const handlePromiseError = async (p) => {\n    try {\n      return await p;\n    } catch (err) {\n      const originalError = (err instanceof B.AggregateError) ? err[0] : err;\n      this.log.debug(`Error received while executing atom: ${originalError.message}`);\n      if (originalError instanceof B.TimeoutError) {\n        throw new errors.TimeoutError(`Did not get any response for atom execution after ` +\n          `${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);\n      }\n      throw originalError;\n    }\n  };\n  // if the atom promise is fulfilled within ATOM_INITIAL_WAIT_MS\n  // then we don't need to check for an alert presence\n  await handlePromiseError(B.any([B.delay(ATOM_INITIAL_WAIT_MS), timedAtomPromise]));\n  if (timedAtomPromise.isFulfilled()) {\n    return await timedAtomPromise;\n  }\n\n  // ...otherwise make sure there is no unexpected alert covering the element\n  if (!_.isPlainObject(this._waitingAtoms)) {\n    this._waitingAtoms = {\n      count: 0,\n      alertNotifier: new EventEmitter(),\n      alertMonitor: B.resolve(),\n    };\n  }\n  this._waitingAtoms.count++;\n\n  let onAlertCallback;\n  let onAppCrashCallback;\n  try {\n    // only restart the monitor if it is not running already\n    if (this._waitingAtoms.alertMonitor.isResolved()) {\n      this._waitingAtoms.alertMonitor = B.resolve((async () => {\n        while (this._waitingAtoms.count > 0) {\n          try {\n            if (await this.checkForAlert()) {\n              this._waitingAtoms.alertNotifier.emit(ON_OBSTRUCTING_ALERT_EVENT);\n            }\n          } catch (err) {\n            if (isErrorType(err, errors.InvalidElementStateError)) {\n              this._waitingAtoms.alertNotifier.emit(ON_APP_CRASH_EVENT, err);\n            }\n          }\n          await B.delay(ATOM_INITIAL_WAIT_MS / 2);\n        }\n      })());\n    }\n\n    return await new B((resolve, reject) => {\n      onAlertCallback = () => reject(new errors.UnexpectedAlertOpenError());\n      onAppCrashCallback = reject;\n      this._waitingAtoms.alertNotifier.once(ON_OBSTRUCTING_ALERT_EVENT, onAlertCallback);\n      this._waitingAtoms.alertNotifier.once(ON_APP_CRASH_EVENT, onAppCrashCallback);\n      handlePromiseError(timedAtomPromise)\n        // eslint-disable-next-line promise/prefer-await-to-then\n        .then(resolve)\n        .catch(reject);\n    });\n  } finally {\n    if (onAlertCallback) {\n      this._waitingAtoms.alertNotifier.removeListener(ON_OBSTRUCTING_ALERT_EVENT, onAlertCallback);\n    }\n    if (onAppCrashCallback) {\n      this._waitingAtoms.alertNotifier.removeListener(ON_APP_CRASH_EVENT, onAppCrashCallback);\n    }\n    this._waitingAtoms.count--;\n  }\n};\n\nextensions.mobileWebNav = async function mobileWebNav (navType) {\n  this.remote.allowNavigationWithoutReload = true;\n  try {\n    await this.executeAtom('execute_script', [`history.${navType}();`, null]);\n  } finally {\n    this.remote.allowNavigationWithoutReload = false;\n  }\n};\n\n/**\n * @typedef {Object} SafariOpts\n * @property {object} preferences An object containing Safari settings to be updated.\n * The list of available setting names and their values could be retrieved by\n * changing the corresponding Safari settings in the UI and then inspecting\n * 'Library/Preferences/com.apple.mobilesafari.plist' file inside of\n * com.apple.mobilesafari app container.\n * The full path to the Mobile Safari's container could be retrieved from\n * `xcrun simctl get_app_container <sim_udid> com.apple.mobilesafari data`\n * command output.\n * Use the `xcrun simctl spawn <sim_udid> defaults read <path_to_plist>` command\n * to print the plist content to the Terminal.\n */\n\n/**\n * Updates preferences of Mobile Safari on Simulator\n *\n * @param {SafariOpts} opts\n */\ncommands.mobileUpdateSafariPreferences = async function mobileUpdateSafariPreferences (opts = {}) {\n  if (!this.isSimulator()) {\n    throw new Error('This extension is only available for Simulator');\n  }\n  const { preferences } = opts;\n  if (!_.isPlainObject(preferences)) {\n    throw new errors.InvalidArgumentError('\"preferences\" argument must be a valid object');\n  }\n\n  this.log.debug(`About to update Safari preferences: ${JSON.stringify(preferences)}`);\n  await this.opts.device.updateSafariSettings(preferences);\n};\n\nObject.assign(commands, extensions, helpers);\n\nexport default commands;\n"],"mappings":";;;;;;;;AAAA,IAAAA,SAAA,GAAAC,OAAA;AACA,IAAAC,QAAA,GAAAD,OAAA;AACA,IAAAE,OAAA,GAAAC,sBAAA,CAAAH,OAAA;AACA,IAAAI,SAAA,GAAAD,sBAAA,CAAAH,OAAA;AACA,IAAAK,OAAA,GAAAL,OAAA;AACA,IAAAM,QAAA,GAAAH,sBAAA,CAAAH,OAAA;AACA,IAAAO,OAAA,GAAAP,OAAA;AAEA,MAAMQ,qBAAqB,GAAG,EAAE;AAChC,MAAMC,8BAA8B,GAAG,EAAE;AACzC,MAAMC,wBAAwB,GAAG,EAAE;AACnC,MAAMC,yBAAyB,GAAG,EAAE;AACpC,MAAMC,4BAA4B,GAAG,EAAE;AAEvC,MAAMC,+BAA+B,GAAG,EAAE;AAC1C,MAAMC,wBAAwB,GAAG,EAAE;AACnC,MAAMC,cAAc,GAAG,EAAE;AACzB,MAAMC,wCAAwC,GAAG,EAAE;AACnD,MAAMC,sCAAsC,GAAG,EAAE;AAEjD,MAAMC,oBAAoB,GAAG,CAC3B;EAACC,CAAC,EAAE,IAAI;EAAEC,CAAC,EAAE;AAAI,CAAC,EAClB;EAACD,CAAC,EAAE,GAAG;EAAEC,CAAC,EAAE;AAAI,CAAC,EACjB;EAACD,CAAC,EAAE,IAAI;EAAEC,CAAC,EAAE;AAAI,CAAC,EAClB;EAACD,CAAC,EAAE,IAAI;EAAEC,CAAC,EAAE;AAAI,CAAC,EAClB;EAACD,CAAC,EAAE,IAAI;EAAEC,CAAC,EAAE;AAAI,CAAC,EAClB;EAACD,CAAC,EAAE,IAAI;EAAEC,CAAC,EAAE;AAAI,CAAC,EAClB;EAACD,CAAC,EAAE,IAAI;EAAEC,CAAC,EAAE;AAAI,CAAC,EAClB;EAACD,CAAC,EAAE,IAAI;EAAEC,CAAC,EAAE;AAAI,CAAC,CACnB;AAED,MAAM;EAAEC;AAA2B,CAAC,GAAGC,aAAI;AAE3C,MAAMC,oBAAoB,GAAG,CAAC,GAAG,KAAK;AACtC,MAAMC,oBAAoB,GAAG,IAAI;AAEjC,MAAMC,0BAA0B,GAAG,OAAO;AAC1C,MAAMC,kBAAkB,GAAG,WAAW;AAEtC,MAAMC,OAAO,GAAG,SAAS;AACzB,MAAMC,SAAS,GAAG,WAAW;AAC7B,MAAMC,MAAM,GAAG,QAAQ;AACvB,MAAMC,YAAY,GAAG,CAACH,OAAO,EAAEC,SAAS,EAAEC,MAAM,CAAC;AAIjD,MAAME,oBAAoB,GAAG,KAAK;AAClC,MAAMC,uBAAuB,GAAG,QAAQ;AACxC,MAAMC,kBAAkB,GAAG,CAACF,oBAAoB,EAAEC,uBAAuB,CAAC;AAE1E,MAAME,QAAQ,GAAG,CAAC,CAAC;EAAEC,OAAO,GAAG,CAAC,CAAC;EAAEC,UAAU,GAAG,CAAC,CAAC;AAElD,SAASC,wBAAwBA,CAAEC,EAAE,EAAE;EACrC,IAAI,CAACC,eAAC,CAACC,QAAQ,CAACF,EAAE,CAAC,IAAI,CAACC,eAAC,CAACE,QAAQ,CAACH,EAAE,CAAC,EAAE;IACtC,OAAO,KAAK;EACd;EACA,IAAIC,eAAC,CAACC,QAAQ,CAACF,EAAE,CAAC,IAAIC,eAAC,CAACG,OAAO,CAACJ,EAAE,CAAC,EAAE;IACnC,OAAO,KAAK;EACd;EACA,IAAIC,eAAC,CAACE,QAAQ,CAACH,EAAE,CAAC,IAAIK,KAAK,CAACL,EAAE,CAAC,EAAE;IAC/B,OAAO,KAAK;EACd;EACA,OAAO,IAAI;AACb;AAEAJ,QAAQ,CAACU,QAAQ,GAAG,eAAeA,QAAQA,CAAEC,KAAK,EAAE;EAClD,IAAI,CAAC,IAAI,CAACC,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,IAAIT,eAAC,CAACU,MAAM,CAACJ,KAAK,CAAC,EAAE;IACnB,IAAI,CAACK,YAAY,GAAG,EAAE;IACtB,IAAI,CAACC,GAAG,CAACC,KAAK,CAAC,qDAAqD,CAAC;IACrE;EACF;EAEA,IAAIjB,OAAO,CAACkB,YAAY,CAACR,KAAK,CAAC,EAAE;IAC/B,MAAMS,YAAY,GAAG,IAAI,CAACC,eAAe,CAACV,KAAK,CAAC;IAChD,MAAMW,KAAK,GAAG,MAAM,IAAI,CAACC,WAAW,CAAC,kBAAkB,EAAE,CAACH,YAAY,CAAC,CAAC;IACxE,IAAI,CAACH,GAAG,CAACC,KAAK,CAAE,4BAA2BI,KAAK,CAACE,MAAO,GAAE,CAAC;IAC3D,IAAI,CAACR,YAAY,CAACS,OAAO,CAACH,KAAK,CAACE,MAAM,CAAC;EACzC,CAAC,MAAM;IACL,MAAME,IAAI,GAAGrB,eAAC,CAACE,QAAQ,CAACI,KAAK,CAAC,GAAG,gBAAgB,GAAG,qBAAqB;IACzE,MAAMW,KAAK,GAAG,MAAM,IAAI,CAACC,WAAW,CAACG,IAAI,EAAE,CAACf,KAAK,CAAC,CAAC;IACnD,IAAIN,eAAC,CAACU,MAAM,CAACO,KAAK,CAAC,IAAIjB,eAAC,CAACsB,WAAW,CAACL,KAAK,CAACE,MAAM,CAAC,EAAE;MAClD,MAAM,IAAIX,cAAM,CAACe,gBAAgB,EAAE;IACrC;IACA,IAAI,CAACX,GAAG,CAACC,KAAK,CAAE,4BAA2BI,KAAK,CAACE,MAAO,GAAE,CAAC;IAC3D,IAAI,CAACR,YAAY,CAACS,OAAO,CAACH,KAAK,CAACE,MAAM,CAAC;EACzC;AACF,CAAC;AAEDxB,QAAQ,CAAC6B,cAAc,GAAG,eAAeA,cAAcA,CAAEC,YAAY,EAAEC,EAAE,EAAE;EACzE,IAAI,CAAC,IAAI,CAACnB,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,MAAMM,YAAY,GAAG,IAAI,CAACC,eAAe,CAACU,EAAE,CAAC;EAC7C,OAAO,MAAM,IAAI,CAACR,WAAW,CAAC,2BAA2B,EAAE,CAACH,YAAY,EAAEU,YAAY,CAAC,CAAC;AAC1F,CAAC;AAED9B,QAAQ,CAACgC,MAAM,GAAG,eAAeA,MAAMA,CAAED,EAAE,EAAE;EAC3C,IAAI,CAAC,IAAI,CAACnB,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,MAAMM,YAAY,GAAG,IAAI,CAACC,eAAe,CAACU,EAAE,CAAC;EAC7C,MAAM,IAAI,CAACR,WAAW,CAAC,QAAQ,EAAE,CAACH,YAAY,CAAC,CAAC;AAClD,CAAC;AAEDpB,QAAQ,CAACiC,OAAO,GAAG,eAAeA,OAAOA,CAAA,EAAI;EAC3C,IAAI,CAAC,IAAI,CAACrB,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,MAAM,IAAI,CAACS,WAAW,CAAC,SAAS,EAAE,EAAE,CAAC;AACvC,CAAC;AAEDvB,QAAQ,CAACkC,MAAM,GAAG,eAAeA,MAAMA,CAAA,EAAI;EACzC,IAAI,CAAC,IAAI,CAACtB,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,OAAO,MAAM,IAAI,CAACqB,MAAM,CAACC,OAAO,CAAC,sBAAsB,CAAC;AAC1D,CAAC;AAEDpC,QAAQ,CAACqC,KAAK,GAAG,eAAeA,KAAKA,CAAA,EAAI;EACvC,IAAI,CAAC,IAAI,CAACzB,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEA,OAAO,MAAM,IAAI,CAACS,WAAW,CAAC,OAAO,EAAE,EAAE,EAAE,IAAI,CAAC;AAClD,CAAC;AAEDvB,QAAQ,CAACsC,SAAS,GAAG,eAAeA,SAASA,CAAEC,MAAM,EAAE;EACrD,IAAI,CAAC,IAAI,CAAC3B,YAAY,EAAE,EAAE;IACxB,MAAM,IAAIC,cAAM,CAACC,mBAAmB,EAAE;EACxC;EAEAyB,MAAM,GAAGlC,eAAC,CAACmC,KAAK,CAACD,MAAM,CAAC;EAGxB,IAAI,CAACA,MAAM,CAACE,IAAI,EAAE;IAChBF,MAAM,CAACE,IAAI,GAAG,GAAG;EACnB;EAEA,MAAMC,QAAQ,GAAGC,gBAAW,CAACC,cAAc,CAACL,MAAM,CAACM,IAAI,EAAEN,MAAM,CAACjB,KAAK,EAAE;IACrEwB,OAAO,EAAEzC,eAAC,CAACE,QAAQ,CAACgC,MAAM,CAACQ,MAAM,CAAC,GAAI,IAAIC,IAAI,CAACT,MAAM,CAACQ,MAAM,GAAG,IAAI,CAAC,CAAEE,WAAW,EAAE,GACjFV,MAAM,CAACQ,MAAM;IACfN,IAAI,EAAEF,MAAM,CAACE,IAAI;IACjBS,MAAM,EAAEX,MAAM,CAACW,MAAM;IACrBC,QAAQ,EAAEZ,MAAM,CAACY,QAAQ;IACzBC,MAAM,EAAEb,MAAM,CAACa;EACjB,CAAC,CAAC;EACF,IAAIC,MAAM,GAAI,qBAAoBC,IAAI,CAACC,SAAS,CAACb,QAAQ,CAAE,EAAC;EAC5D,MAAM,IAAI,CAACnB,WAAW,CAAC,gBAAgB,EAAE,CAAC8B,MAAM,EAAE,EAAE,CAAC,CAAC;AACxD,CAAC;AAEDpD,OAAO,CAACuD,eAAe,GAAG,SAASA,eAAeA,CAAEzB,EAAE,EAAE;EACtD,IAAI,CAAC1B,eAAC,CAACoD,aAAa,CAAC1B,EAAE,CAAC,EAAE;IACxB,OAAOA,EAAE;EACX;EACA,MAAM2B,IAAI,GAAGtE,aAAI,CAACuE,aAAa,CAAC5B,EAAE,CAAC;EACnC,IAAI,CAAC5B,wBAAwB,CAACuD,IAAI,CAAC,EAAE;IACnC,OAAO3B,EAAE;EACX;EAGA,MAAM6B,OAAO,GAAGvD,eAAC,CAACwD,QAAQ,CAACH,IAAI,EAAE,GAAG,CAAC,GAAGA,IAAI,GAAGtE,aAAI,CAAC0E,MAAM,EAAE;EAC5D,IAAI,CAACC,gBAAgB,CAACC,GAAG,CAACJ,OAAO,EAAEF,IAAI,CAAC;EACxC,OAAOtE,aAAI,CAAC6E,WAAW,CAACL,OAAO,CAAC;AAClC,CAAC;AAED3D,OAAO,CAACiE,gBAAgB,GAAG,SAASA,gBAAgBA,CAAEC,QAAQ,EAAE;EAC9D,MAAMC,QAAQ,GAAIC,CAAC,IAAKhE,eAAC,CAACiE,OAAO,CAACD,CAAC,CAAC,IAAIhE,eAAC,CAACoD,aAAa,CAACY,CAAC,CAAC,GACtD,IAAI,CAACH,gBAAgB,CAACG,CAAC,CAAC,GACxBA,CAAC;EAEL,IAAIhE,eAAC,CAACiE,OAAO,CAACH,QAAQ,CAAC,EAAE;IACvB,OAAOA,QAAQ,CAACI,GAAG,CAACH,QAAQ,CAAC;EAC/B,CAAC,MAAM,IAAI/D,eAAC,CAACoD,aAAa,CAACU,QAAQ,CAAC,EAAE;IACpC,MAAMK,MAAM,GAAG;MAAC,GAAGL,QAAQ;MAAE,GAAI,IAAI,CAACX,eAAe,CAACW,QAAQ;IAAE,CAAC;IACjE,OAAO9D,eAAC,CAACoE,OAAO,CAACD,MAAM,CAAC,CAACE,MAAM,CAC7B,CAACC,GAAG,EAAE,CAACC,GAAG,EAAEtD,KAAK,CAAC,KAAK;MACrBqD,GAAG,CAACC,GAAG,CAAC,GAAGR,QAAQ,CAAC9C,KAAK,CAAC;MAC1B,OAAOqD,GAAG;IACZ,CAAC,EAAE,CAAC,CAAC,CACN;EACH;EACA,OAAOR,QAAQ;AACjB,CAAC;AAEDjE,UAAU,CAAC2E,wBAAwB,GAAG,eAAeA,wBAAwBA,CAAEC,QAAQ,EAAEC,QAAQ,EAAEC,IAAI,EAAEC,GAAG,EAAE;EAC5G,MAAMC,cAAc,GAAG7E,eAAC,CAAC8E,KAAK,CAACF,GAAG,CAAC,GAAG,IAAI,GAAG,IAAI,CAAC5D,eAAe,CAAC4D,GAAG,CAAC;EACtE,IAAIG,OAAO;EACX,IAAIC,MAAM,GAAG,MAAAA,CAAA,KAAY;IACvBD,OAAO,GAAG,MAAM,IAAI,CAAC7D,WAAW,CAAE,eAAcyD,IAAI,GAAG,GAAG,GAAG,EAAG,EAAC,EAAE,CAACF,QAAQ,EAAEC,QAAQ,EAAEG,cAAc,CAAC,CAAC;IACxG,OAAO,CAAC7E,eAAC,CAACU,MAAM,CAACqE,OAAO,CAAC;EAC3B,CAAC;EACD,IAAI;IACF,MAAM,IAAI,CAACE,wBAAwB,CAACD,MAAM,CAAC;EAC7C,CAAC,CAAC,OAAOE,GAAG,EAAE;IACZ,IAAIA,GAAG,CAACC,OAAO,IAAInF,eAAC,CAACoF,UAAU,CAACF,GAAG,CAACC,OAAO,CAACE,KAAK,CAAC,IAAIH,GAAG,CAACC,OAAO,CAACE,KAAK,CAAC,iBAAiB,CAAC,EAAE;MAE1FN,OAAO,GAAG,EAAE;IACd,CAAC,MAAM;MACL,MAAMG,GAAG;IACX;EACF;EAEA,IAAIP,IAAI,EAAE;IACR,OAAO,IAAI,CAACd,gBAAgB,CAACkB,OAAO,CAAC;EACvC;EACA,IAAI/E,eAAC,CAACG,OAAO,CAAC4E,OAAO,CAAC,EAAE;IACtB,MAAM,IAAIvE,cAAM,CAAC8E,kBAAkB,EAAE;EACvC;EACA,OAAO,IAAI,CAACzB,gBAAgB,CAACkB,OAAO,CAAC;AACvC,CAAC;AAEDlF,UAAU,CAAC0F,cAAc,GAAG,eAAeA,cAAcA,CAAA,EAAI;EAC3D,IAAIC,MAAM,GAAG,MAAM,IAAI,CAACC,kBAAkB,CAAC,IAAI,CAACC,YAAY,CAAC;EAC7D,MAAM,IAAI,CAACC,WAAW,CAACH,MAAM,CAAC;AAChC,CAAC;AAED5F,OAAO,CAACsB,WAAW,GAAG,eAAeA,WAAWA,CAAEG,IAAI,EAAEuE,IAAI,EAAEC,kBAAkB,GAAG,KAAK,EAAE;EACxF,IAAIC,MAAM,GAAGD,kBAAkB,KAAK,IAAI,GAAG,EAAE,GAAG,IAAI,CAAClF,YAAY;EACjE,IAAIoF,OAAO,GAAG,IAAI,CAACjE,MAAM,CAACZ,WAAW,CAACG,IAAI,EAAEuE,IAAI,EAAEE,MAAM,CAAC;EACzD,OAAO,MAAM,IAAI,CAACE,WAAW,CAACD,OAAO,CAAC;AACxC,CAAC;AAEDnG,OAAO,CAACqG,gBAAgB,GAAG,eAAeA,gBAAgBA,CAAE5E,IAAI,EAAEuE,IAAI,EAAEM,WAAW,EAAE;EAEnF,IAAIH,OAAO,GAAG,IAAII,iBAAC,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACvC,IAAI,CAACC,YAAY,GAAG;MAACF,OAAO;MAAEC;IAAM,CAAC;EACvC,CAAC,CAAC;EACF,MAAM,IAAI,CAACvE,MAAM,CAACmE,gBAAgB,CAAC5E,IAAI,EAAEuE,IAAI,EAAE,IAAI,CAACjF,YAAY,EAAEuF,WAAW,CAAC;EAC9E,OAAO,MAAM,IAAI,CAACF,WAAW,CAACD,OAAO,CAAC;AACxC,CAAC;AAEDnG,OAAO,CAACoB,eAAe,GAAG,SAASA,eAAeA,CAAEuF,MAAM,EAAE;EAC1D,MAAMlD,IAAI,GAAGtE,aAAI,CAACuE,aAAa,CAACiD,MAAM,CAAC;EACvC,IAAI,CAAC,IAAI,CAAC7C,gBAAgB,CAAC8C,GAAG,CAACnD,IAAI,CAAC,EAAE;IACpC,MAAM,IAAI7C,cAAM,CAACiG,0BAA0B,EAAE;EAC/C;EACA,OAAO;IAACC,OAAO,EAAE,IAAI,CAAChD,gBAAgB,CAACiD,GAAG,CAACtD,IAAI;EAAC,CAAC;AACnD,CAAC;AAEDzD,OAAO,CAACgH,uBAAuB,GAAG,SAASA,uBAAuBA,CAAEhB,IAAI,GAAG,EAAE,EAAE;EAC7E,OAAOA,IAAI,CAAC1B,GAAG,CAAE2C,GAAG,IAAK;IACvB,IAAIjH,OAAO,CAACkB,YAAY,CAAC+F,GAAG,CAAC,EAAE;MAC7B,IAAI;QACF,OAAO,IAAI,CAAC7F,eAAe,CAAC6F,GAAG,CAAC;MAClC,CAAC,CAAC,OAAO3B,GAAG,EAAE;QACZ,IAAI,CAAC,IAAA4B,mBAAW,EAAC5B,GAAG,EAAE1E,cAAM,CAACiG,0BAA0B,CAAC,EAAE;UACxD,MAAMvB,GAAG;QACX;MACF;MACA,OAAO2B,GAAG;IACZ;IACA,OAAO7G,eAAC,CAACiE,OAAO,CAAC4C,GAAG,CAAC,GAAG,IAAI,CAACD,uBAAuB,CAACC,GAAG,CAAC,GAAGA,GAAG;EACjE,CAAC,CAAC;AACJ,CAAC;AAEDjH,OAAO,CAACmH,YAAY,GAAG,SAASA,YAAYA,CAAEhC,OAAO,EAAE;EACrD,OAAOA,OAAO,CAAC2B,OAAO,IAAI3B,OAAO,CAACjG,0BAA0B,CAAC;AAC/D,CAAC;AAEDc,OAAO,CAACkB,YAAY,GAAG,SAASA,YAAYA,CAAEiE,OAAO,EAAE;EACrD,OAAOhG,aAAI,CAACiI,QAAQ,CAACjC,OAAO,CAAC,KAAKhG,aAAI,CAACiI,QAAQ,CAACjC,OAAO,CAAC2B,OAAO,CAAC,IAAI3H,aAAI,CAACiI,QAAQ,CAACjC,OAAO,CAACjG,0BAA0B,CAAC,CAAC,CAAC;AACzH,CAAC;AAEDe,UAAU,CAACoH,iBAAiB,GAAG,eAAeA,iBAAiBA,CAAA,EAAI;EACjE,IAAIjH,eAAC,CAACkH,SAAS,CAAC,IAAI,CAACC,eAAe,CAAC,EAAE;IACrC,OAAO,IAAI,CAACA,eAAe;EAC7B;EACA,IAAI;IACF,MAAMC,SAAS,GAAG,MAAM,IAAI,CAACrF,OAAO,CAAC,4BAA4B,CAAC;IAClE,IAAI,CAACoF,eAAe,GAAGC,SAAS,CAACC,WAAW,EAAE,CAAC7D,QAAQ,CAAC,QAAQ,CAAC;EACnE,CAAC,CAAC,OAAO0B,GAAG,EAAE;IACZ,IAAI,CAACtE,GAAG,CAAC0G,IAAI,CAAE,4DAA2D,CAAC;IAC3E,IAAI,CAAC1G,GAAG,CAACC,KAAK,CAAE,UAASqE,GAAG,CAACC,OAAQ,EAAC,CAAC;EACzC;EACA,OAAO,IAAI,CAACgC,eAAe,IAAI,IAAI;AACrC,CAAC;AAEDtH,UAAU,CAAC0H,mBAAmB,GAAG,eAAeA,mBAAmBA,CAAA,EAAI;EACrE,MAAMvE,MAAM,GAAG,kIAAkI;EACjJ,MAAM;IAACwE,KAAK;IAAEC;EAAM,CAAC,GAAG,MAAM,IAAI,CAAC1F,OAAO,CAACiB,MAAM,CAAC;EAClD,MAAM,CAAC0E,UAAU,EAAEC,SAAS,CAAC,GAAGF,MAAM,GAAGD,KAAK,GAAG,CAACC,MAAM,EAAED,KAAK,CAAC,GAAG,CAACA,KAAK,EAAEC,MAAM,CAAC;EAClF,OAAO;IACLD,KAAK,EAAEG,SAAS;IAChBF,MAAM,EAAEC;EACV,CAAC;AACH,CAAC;AAED7H,UAAU,CAAC+H,kBAAkB,GAAG,eAAeA,kBAAkBA,CAAA,EAAI;EACnE,IAAI5H,eAAC,CAACkH,SAAS,CAAC,IAAI,CAACW,gBAAgB,CAAC,EAAE;IACtC,OAAO,IAAI,CAACA,gBAAgB;EAC9B;EAEA,IAAI;IACF,MAAM;MAACL,KAAK;MAAEC;IAAM,CAAC,GAAG,MAAM,IAAI,CAACF,mBAAmB,EAAE;IACxD,KAAK,MAAMO,MAAM,IAAInJ,oBAAoB,EAAE;MACzC,IAAImJ,MAAM,CAAClJ,CAAC,KAAK4I,KAAK,IAAIM,MAAM,CAACjJ,CAAC,KAAK4I,MAAM,EAAE;QAC7C,IAAI,CAACI,gBAAgB,GAAG,IAAI;MAC9B;IACF;EACF,CAAC,CAAC,OAAO3C,GAAG,EAAE;IACZ,IAAI,CAACtE,GAAG,CAAC0G,IAAI,CAAE,gFAA+E,CAAC;IAC/F,IAAI,CAAC1G,GAAG,CAACC,KAAK,CAAE,UAASqE,GAAG,CAACC,OAAQ,EAAC,CAAC;EACzC;EACA,OAAO,IAAI,CAAC0C,gBAAgB,IAAI,KAAK;AACvC,CAAC;AAEDhI,UAAU,CAACkI,gCAAgC,GAAG,eAAeA,gCAAgCA,CAAEC,KAAK,EAAEC,QAAQ,EAAE;EAC9G,IAAIC,SAAS,GAAG,CAAC;EACjB,IAAIC,YAAY,GAAG,CAAC;EAEpB,MAAMC,QAAQ,GAAG,MAAM,IAAI,CAACnB,iBAAiB,EAAE;EAI/C,MAAM;IACJoB,4BAA4B;IAC5BC,oCAAoC;IACpCC,oBAAoB,GAAGxJ,aAAI,CAACyJ,eAAe,CAAC,IAAI,CAACC,IAAI,CAACC,eAAe,EAAE,IAAI,EAAE,MAAM,CAAC,IAAIN,QAAQ,GAC5F3I,uBAAuB,GAAGD;EAChC,CAAC,GAAG,MAAM,IAAI,CAACmJ,QAAQ,CAACC,WAAW,EAAE;EACrC,IAAIC,gBAAgB,GAAG7I,eAAC,CAAC8I,SAAS,CAACT,4BAA4B,CAAC;EAChE,IAAIU,gBAAgB,GAAG/I,eAAC,CAAC8I,SAAS,CAACR,oCAAoC,CAAC;EACxE,MAAMU,cAAc,GAAGhJ,eAAC,CAAC8I,SAAS,CAACP,oBAAoB,CAAC;EAExD,IAAI,CAAChJ,YAAY,CAACiE,QAAQ,CAACqF,gBAAgB,CAAC,EAAE;IAC5CA,gBAAgB,GAAGvJ,MAAM;EAC3B;EACA,IAAI,CAACC,YAAY,CAACiE,QAAQ,CAACuF,gBAAgB,CAAC,EAAE;IAC5CA,gBAAgB,GAAGzJ,MAAM;EAC3B;EAEA,IAAI,CAACI,kBAAkB,CAAC8D,QAAQ,CAACwF,cAAc,CAAC,EAAE;IAChD,MAAM,IAAIxI,cAAM,CAACyI,oBAAoB,CAClC,GAAEV,oBAAqB,mEAAkE7I,kBAAmB,GAAE,CAAC;EACpH;EAEA,MAAMwJ,SAAS,GAAGd,QAAQ,KAAI,MAAM,IAAI,CAACR,kBAAkB,EAAE;EAE7D,MAAMuB,WAAW,GAAGlB,QAAQ,CAACpJ,CAAC,GAAGoJ,QAAQ,CAACrJ,CAAC,GAAG,UAAU,GAAG,WAAW;EAEtE,MAAMwK,WAAW,GAAGF,SAAS,GACzBnK,aAAI,CAACyJ,eAAe,CAAC,IAAI,CAACC,IAAI,CAACC,eAAe,EAAE,GAAG,EAAE,MAAM,CAAC,GAC1DrK,4BAA4B,GAC5BD,yBAAyB,GAC3B,CAAC;EAEL,MAAMiL,UAAU,GAAG,MAAM,IAAI,CAACtH,OAAO,CAAC,+CAA+C,CAAC;EACtF,IAAIsH,UAAU,EAAE;IACdnB,SAAS,GAAGhK,8BAA8B,GAAGkL,WAAW;IAExD,IAAIF,SAAS,EAAE;MACbhB,SAAS,IAAI/J,wBAAwB;IACvC;IAGA,IAAIgL,WAAW,KAAK,WAAW,IAAIf,QAAQ,EAAE;MAC3CF,SAAS,GAAG,CAAC;IACf;EACF,CAAC,MAAM;IACLA,SAAS,GAAGc,cAAc,KAAKvJ,uBAAuB,GAAG,CAAC,GAAGxB,qBAAqB;IAClFiK,SAAS,IAAIkB,WAAW;IACxB,IAAI,CAACxI,GAAG,CAACC,KAAK,CAAE,iCAAgCmI,cAAe,KAAId,SAAU,EAAC,CAAC;IAE/E,IAAIE,QAAQ,EAAE;MACZ,IAAIe,WAAW,KAAK,UAAU,EAAE;QAE9BhB,YAAY,GAAG5J,wBAAwB;MACzC,CAAC,MAAM;QACL2J,SAAS,GAAG5J,+BAA+B;MAC7C;IACF;IAEA,IAAI6K,WAAW,KAAK,WAAW,IAAI,CAACf,QAAQ,EAAE;MAC5C,IAAIS,gBAAgB,KAAKzJ,OAAO,EAAE;QAChC8I,SAAS,IAAI1J,cAAc;MAC7B,CAAC,MAAM,IAAIqK,gBAAgB,KAAKvJ,MAAM,EAAE;QAGtC,MAAMgK,gBAAgB,GAAG,MAAM,IAAI,CAACC,mBAAmB,EAAE;QACzD,MAAMC,IAAI,GAAGF,gBAAgB,CAACG,MAAM,CAAE7E,GAAG,IAAKA,GAAG,CAAC7E,EAAE,CAAC2J,UAAU,CAAC,UAAU,CAAC,CAAC;QAE5E,IAAIF,IAAI,CAACG,MAAM,GAAG,CAAC,EAAE;UACnB,IAAI,CAAC/I,GAAG,CAACC,KAAK,CAAE,SAAQ2I,IAAI,CAACG,MAAO,wCAAuC,CAAC;UAC5EzB,SAAS,IAAI1J,cAAc;QAC7B;MACF;IACF;EACF;EAEA0J,SAAS,IAAI,MAAM,IAAI,CAAC0B,0BAA0B,CAACxB,QAAQ,EAAEW,gBAAgB,CAAC;EAE9Ef,KAAK,CAAC6B,CAAC,IAAI3B,SAAS;EACpBD,QAAQ,CAACpJ,CAAC,IAAKqJ,SAAS,GAAGC,YAAa;AAC1C,CAAC;AAEDtI,UAAU,CAAC+J,0BAA0B,GAAG,eAAeA,0BAA0BA,CAAExB,QAAQ,EAAEW,gBAAgB,EAAE;EAC7G,IAAIe,MAAM,GAAG,CAAC;EAEd,IAAIf,gBAAgB,KAAK3J,OAAO,EAAE;IAChC0K,MAAM,IAAI1B,QAAQ,GAChB3J,wCAAwC,GACxCC,sCAAsC;EAC1C,CAAC,MAAM,IAAIqK,gBAAgB,KAAKzJ,MAAM,EAAE;IAEtC,MAAMyK,OAAO,GAAG,MAAM,IAAI,CAACC,2BAA2B,CAAC,kBAAkB,EAAE,0BAA0B,EAAE,IAAI,CAAC;IAC5G,IAAID,OAAO,CAACJ,MAAM,GAAG,CAAC,EAAE;MACtBG,MAAM,IAAI1B,QAAQ,GAChB3J,wCAAwC,GACxCC,sCAAsC;IAC1C;EACF;EAEA,IAAI,CAACkC,GAAG,CAACC,KAAK,CAAE,8CAA6CiJ,MAAO,EAAC,CAAC;EACtE,OAAOA,MAAM;AACf,CAAC;AAED,eAAeG,qBAAqBA,CAAEC,MAAM,EAAEnJ,YAAY,EAAE;EAG1D,IAAI;IACF,IAAIoJ,IAAI,GAAG,MAAMD,MAAM,CAAChJ,WAAW,CAAC,UAAU,EAAE,CAACH,YAAY,CAAC,CAAC;IAC/D,IAAI,CAACoJ,IAAI,EAAE;MACTA,IAAI,GAAG,MAAMD,MAAM,CAAChJ,WAAW,CAAC,qBAAqB,EAAE,CAACH,YAAY,EAAE,OAAO,CAAC,CAAC;IACjF;IAEA,IAAIoJ,IAAI,EAAE;MACR,MAAMC,GAAG,GAAG,MAAMF,MAAM,CAACF,2BAA2B,CAAC,kBAAkB,EAAEG,IAAI,EAAE,IAAI,CAAC;MACpF,IAAIC,GAAG,CAACT,MAAM,KAAK,CAAC,IAAIS,GAAG,CAACT,MAAM,KAAK,CAAC,EAAE;QACxC,MAAMjI,EAAE,GAAG0I,GAAG,CAAC,CAAC,CAAC;QAEjB,MAAMC,IAAI,GAAG,MAAMH,MAAM,CAACI,YAAY,CAAE,YAAWvL,aAAI,CAACuE,aAAa,CAAC5B,EAAE,CAAE,OAAM,EAAE,KAAK,CAAC;QACxF,IAAI0I,GAAG,CAACT,MAAM,KAAK,CAAC,EAAE;UACpB,MAAMY,GAAG,GAAGH,GAAG,CAAC,CAAC,CAAC;UAClB,MAAMI,KAAK,GAAG,MAAMN,MAAM,CAACI,YAAY,CAAE,YAAWvL,aAAI,CAACuE,aAAa,CAACiH,GAAG,CAAE,OAAM,EAAE,KAAK,CAAC;UAE1F,IAAKF,IAAI,CAACI,CAAC,KAAKD,KAAK,CAACC,CAAC,IAAIJ,IAAI,CAACR,CAAC,KAAKW,KAAK,CAACX,CAAC,IAC5CQ,IAAI,CAAC7C,KAAK,KAAKgD,KAAK,CAAChD,KAAK,IAAI6C,IAAI,CAAC5C,MAAM,KAAK+C,KAAK,CAAC/C,MAAO,EAAE;YAE5D,OAAO,KAAK;UACd;QACF;QACA,MAAMjC,MAAM,GAAG;UACbiF,CAAC,EAAEC,IAAI,CAACC,KAAK,CAACN,IAAI,CAACI,CAAC,GAAGJ,IAAI,CAAC7C,KAAK,GAAG,CAAC,CAAC;UACtCqC,CAAC,EAAEa,IAAI,CAACC,KAAK,CAACN,IAAI,CAACR,CAAC,GAAGQ,IAAI,CAAC5C,MAAM,GAAG,CAAC;QACxC,CAAC;QACD,MAAMyC,MAAM,CAACvE,WAAW,CAACH,MAAM,CAAC;QAChC,OAAO,IAAI;MACb;IACF;EACF,CAAC,CAAC,OAAON,GAAG,EAAE;IAGZgF,MAAM,CAACtJ,GAAG,CAAC0G,IAAI,CAAE,8BAA6BpC,GAAG,CAACC,OAAQ,EAAC,CAAC;EAC9D;EACA,OAAO,KAAK;AACd;AAEAtF,UAAU,CAAC+K,YAAY,GAAG,eAAeA,YAAYA,CAAElJ,EAAE,EAAE;EACzD,MAAMX,YAAY,GAAG,IAAI,CAACC,eAAe,CAACU,EAAE,CAAC;EAG7C,IAAI,CAAC,CAAC,MAAM,IAAI,CAACiH,QAAQ,CAACC,WAAW,EAAE,EAAEiC,kBAAkB,KAAI,MAAMZ,qBAAqB,CAAC,IAAI,EAAElJ,YAAY,CAAC,GAAE;IAC9G;EACF;EACA,IAAI,CAACH,GAAG,CAAC0G,IAAI,CAAC,uEAAuE,CAAC;EAItF,MAAMnB,iBAAC,CAAC2E,OAAO,CAACC,GAAG,CAAC,CAClB,IAAI,CAAC7J,WAAW,CAAC,UAAU,EAAE,CAACH,YAAY,CAAC,CAAC,EAC5C,IAAI,CAACG,WAAW,CAAC,0BAA0B,EAAE,CAACH,YAAY,CAAC,CAAC,CAC7D,CAAC;EAEF,MAAM,CAACiK,IAAI,EAAEC,WAAW,CAAC,GAAG,MAAM9E,iBAAC,CAAC2E,OAAO,CAACC,GAAG,CAAC,CAC9C,IAAI,CAAC7J,WAAW,CAAC,UAAU,EAAE,CAACH,YAAY,CAAC,CAAC,EAC5C,IAAI,CAACG,WAAW,CAAC,0BAA0B,EAAE,CAACH,YAAY,CAAC,CAAC,CAC7D,CAAC;EACF,MAAM;IAACyG,KAAK;IAAEC;EAAM,CAAC,GAAGuD,IAAI;EAC5B,IAAI;IAACP,CAAC;IAAEZ;EAAC,CAAC,GAAGoB,WAAW;EACxBR,CAAC,IAAIjD,KAAK,GAAG,CAAC;EACdqC,CAAC,IAAIpC,MAAM,GAAG,CAAC;EAEf,IAAI,CAAC/B,YAAY,GAAG;IAAC+E,CAAC;IAAEZ;EAAC,CAAC;EAC1B,MAAM,IAAI,CAACtE,cAAc,EAAE;AAC7B,CAAC;AAED1F,UAAU,CAAC8F,WAAW,GAAG,eAAeA,WAAWA,CAAEH,MAAM,EAAE;EAC3D,MAAM,IAAI,CAAC0F,YAAY,CAAC,CACtB;IACEC,MAAM,EAAE,KAAK;IACbC,OAAO,EAAE5F;EACX,CAAC,CACF,CAAC;AACJ,CAAC;AAED3F,UAAU,CAAC4F,kBAAkB,GAAG,eAAeA,kBAAkBA,CAAED,MAAM,EAAE;EACzE,IAAI,CAAC5E,GAAG,CAACC,KAAK,CAAE,4BAA2BoC,IAAI,CAACC,SAAS,CAACsC,MAAM,CAAE,sBAAqB,CAAC;EAGxF,IAAI6F,OAAO;EACX,IAAI;IACFA,OAAO,GAAG,MAAM,IAAAC,uBAAa,EAAC,CAAC,EAAE,GAAG,EAAE,YAAY,MAAM,IAAI,CAACtB,2BAA2B,CAAC,YAAY,EAAE,wBAAwB,EAAE,KAAK,CAAC,CAAC;EAC1I,CAAC,CAAC,OAAOuB,GAAG,EAAE,CAAC;EAEf,IAAI,CAACF,OAAO,EAAE;IACZ,MAAM,IAAIG,KAAK,CAAE,2EAA0E,CAAC;EAC9F;EAEAH,OAAO,GAAGtM,aAAI,CAACuE,aAAa,CAAC+H,OAAO,CAAC;EAErC,MAAMhB,IAAI,GAAG,MAAM,IAAI,CAACC,YAAY,CAAE,YAAWe,OAAQ,OAAM,EAAE,KAAK,CAAC;EACvE,MAAMrD,KAAK,GAAG;IAACyC,CAAC,EAAEJ,IAAI,CAACI,CAAC;IAAEZ,CAAC,EAAEQ,IAAI,CAACR;EAAC,CAAC;EACpC,MAAM5B,QAAQ,GAAG;IAACrJ,CAAC,EAAEyL,IAAI,CAAC7C,KAAK;IAAE3I,CAAC,EAAEwL,IAAI,CAAC5C;EAAM,CAAC;EAEhD,MAAMgE,GAAG,GAAG,2EAA2E;EACvF,MAAMC,MAAM,GAAG,MAAM,IAAI,CAAC5J,MAAM,CAACC,OAAO,CAAC0J,GAAG,CAAC;EAI7C,MAAME,cAAc,GAAG,IAAI,CAACA,cAAc;EAC1C,MAAM,IAAI,CAACC,eAAe,CAAC,CAAC,CAAC;EAC7B,IAAI;IACF,MAAM,IAAI,CAAC7D,gCAAgC,CAACC,KAAK,EAAEC,QAAQ,CAAC;EAC9D,CAAC,SAAS;IACR,MAAM,IAAI,CAAC2D,eAAe,CAACD,cAAc,CAAC;EAC5C;EAEA,IAAID,MAAM,IAAIzD,QAAQ,IAAID,KAAK,EAAE;IAC/B,IAAI6D,MAAM,GAAG5D,QAAQ,CAACrJ,CAAC,GAAG8M,MAAM,CAAC9M,CAAC;IAClC,IAAIkN,MAAM,GAAG7D,QAAQ,CAACpJ,CAAC,GAAG6M,MAAM,CAAC7M,CAAC;IAClC,IAAIkN,SAAS,GAAG;MACdtB,CAAC,EAAEzC,KAAK,CAACyC,CAAC,GAAGC,IAAI,CAACC,KAAK,CAACkB,MAAM,GAAGrG,MAAM,CAACiF,CAAC,CAAC;MAC1CZ,CAAC,EAAE7B,KAAK,CAAC6B,CAAC,GAAGa,IAAI,CAACC,KAAK,CAACmB,MAAM,GAAGtG,MAAM,CAACqE,CAAC;IAC3C,CAAC;IAID,IAAI,CAACjJ,GAAG,CAACC,KAAK,CAAE,0BAAyBoC,IAAI,CAACC,SAAS,CAAC6I,SAAS,CAAE,EAAC,CAAC;IACrE,IAAI,CAACnL,GAAG,CAACC,KAAK,CAAE,aAAYoC,IAAI,CAACC,SAAS,CAACmH,IAAI,CAAE,EAAC,CAAC;IACnD,IAAI,CAACzJ,GAAG,CAACC,KAAK,CAAE,cAAaoC,IAAI,CAACC,SAAS,CAAC8E,KAAK,CAAE,EAAC,CAAC;IACrD,IAAI,CAACpH,GAAG,CAACC,KAAK,CAAE,iBAAgBoC,IAAI,CAACC,SAAS,CAAC+E,QAAQ,CAAE,EAAC,CAAC;IAC3D,IAAI,CAACrH,GAAG,CAACC,KAAK,CAAE,eAAcoC,IAAI,CAACC,SAAS,CAACwI,MAAM,CAAE,EAAC,CAAC;IACvD,IAAI,CAAC9K,GAAG,CAACC,KAAK,CAAE,eAAcoC,IAAI,CAACC,SAAS,CAAC2I,MAAM,CAAE,EAAC,CAAC;IACvD,IAAI,CAACjL,GAAG,CAACC,KAAK,CAAE,eAAcoC,IAAI,CAACC,SAAS,CAAC4I,MAAM,CAAE,EAAC,CAAC;IAEvD,IAAI,CAAClL,GAAG,CAACC,KAAK,CAAE,wBAAuBoC,IAAI,CAACC,SAAS,CAACsC,MAAM,CAAE,GAAE,GAC7D,oBAAmBvC,IAAI,CAACC,SAAS,CAAC6I,SAAS,CAAE,EAAC,CAAC;IAClD,OAAOA,SAAS;EAClB;AACF,CAAC;AAEDlM,UAAU,CAACmM,aAAa,GAAG,eAAeA,aAAaA,CAAA,EAAI;EACzD,OAAOhM,eAAC,CAACC,QAAQ,CAAC,MAAM,IAAI,CAACgM,YAAY,EAAE,CAAC;AAC9C,CAAC;AAEDpM,UAAU,CAACmG,WAAW,GAAG,eAAeA,WAAWA,CAAED,OAAO,EAAE;EAC5D,MAAMmG,KAAK,GAAG,IAAIC,eAAM,CAACC,KAAK,EAAE,CAACC,KAAK,EAAE;EAIxC,MAAMC,gBAAgB,GAAGnG,iBAAC,CAACC,OAAO,CAACL,OAAO,CAAC,CAACwG,OAAO,CAACvN,oBAAoB,CAAC;EACzE,MAAMwN,kBAAkB,GAAG,MAAOC,CAAC,IAAK;IACtC,IAAI;MACF,OAAO,MAAMA,CAAC;IAChB,CAAC,CAAC,OAAOvH,GAAG,EAAE;MACZ,MAAMwH,aAAa,GAAIxH,GAAG,YAAYiB,iBAAC,CAACwG,cAAc,GAAIzH,GAAG,CAAC,CAAC,CAAC,GAAGA,GAAG;MACtE,IAAI,CAACtE,GAAG,CAACC,KAAK,CAAE,wCAAuC6L,aAAa,CAACvH,OAAQ,EAAC,CAAC;MAC/E,IAAIuH,aAAa,YAAYvG,iBAAC,CAACyG,YAAY,EAAE;QAC3C,MAAM,IAAIpM,cAAM,CAACoM,YAAY,CAAE,oDAAmD,GAC/E,GAAEV,KAAK,CAACW,WAAW,EAAE,CAACC,cAAc,CAACC,OAAO,CAAC,CAAC,CAAE,IAAG,CAAC;MACzD;MACA,MAAML,aAAa;IACrB;EACF,CAAC;EAGD,MAAMF,kBAAkB,CAACrG,iBAAC,CAAC6G,GAAG,CAAC,CAAC7G,iBAAC,CAAC8G,KAAK,CAAChO,oBAAoB,CAAC,EAAEqN,gBAAgB,CAAC,CAAC,CAAC;EAClF,IAAIA,gBAAgB,CAACY,WAAW,EAAE,EAAE;IAClC,OAAO,MAAMZ,gBAAgB;EAC/B;EAGA,IAAI,CAACtM,eAAC,CAACoD,aAAa,CAAC,IAAI,CAAC+J,aAAa,CAAC,EAAE;IACxC,IAAI,CAACA,aAAa,GAAG;MACnBC,KAAK,EAAE,CAAC;MACRC,aAAa,EAAE,IAAIC,oBAAY,EAAE;MACjCC,YAAY,EAAEpH,iBAAC,CAACC,OAAO;IACzB,CAAC;EACH;EACA,IAAI,CAAC+G,aAAa,CAACC,KAAK,EAAE;EAE1B,IAAII,eAAe;EACnB,IAAIC,kBAAkB;EACtB,IAAI;IAEF,IAAI,IAAI,CAACN,aAAa,CAACI,YAAY,CAACG,UAAU,EAAE,EAAE;MAChD,IAAI,CAACP,aAAa,CAACI,YAAY,GAAGpH,iBAAC,CAACC,OAAO,CAAC,CAAC,YAAY;QACvD,OAAO,IAAI,CAAC+G,aAAa,CAACC,KAAK,GAAG,CAAC,EAAE;UACnC,IAAI;YACF,IAAI,MAAM,IAAI,CAACpB,aAAa,EAAE,EAAE;cAC9B,IAAI,CAACmB,aAAa,CAACE,aAAa,CAACM,IAAI,CAACzO,0BAA0B,CAAC;YACnE;UACF,CAAC,CAAC,OAAOgG,GAAG,EAAE;YACZ,IAAI,IAAA4B,mBAAW,EAAC5B,GAAG,EAAE1E,cAAM,CAACoN,wBAAwB,CAAC,EAAE;cACrD,IAAI,CAACT,aAAa,CAACE,aAAa,CAACM,IAAI,CAACxO,kBAAkB,EAAE+F,GAAG,CAAC;YAChE;UACF;UACA,MAAMiB,iBAAC,CAAC8G,KAAK,CAAChO,oBAAoB,GAAG,CAAC,CAAC;QACzC;MACF,CAAC,GAAG,CAAC;IACP;IAEA,OAAO,MAAM,IAAIkH,iBAAC,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACtCmH,eAAe,GAAGA,CAAA,KAAMnH,MAAM,CAAC,IAAI7F,cAAM,CAACqN,wBAAwB,EAAE,CAAC;MACrEJ,kBAAkB,GAAGpH,MAAM;MAC3B,IAAI,CAAC8G,aAAa,CAACE,aAAa,CAACS,IAAI,CAAC5O,0BAA0B,EAAEsO,eAAe,CAAC;MAClF,IAAI,CAACL,aAAa,CAACE,aAAa,CAACS,IAAI,CAAC3O,kBAAkB,EAAEsO,kBAAkB,CAAC;MAC7EjB,kBAAkB,CAACF,gBAAgB,CAAC,CAEjCyB,IAAI,CAAC3H,OAAO,CAAC,CACb4H,KAAK,CAAC3H,MAAM,CAAC;IAClB,CAAC,CAAC;EACJ,CAAC,SAAS;IACR,IAAImH,eAAe,EAAE;MACnB,IAAI,CAACL,aAAa,CAACE,aAAa,CAACY,cAAc,CAAC/O,0BAA0B,EAAEsO,eAAe,CAAC;IAC9F;IACA,IAAIC,kBAAkB,EAAE;MACtB,IAAI,CAACN,aAAa,CAACE,aAAa,CAACY,cAAc,CAAC9O,kBAAkB,EAAEsO,kBAAkB,CAAC;IACzF;IACA,IAAI,CAACN,aAAa,CAACC,KAAK,EAAE;EAC5B;AACF,CAAC;AAEDvN,UAAU,CAACqO,YAAY,GAAG,eAAeA,YAAYA,CAAEC,OAAO,EAAE;EAC9D,IAAI,CAACrM,MAAM,CAACsM,4BAA4B,GAAG,IAAI;EAC/C,IAAI;IACF,MAAM,IAAI,CAAClN,WAAW,CAAC,gBAAgB,EAAE,CAAE,WAAUiN,OAAQ,KAAI,EAAE,IAAI,CAAC,CAAC;EAC3E,CAAC,SAAS;IACR,IAAI,CAACrM,MAAM,CAACsM,4BAA4B,GAAG,KAAK;EAClD;AACF,CAAC;AAqBDzO,QAAQ,CAAC0O,6BAA6B,GAAG,eAAeA,6BAA6BA,CAAE5F,IAAI,GAAG,CAAC,CAAC,EAAE;EAChG,IAAI,CAAC,IAAI,CAAC6F,WAAW,EAAE,EAAE;IACvB,MAAM,IAAI9C,KAAK,CAAC,gDAAgD,CAAC;EACnE;EACA,MAAM;IAAE+C;EAAY,CAAC,GAAG9F,IAAI;EAC5B,IAAI,CAACzI,eAAC,CAACoD,aAAa,CAACmL,WAAW,CAAC,EAAE;IACjC,MAAM,IAAI/N,cAAM,CAACyI,oBAAoB,CAAC,+CAA+C,CAAC;EACxF;EAEA,IAAI,CAACrI,GAAG,CAACC,KAAK,CAAE,uCAAsCoC,IAAI,CAACC,SAAS,CAACqL,WAAW,CAAE,EAAC,CAAC;EACpF,MAAM,IAAI,CAAC9F,IAAI,CAACX,MAAM,CAAC0G,oBAAoB,CAACD,WAAW,CAAC;AAC1D,CAAC;AAEDE,MAAM,CAACC,MAAM,CAAC/O,QAAQ,EAAEE,UAAU,EAAED,OAAO,CAAC;AAAC,IAAA+O,QAAA,GAE9BhP,QAAQ;AAAAiP,OAAA,CAAAC,OAAA,GAAAF,QAAA"}