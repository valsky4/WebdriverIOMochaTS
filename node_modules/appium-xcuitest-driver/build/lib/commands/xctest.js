"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.assertIDB = assertIDB;
exports.default = exports.commands = void 0;
exports.parseXCTestStdout = parseXCTestStdout;
require("source-map-support/register");
var _bluebird = _interopRequireDefault(require("bluebird"));
var _support = require("appium/support");
var _lodash = _interopRequireDefault(require("lodash"));
var _driver = require("appium/driver");
const commands = {};
exports.commands = commands;
const XCTEST_TIMEOUT = 60 * 60 * 1000;
const xctestLog = _support.logger.getLogger('XCTest');
function assertIDB(opts) {
  var _opts$device;
  if (!((_opts$device = opts.device) !== null && _opts$device !== void 0 && _opts$device.idb) || !opts.launchWithIDB) {
    throw new Error(`To use XCTest runner, IDB (https://github.com/facebook/idb) must be installed ` + `and sessions must be run with the "launchWithIDB" capability`);
  }
  return opts.device.idb;
}
function parseXCTestStdout(stdout) {
  function parseKey(name) {
    const words = name.split(' ');
    let out = '';
    for (const word of words) {
      out += word.substr(0, 1).toUpperCase() + word.substr(1);
    }
    return out.substr(0, 1).toLowerCase() + out.substr(1);
  }
  function parseValue(value) {
    value = value || '';
    switch (value.toLowerCase()) {
      case 'true':
        return true;
      case 'false':
        return false;
      case '':
        return null;
      default:
        break;
    }
    if (!isNaN(value)) {
      if (!_lodash.default.isString(value)) {
        return 0;
      } else if (value.indexOf('.') > 0) {
        return parseFloat(value);
      }
      return parseInt(value, 10);
    }
    return value;
  }
  if (!stdout) {
    return [];
  }
  const lines = stdout.trim().split('\n');
  if (lines.length === 1 && !lines[0].includes('|')) {
    return [lines[0]];
  }
  const results = [];
  for (const line of lines) {
    const properties = line.split('|');
    const output = {};
    let entryIndex = 0;
    for (const prop of properties) {
      if (entryIndex === 0) {
        output.testName = prop.trim();
      } else if (prop.trim().startsWith('Location')) {
        output.location = prop.substring(prop.indexOf('Location') + 8).trim();
      } else {
        let [key, value] = prop.split(':');
        output[parseKey(key.trim())] = parseValue(value ? value.trim() : '');
      }
      entryIndex++;
    }
    if (!output.passed) {
      output.passed = output.status === 'passed';
      output.crashed = output.status === 'crashed';
    } else if (!output.status) {
      if (output.passed) {
        output.status = 'passed';
      } else if (output.crashed) {
        output.status = 'crashed';
      } else {
        output.status = 'failed';
      }
    }
    results.push(output);
  }
  return results;
}
commands.mobileRunXCTest = async function runXCTest({
  testRunnerBundleId,
  appUnderTestBundleId,
  xctestBundleId,
  testType = 'ui',
  env,
  args,
  timeout = XCTEST_TIMEOUT
}) {
  const subproc = await assertIDB(this.opts).runXCUITest(testRunnerBundleId, appUnderTestBundleId, xctestBundleId, {
    env,
    args,
    testType
  });
  return await new _bluebird.default((resolve, reject) => {
    let mostRecentLogObject = null;
    let xctestTimeout;
    let lastErrorMessage = null;
    if (timeout > 0) {
      xctestTimeout = setTimeout(() => reject(new _driver.errors.TimeoutError(`Timed out after '${timeout}ms' waiting for XCTest to complete`)), timeout);
    }
    subproc.on('output', (stdout, stderr) => {
      if (stdout) {
        try {
          mostRecentLogObject = parseXCTestStdout(stdout);
        } catch (err) {
          this.log.warn(`Failed to parse logs from test output: '${stdout}'`);
          this.log.debug(err.stack);
        }
      }
      if (stderr) {
        lastErrorMessage = stderr;
      }
      stdout && xctestLog.info(stdout);
      stderr && xctestLog.error(stderr);
    });
    subproc.on('exit', (code, signal) => {
      clearTimeout(xctestTimeout);
      if (code !== 0) {
        const err = new Error(lastErrorMessage || mostRecentLogObject);
        err.code = code;
        if (signal != null) {
          err.signal = signal;
        }
        if (mostRecentLogObject) {
          err.result = mostRecentLogObject;
        }
        return reject(err);
      }
      resolve({
        code,
        signal,
        results: mostRecentLogObject,
        passed: true
      });
    });
  });
};
commands.mobileInstallXCTestBundle = async function installXCTestBundle(opts) {
  const {
    xctestApp
  } = opts;
  if (!_lodash.default.isString(xctestApp)) {
    throw new _driver.errors.InvalidArgumentError(`'xctestApp' is a required parameter for 'installXCTestBundle' and ` + `must be a string. Found '${xctestApp}'`);
  }
  xctestLog.info(`Installing bundle '${xctestApp}'`);
  const idb = assertIDB(this.opts);
  const res = await this.helpers.configureApp(xctestApp, '.xctest');
  await idb.installXCTestBundle(res);
};
commands.mobileListXCTestBundles = async function listXCTestsInTestBundle() {
  return await assertIDB(this.opts).listXCTestBundles();
};
commands.mobileListXCTestsInTestBundle = async function listXCTestsInTestBundle(opts) {
  const {
    bundle
  } = opts;
  if (!_lodash.default.isString(bundle)) {
    throw new _driver.errors.InvalidArgumentError(`'bundle' is a required parameter for 'listXCTestsInTestBundle' and ` + `must be a string. Found '${bundle}'`);
  }
  const idb = assertIDB(this.opts);
  return await idb.listXCTestsInTestBundle(bundle);
};
Object.assign(commands);
var _default = commands;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYmx1ZWJpcmQiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9zdXBwb3J0IiwiX2xvZGFzaCIsIl9kcml2ZXIiLCJjb21tYW5kcyIsImV4cG9ydHMiLCJYQ1RFU1RfVElNRU9VVCIsInhjdGVzdExvZyIsImxvZ2dlciIsImdldExvZ2dlciIsImFzc2VydElEQiIsIm9wdHMiLCJfb3B0cyRkZXZpY2UiLCJkZXZpY2UiLCJpZGIiLCJsYXVuY2hXaXRoSURCIiwiRXJyb3IiLCJwYXJzZVhDVGVzdFN0ZG91dCIsInN0ZG91dCIsInBhcnNlS2V5IiwibmFtZSIsIndvcmRzIiwic3BsaXQiLCJvdXQiLCJ3b3JkIiwic3Vic3RyIiwidG9VcHBlckNhc2UiLCJ0b0xvd2VyQ2FzZSIsInBhcnNlVmFsdWUiLCJ2YWx1ZSIsImlzTmFOIiwiXyIsImlzU3RyaW5nIiwiaW5kZXhPZiIsInBhcnNlRmxvYXQiLCJwYXJzZUludCIsImxpbmVzIiwidHJpbSIsImxlbmd0aCIsImluY2x1ZGVzIiwicmVzdWx0cyIsImxpbmUiLCJwcm9wZXJ0aWVzIiwib3V0cHV0IiwiZW50cnlJbmRleCIsInByb3AiLCJ0ZXN0TmFtZSIsInN0YXJ0c1dpdGgiLCJsb2NhdGlvbiIsInN1YnN0cmluZyIsImtleSIsInBhc3NlZCIsInN0YXR1cyIsImNyYXNoZWQiLCJwdXNoIiwibW9iaWxlUnVuWENUZXN0IiwicnVuWENUZXN0IiwidGVzdFJ1bm5lckJ1bmRsZUlkIiwiYXBwVW5kZXJUZXN0QnVuZGxlSWQiLCJ4Y3Rlc3RCdW5kbGVJZCIsInRlc3RUeXBlIiwiZW52IiwiYXJncyIsInRpbWVvdXQiLCJzdWJwcm9jIiwicnVuWENVSVRlc3QiLCJCIiwicmVzb2x2ZSIsInJlamVjdCIsIm1vc3RSZWNlbnRMb2dPYmplY3QiLCJ4Y3Rlc3RUaW1lb3V0IiwibGFzdEVycm9yTWVzc2FnZSIsInNldFRpbWVvdXQiLCJlcnJvcnMiLCJUaW1lb3V0RXJyb3IiLCJvbiIsInN0ZGVyciIsImVyciIsImxvZyIsIndhcm4iLCJkZWJ1ZyIsInN0YWNrIiwiaW5mbyIsImVycm9yIiwiY29kZSIsInNpZ25hbCIsImNsZWFyVGltZW91dCIsInJlc3VsdCIsIm1vYmlsZUluc3RhbGxYQ1Rlc3RCdW5kbGUiLCJpbnN0YWxsWENUZXN0QnVuZGxlIiwieGN0ZXN0QXBwIiwiSW52YWxpZEFyZ3VtZW50RXJyb3IiLCJyZXMiLCJoZWxwZXJzIiwiY29uZmlndXJlQXBwIiwibW9iaWxlTGlzdFhDVGVzdEJ1bmRsZXMiLCJsaXN0WENUZXN0c0luVGVzdEJ1bmRsZSIsImxpc3RYQ1Rlc3RCdW5kbGVzIiwibW9iaWxlTGlzdFhDVGVzdHNJblRlc3RCdW5kbGUiLCJidW5kbGUiLCJPYmplY3QiLCJhc3NpZ24iLCJfZGVmYXVsdCIsImRlZmF1bHQiXSwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvY29tbWFuZHMveGN0ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBlcnJvcnMgfSBmcm9tICdhcHBpdW0vZHJpdmVyJztcblxuXG5jb25zdCBjb21tYW5kcyA9IHt9O1xuXG5jb25zdCBYQ1RFU1RfVElNRU9VVCA9IDYwICogNjAgKiAxMDAwOyAvLyA2MCBtaW51dGUgdGltZW91dFxuXG5jb25zdCB4Y3Rlc3RMb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdYQ1Rlc3QnKTtcblxuLyoqXG4gKiBBc3NlcnRzIHRoYXQgSURCIGlzIHByZXNlbnQgYW5kIHRoYXQgbGF1bmNoV2l0aElEQiB3YXMgdXNlZFxuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzIE9wdHMgb2JqZWN0IGZyb20gdGhlIGRyaXZlciBpbnN0YW5jZVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXNzZXJ0SURCIChvcHRzKSB7XG4gIGlmICghb3B0cy5kZXZpY2U/LmlkYiB8fCAhb3B0cy5sYXVuY2hXaXRoSURCKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUbyB1c2UgWENUZXN0IHJ1bm5lciwgSURCIChodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svaWRiKSBtdXN0IGJlIGluc3RhbGxlZCBgICtcbiAgICAgIGBhbmQgc2Vzc2lvbnMgbXVzdCBiZSBydW4gd2l0aCB0aGUgXCJsYXVuY2hXaXRoSURCXCIgY2FwYWJpbGl0eWApO1xuICB9XG4gIHJldHVybiBvcHRzLmRldmljZS5pZGI7XG59XG5cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBYQ1Rlc3RSZXN1bHRcbiAqXG4gKiBAcHJvcGVydHkge3N0cmluZ30gdGVzdE5hbWUgTmFtZSBvZiB0aGUgdGVzdCAoZS5nLjogJ1hDVGVzdGVyQXBwVUlUZXN0cyAtIFhDVGVzdGVyQXBwVUlUZXN0cy5YQ1Rlc3RlckFwcFVJVGVzdHMvdGVzdEV4YW1wbGUnKVxuICogQHByb3BlcnR5IHtib29sZWFufSBwYXNzZWQgRGlkIHRoZSB0ZXN0cyBwYXNzP1xuICogQHByb3BlcnR5IHtib29sZWFufSBjcmFzaGVkIERpZCB0aGUgdGVzdHMgY3Jhc2g/XG4gKiBAcHJvcGVydHkge3N0cmluZ30gc3RhdHVzIFRlc3QgcmVzdWx0IHN0YXR1cyAoZS5nLjogJ3Bhc3NlZCcsICdmYWlsZWQnLCAnY3Jhc2hlZCcpXG4gKiBAcHJvcGVydHkge251bWJlcn0gZHVyYXRpb24gSG93IGxvbmcgZGlkIHRoZSB0ZXN0cyB0YWtlIChpbiBzZWNvbmRzKVxuICogQHByb3BlcnR5IHtzdHJpbmd9IGZhaWx1cmVNZXNzYWdlIEZhaWx1cmUgbWVzc2FnZSAoaWYgYXBwbGljYWJsZSlcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBsb2NhdGlvbiBUaGUgZ2VvbG9jYXRpb24gb2YgdGhlIHRlc3RzIChpZiBhcHBsaWNhYmxlKVxuICovXG5cbi8qKlxuICogUGFyc2UgdGhlIHN0ZG91dCBvZiBYQyB0ZXN0IGxvZ1xuICogQHBhcmFtIHtzdHJpbmd9IHN0ZG91dCBBIGxpbmUgb2Ygc3RhbmRhcmQgb3V0IGZyb20gYGlkYiB4Y3Rlc3QgcnVuIC4uLmBcbiAqIEByZXR1cm5zIHtBcnJheTxYQ1Rlc3RSZXN1bHQ+fSByZXN1bHRzIFRoZSBmaW5hbCBvdXRwdXQgb2YgdGhlIFhDVGVzdCBydW5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlWENUZXN0U3Rkb3V0IChzdGRvdXQpIHtcbiAgLy8gUGFyc2VzIGEgJ2tleScgaW50byBKU09OIGZvcm1hdFxuICBmdW5jdGlvbiBwYXJzZUtleSAobmFtZSkge1xuICAgIGNvbnN0IHdvcmRzID0gbmFtZS5zcGxpdCgnICcpO1xuICAgIGxldCBvdXQgPSAnJztcbiAgICBmb3IgKGNvbnN0IHdvcmQgb2Ygd29yZHMpIHtcbiAgICAgIG91dCArPSB3b3JkLnN1YnN0cigwLCAxKS50b1VwcGVyQ2FzZSgpICsgd29yZC5zdWJzdHIoMSk7XG4gICAgfVxuICAgIHJldHVybiBvdXQuc3Vic3RyKDAsIDEpLnRvTG93ZXJDYXNlKCkgKyBvdXQuc3Vic3RyKDEpO1xuICB9XG5cbiAgLy8gUGFyc2VzIGEgJ3ZhbHVlJyBpbnRvIEpTT04gZm9ybWF0XG4gIGZ1bmN0aW9uIHBhcnNlVmFsdWUgKHZhbHVlKSB7XG4gICAgdmFsdWUgPSB2YWx1ZSB8fCAnJztcbiAgICBzd2l0Y2ggKHZhbHVlLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgIGNhc2UgJ3RydWUnOiByZXR1cm4gdHJ1ZTtcbiAgICAgIGNhc2UgJ2ZhbHNlJzogcmV0dXJuIGZhbHNlO1xuICAgICAgY2FzZSAnJzogcmV0dXJuIG51bGw7XG4gICAgICBkZWZhdWx0OiBicmVhaztcbiAgICB9XG4gICAgaWYgKCFpc05hTih2YWx1ZSkpIHtcbiAgICAgIGlmICghXy5pc1N0cmluZyh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9IGVsc2UgaWYgKHZhbHVlLmluZGV4T2YoJy4nKSA+IDApIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQodmFsdWUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHBhcnNlSW50KHZhbHVlLCAxMCk7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICBpZiAoIXN0ZG91dCkge1xuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIC8vIFBhcnNlIGVhY2ggbGluZSBpbnRvIGFuIGFycmF5XG4gIGNvbnN0IGxpbmVzID0gc3Rkb3V0LnRyaW0oKS5zcGxpdCgnXFxuJyk7XG5cbiAgLy8gT25lIHNpbmdsZSBzdHJpbmcsIGp1c3QgcmV0dXJuIHRoZSBzdHJpbmdcbiAgaWYgKGxpbmVzLmxlbmd0aCA9PT0gMSAmJiAhbGluZXNbMF0uaW5jbHVkZXMoJ3wnKSkge1xuICAgIHJldHVybiBbbGluZXNbMF1dO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0cyA9IFtdO1xuICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAvLyBUaGUgcHJvcGVydGllcyBhcmUgc3BsaXQgdXAgYnkgcGlwZXMgYW5kIGVhY2ggcHJvcGVydHlcbiAgICAvLyBoYXMgdGhlIGZvcm1hdCBcIlNvbWUgS2V5IDogU29tZSBWYWx1ZVwiXG4gICAgY29uc3QgcHJvcGVydGllcyA9IGxpbmUuc3BsaXQoJ3wnKTtcblxuICAgIC8vIFBhcnNlIGVhY2ggcHJvcGVydHlcbiAgICBjb25zdCBvdXRwdXQgPSB7fTtcbiAgICBsZXQgZW50cnlJbmRleCA9IDA7XG4gICAgZm9yIChjb25zdCBwcm9wIG9mIHByb3BlcnRpZXMpIHtcbiAgICAgIGlmIChlbnRyeUluZGV4ID09PSAwKSB7XG4gICAgICAgIC8vIFRoZSBmaXJzdCBwcm9wZXJ0eSBvbmx5IGNvbnRhaW5zIG9uZSBzdHJpbmcgdGhhdCBjb250YWluc1xuICAgICAgICAvLyB0aGUgdGVzdCBuYW1lIChlLmcuOiAnWENUZXN0ZXJBcHBVSVRlc3RzIC0gWENUZXN0ZXJBcHBVSVRlc3RzLlhDVGVzdGVyQXBwVUlUZXN0cy90ZXN0RXhhbXBsZScpXG4gICAgICAgIG91dHB1dC50ZXN0TmFtZSA9IHByb3AudHJpbSgpO1xuICAgICAgfSBlbHNlIGlmIChwcm9wLnRyaW0oKS5zdGFydHNXaXRoKCdMb2NhdGlvbicpKSB7XG4gICAgICAgIC8vIFRoZSBMb2NhdGlvbiBwcm9wZXJ0eSBoYXMgYSB2YWx1ZSB0aGF0IGNvbWVzIGFmdGVyICdMb2NhdGlvbicgd2l0aG91dCBjb2xvbi5cbiAgICAgICAgLy8gZS5nLiBMb2NhdGlvbiAvcGF0aC90by9YQ1Rlc3RlckFwcFVJVGVzdHMvWENUZXN0ZXJBcHBVSVRlc3RzLnN3aWZ0OjM2XG4gICAgICAgIG91dHB1dC5sb2NhdGlvbiA9IHByb3Auc3Vic3RyaW5nKHByb3AuaW5kZXhPZignTG9jYXRpb24nKSArIDgpLnRyaW0oKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBba2V5LCB2YWx1ZV0gPSBwcm9wLnNwbGl0KCc6Jyk7XG4gICAgICAgIG91dHB1dFtwYXJzZUtleShrZXkudHJpbSgpKV0gPSBwYXJzZVZhbHVlKHZhbHVlID8gdmFsdWUudHJpbSgpIDogJycpO1xuICAgICAgfVxuICAgICAgZW50cnlJbmRleCsrO1xuICAgIH1cblxuICAgIC8vIGtlZXAgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuICAgIC8vIG9sZCBwYXR0ZXJuOiBYQ1Rlc3RlckFwcFVJVGVzdHMgLSBYQ1Rlc3RlckFwcFVJVGVzdHMuWENUZXN0ZXJBcHBVSVRlc3RzL3Rlc3RFeGFtcGxlIHwgUGFzc2VkOiBUcnVlIHwgQ3Jhc2hlZDogRmFsc2UgfCBEdXJhdGlvbjogMS40ODUgfCBGYWlsdXJlIG1lc3NhZ2U6ICB8IExvY2F0aW9uIDowXG4gICAgLy8gbGF0ZXN0IHBhdHRlcm46IFhDVGVzdGVyQXBwVUlUZXN0cyAtIFhDVGVzdGVyQXBwVUlUZXN0cy5YQ1Rlc3RlckFwcFVJVGVzdHMvdGVzdEV4YW1wbGUgfCBTdGF0dXM6IHBhc3NlZCB8IER1cmF0aW9uOiAxLjkyNTU3ODk1MTgzNTYzMjNcbiAgICBpZiAoIW91dHB1dC5wYXNzZWQpIHtcbiAgICAgIG91dHB1dC5wYXNzZWQgPSBvdXRwdXQuc3RhdHVzID09PSAncGFzc2VkJztcbiAgICAgIG91dHB1dC5jcmFzaGVkID0gb3V0cHV0LnN0YXR1cyA9PT0gJ2NyYXNoZWQnO1xuICAgIH0gZWxzZSBpZiAoIW91dHB1dC5zdGF0dXMpIHtcbiAgICAgIGlmIChvdXRwdXQucGFzc2VkKSB7XG4gICAgICAgIG91dHB1dC5zdGF0dXMgPSAncGFzc2VkJztcbiAgICAgIH0gZWxzZSBpZiAob3V0cHV0LmNyYXNoZWQpIHtcbiAgICAgICAgb3V0cHV0LnN0YXR1cyA9ICdjcmFzaGVkJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG91dHB1dC5zdGF0dXMgPSAnZmFpbGVkJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBZGQgdGhpcyBsaW5lIHRvIHRoZSByZXN1bHRzXG4gICAgcmVzdWx0cy5wdXNoKG91dHB1dCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdHM7XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gUnVuWENVSVRlc3RSZXNwb25zZVxuICpcbiAqIEBwcm9wZXJ0eSB7QXJyYXk8WENUZXN0UmVzdWx0Pn0gcmVzdWx0cyBUaGUgcmVzdWx0cyBvZiBhbGwgdGhlIHRlc3RzIHdpdGggaW5mb3JtYXRpb25cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBjb2RlIFRoZSBleGl0IGNvZGUgb2YgdGhlIHByb2Nlc3NcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzaWduYWwgVGhlIHNpZ25hbCB0aGF0IHRlcm1pbmF0ZWQgdGhlIHByb2Nlc3MgKG9yIG51bGwpIChlLmcuOiBTSUdURVJNKVxuICpcbiAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFJ1blhDVUlUZXN0T3B0aW9uc1xuICpcbiAqIEBwcm9wZXJ0eSB7IXN0cmluZ30gdGVzdFJ1bm5lckJ1bmRsZUlkIFRlc3QgYXBwIGJ1bmRsZSAoZS5nLjogJ2lvLmFwcGl1bS5YQ1Rlc3RlckFwcFVJVGVzdHMueGN0cnVubmVyJylcbiAqIEBwcm9wZXJ0eSB7IXN0cmluZ30gYXBwVW5kZXJUZXN0QnVuZGxlSWQgQXBwLXVuZGVyLXRlc3QgYnVuZGxlXG4gKiBAcHJvcGVydHkgeyFzdHJpbmd9IHhjVGVzdEJ1bmRsZUlEIHhjdGVzdCBidW5kbGUgaWRcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0ZXN0VHlwZSBbdWldIFhDIHRlc3QgdHlwZS4gJ2FwcCcsICd1aScsIG9yICdsb2dpYydcbiAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBlbnYgRW52aXJvbm1lbnQgdmFyaWFibGVzIHBhc3NlZCB0byB0ZXN0XG4gKiBAcHJvcGVydHkge0FycmF5PFN0cmluZz59IGFyZ3MgTGF1bmNoIGFyZ3VtZW50cyB0byBzdGFydCB0aGUgdGVzdCB3aXRoIChzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2RvY3VtZW50YXRpb24veGN0ZXN0L3hjdWlhcHBsaWNhdGlvbi8xNTAwNDc3LWxhdW5jaGFyZ3VtZW50cyBmb3IgcmVmZXJlbmNlKVxuICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVvdXQgWzM2MDAwMF0gVGltZW91dCBpZiBzZXNzaW9uIGRvZXNuJ3QgY29tcGxldGUgYWZ0ZXIgZ2l2ZW4gdGltZSAoaW4gbWlsbGlzZWNvbmRzKVxuICovXG5cblxuLyoqXG4gKiBAdHlwZWRlZiB7RXJyb3J9IFhDVUlUZXN0RXJyb3JcbiAqXG4gKiBAcHJvcGVydHkge251bWJlcn0gY29kZSBTdWJwcm9jZXNzIGV4aXQgY29kZVxuICogQHByb3BlcnR5IHtzdHJpbmd9IHNpZ25hbCBUaGUgc2lnbmFsIChTSUcqKSB0aGF0IGNhdXNlZCB0aGUgcHJvY2VzcyB0byBmYWlsXG4gKiBAcHJvcGVydHkgeyFBcnJheTxYQ1Rlc3RSZXN1bHQ+fSByZXN1bHRzIFRoZSBvdXRwdXQgb2YgdGhlIGZhaWxlZCB0ZXN0IChpZiB0aGVyZSBpcyBvdXRwdXQpXG4gKi9cblxuLyoqXG4gKiBSdW4gYW4gWENUZXN0LiBMYXVuY2hlcyBhIHN1YnByb2Nlc3MgdGhhdCBydW5zIHRoZSBYQyBUZXN0IGFuZCBibG9ja3NcbiAqIHVudGlsIGl0IGlzIGNvbXBsZXRlLiBQYXJzZXMgdGhlIHN0ZG91dCBvZiB0aGUgcHJvY2VzcyBhbmQgcmV0dXJuc1xuICogcmVzdWx0IGFzIGFuIGFycmF5XG4gKlxuICogU2VlIGh0dHBzOi8vZmJpZGIuaW8vZG9jcy90ZXN0X2V4ZWN1dGlvbiBmb3IgcmVmZXJlbmNlXG4gKlxuICogQHBhcmFtIHtSdW5YQ1VJVGVzdE9wdGlvbnN9IHJ1blhDVUlUZXN0T3B0aW9uc1xuICogQHRocm93cyB7WENVSVRlc3RFcnJvcn0gRXJyb3IgdGhyb3duIGlmIHN1YnByb2Nlc3MgcmV0dXJucyBub24temVybyBleGl0IGNvZGVcbiAqIEByZXR1cm5zIHtSdW5YQ1VJVGVzdFJlc3BvbnNlfVxuICovXG5jb21tYW5kcy5tb2JpbGVSdW5YQ1Rlc3QgPSBhc3luYyBmdW5jdGlvbiBydW5YQ1Rlc3QgKHtcbiAgdGVzdFJ1bm5lckJ1bmRsZUlkLFxuICBhcHBVbmRlclRlc3RCdW5kbGVJZCxcbiAgeGN0ZXN0QnVuZGxlSWQsXG4gIHRlc3RUeXBlID0gJ3VpJyxcbiAgZW52LFxuICBhcmdzLFxuICB0aW1lb3V0ID0gWENURVNUX1RJTUVPVVQsXG59KSB7XG4gIGNvbnN0IHN1YnByb2MgPSBhd2FpdCBhc3NlcnRJREIodGhpcy5vcHRzKS5ydW5YQ1VJVGVzdChcbiAgICAgICAgdGVzdFJ1bm5lckJ1bmRsZUlkLCBhcHBVbmRlclRlc3RCdW5kbGVJZCwgeGN0ZXN0QnVuZGxlSWQsIHtlbnYsIGFyZ3MsIHRlc3RUeXBlfSxcbiAgKTtcbiAgcmV0dXJuIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBsZXQgbW9zdFJlY2VudExvZ09iamVjdCA9IG51bGw7XG4gICAgbGV0IHhjdGVzdFRpbWVvdXQ7XG4gICAgbGV0IGxhc3RFcnJvck1lc3NhZ2UgPSBudWxsO1xuICAgIGlmICh0aW1lb3V0ID4gMCkge1xuICAgICAgeGN0ZXN0VGltZW91dCA9IHNldFRpbWVvdXQoXG4gICAgICAgICgpID0+IHJlamVjdChuZXcgZXJyb3JzLlRpbWVvdXRFcnJvcihgVGltZWQgb3V0IGFmdGVyICcke3RpbWVvdXR9bXMnIHdhaXRpbmcgZm9yIFhDVGVzdCB0byBjb21wbGV0ZWApKSxcbiAgICAgICAgdGltZW91dFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBzdWJwcm9jLm9uKCdvdXRwdXQnLCAoc3Rkb3V0LCBzdGRlcnIpID0+IHtcbiAgICAgIGlmIChzdGRvdXQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBtb3N0UmVjZW50TG9nT2JqZWN0ID0gcGFyc2VYQ1Rlc3RTdGRvdXQoc3Rkb3V0KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgLy8gRmFpbHMgaWYgbG9nIHBhcnNpbmcgZmFpbHMuXG4gICAgICAgICAgLy8gVGhpcyBpcyBpbiBjYXNlIElEQiBjaGFuZ2VzIHRoZSB3YXkgdGhhdCBsb2dzIGFyZSBmb3JtYXR0ZWQgYW5kXG4gICAgICAgICAgLy8gaXQgYnJlYWtzICdwYXJzZVhDVGVzdFN0ZG91dCcuIElmIHRoYXQgaGFwcGVucyB3ZSBzdGlsbCB3YW50IHRoZSBwcm9jZXNzXG4gICAgICAgICAgLy8gdG8gZmluaXNoXG4gICAgICAgICAgdGhpcy5sb2cud2FybihgRmFpbGVkIHRvIHBhcnNlIGxvZ3MgZnJvbSB0ZXN0IG91dHB1dDogJyR7c3Rkb3V0fSdgKTtcbiAgICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhlcnIuc3RhY2spO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGRlcnIpIHtcbiAgICAgICAgbGFzdEVycm9yTWVzc2FnZSA9IHN0ZGVycjtcbiAgICAgIH1cblxuICAgICAgc3Rkb3V0ICYmIHhjdGVzdExvZy5pbmZvKHN0ZG91dCk7XG4gICAgICBzdGRlcnIgJiYgeGN0ZXN0TG9nLmVycm9yKHN0ZGVycik7XG4gICAgfSk7XG5cbiAgICBzdWJwcm9jLm9uKCdleGl0JywgKGNvZGUsIHNpZ25hbCkgPT4ge1xuICAgICAgY2xlYXJUaW1lb3V0KHhjdGVzdFRpbWVvdXQpO1xuICAgICAgaWYgKGNvZGUgIT09IDApIHtcbiAgICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKGxhc3RFcnJvck1lc3NhZ2UgfHwgbW9zdFJlY2VudExvZ09iamVjdCk7XG4gICAgICAgIGVyci5jb2RlID0gY29kZTtcbiAgICAgICAgaWYgKHNpZ25hbCAhPSBudWxsKSB7XG4gICAgICAgICAgZXJyLnNpZ25hbCA9IHNpZ25hbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAobW9zdFJlY2VudExvZ09iamVjdCkge1xuICAgICAgICAgIGVyci5yZXN1bHQgPSBtb3N0UmVjZW50TG9nT2JqZWN0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgIH1cbiAgICAgIHJlc29sdmUoe1xuICAgICAgICBjb2RlLCBzaWduYWwsIHJlc3VsdHM6IG1vc3RSZWNlbnRMb2dPYmplY3QsIHBhc3NlZDogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gSW5zdGFsbFhDVGVzdEJ1bmRsZU9wdHNcbiAqXG4gKiBAcHJvcGVydHkge3hjdGVzdEFwcH0geGN0ZXN0QnVuZGxlIFBhdGggb2YgdGhlIFhDVGVzdCBhcHAgKFVSTCBvciAuYXBwKVxuICovXG5cbi8qKlxuICogSW5zdGFsbCBhbiBYQ1Rlc3RCdW5kbGVcbiAqXG4gKiBAcGFyYW0ge0luc3RhbGxYQ1Rlc3RCdW5kbGVPcHRzIX0gb3B0cyBJbnN0YWxsIHhjdGVzdCBidW5kbGUgb3B0c1xuICovXG5jb21tYW5kcy5tb2JpbGVJbnN0YWxsWENUZXN0QnVuZGxlID0gYXN5bmMgZnVuY3Rpb24gaW5zdGFsbFhDVGVzdEJ1bmRsZSAob3B0cykge1xuICBjb25zdCB7IHhjdGVzdEFwcCB9ID0gb3B0cztcbiAgaWYgKCFfLmlzU3RyaW5nKHhjdGVzdEFwcCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRBcmd1bWVudEVycm9yKGAneGN0ZXN0QXBwJyBpcyBhIHJlcXVpcmVkIHBhcmFtZXRlciBmb3IgJ2luc3RhbGxYQ1Rlc3RCdW5kbGUnIGFuZCBgICtcbiAgICAgIGBtdXN0IGJlIGEgc3RyaW5nLiBGb3VuZCAnJHt4Y3Rlc3RBcHB9J2ApO1xuICB9XG4gIHhjdGVzdExvZy5pbmZvKGBJbnN0YWxsaW5nIGJ1bmRsZSAnJHt4Y3Rlc3RBcHB9J2ApO1xuICBjb25zdCBpZGIgPSBhc3NlcnRJREIodGhpcy5vcHRzKTtcbiAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5oZWxwZXJzLmNvbmZpZ3VyZUFwcCh4Y3Rlc3RBcHAsICcueGN0ZXN0Jyk7XG4gIGF3YWl0IGlkYi5pbnN0YWxsWENUZXN0QnVuZGxlKHJlcyk7XG59O1xuXG4vKipcbiAqIExpc3QgWENUZXN0IGJ1bmRsZXMgdGhhdCBhcmUgaW5zdGFsbGVkIG9uIGRldmljZVxuICpcbiAqIEByZXR1cm5zIHtBcnJheTxzdHJpbmc+fSBMaXN0IG9mIFhDVGVzdCBidW5kbGVzIChlLmcuOiBcIlhDVGVzdGVyQXBwVUlUZXN0cy5YQ1Rlc3RlckFwcFVJVGVzdHMvdGVzdExhdW5jaFBlcmZvcm1hbmNlXCIpXG4gKi9cbmNvbW1hbmRzLm1vYmlsZUxpc3RYQ1Rlc3RCdW5kbGVzID0gYXN5bmMgZnVuY3Rpb24gbGlzdFhDVGVzdHNJblRlc3RCdW5kbGUgKCkge1xuICByZXR1cm4gYXdhaXQgYXNzZXJ0SURCKHRoaXMub3B0cykubGlzdFhDVGVzdEJ1bmRsZXMoKTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gTGlzdFhDVGVzdHNPcHRzXG4gKlxuICogQHByb3BlcnR5IHshc3RyaW5nfSBidW5kbGUgQnVuZGxlIElEIG9mIHRoZSBYQ1Rlc3RcbiAqL1xuXG4vKipcbiAqIExpc3QgWENUZXN0cyBpbiBhIHRlc3QgYnVuZGxlXG4gKlxuICogQHBhcmFtIHshTGlzdFhDVGVzdHNPcHRzfSBvcHRzIFhDVGVzdCBsaXN0IG9wdGlvbnNcbiAqXG4gKiBAcmV0dXJucyB7QXJyYXk8c3RyaW5nPn0gVGhlIGxpc3Qgb2YgeGN0ZXN0cyBpbiB0aGUgdGVzdCBidW5kbGVcbiAqICAgIChlLmcuOiBbICdYQ1Rlc3RlckFwcFVJVGVzdHMuWENUZXN0ZXJBcHBVSVRlc3RzL3Rlc3RFeGFtcGxlJyxcbiAgICAgICAgICAgICAgICAnWENUZXN0ZXJBcHBVSVRlc3RzLlhDVGVzdGVyQXBwVUlUZXN0cy90ZXN0TGF1bmNoUGVyZm9ybWFuY2UnIF0gKVxuICovXG5jb21tYW5kcy5tb2JpbGVMaXN0WENUZXN0c0luVGVzdEJ1bmRsZSA9IGFzeW5jIGZ1bmN0aW9uIGxpc3RYQ1Rlc3RzSW5UZXN0QnVuZGxlIChvcHRzKSB7XG4gIGNvbnN0IHsgYnVuZGxlIH0gPSBvcHRzO1xuICBpZiAoIV8uaXNTdHJpbmcoYnVuZGxlKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZEFyZ3VtZW50RXJyb3IoYCdidW5kbGUnIGlzIGEgcmVxdWlyZWQgcGFyYW1ldGVyIGZvciAnbGlzdFhDVGVzdHNJblRlc3RCdW5kbGUnIGFuZCBgICtcbiAgICAgIGBtdXN0IGJlIGEgc3RyaW5nLiBGb3VuZCAnJHtidW5kbGV9J2ApO1xuICB9XG4gIGNvbnN0IGlkYiA9IGFzc2VydElEQih0aGlzLm9wdHMpO1xuICByZXR1cm4gYXdhaXQgaWRiLmxpc3RYQ1Rlc3RzSW5UZXN0QnVuZGxlKGJ1bmRsZSk7XG59O1xuXG5PYmplY3QuYXNzaWduKGNvbW1hbmRzKTtcbmV4cG9ydCB7IGNvbW1hbmRzIH07XG5leHBvcnQgZGVmYXVsdCBjb21tYW5kcztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLElBQUFBLFNBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFFBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLE9BQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFHLE9BQUEsR0FBQUgsT0FBQTtBQUdBLE1BQU1JLFFBQVEsR0FBRyxDQUFDLENBQUM7QUFBQ0MsT0FBQSxDQUFBRCxRQUFBLEdBQUFBLFFBQUE7QUFFcEIsTUFB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