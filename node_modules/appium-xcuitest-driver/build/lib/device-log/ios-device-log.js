"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.IOSDeviceLog = void 0;
require("source-map-support/register");
var _support = require("appium/support");
var _iosLog = require("./ios-log");
var _appiumIosDevice = require("appium-ios-device");
const log = _support.logger.getLogger('IOSDeviceLog');
class IOSDeviceLog extends _iosLog.IOSLog {
  constructor(opts) {
    super();
    this.udid = opts.udid;
    this.showLogs = !!opts.showLogs;
    this.service = null;
  }
  async startCapture() {
    if (this.service) {
      return;
    }
    this.service = await _appiumIosDevice.services.startSyslogService(this.udid);
    this.service.start(this.onLog.bind(this));
  }
  onLog(logLine) {
    this.broadcast(logLine);
    if (this.showLogs) {
      log.info(logLine);
    }
  }
  get isCapturing() {
    return !!this.service;
  }
  stopCapture() {
    if (!this.service) {
      return;
    }
    this.service.close();
    this.service = null;
  }
}
exports.IOSDeviceLog = IOSDeviceLog;
var _default = IOSDeviceLog;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc3VwcG9ydCIsInJlcXVpcmUiLCJfaW9zTG9nIiwiX2FwcGl1bUlvc0RldmljZSIsImxvZyIsImxvZ2dlciIsImdldExvZ2dlciIsIklPU0RldmljZUxvZyIsIklPU0xvZyIsImNvbnN0cnVjdG9yIiwib3B0cyIsInVkaWQiLCJzaG93TG9ncyIsInNlcnZpY2UiLCJzdGFydENhcHR1cmUiLCJzZXJ2aWNlcyIsInN0YXJ0U3lzbG9nU2VydmljZSIsInN0YXJ0Iiwib25Mb2ciLCJiaW5kIiwibG9nTGluZSIsImJyb2FkY2FzdCIsImluZm8iLCJpc0NhcHR1cmluZyIsInN0b3BDYXB0dXJlIiwiY2xvc2UiLCJleHBvcnRzIiwiX2RlZmF1bHQiLCJkZWZhdWx0Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2RldmljZS1sb2cvaW9zLWRldmljZS1sb2cuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHsgSU9TTG9nIH0gZnJvbSAnLi9pb3MtbG9nJztcbmltcG9ydCB7IHNlcnZpY2VzIH0gZnJvbSAnYXBwaXVtLWlvcy1kZXZpY2UnO1xuXG5jb25zdCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdJT1NEZXZpY2VMb2cnKTtcblxuY2xhc3MgSU9TRGV2aWNlTG9nIGV4dGVuZHMgSU9TTG9nIHtcblxuICBjb25zdHJ1Y3RvciAob3B0cykge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy51ZGlkID0gb3B0cy51ZGlkO1xuICAgIHRoaXMuc2hvd0xvZ3MgPSAhIW9wdHMuc2hvd0xvZ3M7XG4gICAgdGhpcy5zZXJ2aWNlID0gbnVsbDtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0Q2FwdHVyZSAoKSB7XG4gICAgaWYgKHRoaXMuc2VydmljZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnNlcnZpY2UgPSBhd2FpdCBzZXJ2aWNlcy5zdGFydFN5c2xvZ1NlcnZpY2UodGhpcy51ZGlkKTtcbiAgICB0aGlzLnNlcnZpY2Uuc3RhcnQodGhpcy5vbkxvZy5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIG9uTG9nIChsb2dMaW5lKSB7XG4gICAgdGhpcy5icm9hZGNhc3QobG9nTGluZSk7XG4gICAgaWYgKHRoaXMuc2hvd0xvZ3MpIHtcbiAgICAgIGxvZy5pbmZvKGxvZ0xpbmUpO1xuICAgIH1cbiAgfVxuXG4gIGdldCBpc0NhcHR1cmluZyAoKSB7XG4gICAgcmV0dXJuICEhdGhpcy5zZXJ2aWNlO1xuICB9XG5cbiAgc3RvcENhcHR1cmUgKCkge1xuICAgIGlmICghdGhpcy5zZXJ2aWNlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc2VydmljZS5jbG9zZSgpO1xuICAgIHRoaXMuc2VydmljZSA9IG51bGw7XG4gIH1cbn1cblxuZXhwb3J0IHsgSU9TRGV2aWNlTG9nIH07XG5leHBvcnQgZGVmYXVsdCBJT1NEZXZpY2VMb2c7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxJQUFBQSxRQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxPQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxnQkFBQSxHQUFBRixPQUFBO0FBRUEsTUFBTUcsR0FBRyxHQUFHQyxlQUFNLENBQUNDLFNBQVMsQ0FBQyxjQUFjLENBQUM7QUFFNUMsTUFBTUMsWUFBWSxTQUFTQyxjQUFNLENBQUM7RUFFaENDLFdBQVdBLENBQUVDLElBQUksRUFBRTtJQUNqQixLQUFLLEVBQUU7SUFDUCxJQUFJLENBQUNDLElBQUksR0FBR0QsSUFBSSxDQUFDQyxJQUFJO0lBQ3JCLElBQUksQ0FBQ0MsUUFBUSxHQUFHLENBQUMsQ0FBQ0YsSUFBSSxDQUFDRSxRQUFRO0lBQy9CLElBQUksQ0FBQ0MsT0FBTyxHQUFHLElBQUk7RUFDckI7RUFFQSxNQUFNQyxZQUFZQSxDQUFBLEVBQUk7SUFDcEIsSUFBSSxJQUFJLENBQUNELE9BQU8sRUFBRTtNQUNoQjtJQUNGO0lBQ0EsSUFBSSxDQUFDQSxPQUFPLEdBQUcsTUFBTUUseUJBQVEsQ0FBQ0Msa0JBQWtCLENBQUMsSUFBSSxDQUFDTCxJQUFJLENBQUM7SUFDM0QsSUFBSSxDQUFDRSxPQUFPLENBQUNJLEtBQUssQ0FBQyxJQUFJLENBQUNDLEtBQUssQ0FBQ0MsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0VBQzNDO0VBRUFELEtBQUtBLENBQUVFLE9BQU8sRUFBRTtJQUNkLElBQUksQ0FBQ0MsU0FBUyxDQUFDRCxPQUFPLENBQUM7SUFDdkIsSUFBSSxJQUFJLENBQUNSLFFBQVEsRUFBRTtNQUNqQlIsR0FBRyxDQUFDa0IsSUFBSSxDQUFDRixPQUFPLENBQUM7SUFDbkI7RUFDRjtFQUVBLElBQUlHLFdBQVdBLENBQUEsRUFBSTtJQUNqQixPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUNWLE9BQU87RUFDdkI7RUFFQVcsV0FBV0EsQ0FBQSxFQUFJO0lBQ2IsSUFBSSxDQUFDLElBQUksQ0FBQ1gsT0FBTyxFQUFFO01BQ2pCO0lBQ0Y7SUFDQSxJQUFJLENBQUNBLE9BQU8sQ0FBQ1ksS0FBSyxFQUFFO0lBQ3BCLElBQUksQ0FBQ1osT0FBTyxHQUFHLElBQUk7RUFDckI7QUFDRjtBQUFDYSxPQUFBLENBQUFuQixZQUFBLEdBQUFBLFlBQUE7QUFBQSxJQUFBb0IsUUFBQSxHQUdjcEIsWUFBWTtBQUFBbUIsT0FBQSxDQUFBRSxPQUFBLEdBQUFELFFBQUEifQ==