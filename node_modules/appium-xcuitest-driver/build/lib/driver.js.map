{"version":3,"file":"driver.js","names":["_driver","require","_support","_lodash","_interopRequireDefault","_url","_appiumWebdriveragent","_lruCache","_methodMap","_simulatorManagement","_appiumIosSimulator","_asyncbox","_appUtils","_desiredCaps","_index","_utils","_realDeviceManagement","_bluebird","_asyncLock","_path","_appiumIdb","_deviceConnectionsFactory","_pyIosDeviceClient","SHUTDOWN_OTHER_FEAT_NAME","CUSTOMIZE_RESULT_BUNDPE_PATH","SUPPORTED_EXTENSIONS","IPA_EXT","APP_EXT","MAX_ARCHIVE_SCAN_DEPTH","defaultServerCaps","webStorageEnabled","locationContextEnabled","browserName","platform","javascriptEnabled","databaseEnabled","takesScreenshot","networkConnectionEnabled","WDA_SIM_STARTUP_RETRIES","WDA_REAL_DEV_STARTUP_RETRIES","WDA_REAL_DEV_TUTORIAL_URL","WDA_STARTUP_RETRY_INTERVAL","DEFAULT_SETTINGS","nativeWebTap","nativeWebTapStrict","useJSONSource","shouldUseCompactResponses","elementResponseAttributes","mjpegServerScreenshotQuality","mjpegServerFramerate","screenshotQuality","mjpegScalingFactor","reduceMotion","SHARED_RESOURCES_GUARD","AsyncLock","WEB_ELEMENTS_CACHE_SIZE","SUPPORTED_ORIENATIONS","NO_PROXY_NATIVE_LIST","NO_PROXY_WEB_LIST","concat","MEMOIZED_FUNCTIONS","BUNDLE_VERSION_PATTERN","XCUITestDriver","BaseDriver","newMethodMap","constructor","opts","shouldValidateCaps","desiredCapConstraints","locatorStrategies","webLocatorStrategies","resetIos","settings","DeviceSettings","onSettingsUpdate","bind","logs","fn","_","memoize","key","value","proxyCommand","wda","device","jwpProxyActive","proxyReqRes","jwpProxyAvoid","safari","cachedWdaStatus","curWebFrames","_currentUrl","curContext","xcodeVersion","contexts","implicitWaitMs","asynclibWaitMs","pageLoadMs","landscapeWebCoordsOffset","remote","_conditionInducerService","webElementsCache","LRU","max","driverData","getStatus","driverInfo","getDriverInfo","status","build","version","mergeCliArgsToOpts","didMerge","Object","entries","cliArgs","has","log","info","createSession","args","lifecycleData","sessionId","caps","validateDesiredCaps","start","assign","udid","updateSettings","wdaSettings","mjpegScreenshotUrl","mjpegStream","mjpeg","MJpegStream","e","error","JSON","stringify","deleteSession","getDefaultUrl","isRealDevice","wdaLocalPort","address","includes","port","noReset","fullReset","printUser","iosSdkVersion","realDevice","determineDevice","simulatorDevicesSetPath","devicesSetPath","platformVersion","getPlatformVersion","normalizedVersion","normalizePlatformVersion","util","compareVersions","Error","isEmpty","webDriverAgentUrl","getAndCheckXcodeVersion","logEvent","toLower","app","undefined","processArguments","bundleId","SAFARI_BUNDLE_ID","safariInitialUrl","configureApp","checkAppPresent","extractBundleId","runReset","WebDriverAgent","retrieveDerivedDataPath","catch","debug","memoizedLogInfo","startLogCapture","skipLogCapture","result","isLogCaptureStarted","isSimulator","shutdownOtherSimulators","ensureFeatureEnabled","startSim","customSSLCert","addCertificate","setSafariPrefs","setLocalizationPrefs","isBoolean","setReduceMotion","reduceTransparency","setReduceTransparency","launchWithIDB","idb","IDB","connect","stack","warn","message","Pyidevice","installProfile","payload","installAUT","isSafari","isAppInstalled","errorAndThrow","permissions","permissionsMapping","toPairs","parse","setPermissions","calendarAccessAuthorized","methodName","startWda","orientation","setInitialOrientation","autoWebview","activateRecentWebview","isNil","getCurrentUrl","setUrl","setCurrentUrl","getUrl","hasValue","cleanupObsoleteProcesses","usePortForwarding","isLocalHost","wdaBaseUrl","DEVICE_CONNECTIONS_FACTORY","requestConnection","url","devicePort","wdaRemotePort","synchronizationKey","name","useXctestrunFile","isSourceFresh","derivedDataPath","path","normalize","isBusy","bootstrapPath","acquire","useNewWDA","quitAndUninstall","setupCaching","msg","resultBundlePath","startupRetries","wdaStartupRetries","startupRetryInterval","wdaStartupRetryInterval","retryCount","retryInterval","retries","major","retry","launch","err","errorMsg","originalStacktrace","startWdaSession","clearSystemFiles","markSystemFilesForCleanup","fullyStarted","runRealDeviceReset","runSimulatorReset","removeAllSessionWebSocketHandlers","server","recorder","compact","_recentScreenRecorder","_audioRecorder","_trafficCapture","interrupt","cleanup","_perfRecorders","B","all","map","x","stop","mobileDisableConditionInducer","stopRemote","resetOnSessionStartOnly","enforceSimulatorShutdown","createSim","shutdownSimulator","delete","shouldResetLocationServivce","resetLocationService","mobileResetLocationService","ignore","syslog","stopCapture","jwproxy","quit","releaseConnection","executeCommand","cmd","receiveAsyncResponse","appIsPackageOrBundle","test","helpers","onPostProcess","onPostConfigureApp","supportedExtensions","unzipApp","appPath","depth","rootDir","matchedPaths","findApps","basename","pluralize","length","matchedPath","fullPath","join","isAppBundle","supportedPlatforms","fetchSupportedAppPlatforms","some","p","isolateAppBundle","endsWith","fs","stat","isFile","rimraf","cachedAppInfo","isUrl","isPlainObject","hash","packageHash","exists","glob","cwd","strict","nosort","integrity","folder","deviceName","translateDeviceName","setupVersionCaps","getAndCheckIosSdkVersion","toLowerCase","detectUdid","getExistingSim","devicePlatform","devices","getConnectedDevices","getSimulator","ign","getRealDeviceObj","enforceFreshSimulatorCreation","runOpts","scaleFactor","connectHardwareKeyboard","pasteboardAutomaticSync","simulatorPasteboardAutomaticSync","isHeadless","tracePointer","simulatorTracePointer","devicePreferences","SimulatorWindowCenter","isInteger","simulatorStartupTimeout","startupTimeout","isString","toUpperCase","SimulatorWindowOrientation","SimulatorWindowRotationAngle","run","platformName","isTvOS","PLATFORM_NAME_TVOS","PLATFORM_NAME_IOS","sim","launchApp","APP_LAUNCH_TIMEOUT","checkStatus","response","currentApp","bundleID","parseInt","isArray","env","language","push","locale","shouldTerminateApp","forceAppLaunch","wdaCaps","autoLaunch","arguments","environment","eventloopIdleDelaySec","wdaEventloopIdleDelay","shouldWaitForQuiescence","waitForQuiescence","shouldUseTestManagerForVisibilityDetection","simpleIsVisibleCheck","maxTypingFrequency","shouldUseSingletonTestManager","waitForIdleTimeout","elementResponseFields","disableAutomaticScreenshots","useNativeCachingStrategy","forceSimulatorSoftwareKeyboardPresence","autoAcceptAlerts","defaultAlertAction","autoDismissAlerts","capabilities","firstMatch","alwaysMatch","proxyActive","getProxyAvoidList","isWebview","canProxy","isWebContext","validateLocatorStrategy","strategy","coerceVersion","verifyProcessArgument","keychainPath","keychainPassword","commandTimeouts","normalizeCommandTimeouts","protocol","host","perms","additionalWebviewBundleIds","parseCapsArray","checkAutInstallationState","_await$device$fetchAp","_BUNDLE_VERSION_PATTE","enforceAppInstall","wasAppInstalled","install","skipUninstall","candidateBundleVersion","extractBundleVersion","appBundleVersion","fetchAppInfo","CFBundleVersion","exec","simctl","appInfo","shouldUpgrade","verifyApplicationPlatform","installToRealDevice","timeout","appPushTimeout","appInstallStrategy","installToSimulator","newSimulator","iosInstallPause","pauseMs","delay","otherApps","installOtherApps","appsList","appPaths","otherApp","dstOrientation","toUpper","_getCommandTimeout","cmdName","DEFAULT_TIMEOUT_KEY","getSession","driverSession","shouldGetDeviceCaps","includeDeviceCapsToSessionInfo","deviceCaps","statusBarSize","scale","getScreenInfo","pixelRatio","statBarHeight","height","viewportRect","getViewportRect","reset","cloneDeep","shutdownHandler","resetOnUnexpectedShutdown","exports","prototype","commands","_default","default"],"sources":["../../lib/driver.js"],"sourcesContent":["import { BaseDriver, DeviceSettings } from 'appium/driver';\nimport { util, mjpeg, fs } from 'appium/support';\nimport _ from 'lodash';\nimport url from 'url';\nimport { WebDriverAgent } from 'appium-webdriveragent';\nimport LRU from 'lru-cache';\nimport { newMethodMap } from './method-map';\nimport {\n  createSim, getExistingSim, runSimulatorReset, installToSimulator,\n  shutdownOtherSimulators, shutdownSimulator, setSafariPrefs, setLocalizationPrefs\n} from './simulator-management';\nimport { getSimulator } from 'appium-ios-simulator';\nimport { retryInterval, retry } from 'asyncbox';\nimport {\n  verifyApplicationPlatform, extractBundleId, SAFARI_BUNDLE_ID,\n  fetchSupportedAppPlatforms, APP_EXT, IPA_EXT,\n  isAppBundle, findApps, isolateAppBundle, extractBundleVersion,\n} from './app-utils';\nimport {\n  desiredCapConstraints, PLATFORM_NAME_IOS, PLATFORM_NAME_TVOS\n} from './desired-caps';\nimport commands from './commands/index';\nimport {\n  detectUdid, getAndCheckXcodeVersion, getAndCheckIosSdkVersion,\n  checkAppPresent, getDriverInfo,\n  clearSystemFiles, translateDeviceName, normalizeCommandTimeouts,\n  DEFAULT_TIMEOUT_KEY, markSystemFilesForCleanup,\n  printUser, removeAllSessionWebSocketHandlers,\n  normalizePlatformVersion, isLocalHost\n} from './utils';\nimport {\n  getConnectedDevices, runRealDeviceReset, installToRealDevice,\n  getRealDeviceObj\n} from './real-device-management';\nimport B from 'bluebird';\nimport AsyncLock from 'async-lock';\nimport path from 'path';\nimport IDB from 'appium-idb';\nimport DEVICE_CONNECTIONS_FACTORY from './device-connections-factory';\nimport Pyidevice from './py-ios-device-client';\n\n\nconst SHUTDOWN_OTHER_FEAT_NAME = 'shutdown_other_sims';\nconst CUSTOMIZE_RESULT_BUNDPE_PATH = 'customize_result_bundle_path';\n\nconst SUPPORTED_EXTENSIONS = [IPA_EXT, APP_EXT];\nconst MAX_ARCHIVE_SCAN_DEPTH = 1;\nconst defaultServerCaps = {\n  webStorageEnabled: false,\n  locationContextEnabled: false,\n  browserName: '',\n  platform: 'MAC',\n  javascriptEnabled: true,\n  databaseEnabled: false,\n  takesScreenshot: true,\n  networkConnectionEnabled: false,\n};\nconst WDA_SIM_STARTUP_RETRIES = 2;\nconst WDA_REAL_DEV_STARTUP_RETRIES = 1;\nconst WDA_REAL_DEV_TUTORIAL_URL = 'https://github.com/appium/appium-xcuitest-driver/blob/master/docs/real-device-config.md';\nconst WDA_STARTUP_RETRY_INTERVAL = 10000;\nconst DEFAULT_SETTINGS = {\n  nativeWebTap: false,\n  nativeWebTapStrict: false,\n  useJSONSource: false,\n  shouldUseCompactResponses: true,\n  elementResponseAttributes: 'type,label',\n  // Read https://github.com/appium/WebDriverAgent/blob/master/WebDriverAgentLib/Utilities/FBConfiguration.m for following settings' values\n  mjpegServerScreenshotQuality: 25,\n  mjpegServerFramerate: 10,\n  screenshotQuality: 1,\n  mjpegScalingFactor: 100,\n  // set `reduceMotion` to `null` so that it will be verified but still set either true/false\n  reduceMotion: null,\n};\n// This lock assures, that each driver session does not\n// affect shared resources of the other parallel sessions\nconst SHARED_RESOURCES_GUARD = new AsyncLock();\nconst WEB_ELEMENTS_CACHE_SIZE = 500;\nconst SUPPORTED_ORIENATIONS = ['LANDSCAPE', 'PORTRAIT'];\n/* eslint-disable no-useless-escape */\nconst NO_PROXY_NATIVE_LIST = [\n  ['DELETE', /window/],\n  ['GET', /^\\/session\\/[^\\/]+$/],\n  ['GET', /alert_text/],\n  ['GET', /alert\\/[^\\/]+/],\n  ['GET', /appium/],\n  ['GET', /attribute/],\n  ['GET', /context/],\n  ['GET', /location/],\n  ['GET', /log/],\n  ['GET', /screenshot/],\n  ['GET', /size/],\n  ['GET', /source/],\n  ['GET', /timeouts$/],\n  ['GET', /url/],\n  ['GET', /window/],\n  ['POST', /accept_alert/],\n  ['POST', /actions$/],\n  ['DELETE', /actions$/],\n  ['POST', /alert_text/],\n  ['POST', /alert\\/[^\\/]+/],\n  ['POST', /appium/],\n  ['POST', /appium\\/device\\/is_locked/],\n  ['POST', /appium\\/device\\/lock/],\n  ['POST', /appium\\/device\\/unlock/],\n  ['POST', /back/],\n  ['POST', /clear/],\n  ['POST', /context/],\n  ['POST', /dismiss_alert/],\n  ['POST', /element\\/active/], // MJSONWP get active element should proxy\n  ['POST', /element$/],\n  ['POST', /elements$/],\n  ['POST', /execute/],\n  ['POST', /keys/],\n  ['POST', /log/],\n  ['POST', /moveto/],\n  ['POST', /receive_async_response/], // always, in case context switches while waiting\n  ['POST', /session\\/[^\\/]+\\/location/], // geo location, but not element location\n  ['POST', /shake/],\n  ['POST', /timeouts/],\n  ['POST', /touch/],\n  ['POST', /url/],\n  ['POST', /value/],\n  ['POST', /window/],\n  ['DELETE', /cookie/],\n  ['GET', /cookie/],\n  ['POST', /cookie/],\n];\nconst NO_PROXY_WEB_LIST = [\n  ['GET', /attribute/],\n  ['GET', /element/],\n  ['GET', /text/],\n  ['GET', /title/],\n  ['POST', /clear/],\n  ['POST', /click/],\n  ['POST', /element/],\n  ['POST', /forward/],\n  ['POST', /frame/],\n  ['POST', /keys/],\n  ['POST', /refresh/],\n].concat(NO_PROXY_NATIVE_LIST);\n/* eslint-enable no-useless-escape */\n\nconst MEMOIZED_FUNCTIONS = [\n  'getStatusBarHeight',\n  'getDevicePixelRatio',\n  'getScreenInfo',\n];\nconst BUNDLE_VERSION_PATTERN = /CFBundleVersion\\s+=\\s+\"?([^(;|\")]+)/;\n\n\nclass XCUITestDriver extends BaseDriver {\n\n  static newMethodMap = newMethodMap;\n\n  constructor (opts = {}, shouldValidateCaps = true) {\n    super(opts, shouldValidateCaps);\n\n    this.desiredCapConstraints = desiredCapConstraints;\n\n    this.locatorStrategies = [\n      'xpath',\n      'id',\n      'name',\n      'class name',\n      '-ios predicate string',\n      '-ios class chain',\n      'accessibility id',\n      'css selector',\n    ];\n    this.webLocatorStrategies = [\n      'link text',\n      'css selector',\n      'tag name',\n      'link text',\n      'partial link text',\n    ];\n    this.resetIos();\n    this.settings = new DeviceSettings(DEFAULT_SETTINGS, this.onSettingsUpdate.bind(this));\n    this.logs = {};\n\n    // memoize functions here, so that they are done on a per-instance basis\n    for (const fn of MEMOIZED_FUNCTIONS) {\n      this[fn] = _.memoize(this[fn]);\n    }\n  }\n\n  async onSettingsUpdate (key, value) {\n    if (key !== 'nativeWebTap' && key !== 'nativeWebTapStrict') {\n      return await this.proxyCommand('/appium/settings', 'POST', {\n        settings: {[key]: value}\n      });\n    }\n    this.opts[key] = !!value;\n  }\n\n  resetIos () {\n    this.opts = this.opts || {};\n    this.wda = null;\n    this.opts.device = null;\n    this.jwpProxyActive = false;\n    this.proxyReqRes = null;\n    this.jwpProxyAvoid = [];\n    this.safari = false;\n    this.cachedWdaStatus = null;\n\n    this.curWebFrames = [];\n    this._currentUrl = null;\n    this.curContext = null;\n    this.xcodeVersion = {};\n    this.contexts = [];\n    this.implicitWaitMs = 0;\n    this.asynclibWaitMs = 0;\n    this.pageLoadMs = 6000;\n    this.landscapeWebCoordsOffset = 0;\n    this.remote = null;\n    this._conditionInducerService = null;\n\n    this.webElementsCache = new LRU({\n      max: WEB_ELEMENTS_CACHE_SIZE,\n    });\n  }\n\n  get driverData () {\n    // TODO fill out resource info here\n    return {};\n  }\n\n  async getStatus () {\n    if (typeof this.driverInfo === 'undefined') {\n      this.driverInfo = await getDriverInfo();\n    }\n    let status = {build: {version: this.driverInfo.version}};\n    if (this.cachedWdaStatus) {\n      status.wda = this.cachedWdaStatus;\n    }\n    return status;\n  }\n\n  mergeCliArgsToOpts () {\n    let didMerge = false;\n    // this.cliArgs should never include anything we do not expect.\n    for (const [key, value] of Object.entries(this.cliArgs ?? {})) {\n      if (_.has(this.opts, key)) {\n        this.log.info(`CLI arg '${key}' with value '${value}' overwrites value '${this.opts[key]}' sent in via caps)`);\n        didMerge = true;\n      }\n      this.opts[key] = value;\n    }\n    return didMerge;\n  }\n\n  async createSession (...args) {\n    this.lifecycleData = {}; // this is used for keeping track of the state we start so when we delete the session we can put things back\n    try {\n      let [sessionId, caps] = await super.createSession(...args);\n      this.opts.sessionId = sessionId;\n\n      // merge cli args to opts, and if we did merge any, revalidate opts to ensure the final set\n      // is also consistent\n      if (this.mergeCliArgsToOpts()) {\n        this.validateDesiredCaps({...caps, ...this.cliArgs});\n      }\n\n      await this.start();\n\n      // merge server capabilities + desired capabilities\n      caps = Object.assign({}, defaultServerCaps, caps);\n      // update the udid with what is actually used\n      caps.udid = this.opts.udid;\n      // ensure we track nativeWebTap capability as a setting as well\n      if (_.has(this.opts, 'nativeWebTap')) {\n        await this.updateSettings({nativeWebTap: this.opts.nativeWebTap});\n      }\n      // ensure we track nativeWebTapStrict capability as a setting as well\n      if (_.has(this.opts, 'nativeWebTapStrict')) {\n        await this.updateSettings({nativeWebTapStrict: this.opts.nativeWebTapStrict});\n      }\n      // ensure we track useJSONSource capability as a setting as well\n      if (_.has(this.opts, 'useJSONSource')) {\n        await this.updateSettings({useJSONSource: this.opts.useJSONSource});\n      }\n\n      let wdaSettings = {\n        elementResponseAttributes: DEFAULT_SETTINGS.elementResponseAttributes,\n        shouldUseCompactResponses: DEFAULT_SETTINGS.shouldUseCompactResponses,\n      };\n      if (_.has(this.opts, 'elementResponseAttributes')) {\n        wdaSettings.elementResponseAttributes = this.opts.elementResponseAttributes;\n      }\n      if (_.has(this.opts, 'shouldUseCompactResponses')) {\n        wdaSettings.shouldUseCompactResponses = this.opts.shouldUseCompactResponses;\n      }\n      if (_.has(this.opts, 'mjpegServerScreenshotQuality')) {\n        wdaSettings.mjpegServerScreenshotQuality = this.opts.mjpegServerScreenshotQuality;\n      }\n      if (_.has(this.opts, 'mjpegServerFramerate')) {\n        wdaSettings.mjpegServerFramerate = this.opts.mjpegServerFramerate;\n      }\n      if (_.has(this.opts, 'screenshotQuality')) {\n        this.log.info(`Setting the quality of phone screenshot: '${this.opts.screenshotQuality}'`);\n        wdaSettings.screenshotQuality = this.opts.screenshotQuality;\n      }\n      // ensure WDA gets our defaults instead of whatever its own might be\n      await this.updateSettings(wdaSettings);\n\n      // turn on mjpeg stream reading if requested\n      if (this.opts.mjpegScreenshotUrl) {\n        this.log.info(`Starting MJPEG stream reading URL: '${this.opts.mjpegScreenshotUrl}'`);\n        this.mjpegStream = new mjpeg.MJpegStream(this.opts.mjpegScreenshotUrl);\n        await this.mjpegStream.start();\n      }\n      return [sessionId, caps];\n    } catch (e) {\n      this.log.error(JSON.stringify(e));\n      await this.deleteSession();\n      throw e;\n    }\n  }\n\n  /**\n   * Returns the default URL for Safari browser\n   * @returns {string} The default URL\n   */\n  getDefaultUrl () {\n    // Setting this to some external URL slows down Appium startup\n    return this.isRealDevice()\n      ? `http://127.0.0.1:${this.opts.wdaLocalPort || 8100}/health`\n      : `http://${\n        this.opts.address.includes(':') ? `[${this.opts.address}]` : this.opts.address\n      }:${this.opts.port}/welcome`;\n  }\n\n  async start () {\n    this.opts.noReset = !!this.opts.noReset;\n    this.opts.fullReset = !!this.opts.fullReset;\n\n    await printUser();\n\n    this.opts.iosSdkVersion = null; // For WDA and xcodebuild\n    const {device, udid, realDevice} = await this.determineDevice();\n    this.log.info(`Determining device to run tests on: udid: '${udid}', real device: ${realDevice}`);\n    this.opts.device = device;\n    this.opts.udid = udid;\n    this.opts.realDevice = realDevice;\n\n    if (this.opts.simulatorDevicesSetPath) {\n      if (realDevice) {\n        this.log.info(`The 'simulatorDevicesSetPath' capability is only supported for Simulator devices`);\n      } else {\n        this.log.info(`Setting simulator devices set path to '${this.opts.simulatorDevicesSetPath}'`);\n        this.opts.device.devicesSetPath = this.opts.simulatorDevicesSetPath;\n      }\n    }\n\n    // at this point if there is no platformVersion, get it from the device\n    if (!this.opts.platformVersion && this.opts.device) {\n      this.opts.platformVersion = await this.opts.device.getPlatformVersion();\n      this.log.info(`No platformVersion specified. Using device version: '${this.opts.platformVersion}'`);\n    }\n\n    const normalizedVersion = normalizePlatformVersion(this.opts.platformVersion);\n    if (this.opts.platformVersion !== normalizedVersion) {\n      this.log.info(`Normalized platformVersion capability value '${this.opts.platformVersion}' to '${normalizedVersion}'`);\n      this.opts.platformVersion = normalizedVersion;\n    }\n    if (util.compareVersions(this.opts.platformVersion, '<', '9.3')) {\n      throw new Error(`Platform version must be 9.3 or above. '${this.opts.platformVersion}' is not supported.`);\n    }\n\n    if (_.isEmpty(this.xcodeVersion) && (!this.opts.webDriverAgentUrl || !this.opts.realDevice)) {\n      // no `webDriverAgentUrl`, or on a simulator, so we need an Xcode version\n      this.xcodeVersion = await getAndCheckXcodeVersion();\n    }\n    this.logEvent('xcodeDetailsRetrieved');\n\n    if (_.toLower(this.opts.browserName) === 'safari') {\n      this.log.info('Safari test requested');\n      this.safari = true;\n      this.opts.app = undefined;\n      this.opts.processArguments = this.opts.processArguments || {};\n      this.opts.bundleId = SAFARI_BUNDLE_ID;\n      this._currentUrl = this.opts.safariInitialUrl || this.getDefaultUrl();\n    } else if (this.opts.app || this.opts.bundleId) {\n      await this.configureApp();\n    }\n    this.logEvent('appConfigured');\n\n    // fail very early if the app doesn't actually exist\n    // or if bundle id doesn't point to an installed app\n    if (this.opts.app) {\n      await checkAppPresent(this.opts.app);\n\n      if (!this.opts.bundleId) {\n        this.opts.bundleId = await extractBundleId.bind(this)(this.opts.app);\n      }\n    }\n\n    await this.runReset();\n\n    this.wda = new WebDriverAgent(this.xcodeVersion, this.opts, this.log);\n    // Derived data path retrieval is an expensive operation\n    // We could start that now in background and get the cached result\n    // whenever it is needed\n    // eslint-disable-next-line promise/prefer-await-to-then\n    this.wda.retrieveDerivedDataPath().catch((e) => this.log.debug(e));\n\n    const memoizedLogInfo = _.memoize(() => {\n      this.log.info(\"'skipLogCapture' is set. Skipping starting logs such as crash, system, safari console and safari network.\");\n    });\n    const startLogCapture = async () => {\n      if (this.opts.skipLogCapture) {\n        memoizedLogInfo();\n        return false;\n      }\n\n      const result = await this.startLogCapture();\n      if (result) {\n        this.logEvent('logCaptureStarted');\n      }\n      return result;\n    };\n    const isLogCaptureStarted = await startLogCapture();\n\n    this.log.info(`Setting up ${this.isRealDevice() ? 'real device' : 'simulator'}`);\n\n    if (this.isSimulator()) {\n      if (this.opts.shutdownOtherSimulators) {\n        this.ensureFeatureEnabled(SHUTDOWN_OTHER_FEAT_NAME);\n        await shutdownOtherSimulators(this.opts.device);\n      }\n\n      await this.startSim();\n\n      if (this.opts.customSSLCert) {\n        // Simulator must be booted in order to call this helper\n        await this.opts.device.addCertificate(this.opts.customSSLCert);\n        this.logEvent('customCertInstalled');\n      }\n\n      if (await setSafariPrefs(this.opts.device, this.opts)) {\n        this.log.debug('Safari preferences have been updated');\n      }\n\n      if (await setLocalizationPrefs(this.opts.device, this.opts)) {\n        this.log.debug('Localization preferences have been updated');\n      }\n\n      if (_.isBoolean(this.opts.reduceMotion)) {\n        this.log.info(`Setting reduceMotion to ${this.opts.reduceMotion}`);\n        await this.opts.device.setReduceMotion(this.opts.reduceMotion);\n      }\n\n      if (_.isBoolean(this.opts.reduceTransparency)) {\n        this.log.info(`Setting reduceTransparency to ${this.opts.reduceTransparency}`);\n        await this.opts.device.setReduceTransparency(this.opts.reduceTransparency);\n      }\n\n      if (this.opts.launchWithIDB) {\n        try {\n          const idb = new IDB({udid});\n          await idb.connect();\n          this.opts.device.idb = idb;\n        } catch (e) {\n          this.log.debug(e.stack);\n          this.log.warn(`idb will not be used for Simulator interaction. Original error: ${e.message}`);\n        }\n      }\n\n      this.logEvent('simStarted');\n      if (!isLogCaptureStarted) {\n        // Retry log capture if Simulator was not running before\n        await startLogCapture();\n      }\n    } else if (this.opts.customSSLCert) {\n      await new Pyidevice(udid).installProfile({payload: this.opts.customSSLCert});\n      this.logEvent('customCertInstalled');\n    }\n\n    if (this.opts.app) {\n      await this.installAUT();\n      this.logEvent('appInstalled');\n    }\n\n    // if we only have bundle identifier and no app, fail if it is not already installed\n    if (!this.opts.app && this.opts.bundleId && !this.isSafari()\n        && !await this.opts.device.isAppInstalled(this.opts.bundleId)) {\n      this.log.errorAndThrow(`App with bundle identifier '${this.opts.bundleId}' unknown`);\n    }\n\n    if (this.isSimulator()) {\n      if (this.opts.permissions) {\n        this.log.debug('Setting the requested permissions before WDA is started');\n        for (const [bundleId, permissionsMapping] of _.toPairs(JSON.parse(this.opts.permissions))) {\n          await this.opts.device.setPermissions(bundleId, permissionsMapping);\n        }\n      }\n\n      // TODO: Deprecate and remove this block together with calendarAccessAuthorized capability\n      if (_.isBoolean(this.opts.calendarAccessAuthorized)) {\n        this.log.warn(`The 'calendarAccessAuthorized' capability is deprecated and will be removed soon. ` +\n          `Consider using 'permissions' one instead with 'calendar' key`);\n        const methodName = `${this.opts.calendarAccessAuthorized ? 'enable' : 'disable' }CalendarAccess`;\n        await this.opts.device[methodName](this.opts.bundleId);\n      }\n    }\n\n    await this.startWda(this.opts.sessionId, realDevice);\n\n    if (this.opts.orientation) {\n      await this.setInitialOrientation(this.opts.orientation);\n      this.logEvent('orientationSet');\n    }\n\n    if (this.isSafari() || this.opts.autoWebview) {\n      await this.activateRecentWebview();\n    }\n    if (this.isSafari()) {\n      if (!(this.opts.safariInitialUrl === ''\n          || (this.opts.noReset && _.isNil(this.opts.safariInitialUrl)))) {\n        this.log.info(`About to set the initial Safari URL to '${this.getCurrentUrl()}'.` +\n          `Use 'safariInitialUrl' capability in order to customize it`);\n        await this.setUrl(this.getCurrentUrl());\n      } else {\n        this.setCurrentUrl(await this.getUrl());\n      }\n    }\n  }\n\n  /**\n   * Start WebDriverAgentRunner\n   * @param {string} sessionId - The id of the target session to launch WDA with.\n   * @param {boolean} realDevice - Equals to true if the test target device is a real device.\n   */\n  async startWda (sessionId, realDevice) {\n    // Don't cleanup the processes if webDriverAgentUrl is set\n    if (!util.hasValue(this.wda.webDriverAgentUrl)) {\n      await this.wda.cleanupObsoleteProcesses();\n    }\n\n    const usePortForwarding = this.isRealDevice()\n      && !this.wda.webDriverAgentUrl\n      && isLocalHost(this.wda.wdaBaseUrl);\n    await DEVICE_CONNECTIONS_FACTORY.requestConnection(this.opts.udid, this.wda.url.port, {\n      devicePort: usePortForwarding ? this.wda.wdaRemotePort : null,\n      usePortForwarding,\n    });\n\n    // Let multiple WDA binaries with different derived data folders be built in parallel\n    // Concurrent WDA builds from the same source will cause xcodebuild synchronization errors\n    let synchronizationKey = XCUITestDriver.name;\n    if (this.opts.useXctestrunFile || !(await this.wda.isSourceFresh())) {\n      // First-time compilation is an expensive operation, which is done faster if executed\n      // sequentially. Xcodebuild spreads the load caused by the clang compiler to all available CPU cores\n      const derivedDataPath = await this.wda.retrieveDerivedDataPath();\n      if (derivedDataPath) {\n        synchronizationKey = path.normalize(derivedDataPath);\n      }\n    }\n    this.log.debug(`Starting WebDriverAgent initialization with the synchronization key '${synchronizationKey}'`);\n    if (SHARED_RESOURCES_GUARD.isBusy() && !this.opts.derivedDataPath && !this.opts.bootstrapPath) {\n      this.log.debug(`Consider setting a unique 'derivedDataPath' capability value for each parallel driver instance ` +\n        `to avoid conflicts and speed up the building process`);\n    }\n    return await SHARED_RESOURCES_GUARD.acquire(synchronizationKey, async () => {\n      if (this.opts.useNewWDA) {\n        this.log.debug(`Capability 'useNewWDA' set to true, so uninstalling WDA before proceeding`);\n        await this.wda.quitAndUninstall();\n        this.logEvent('wdaUninstalled');\n      } else if (!util.hasValue(this.wda.webDriverAgentUrl)) {\n        await this.wda.setupCaching();\n      }\n\n      // local helper for the two places we need to uninstall wda and re-start it\n      const quitAndUninstall = async (msg) => {\n        this.log.debug(msg);\n        if (this.opts.webDriverAgentUrl) {\n          this.log.debug('Not quitting/uninstalling WebDriverAgent since webDriverAgentUrl capability is provided');\n          throw new Error(msg);\n        }\n        this.log.warn('Quitting and uninstalling WebDriverAgent');\n        await this.wda.quitAndUninstall();\n\n        throw new Error(msg);\n      };\n\n      // Used in the following WDA build\n      if (this.opts.resultBundlePath) {\n        this.ensureFeatureEnabled(CUSTOMIZE_RESULT_BUNDPE_PATH);\n      }\n\n      const startupRetries = this.opts.wdaStartupRetries || (this.isRealDevice() ? WDA_REAL_DEV_STARTUP_RETRIES : WDA_SIM_STARTUP_RETRIES);\n      const startupRetryInterval = this.opts.wdaStartupRetryInterval || WDA_STARTUP_RETRY_INTERVAL;\n      this.log.debug(`Trying to start WebDriverAgent ${startupRetries} times with ${startupRetryInterval}ms interval`);\n      if (!util.hasValue(this.opts.wdaStartupRetries) && !util.hasValue(this.opts.wdaStartupRetryInterval)) {\n        this.log.debug(`These values can be customized by changing wdaStartupRetries/wdaStartupRetryInterval capabilities`);\n      }\n      let retryCount = 0;\n      await retryInterval(startupRetries, startupRetryInterval, async () => {\n        this.logEvent('wdaStartAttempted');\n        if (retryCount > 0) {\n          this.log.info(`Retrying WDA startup (${retryCount + 1} of ${startupRetries})`);\n        }\n        try {\n          // on xcode 10 installd will often try to access the app from its staging\n          // directory before fully moving it there, and fail. Retrying once\n          // immediately helps\n          const retries = this.xcodeVersion.major >= 10 ? 2 : 1;\n          this.cachedWdaStatus = await retry(retries, this.wda.launch.bind(this.wda), sessionId, realDevice);\n        } catch (err) {\n          this.logEvent('wdaStartFailed');\n          retryCount++;\n          let errorMsg = `Unable to launch WebDriverAgent because of xcodebuild failure: ${err.message}`;\n          if (this.isRealDevice()) {\n            errorMsg += `. Make sure you follow the tutorial at ${WDA_REAL_DEV_TUTORIAL_URL}. ` +\n                        `Try to remove the WebDriverAgentRunner application from the device if it is installed ` +\n                        `and reboot the device.`;\n          }\n          await quitAndUninstall(errorMsg);\n        }\n\n        this.proxyReqRes = this.wda.proxyReqRes.bind(this.wda);\n        this.jwpProxyActive = true;\n\n        let originalStacktrace = null;\n        try {\n          await retryInterval(15, 1000, async () => {\n            this.logEvent('wdaSessionAttempted');\n            this.log.debug('Sending createSession command to WDA');\n            try {\n              this.cachedWdaStatus = this.cachedWdaStatus || await this.proxyCommand('/status', 'GET');\n              await this.startWdaSession(this.opts.bundleId, this.opts.processArguments);\n            } catch (err) {\n              originalStacktrace = err.stack;\n              this.log.debug(`Failed to create WDA session (${err.message}). Retrying...`);\n              throw err;\n            }\n          });\n          this.logEvent('wdaSessionStarted');\n        } catch (err) {\n          if (originalStacktrace) {\n            this.log.debug(originalStacktrace);\n          }\n          let errorMsg = `Unable to start WebDriverAgent session because of xcodebuild failure: ${err.message}`;\n          if (this.isRealDevice()) {\n            errorMsg += ` Make sure you follow the tutorial at ${WDA_REAL_DEV_TUTORIAL_URL}. ` +\n                        `Try to remove the WebDriverAgentRunner application from the device if it is installed ` +\n                        `and reboot the device.`;\n          }\n          await quitAndUninstall(errorMsg);\n        }\n\n        if (this.opts.clearSystemFiles && !this.opts.webDriverAgentUrl) {\n          await markSystemFilesForCleanup(this.wda);\n        }\n\n        // we expect certain socket errors until this point, but now\n        // mark things as fully working\n        this.wda.fullyStarted = true;\n        this.logEvent('wdaStarted');\n      });\n    });\n  }\n\n  async runReset (opts = null) {\n    this.logEvent('resetStarted');\n    if (this.isRealDevice()) {\n      await runRealDeviceReset(this.opts.device, opts || this.opts);\n    } else {\n      await runSimulatorReset(this.opts.device, opts || this.opts);\n    }\n    this.logEvent('resetComplete');\n  }\n\n  async deleteSession () {\n    await removeAllSessionWebSocketHandlers(this.server, this.sessionId);\n\n    for (const recorder of _.compact([\n      this._recentScreenRecorder, this._audioRecorder, this._trafficCapture\n    ])) {\n      await recorder.interrupt(true);\n      await recorder.cleanup();\n    }\n\n    if (!_.isEmpty(this._perfRecorders)) {\n      await B.all(this._perfRecorders.map((x) => x.stop(true)));\n      this._perfRecorders = [];\n    }\n\n    if (this._conditionInducerService) {\n      this.mobileDisableConditionInducer();\n    }\n\n    await this.stop();\n\n    if (this.wda && !this.opts.webDriverAgentUrl) {\n      if (this.opts.clearSystemFiles) {\n        let synchronizationKey = XCUITestDriver.name;\n        const derivedDataPath = await this.wda.retrieveDerivedDataPath();\n        if (derivedDataPath) {\n          synchronizationKey = path.normalize(derivedDataPath);\n        }\n        await SHARED_RESOURCES_GUARD.acquire(synchronizationKey, async () => {\n          await clearSystemFiles(this.wda);\n        });\n      } else {\n        this.log.debug('Not clearing log files. Use `clearSystemFiles` capability to turn on.');\n      }\n    }\n\n    if (this.remote) {\n      this.log.debug('Found a remote debugger session. Removing...');\n      await this.stopRemote();\n    }\n\n    if (this.opts.resetOnSessionStartOnly === false) {\n      await this.runReset(Object.assign({}, this.opts, {\n        enforceSimulatorShutdown: true,\n      }));\n    }\n\n    if (this.isSimulator() && !this.opts.noReset && !!this.opts.device) {\n      if (this.lifecycleData.createSim) {\n        this.log.debug(`Deleting simulator created for this run (udid: '${this.opts.udid}')`);\n        await shutdownSimulator(this.opts.device);\n        await this.opts.device.delete();\n      }\n    }\n\n    const shouldResetLocationServivce = this.isRealDevice() && !!this.opts.resetLocationService;\n    if (shouldResetLocationServivce) {\n      try {\n        await this.mobileResetLocationService();\n      } catch (ignore) { /* Ignore this error since mobileResetLocationService already logged the error */ }\n    }\n\n    if (!_.isEmpty(this.logs)) {\n      await this.logs.syslog.stopCapture();\n      this.logs = {};\n    }\n\n    if (this.mjpegStream) {\n      this.log.info('Closing MJPEG stream');\n      this.mjpegStream.stop();\n    }\n\n    this.resetIos();\n\n    await super.deleteSession();\n  }\n\n  async stop () {\n    this.jwpProxyActive = false;\n    this.proxyReqRes = null;\n\n\n    if (this.wda && this.wda.fullyStarted) {\n      if (this.wda.jwproxy) {\n        try {\n          await this.proxyCommand(`/session/${this.sessionId}`, 'DELETE');\n        } catch (err) {\n          // an error here should not short-circuit the rest of clean up\n          this.log.debug(`Unable to DELETE session on WDA: '${err.message}'. Continuing shutdown.`);\n        }\n      }\n      if (!this.wda.webDriverAgentUrl && this.opts.useNewWDA) {\n        await this.wda.quit();\n      }\n    }\n\n    DEVICE_CONNECTIONS_FACTORY.releaseConnection(this.opts.udid);\n  }\n\n  async executeCommand (cmd, ...args) {\n    this.log.debug(`Executing command '${cmd}'`);\n\n    if (cmd === 'receiveAsyncResponse') {\n      return await this.receiveAsyncResponse(...args);\n    }\n    // TODO: once this fix gets into base driver remove from here\n    if (cmd === 'getStatus') {\n      return await this.getStatus();\n    }\n    return await super.executeCommand(cmd, ...args);\n  }\n\n  async configureApp () {\n    function appIsPackageOrBundle (app) {\n      return (/^([a-zA-Z0-9\\-_]+\\.[a-zA-Z0-9\\-_]+)+$/).test(app);\n    }\n\n    // the app name is a bundleId assign it to the bundleId property\n    if (!this.opts.bundleId && appIsPackageOrBundle(this.opts.app)) {\n      this.opts.bundleId = this.opts.app;\n      this.opts.app = '';\n    }\n    // we have a bundle ID, but no app, or app is also a bundle\n    if ((this.opts.bundleId && appIsPackageOrBundle(this.opts.bundleId)) &&\n        (this.opts.app === '' || appIsPackageOrBundle(this.opts.app))) {\n      this.log.debug('App is an iOS bundle, will attempt to run as pre-existing');\n      return;\n    }\n\n    // check for supported build-in apps\n    switch (_.toLower(this.opts.app)) {\n      case 'settings':\n        this.opts.bundleId = 'com.apple.Preferences';\n        this.opts.app = null;\n        return;\n      case 'calendar':\n        this.opts.bundleId = 'com.apple.mobilecal';\n        this.opts.app = null;\n        return;\n    }\n\n    this.opts.app = await this.helpers.configureApp(this.opts.app, {\n      onPostProcess: this.onPostConfigureApp.bind(this),\n      supportedExtensions: SUPPORTED_EXTENSIONS\n    });\n  }\n\n  /**\n   * Unzip the given archive and find a matching .app bundle in it\n   *\n   * @param {string} appPath The path to the archive.\n   * @param {number} depth [0] the current nesting depth. App bundles whose nesting level\n   * is greater than 1 are not supported.\n   * @returns {string} Full path to the first matching .app bundle..\n   * @throws If no matching .app bundles were found in the provided archive.\n   */\n  async unzipApp (appPath, depth = 0) {\n    if (depth > MAX_ARCHIVE_SCAN_DEPTH) {\n      throw new Error('Nesting of package bundles is not supported');\n    }\n    const [rootDir, matchedPaths] = await findApps(appPath, SUPPORTED_EXTENSIONS);\n    if (_.isEmpty(matchedPaths)) {\n      this.log.debug(`'${path.basename(appPath)}' has no bundles`);\n    } else {\n      this.log.debug(\n        `Found ${util.pluralize('bundle', matchedPaths.length, true)} in ` +\n        `'${path.basename(appPath)}': ${matchedPaths}`\n      );\n    }\n    try {\n      for (const matchedPath of matchedPaths) {\n        const fullPath = path.join(rootDir, matchedPath);\n        if (await isAppBundle(fullPath)) {\n          const supportedPlatforms = await fetchSupportedAppPlatforms(fullPath);\n          if (this.isSimulator() && !supportedPlatforms.some((p) => _.includes(p, 'Simulator'))) {\n            this.log.info(`'${matchedPath}' does not have Simulator devices in the list of supported platforms ` +\n              `(${supportedPlatforms.join(',')}). Skipping it`);;\n            continue;\n          }\n          if (this.isRealDevice() && !supportedPlatforms.some((p) => _.includes(p, 'OS'))) {\n            this.log.info(`'${matchedPath}' does not have real devices in the list of supported platforms ` +\n              `(${supportedPlatforms.join(',')}). Skipping it`);;\n            continue;\n          }\n          this.log.info(`'${matchedPath}' is the resulting application bundle selected from '${appPath}'`);\n          return await isolateAppBundle(fullPath);\n        } else if (_.endsWith(_.toLower(fullPath), IPA_EXT) && (await fs.stat(fullPath)).isFile()) {\n          try {\n            return await this.unzipApp(fullPath, depth + 1);\n          } catch (e) {\n            this.log.warn(`Skipping processing of '${matchedPath}': ${e.message}`);\n          }\n        }\n      }\n    } finally {\n      await fs.rimraf(rootDir);\n    }\n    throw new Error(`${this.opts.app} did not have any matching ${APP_EXT} or ${IPA_EXT} ` +\n      `bundles. Please make sure the provided package is valid and contains at least one matching ` +\n      `application bundle which is not nested.`\n    );\n  }\n\n  async onPostConfigureApp ({cachedAppInfo, isUrl, appPath}) {\n    // Pick the previously cached entry if its integrity has been preserved\n    if (_.isPlainObject(cachedAppInfo)\n        && (await fs.stat(appPath)).isFile()\n        && await fs.hash(appPath) === cachedAppInfo.packageHash\n        && await fs.exists(cachedAppInfo.fullPath)\n        && (await fs.glob('**/*', {\n          cwd: cachedAppInfo.fullPath, strict: false, nosort: true\n        })).length === cachedAppInfo.integrity.folder) {\n      this.log.info(`Using '${cachedAppInfo.fullPath}' which was cached from '${appPath}'`);\n      return {appPath: cachedAppInfo.fullPath};\n    }\n\n    // Only local .app bundles that are available in-place should not be cached\n    if (await isAppBundle(appPath)) {\n      return false;\n    }\n\n    // Extract the app bundle and cache it\n    try {\n      return {appPath: await this.unzipApp(appPath)};\n    } finally {\n      // Cleanup previously downloaded archive\n      if (isUrl) {\n        await fs.rimraf(appPath);\n      }\n    }\n  }\n\n  async determineDevice () {\n    // in the one case where we create a sim, we will set this state\n    this.lifecycleData.createSim = false;\n\n    // if we get generic names, translate them\n    this.opts.deviceName = translateDeviceName(this.opts.platformVersion, this.opts.deviceName);\n\n    const setupVersionCaps = async () => {\n      this.opts.iosSdkVersion = await getAndCheckIosSdkVersion();\n      this.log.info(`iOS SDK Version set to '${this.opts.iosSdkVersion}'`);\n      if (!this.opts.platformVersion && this.opts.iosSdkVersion) {\n        this.log.info(`No platformVersion specified. Using the latest version Xcode supports: '${this.opts.iosSdkVersion}'. ` +\n          `This may cause problems if a simulator does not exist for this platform version.`);\n        this.opts.platformVersion = normalizePlatformVersion(this.opts.iosSdkVersion);\n      }\n    };\n\n    if (this.opts.udid) {\n      if (this.opts.udid.toLowerCase() === 'auto') {\n        try {\n          this.opts.udid = await detectUdid();\n        } catch (err) {\n          // Trying to find matching UDID for Simulator\n          this.log.warn(`Cannot detect any connected real devices. Falling back to Simulator. Original error: ${err.message}`);\n          const device = await getExistingSim(this.opts);\n          if (!device) {\n            // No matching Simulator is found. Throw an error\n            this.log.errorAndThrow(`Cannot detect udid for ${this.opts.deviceName} Simulator running iOS ${this.opts.platformVersion}`);\n          }\n\n          // Matching Simulator exists and is found. Use it\n          this.opts.udid = device.udid;\n          const devicePlatform = normalizePlatformVersion(await device.getPlatformVersion());\n          if (this.opts.platformVersion !== devicePlatform) {\n            this.opts.platformVersion = devicePlatform;\n            this.log.info(`Set platformVersion to '${devicePlatform}' to match the device with given UDID`);\n          }\n          await setupVersionCaps();\n          return {device, realDevice: false, udid: device.udid};\n        }\n      } else {\n        // make sure it is a connected device. If not, the udid passed in is invalid\n        const devices = await getConnectedDevices();\n        this.log.debug(`Available devices: ${devices.join(', ')}`);\n        if (!devices.includes(this.opts.udid)) {\n          // check for a particular simulator\n          this.log.debug(`No real device with udid '${this.opts.udid}'. Looking for simulator`);\n          try {\n            const device = await getSimulator(this.opts.udid, {\n              devicesSetPath: this.opts.simulatorDevicesSetPath,\n            });\n            return {device, realDevice: false, udid: this.opts.udid};\n          } catch (ign) {\n            throw new Error(`Unknown device or simulator UDID: '${this.opts.udid}'`);\n          }\n        }\n      }\n\n      const device = await getRealDeviceObj(this.opts.udid);\n      return {device, realDevice: true, udid: this.opts.udid};\n    }\n\n    // Now we know for sure the device will be a Simulator\n    await setupVersionCaps();\n    if (this.opts.enforceFreshSimulatorCreation) {\n      this.log.debug(`New simulator is requested. If this is not wanted, set 'enforceFreshSimulatorCreation' capability to false`);\n    } else {\n      // figure out the correct simulator to use, given the desired capabilities\n      const device = await getExistingSim(this.opts);\n\n      // check for an existing simulator\n      if (device) {\n        return {device, realDevice: false, udid: device.udid};\n      }\n\n      this.log.info('Simulator udid not provided');\n    }\n\n    // no device of this type exists, or they request new sim, so create one\n    this.log.info('Using desired caps to create a new simulator');\n    const device = await this.createSim();\n    return {device, realDevice: false, udid: device.udid};\n  }\n\n  async startSim () {\n    const runOpts = {\n      scaleFactor: this.opts.scaleFactor,\n      connectHardwareKeyboard: !!this.opts.connectHardwareKeyboard,\n      pasteboardAutomaticSync: this.opts.simulatorPasteboardAutomaticSync ?? 'off',\n      isHeadless: !!this.opts.isHeadless,\n      tracePointer: this.opts.simulatorTracePointer,\n      devicePreferences: {},\n    };\n\n    // add the window center, if it is specified\n    if (this.opts.SimulatorWindowCenter) {\n      runOpts.devicePreferences.SimulatorWindowCenter = this.opts.SimulatorWindowCenter;\n    }\n\n    if (_.isInteger(this.opts.simulatorStartupTimeout)) {\n      runOpts.startupTimeout = this.opts.simulatorStartupTimeout;\n    }\n\n    // This is to workaround XCTest bug about changing Simulator\n    // orientation is not synchronized to the actual window orientation\n    const orientation = _.isString(this.opts.orientation) && this.opts.orientation.toUpperCase();\n    switch (orientation) {\n      case 'LANDSCAPE':\n        runOpts.devicePreferences.SimulatorWindowOrientation = 'LandscapeLeft';\n        runOpts.devicePreferences.SimulatorWindowRotationAngle = 90;\n        break;\n      case 'PORTRAIT':\n        runOpts.devicePreferences.SimulatorWindowOrientation = 'Portrait';\n        runOpts.devicePreferences.SimulatorWindowRotationAngle = 0;\n        break;\n    }\n\n    await this.opts.device.run(runOpts);\n  }\n\n  async createSim () {\n    this.lifecycleData.createSim = true;\n\n    // Get platform name from const since it must be case sensitive to create a new simulator\n    const platformName = this.isTvOS() ? PLATFORM_NAME_TVOS : PLATFORM_NAME_IOS;\n\n    // create sim for caps\n    const sim = await createSim(this.opts, platformName);\n    this.log.info(`Created simulator with udid '${sim.udid}'.`);\n\n    return sim;\n  }\n\n  async launchApp () {\n    const APP_LAUNCH_TIMEOUT = 20 * 1000;\n\n    this.logEvent('appLaunchAttempted');\n    await this.opts.device.launchApp(this.opts.bundleId);\n\n    let checkStatus = async () => {\n      let response = await this.proxyCommand('/status', 'GET');\n      let currentApp = response.currentApp.bundleID;\n      if (currentApp !== this.opts.bundleId) {\n        throw new Error(`${this.opts.bundleId} not in foreground. ${currentApp} is in foreground`);\n      }\n    };\n\n    this.log.info(`Waiting for '${this.opts.bundleId}' to be in foreground`);\n    let retries = parseInt(APP_LAUNCH_TIMEOUT / 200, 10);\n    await retryInterval(retries, 200, checkStatus);\n    this.log.info(`${this.opts.bundleId} is in foreground`);\n    this.logEvent('appLaunched');\n  }\n\n  async startWdaSession (bundleId, processArguments) {\n    const args = processArguments ? (processArguments.args || []) : [];\n    if (!_.isArray(args)) {\n      throw new Error(`processArguments.args capability is expected to be an array. ` +\n        `${JSON.stringify(args)} is given instead`);\n    }\n    const env = processArguments ? (processArguments.env || {}) : {};\n    if (!_.isPlainObject(env)) {\n      throw new Error(`processArguments.env capability is expected to be a dictionary. ` +\n        `${JSON.stringify(env)} is given instead`);\n    }\n\n    if (util.hasValue(this.opts.language)) {\n      args.push('-AppleLanguages', `(${this.opts.language})`);\n      args.push('-NSLanguages', `(${this.opts.language})`);\n    }\n    if (util.hasValue(this.opts.locale)) {\n      args.push('-AppleLocale', this.opts.locale);\n    }\n\n    if (this.opts.noReset) {\n      if (_.isNil(this.opts.shouldTerminateApp)) {\n        this.opts.shouldTerminateApp = false;\n      }\n      if (_.isNil(this.opts.forceAppLaunch)) {\n        this.opts.forceAppLaunch = false;\n      }\n    }\n\n    const wdaCaps = {\n      bundleId: this.opts.autoLaunch === false ? undefined : bundleId,\n      arguments: args,\n      environment: env,\n      eventloopIdleDelaySec: this.opts.wdaEventloopIdleDelay ?? 0,\n      shouldWaitForQuiescence: this.opts.waitForQuiescence ?? true,\n      shouldUseTestManagerForVisibilityDetection: this.opts.simpleIsVisibleCheck ?? false,\n      maxTypingFrequency: this.opts.maxTypingFrequency ?? 60,\n      shouldUseSingletonTestManager: this.opts.shouldUseSingletonTestManager ?? true,\n      waitForIdleTimeout: this.opts.waitForIdleTimeout,\n      shouldUseCompactResponses: this.opts.shouldUseCompactResponses,\n      elementResponseFields: this.opts.elementResponseFields,\n      disableAutomaticScreenshots: this.opts.disableAutomaticScreenshots,\n      shouldTerminateApp: this.opts.shouldTerminateApp ?? true,\n      forceAppLaunch: this.opts.forceAppLaunch ?? true,\n      useNativeCachingStrategy: this.opts.useNativeCachingStrategy ?? true,\n      forceSimulatorSoftwareKeyboardPresence: this.opts.forceSimulatorSoftwareKeyboardPresence\n        ?? (this.opts.connectHardwareKeyboard === true ? false : true),\n    };\n    if (this.opts.autoAcceptAlerts) {\n      wdaCaps.defaultAlertAction = 'accept';\n    } else if (this.opts.autoDismissAlerts) {\n      wdaCaps.defaultAlertAction = 'dismiss';\n    }\n\n    await this.proxyCommand('/session', 'POST', {\n      capabilities: {\n        firstMatch: [wdaCaps],\n        alwaysMatch: {},\n      }\n    });\n  }\n\n  // Override Proxy methods from BaseDriver\n  proxyActive () {\n    return this.jwpProxyActive;\n  }\n\n  getProxyAvoidList () {\n    if (this.isWebview()) {\n      return NO_PROXY_WEB_LIST;\n    }\n    return NO_PROXY_NATIVE_LIST;\n  }\n\n  canProxy () {\n    return true;\n  }\n\n  isSafari () {\n    return !!this.safari;\n  }\n\n  isRealDevice () {\n    return this.opts.realDevice;\n  }\n\n  isSimulator () {\n    return !this.opts.realDevice;\n  }\n\n  isTvOS () {\n    return _.toLower(this.opts.platformName) === _.toLower(PLATFORM_NAME_TVOS);\n  }\n\n  isWebview () {\n    return this.isSafari() || this.isWebContext();\n  }\n\n  validateLocatorStrategy (strategy) {\n    super.validateLocatorStrategy(strategy, this.isWebContext());\n  }\n\n  validateDesiredCaps (caps) {\n    if (!super.validateDesiredCaps(caps)) {\n      return false;\n    }\n\n    // make sure that the capabilities have one of `app` or `bundleId`\n    if (_.toLower(caps.browserName) !== 'safari' && !caps.app && !caps.bundleId) {\n      this.log.info('The desired capabilities include neither an app nor a bundleId. ' +\n        'WebDriverAgent will be started without the default app');\n    }\n\n    if (!util.coerceVersion(caps.platformVersion, false)) {\n      this.log.warn(`'platformVersion' capability ('${caps.platformVersion}') is not a valid version number. ` +\n        `Consider fixing it or be ready to experience an inconsistent driver behavior.`);\n    }\n\n    let verifyProcessArgument = (processArguments) => {\n      const {args, env} = processArguments;\n      if (!_.isNil(args) && !_.isArray(args)) {\n        this.log.errorAndThrow('processArguments.args must be an array of strings');\n      }\n      if (!_.isNil(env) && !_.isPlainObject(env)) {\n        this.log.errorAndThrow('processArguments.env must be an object <key,value> pair {a:b, c:d}');\n      }\n    };\n\n    // `processArguments` should be JSON string or an object with arguments and/ environment details\n    if (caps.processArguments) {\n      if (_.isString(caps.processArguments)) {\n        try {\n          // try to parse the string as JSON\n          caps.processArguments = JSON.parse(caps.processArguments);\n          verifyProcessArgument(caps.processArguments);\n        } catch (err) {\n          this.log.errorAndThrow(`processArguments must be a JSON format or an object with format {args : [], env : {a:b, c:d}}. ` +\n            `Both environment and argument can be null. Error: ${err}`);\n        }\n      } else if (_.isPlainObject(caps.processArguments)) {\n        verifyProcessArgument(caps.processArguments);\n      } else {\n        this.log.errorAndThrow(`'processArguments must be an object, or a string JSON object with format {args : [], env : {a:b, c:d}}. ` +\n          `Both environment and argument can be null.`);\n      }\n    }\n\n    // there is no point in having `keychainPath` without `keychainPassword`\n    if ((caps.keychainPath && !caps.keychainPassword) || (!caps.keychainPath && caps.keychainPassword)) {\n      this.log.errorAndThrow(`If 'keychainPath' is set, 'keychainPassword' must also be set (and vice versa).`);\n    }\n\n    // `resetOnSessionStartOnly` should be set to true by default\n    this.opts.resetOnSessionStartOnly = !util.hasValue(this.opts.resetOnSessionStartOnly) || this.opts.resetOnSessionStartOnly;\n    this.opts.useNewWDA = util.hasValue(this.opts.useNewWDA) ? this.opts.useNewWDA : false;\n\n    if (caps.commandTimeouts) {\n      caps.commandTimeouts = normalizeCommandTimeouts(caps.commandTimeouts);\n    }\n\n    if (_.isString(caps.webDriverAgentUrl)) {\n      const {protocol, host} = url.parse(caps.webDriverAgentUrl);\n      if (_.isEmpty(protocol) || _.isEmpty(host)) {\n        this.log.errorAndThrow(`'webDriverAgentUrl' capability is expected to contain a valid WebDriverAgent server URL. ` +\n                          `'${caps.webDriverAgentUrl}' is given instead`);\n      }\n    }\n\n    if (caps.browserName) {\n      if (caps.bundleId) {\n        this.log.errorAndThrow(`'browserName' cannot be set together with 'bundleId' capability`);\n      }\n      // warn if the capabilities have both `app` and `browser, although this\n      // is common with selenium grid\n      if (caps.app) {\n        this.log.warn(`The capabilities should generally not include both an 'app' and a 'browserName'`);\n      }\n    }\n\n    if (caps.permissions) {\n      try {\n        for (const [bundleId, perms] of _.toPairs(JSON.parse(caps.permissions))) {\n          if (!_.isString(bundleId)) {\n            throw new Error(`'${JSON.stringify(bundleId)}' must be a string`);\n          }\n          if (!_.isPlainObject(perms)) {\n            throw new Error(`'${JSON.stringify(perms)}' must be a JSON object`);\n          }\n        }\n      } catch (e) {\n        this.log.errorAndThrow(`'${caps.permissions}' is expected to be a valid object with format ` +\n          `{\"<bundleId1>\": {\"<serviceName1>\": \"<serviceStatus1>\", ...}, ...}. Original error: ${e.message}`);\n      }\n    }\n\n    if (caps.platformVersion && !util.coerceVersion(caps.platformVersion, false)) {\n      this.log.errorAndThrow(`'platformVersion' must be a valid version number. ` +\n        `'${caps.platformVersion}' is given instead.`);\n    }\n\n    // additionalWebviewBundleIds is an array, JSON array, or string\n    if (caps.additionalWebviewBundleIds) {\n      caps.additionalWebviewBundleIds = this.helpers.parseCapsArray(caps.additionalWebviewBundleIds);\n    }\n\n    // finally, return true since the superclass check passed, as did this\n    return true;\n  }\n\n  async checkAutInstallationState () {\n    const {\n      enforceAppInstall,\n      fullReset,\n      noReset,\n      bundleId,\n      device,\n      app,\n    } = this.opts;\n\n    const wasAppInstalled = await device.isAppInstalled(bundleId);\n    if (wasAppInstalled) {\n      this.log.info(`App '${bundleId}' is already installed`);\n      if (noReset) {\n        this.log.info('noReset is requested. The app will not be be (re)installed');\n        return {\n          install: false,\n          skipUninstall: true,\n        };\n      }\n    } else {\n      this.log.info(`App '${bundleId}' is not installed on the device yet`);\n    }\n    if (enforceAppInstall !== false || fullReset || !wasAppInstalled) {\n      return {\n        install: true,\n        skipUninstall: !wasAppInstalled,\n      };\n    }\n\n    const candidateBundleVersion = await extractBundleVersion.bind(this)(app);\n    this.log.debug(`CFBundleVersion from Info.plist: ${candidateBundleVersion}`);\n    if (!candidateBundleVersion) {\n      return {\n        install: true,\n        skipUninstall: false,\n      };\n    }\n\n    const appBundleVersion = this.isRealDevice()\n      ? (await device.fetchAppInfo(bundleId))?.CFBundleVersion\n      : BUNDLE_VERSION_PATTERN.exec(await device.simctl.appInfo(bundleId))?.[1];\n    this.log.debug(`CFBundleVersion from installed app info: ${appBundleVersion}`);\n    if (!appBundleVersion) {\n      return {\n        install: true,\n        skipUninstall: false,\n      };\n    }\n\n    let shouldUpgrade;\n    try {\n      shouldUpgrade = util.compareVersions(candidateBundleVersion, '>', appBundleVersion);\n    } catch (err) {\n      this.log.warn(`App versions comparison is not possible: ${err.message}`);\n      return {\n        install: true,\n        skipUninstall: false,\n      };\n    }\n    if (shouldUpgrade) {\n      this.log.info(\n        `The installed version of ${bundleId} is lower than the candidate one ` +\n        `(${candidateBundleVersion} > ${appBundleVersion}). The app will be upgraded.`\n      );\n    } else {\n      this.log.info(\n        `The candidate version of ${bundleId} is lower than the installed one ` +\n        `(${candidateBundleVersion} <= ${appBundleVersion}). The app won't be reinstalled.`\n      );\n    }\n    return {\n      install: shouldUpgrade,\n      skipUninstall: true,\n    };\n  }\n\n  async installAUT () {\n    if (this.isSafari()) {\n      return;\n    }\n\n    await verifyApplicationPlatform.bind(this)(this.opts.app, {\n      isSimulator: this.isSimulator(),\n      isTvOS: this.isTvOS(),\n    });\n\n    const {install, skipUninstall} = await this.checkAutInstallationState();\n    if (install) {\n      if (this.isRealDevice()) {\n        await installToRealDevice(this.opts.device, this.opts.app, this.opts.bundleId, {\n          skipUninstall,\n          timeout: this.opts.appPushTimeout,\n          strategy: this.opts.appInstallStrategy,\n        });\n      } else {\n        await installToSimulator(this.opts.device, this.opts.app, this.opts.bundleId, {\n          skipUninstall,\n          newSimulator: this.lifecycleData.createSim,\n        });\n      }\n      if (util.hasValue(this.opts.iosInstallPause)) {\n        // https://github.com/appium/appium/issues/6889\n        const pauseMs = parseInt(this.opts.iosInstallPause, 10);\n        this.log.debug(`iosInstallPause set. Pausing ${pauseMs} ms before continuing`);\n        await B.delay(pauseMs);\n      }\n    }\n\n    if (this.opts.otherApps) {\n      await this.installOtherApps(this.opts.otherApps);\n    }\n  }\n\n  async installOtherApps (otherApps) {\n    if (this.isRealDevice()) {\n      this.log.warn('Capability otherApps is only supported for Simulators');\n      return;\n    }\n    let appsList;\n    try {\n      appsList = this.helpers.parseCapsArray(otherApps);\n    } catch (e) {\n      this.log.errorAndThrow(`Could not parse \"otherApps\" capability: ${e.message}`);\n    }\n    if (_.isEmpty(appsList)) {\n      this.log.info(`Got zero apps from 'otherApps' capability value. Doing nothing`);\n      return;\n    }\n\n    const appPaths = await B.all(appsList.map(\n      (app) => this.helpers.configureApp(app, '.app')\n    ));\n    for (const otherApp of appPaths) {\n      await installToSimulator(this.opts.device, otherApp, undefined, {\n        newSimulator: this.lifecycleData.createSim,\n      });\n    }\n  }\n\n  async setInitialOrientation (orientation) {\n    const dstOrientation = _.toUpper(orientation);\n    if (!SUPPORTED_ORIENATIONS.includes(dstOrientation)) {\n      this.log.debug(\n        `The initial orientation value '${orientation}' is unknown. ` +\n        `Only ${JSON.stringify(SUPPORTED_ORIENATIONS)} are supported.`\n      );\n      return;\n    }\n\n    this.log.debug(`Setting initial orientation to '${dstOrientation}'`);\n    try {\n      await this.proxyCommand('/orientation', 'POST', {orientation: dstOrientation});\n    } catch (err) {\n      this.log.warn(`Setting initial orientation failed with: ${err.message}`);\n    }\n  }\n\n  _getCommandTimeout (cmdName) {\n    if (this.opts.commandTimeouts) {\n      if (cmdName && _.has(this.opts.commandTimeouts, cmdName)) {\n        return this.opts.commandTimeouts[cmdName];\n      }\n      return this.opts.commandTimeouts[DEFAULT_TIMEOUT_KEY];\n    }\n  }\n\n  /**\n   * Get session capabilities merged with what WDA reports\n   * This is a library command but needs to call 'super' so can't be on\n   * a helper object\n   */\n  async getSession () {\n    // call super to get event timings, etc...\n    const driverSession = await super.getSession();\n    if (!this.wdaCaps) {\n      this.wdaCaps = await this.proxyCommand('/', 'GET');\n    }\n\n    const shouldGetDeviceCaps = _.isBoolean(this.opts.includeDeviceCapsToSessionInfo)\n      ? this.opts.includeDeviceCapsToSessionInfo\n      : true; // Backward compatibility\n    if (shouldGetDeviceCaps && !this.deviceCaps) {\n      const {statusBarSize, scale} = await this.getScreenInfo();\n      this.deviceCaps = {\n        pixelRatio: scale,\n        statBarHeight: statusBarSize.height,\n        viewportRect: await this.getViewportRect(),\n      };\n    }\n    this.log.info('Merging WDA caps over Appium caps for session detail response');\n    return Object.assign({udid: this.opts.udid}, driverSession,\n      this.wdaCaps.capabilities, this.deviceCaps || {});\n  }\n\n  async reset () {\n    if (this.opts.noReset) {\n      // This is to make sure reset happens even if noReset is set to true\n      let opts = _.cloneDeep(this.opts);\n      opts.noReset = false;\n      opts.fullReset = false;\n      const shutdownHandler = this.resetOnUnexpectedShutdown;\n      this.resetOnUnexpectedShutdown = () => {};\n      try {\n        await this.runReset(opts);\n      } finally {\n        this.resetOnUnexpectedShutdown = shutdownHandler;\n      }\n    }\n    await super.reset();\n  }\n}\n\nObject.assign(XCUITestDriver.prototype, commands);\n\nexport default XCUITestDriver;\nexport { XCUITestDriver };\n"],"mappings":"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"}