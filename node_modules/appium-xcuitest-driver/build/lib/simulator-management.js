"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createSim = createSim;
exports.getExistingSim = getExistingSim;
exports.installToSimulator = installToSimulator;
exports.runSimulatorReset = runSimulatorReset;
exports.setLocalizationPrefs = setLocalizationPrefs;
exports.setSafariPrefs = setSafariPrefs;
exports.shutdownOtherSimulators = shutdownOtherSimulators;
exports.shutdownSimulator = shutdownSimulator;
require("source-map-support/register");
var _appiumIosSimulator = require("appium-ios-simulator");
var _nodeSimctl = _interopRequireDefault(require("node-simctl"));
var _appiumWebdriveragent = require("appium-webdriveragent");
var _lodash = _interopRequireDefault(require("lodash"));
var _logger = _interopRequireDefault(require("./logger"));
var _support = require("appium/support");
var _desiredCaps = require("./desired-caps");
const APPIUM_SIM_PREFIX = 'appiumTest';
const SAFARI_OPTS_ALIASES_MAP = {
  safariAllowPopups: [['WebKitJavaScriptCanOpenWindowsAutomatically', 'JavaScriptCanOpenWindowsAutomatically'], x => Number(Boolean(x))],
  safariIgnoreFraudWarning: [['WarnAboutFraudulentWebsites'], x => Number(!x)],
  safariOpenLinksInBackground: [['OpenLinksInBackground'], x => Number(Boolean(x))]
};
async function createSim(caps, platform = _desiredCaps.PLATFORM_NAME_IOS) {
  const devicesSetPath = caps.simulatorDevicesSetPath;
  const udid = await new _nodeSimctl.default({
    devicesSetPath
  }).createDevice(`${APPIUM_SIM_PREFIX}-${_support.util.uuidV4().toUpperCase()}-${caps.deviceName}`, caps.deviceName, caps.platformVersion, {
    platform
  });
  return await (0, _appiumIosSimulator.getSimulator)(udid, {
    platform,
    checkExistence: false,
    devicesSetPath
  });
}
async function getExistingSim(opts = {}) {
  const {
    platformVersion,
    deviceName,
    simulatorDevicesSetPath: devicesSetPath
  } = opts;
  let appiumTestDevice;
  const simctl = new _nodeSimctl.default({
    devicesSetPath
  });
  for (const device of _lodash.default.values(await simctl.getDevices(platformVersion))) {
    if (deviceName && device.name === deviceName || !deviceName) {
      return await (0, _appiumIosSimulator.getSimulator)(device.udid, {
        platform: device.platform,
        checkExistence: false,
        devicesSetPath
      });
    }
    if (device.name.startsWith(APPIUM_SIM_PREFIX) && (deviceName && device.name.endsWith(deviceName) || !deviceName)) {
      appiumTestDevice = device;
      if (device.state === 'Booted') {
        break;
      }
    }
  }
  if (appiumTestDevice) {
    _logger.default.warn(`Unable to find device '${deviceName}'. ` + `Found '${appiumTestDevice.name}' (udid: '${appiumTestDevice.udid}') instead`);
    return await (0, _appiumIosSimulator.getSimulator)(appiumTestDevice.udid, {
      platform: appiumTestDevice.platform,
      checkExistence: false,
      devicesSetPath
    });
  }
  return null;
}
async function shutdownSimulator(device) {
  await (0, _appiumWebdriveragent.resetTestProcesses)(device.udid, true);
  await device.shutdown();
}
async function runSimulatorReset(device, opts) {
  const {
    noReset,
    fullReset,
    keychainsExcludePatterns,
    keepKeyChains,
    bundleId,
    app,
    browserName,
    enforceSimulatorShutdown
  } = opts;
  if (noReset && !fullReset) {
    _logger.default.debug('Reset: noReset is on. Leaving simulator as is');
    return;
  }
  if (!device) {
    _logger.default.debug('Reset: no device available. Skipping');
    return;
  }
  if (fullReset) {
    _logger.default.debug('Reset: fullReset is on. Cleaning simulator');
    await shutdownSimulator(device);
    const isKeychainsBackupSuccessful = (keychainsExcludePatterns || keepKeyChains) && (await device.backupKeychains());
    await device.clean();
    if (isKeychainsBackupSuccessful) {
      await device.restoreKeychains(keychainsExcludePatterns || []);
      _logger.default.info(`Successfully restored keychains after full reset`);
    } else if (keychainsExcludePatterns || keepKeyChains) {
      _logger.default.warn('Cannot restore keychains after full reset, because ' + 'the backup operation did not succeed');
    }
  } else if (bundleId) {
    try {
      await device.terminateApp(bundleId);
    } catch (err) {
      _logger.default.warn(`Reset: failed to terminate Simulator application with id "${bundleId}"`);
    }
    if (app) {
      _logger.default.info('Not scrubbing third party app in anticipation of uninstall');
    } else {
      const isSafari = _lodash.default.toLower(browserName) === 'safari';
      try {
        if (isSafari) {
          await device.scrubSafari();
        } else {
          await device.scrubApp(bundleId);
        }
      } catch (err) {
        _logger.default.debug(err.stack);
        _logger.default.warn(err.message);
        _logger.default.warn(`Reset: could not scrub ${isSafari ? 'Safari browser' : 'application with id "' + opts.bundleId + '"'}. ` + `Leaving as is.`);
      }
    }
    if (enforceSimulatorShutdown && (await device.isRunning())) {
      await shutdownSimulator(device);
    }
  }
}
async function installToSimulator(device, app, bundleId, opts = {}) {
  if (!app) {
    _logger.default.debug('No app path is given. Nothing to install.');
    return;
  }
  const {
    skipUninstall,
    newSimulator = false
  } = opts;
  if (!skipUninstall && !newSimulator && bundleId && (await device.isAppInstalled(bundleId))) {
    _logger.default.debug(`Reset requested. Removing app with id '${bundleId}' from the device`);
    await device.removeApp(bundleId);
  }
  _logger.default.debug(`Installing '${app}' on Simulator with UUID '${device.udid}'...`);
  try {
    await device.installApp(app);
  } catch (e) {
    _logger.default.info(`Got an error on '${app}' install: ${e.message}`);
    _logger.default.info('Retrying application install');
    await device.installApp(app);
  }
  _logger.default.debug('The app has been installed successfully.');
}
async function shutdownOtherSimulators(currentDevice) {
  const simctl = new _nodeSimctl.default({
    devicesSetPath: currentDevice.devicesSetPath
  });
  const allDevices = _lodash.default.flatMap(_lodash.default.values(await simctl.getDevices()));
  const otherBootedDevices = allDevices.filter(device => device.udid !== currentDevice.udid && device.state === 'Booted');
  if (_lodash.default.isEmpty(otherBootedDevices)) {
    _logger.default.info('No other running simulators have been detected');
    return;
  }
  _logger.default.info(`Detected ${otherBootedDevices.length} other running ${_support.util.pluralize('Simulator', otherBootedDevices.length)}.` + `Shutting them down...`);
  for (const {
    udid
  } of otherBootedDevices) {
    await (0, _appiumWebdriveragent.resetTestProcesses)(udid, true);
    simctl.udid = udid;
    await simctl.shutdownDevice();
  }
}
async function setSafariPrefs(sim, opts = {}) {
  const safariSettings = _lodash.default.cloneDeep(opts.safariGlobalPreferences ?? {});
  for (const [name, [aliases, valueConverter]] of _lodash.default.toPairs(SAFARI_OPTS_ALIASES_MAP)) {
    if (!_lodash.default.has(opts, name)) {
      continue;
    }
    for (const alias of aliases) {
      safariSettings[alias] = valueConverter(opts[name]);
    }
  }
  if (_lodash.default.isEmpty(safariSettings)) {
    return false;
  }
  _logger.default.debug(`About to update Safari preferences: ${JSON.stringify(safariSettings)}`);
  await sim.updateSafariSettings(safariSettings);
  return true;
}
async function setLocalizationPrefs(sim, opts = {}) {
  const {
    language,
    locale,
    calendarFormat
  } = opts;
  const l10nConfig = {};
  if (language) {
    l10nConfig.language = {
      name: language
    };
  }
  if (locale) {
    l10nConfig.locale = {
      name: locale
    };
    if (calendarFormat) {
      l10nConfig.locale.calendar = calendarFormat;
    }
  }
  if (_lodash.default.isEmpty(l10nConfig)) {
    return false;
  }
  _logger.default.debug(`About to update localization preferences: ${JSON.stringify(l10nConfig)}`);
  await sim.configureLocalization(l10nConfig);
  return true;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXBwaXVtSW9zU2ltdWxhdG9yIiwicmVxdWlyZSIsIl9ub2RlU2ltY3RsIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9hcHBpdW1XZWJkcml2ZXJhZ2VudCIsIl9sb2Rhc2giLCJfbG9nZ2VyIiwiX3N1cHBvcnQiLCJfZGVzaXJlZENhcHMiLCJBUFBJVU1fU0lNX1BSRUZJWCIsIlNBRkFSSV9PUFRTX0FMSUFTRVNfTUFQIiwic2FmYXJpQWxsb3dQb3B1cHMiLCJ4IiwiTnVtYmVyIiwiQm9vbGVhbiIsInNhZmFyaUlnbm9yZUZyYXVkV2FybmluZyIsInNhZmFyaU9wZW5MaW5rc0luQmFja2dyb3VuZCIsImNyZWF0ZVNpbSIsImNhcHMiLCJwbGF0Zm9ybSIsIlBMQVRGT1JNX05BTUVfSU9TIiwiZGV2aWNlc1NldFBhdGgiLCJzaW11bGF0b3JEZXZpY2VzU2V0UGF0aCIsInVkaWQiLCJTaW1jdGwiLCJjcmVhdGVEZXZpY2UiLCJ1dGlsIiwidXVpZFY0IiwidG9VcHBlckNhc2UiLCJkZXZpY2VOYW1lIiwicGxhdGZvcm1WZXJzaW9uIiwiZ2V0U2ltdWxhdG9yIiwiY2hlY2tFeGlzdGVuY2UiLCJnZXRFeGlzdGluZ1NpbSIsIm9wdHMiLCJhcHBpdW1UZXN0RGV2aWNlIiwic2ltY3RsIiwiZGV2aWNlIiwiXyIsInZhbHVlcyIsImdldERldmljZXMiLCJuYW1lIiwic3RhcnRzV2l0aCIsImVuZHNXaXRoIiwic3RhdGUiLCJsb2ciLCJ3YXJuIiwic2h1dGRvd25TaW11bGF0b3IiLCJyZXNldFRlc3RQcm9jZXNzZXMiLCJzaHV0ZG93biIsInJ1blNpbXVsYXRvclJlc2V0Iiwibm9SZXNldCIsImZ1bGxSZXNldCIsImtleWNoYWluc0V4Y2x1ZGVQYXR0ZXJucyIsImtlZXBLZXlDaGFpbnMiLCJidW5kbGVJZCIsImFwcCIsImJyb3dzZXJOYW1lIiwiZW5mb3JjZVNpbXVsYXRvclNodXRkb3duIiwiZGVidWciLCJpc0tleWNoYWluc0JhY2t1cFN1Y2Nlc3NmdWwiLCJiYWNrdXBLZXljaGFpbnMiLCJjbGVhbiIsInJlc3RvcmVLZXljaGFpbnMiLCJpbmZvIiwidGVybWluYXRlQXBwIiwiZXJyIiwiaXNTYWZhcmkiLCJ0b0xvd2VyIiwic2NydWJTYWZhcmkiLCJzY3J1YkFwcCIsInN0YWNrIiwibWVzc2FnZSIsImlzUnVubmluZyIsImluc3RhbGxUb1NpbXVsYXRvciIsInNraXBVbmluc3RhbGwiLCJuZXdTaW11bGF0b3IiLCJpc0FwcEluc3RhbGxlZCIsInJlbW92ZUFwcCIsImluc3RhbGxBcHAiLCJlIiwic2h1dGRvd25PdGhlclNpbXVsYXRvcnMiLCJjdXJyZW50RGV2aWNlIiwiYWxsRGV2aWNlcyIsImZsYXRNYXAiLCJvdGhlckJvb3RlZERldmljZXMiLCJmaWx0ZXIiLCJpc0VtcHR5IiwibGVuZ3RoIiwicGx1cmFsaXplIiwic2h1dGRvd25EZXZpY2UiLCJzZXRTYWZhcmlQcmVmcyIsInNpbSIsInNhZmFyaVNldHRpbmdzIiwiY2xvbmVEZWVwIiwic2FmYXJpR2xvYmFsUHJlZmVyZW5jZXMiLCJhbGlhc2VzIiwidmFsdWVDb252ZXJ0ZXIiLCJ0b1BhaXJzIiwiaGFzIiwiYWxpYXMiLCJKU09OIiwic3RyaW5naWZ5IiwidXBkYXRlU2FmYXJpU2V0dGluZ3MiLCJzZXRMb2NhbGl6YXRpb25QcmVmcyIsImxhbmd1YWdlIiwibG9jYWxlIiwiY2FsZW5kYXJGb3JtYXQiLCJsMTBuQ29uZmlnIiwiY2FsZW5kYXIiLCJjb25maWd1cmVMb2NhbGl6YXRpb24iXSwic291cmNlcyI6WyIuLi8uLi9saWIvc2ltdWxhdG9yLW1hbmFnZW1lbnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0U2ltdWxhdG9yIH0gZnJvbSAnYXBwaXVtLWlvcy1zaW11bGF0b3InO1xuaW1wb3J0IFNpbWN0bCBmcm9tICdub2RlLXNpbWN0bCc7XG5pbXBvcnQgeyByZXNldFRlc3RQcm9jZXNzZXMgfSBmcm9tICdhcHBpdW0td2ViZHJpdmVyYWdlbnQnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcbmltcG9ydCB7IFBMQVRGT1JNX05BTUVfSU9TIH0gZnJvbSAnLi9kZXNpcmVkLWNhcHMnO1xuXG5cbmNvbnN0IEFQUElVTV9TSU1fUFJFRklYID0gJ2FwcGl1bVRlc3QnO1xuY29uc3QgU0FGQVJJX09QVFNfQUxJQVNFU19NQVAgPSB7XG4gIHNhZmFyaUFsbG93UG9wdXBzOiBbXG4gICAgWydXZWJLaXRKYXZhU2NyaXB0Q2FuT3BlbldpbmRvd3NBdXRvbWF0aWNhbGx5JywgJ0phdmFTY3JpcHRDYW5PcGVuV2luZG93c0F1dG9tYXRpY2FsbHknXSxcbiAgICAoeCkgPT4gTnVtYmVyKEJvb2xlYW4oeCkpLFxuICBdLFxuICBzYWZhcmlJZ25vcmVGcmF1ZFdhcm5pbmc6IFtcbiAgICBbJ1dhcm5BYm91dEZyYXVkdWxlbnRXZWJzaXRlcyddLFxuICAgICh4KSA9PiBOdW1iZXIoIXgpLFxuICBdLFxuICBzYWZhcmlPcGVuTGlua3NJbkJhY2tncm91bmQ6IFtcbiAgICBbJ09wZW5MaW5rc0luQmFja2dyb3VuZCddLFxuICAgICh4KSA9PiBOdW1iZXIoQm9vbGVhbih4KSksXG4gIF1cbn07XG5cbi8qKlxuICogQ2FwYWJpbGl0eSBzZXQgYnkgYSB1c2VyXG4gKlxuICogQHByb3BlcnR5IHtzdHJpbmd9IGRldmljZU5hbWUgLSBBIG5hbWUgZm9yIHRoZSBkZXZpY2VcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBwbGF0Zm9ybVZlcnNpb24gLSBUaGUgdmVyc2lvbiBvZiBpT1MgdG8gdXNlXG4gKi9cbi8qKlxuICogQ3JlYXRlIGEgbmV3IHNpbXVsYXRvciB3aXRoIGBhcHBpdW1UZXN0LWAgcHJlZml4IGFuZCByZXR1cm4gdGhlIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gU2ltQ3JlYXRpb25DYXBzIC0gQ2FwYWJpbGl0eSBzZXQgYnkgYSB1c2VyLiBUaGUgb3B0aW9ucyBhdmFpbGFibGUgYXJlOlxuICogQHByb3BlcnR5IHtzdHJpbmd9IHBsYXRmb3JtIFtpT1NdIC0gUGxhdGZvcm0gbmFtZSBpbiBvcmRlciB0byBzcGVjaWZ5IHJ1bnRpbWUgc3VjaCBhcyAnaU9TJywgJ3R2T1MnLCAnd2F0Y2hPUydcbiAqIEByZXR1cm5zIHtvYmplY3R9IFNpbXVsYXRvciBvYmplY3QgYXNzb2NpYXRlZCB3aXRoIHRoZSB1ZGlkIHBhc3NlZCBpbi5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gY3JlYXRlU2ltIChjYXBzLCBwbGF0Zm9ybSA9IFBMQVRGT1JNX05BTUVfSU9TKSB7XG4gIGNvbnN0IGRldmljZXNTZXRQYXRoID0gY2Fwcy5zaW11bGF0b3JEZXZpY2VzU2V0UGF0aDtcbiAgY29uc3QgdWRpZCA9IGF3YWl0IG5ldyBTaW1jdGwoe2RldmljZXNTZXRQYXRofSkuY3JlYXRlRGV2aWNlKFxuICAgIGAke0FQUElVTV9TSU1fUFJFRklYfS0ke3V0aWwudXVpZFY0KCkudG9VcHBlckNhc2UoKX0tJHtjYXBzLmRldmljZU5hbWV9YCxcbiAgICBjYXBzLmRldmljZU5hbWUsXG4gICAgY2Fwcy5wbGF0Zm9ybVZlcnNpb24sXG4gICAge3BsYXRmb3JtfSxcbiAgKTtcbiAgcmV0dXJuIGF3YWl0IGdldFNpbXVsYXRvcih1ZGlkLCB7XG4gICAgcGxhdGZvcm0sXG4gICAgY2hlY2tFeGlzdGVuY2U6IGZhbHNlLFxuICAgIGRldmljZXNTZXRQYXRoLFxuICB9KTtcbn1cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBTaW11bGF0b3JMb29rdXBPcHRpb25zXG4gKiBAcHJvcGVydHkge3N0cmluZz99IGRldmljZU5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgZGV2aWNlIHRvIGxvb2t1cFxuICogQHByb3BlcnR5IHtzdHJpbmchfSBwbGF0Zm9ybVZlcnNpb24gLSBUaGUgcGxhdGZvcm0gdmVyc2lvbiBzdHJpbmdcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nP30gc2ltdWxhdG9yRGV2aWNlc1NldFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBzaW11bGF0b3IgZGV2aWNlcyBzZXRcbiAqL1xuXG4vKipcbiAqIEdldCBhIHNpbXVsYXRvciB3aGljaCBpcyBhbHJlYWR5IHJ1bm5pbmcuXG4gKlxuICogQHBhcmFtIHtTaW11bGF0b3JMb29rdXBPcHRpb25zP30gb3B0c1xuICogQHJldHVybnMge1NpbXVsYXRvcj99IFRoZSBtYXRjaGVkIFNpbXVsYXRvciBpbnN0YW5jZSBvciBgbnVsbGAgaWYgbm8gbWF0Y2hpbmcgIGRldmljZSBpcyBmb3VuZC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0RXhpc3RpbmdTaW0gKG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgcGxhdGZvcm1WZXJzaW9uLFxuICAgIGRldmljZU5hbWUsXG4gICAgc2ltdWxhdG9yRGV2aWNlc1NldFBhdGg6IGRldmljZXNTZXRQYXRoLFxuICB9ID0gb3B0cztcblxuICBsZXQgYXBwaXVtVGVzdERldmljZTtcbiAgY29uc3Qgc2ltY3RsID0gbmV3IFNpbWN0bCh7ZGV2aWNlc1NldFBhdGh9KTtcbiAgZm9yIChjb25zdCBkZXZpY2Ugb2YgXy52YWx1ZXMoYXdhaXQgc2ltY3RsLmdldERldmljZXMocGxhdGZvcm1WZXJzaW9uKSkpIHtcbiAgICBpZiAoKGRldmljZU5hbWUgJiYgZGV2aWNlLm5hbWUgPT09IGRldmljZU5hbWUpIHx8ICFkZXZpY2VOYW1lKSB7XG4gICAgICByZXR1cm4gYXdhaXQgZ2V0U2ltdWxhdG9yKGRldmljZS51ZGlkLCB7XG4gICAgICAgIHBsYXRmb3JtOiBkZXZpY2UucGxhdGZvcm0sXG4gICAgICAgIGNoZWNrRXhpc3RlbmNlOiBmYWxzZSxcbiAgICAgICAgZGV2aWNlc1NldFBhdGgsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoZGV2aWNlLm5hbWUuc3RhcnRzV2l0aChBUFBJVU1fU0lNX1BSRUZJWClcbiAgICAgICYmICgoZGV2aWNlTmFtZSAmJiBkZXZpY2UubmFtZS5lbmRzV2l0aChkZXZpY2VOYW1lKSkgfHwgIWRldmljZU5hbWUpKSB7XG4gICAgICBhcHBpdW1UZXN0RGV2aWNlID0gZGV2aWNlO1xuICAgICAgLy8gY2hvb3NlIHRoZSBmaXJzdCBib290ZWQgc2ltdWxhdG9yXG4gICAgICBpZiAoZGV2aWNlLnN0YXRlID09PSAnQm9vdGVkJykge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoYXBwaXVtVGVzdERldmljZSkge1xuICAgIGxvZy53YXJuKGBVbmFibGUgdG8gZmluZCBkZXZpY2UgJyR7ZGV2aWNlTmFtZX0nLiBgICtcbiAgICAgIGBGb3VuZCAnJHthcHBpdW1UZXN0RGV2aWNlLm5hbWV9JyAodWRpZDogJyR7YXBwaXVtVGVzdERldmljZS51ZGlkfScpIGluc3RlYWRgKTtcbiAgICByZXR1cm4gYXdhaXQgZ2V0U2ltdWxhdG9yKGFwcGl1bVRlc3REZXZpY2UudWRpZCwge1xuICAgICAgcGxhdGZvcm06IGFwcGl1bVRlc3REZXZpY2UucGxhdGZvcm0sXG4gICAgICBjaGVja0V4aXN0ZW5jZTogZmFsc2UsXG4gICAgICBkZXZpY2VzU2V0UGF0aCxcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2h1dGRvd25TaW11bGF0b3IgKGRldmljZSkge1xuICAvLyBzdG9wIFhDVGVzdCBwcm9jZXNzZXMgaWYgcnVubmluZyB0byBhdm9pZCB1bmV4cGVjdGVkIHNpZGUgZWZmZWN0c1xuICBhd2FpdCByZXNldFRlc3RQcm9jZXNzZXMoZGV2aWNlLnVkaWQsIHRydWUpO1xuICBhd2FpdCBkZXZpY2Uuc2h1dGRvd24oKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcnVuU2ltdWxhdG9yUmVzZXQgKGRldmljZSwgb3B0cykge1xuICBjb25zdCB7XG4gICAgbm9SZXNldCxcbiAgICBmdWxsUmVzZXQsXG4gICAga2V5Y2hhaW5zRXhjbHVkZVBhdHRlcm5zLFxuICAgIGtlZXBLZXlDaGFpbnMsXG4gICAgYnVuZGxlSWQsXG4gICAgYXBwLFxuICAgIGJyb3dzZXJOYW1lLFxuICAgIGVuZm9yY2VTaW11bGF0b3JTaHV0ZG93bixcbiAgfSA9IG9wdHM7XG4gIGlmIChub1Jlc2V0ICYmICFmdWxsUmVzZXQpIHtcbiAgICAvLyBub1Jlc2V0ID09PSB0cnVlICYmIGZ1bGxSZXNldCA9PT0gZmFsc2VcbiAgICBsb2cuZGVidWcoJ1Jlc2V0OiBub1Jlc2V0IGlzIG9uLiBMZWF2aW5nIHNpbXVsYXRvciBhcyBpcycpO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoIWRldmljZSkge1xuICAgIGxvZy5kZWJ1ZygnUmVzZXQ6IG5vIGRldmljZSBhdmFpbGFibGUuIFNraXBwaW5nJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGZ1bGxSZXNldCkge1xuICAgIGxvZy5kZWJ1ZygnUmVzZXQ6IGZ1bGxSZXNldCBpcyBvbi4gQ2xlYW5pbmcgc2ltdWxhdG9yJyk7XG4gICAgYXdhaXQgc2h1dGRvd25TaW11bGF0b3IoZGV2aWNlKTtcbiAgICBjb25zdCBpc0tleWNoYWluc0JhY2t1cFN1Y2Nlc3NmdWwgPSAoa2V5Y2hhaW5zRXhjbHVkZVBhdHRlcm5zIHx8IGtlZXBLZXlDaGFpbnMpXG4gICAgICAmJiBhd2FpdCBkZXZpY2UuYmFja3VwS2V5Y2hhaW5zKCk7XG4gICAgYXdhaXQgZGV2aWNlLmNsZWFuKCk7XG4gICAgaWYgKGlzS2V5Y2hhaW5zQmFja3VwU3VjY2Vzc2Z1bCkge1xuICAgICAgYXdhaXQgZGV2aWNlLnJlc3RvcmVLZXljaGFpbnMoa2V5Y2hhaW5zRXhjbHVkZVBhdHRlcm5zIHx8IFtdKTtcbiAgICAgIGxvZy5pbmZvKGBTdWNjZXNzZnVsbHkgcmVzdG9yZWQga2V5Y2hhaW5zIGFmdGVyIGZ1bGwgcmVzZXRgKTtcbiAgICB9IGVsc2UgaWYgKGtleWNoYWluc0V4Y2x1ZGVQYXR0ZXJucyB8fCBrZWVwS2V5Q2hhaW5zKSB7XG4gICAgICBsb2cud2FybignQ2Fubm90IHJlc3RvcmUga2V5Y2hhaW5zIGFmdGVyIGZ1bGwgcmVzZXQsIGJlY2F1c2UgJyArXG4gICAgICAgICd0aGUgYmFja3VwIG9wZXJhdGlvbiBkaWQgbm90IHN1Y2NlZWQnKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoYnVuZGxlSWQpIHtcbiAgICAvLyBmYXN0UmVzZXQgb3Igbm9SZXNldFxuXG4gICAgLy8gVGVybWluYXRlIHRoZSBhcHAgdW5kZXIgdGVzdCBpZiBpdCBpcyBzdGlsbCBydW5uaW5nIG9uIFNpbXVsYXRvclxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBkZXZpY2UudGVybWluYXRlQXBwKGJ1bmRsZUlkKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBSZXNldDogZmFpbGVkIHRvIHRlcm1pbmF0ZSBTaW11bGF0b3IgYXBwbGljYXRpb24gd2l0aCBpZCBcIiR7YnVuZGxlSWR9XCJgKTtcbiAgICB9XG5cbiAgICBpZiAoYXBwKSB7XG4gICAgICBsb2cuaW5mbygnTm90IHNjcnViYmluZyB0aGlyZCBwYXJ0eSBhcHAgaW4gYW50aWNpcGF0aW9uIG9mIHVuaW5zdGFsbCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBpc1NhZmFyaSA9IF8udG9Mb3dlcihicm93c2VyTmFtZSkgPT09ICdzYWZhcmknO1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKGlzU2FmYXJpKSB7XG4gICAgICAgICAgYXdhaXQgZGV2aWNlLnNjcnViU2FmYXJpKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXdhaXQgZGV2aWNlLnNjcnViQXBwKGJ1bmRsZUlkKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhlcnIuc3RhY2spO1xuICAgICAgICBsb2cud2FybihlcnIubWVzc2FnZSk7XG4gICAgICAgIGxvZy53YXJuKFxuICAgICAgICAgIGBSZXNldDogY291bGQgbm90IHNjcnViICR7aXNTYWZhcmkgPyAnU2FmYXJpIGJyb3dzZXInIDogJ2FwcGxpY2F0aW9uIHdpdGggaWQgXCInICsgb3B0cy5idW5kbGVJZCArICdcIid9LiBgICtcbiAgICAgICAgICBgTGVhdmluZyBhcyBpcy5gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGVuZm9yY2VTaW11bGF0b3JTaHV0ZG93biAmJiBhd2FpdCBkZXZpY2UuaXNSdW5uaW5nKCkpIHtcbiAgICAgIGF3YWl0IHNodXRkb3duU2ltdWxhdG9yKGRldmljZSk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gSW5zdGFsbE9wdGlvbnNcbiAqXG4gKiBAcHJvcGVydHkge2Jvb2xlYW4/fSBza2lwVW5pbnN0YWxsIFdoZXRoZXIgdG8gc2tpcCBhcHAgdW5pbnN0YWxsIGJlZm9yZSBpbnN0YWxsaW5nIGl0XG4gKiBAcHJvcGVydHkge2Jvb2xlYW4/fSBuZXdTaW11bGF0b3IgW2ZhbHNlXSBXaGV0aGVyIHRoZSBzaW11bGF0b3IgaXMgYnJhbmQgbmV3XG4gKi9cblxuLyoqXG4gKiBAcGFyYW0ge09iamVjdH0gZGV2aWNlIFRoZSBzaW11bGF0b3IgZGV2aWNlIG9iamVjdFxuICogQHBhcmFtIHtzdHJpbmc/fSBhcHAgVGhlIGFwcCB0byB0aGUgcGF0aFxuICogQHBhcmFtIHtzdHJpbmc/fSBidW5kbGVJZCBUaGUgYnVuZGxlIGlkIHRvIGVuc3VyZSBpdCBpcyBhbHJlYWR5IGluc3RhbGxlZCBhbmQgdW5pbnN0YWxsIGl0XG4gKiBAcGFyYW0ge0luc3RhbGxPcHRpb25zP30gb3B0c1xuICovXG5hc3luYyBmdW5jdGlvbiBpbnN0YWxsVG9TaW11bGF0b3IgKGRldmljZSwgYXBwLCBidW5kbGVJZCwgb3B0cyA9IHt9KSB7XG4gIGlmICghYXBwKSB7XG4gICAgbG9nLmRlYnVnKCdObyBhcHAgcGF0aCBpcyBnaXZlbi4gTm90aGluZyB0byBpbnN0YWxsLicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHtcbiAgICBza2lwVW5pbnN0YWxsLFxuICAgIG5ld1NpbXVsYXRvciA9IGZhbHNlLFxuICB9ID0gb3B0cztcblxuICBpZiAoIXNraXBVbmluc3RhbGwgJiYgIW5ld1NpbXVsYXRvciAmJiBidW5kbGVJZCAmJiBhd2FpdCBkZXZpY2UuaXNBcHBJbnN0YWxsZWQoYnVuZGxlSWQpKSB7XG4gICAgbG9nLmRlYnVnKGBSZXNldCByZXF1ZXN0ZWQuIFJlbW92aW5nIGFwcCB3aXRoIGlkICcke2J1bmRsZUlkfScgZnJvbSB0aGUgZGV2aWNlYCk7XG4gICAgYXdhaXQgZGV2aWNlLnJlbW92ZUFwcChidW5kbGVJZCk7XG4gIH1cblxuICBsb2cuZGVidWcoYEluc3RhbGxpbmcgJyR7YXBwfScgb24gU2ltdWxhdG9yIHdpdGggVVVJRCAnJHtkZXZpY2UudWRpZH0nLi4uYCk7XG4gIHRyeSB7XG4gICAgYXdhaXQgZGV2aWNlLmluc3RhbGxBcHAoYXBwKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIC8vIGl0IHNvbWV0aW1lcyBmYWlscyBvbiBYY29kZSAxMCBiZWNhdXNlIG9mIGEgcmFjZSBjb25kaXRpb25cbiAgICBsb2cuaW5mbyhgR290IGFuIGVycm9yIG9uICcke2FwcH0nIGluc3RhbGw6ICR7ZS5tZXNzYWdlfWApO1xuICAgIGxvZy5pbmZvKCdSZXRyeWluZyBhcHBsaWNhdGlvbiBpbnN0YWxsJyk7XG4gICAgYXdhaXQgZGV2aWNlLmluc3RhbGxBcHAoYXBwKTtcbiAgfVxuICBsb2cuZGVidWcoJ1RoZSBhcHAgaGFzIGJlZW4gaW5zdGFsbGVkIHN1Y2Nlc3NmdWxseS4nKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2h1dGRvd25PdGhlclNpbXVsYXRvcnMgKGN1cnJlbnREZXZpY2UpIHtcbiAgY29uc3Qgc2ltY3RsID0gbmV3IFNpbWN0bCh7XG4gICAgZGV2aWNlc1NldFBhdGg6IGN1cnJlbnREZXZpY2UuZGV2aWNlc1NldFBhdGhcbiAgfSk7XG4gIGNvbnN0IGFsbERldmljZXMgPSBfLmZsYXRNYXAoXy52YWx1ZXMoYXdhaXQgc2ltY3RsLmdldERldmljZXMoKSkpO1xuICBjb25zdCBvdGhlckJvb3RlZERldmljZXMgPSBhbGxEZXZpY2VzLmZpbHRlcigoZGV2aWNlKSA9PiBkZXZpY2UudWRpZCAhPT0gY3VycmVudERldmljZS51ZGlkICYmIGRldmljZS5zdGF0ZSA9PT0gJ0Jvb3RlZCcpO1xuICBpZiAoXy5pc0VtcHR5KG90aGVyQm9vdGVkRGV2aWNlcykpIHtcbiAgICBsb2cuaW5mbygnTm8gb3RoZXIgcnVubmluZyBzaW11bGF0b3JzIGhhdmUgYmVlbiBkZXRlY3RlZCcpO1xuICAgIHJldHVybjtcbiAgfVxuICBsb2cuaW5mbyhgRGV0ZWN0ZWQgJHtvdGhlckJvb3RlZERldmljZXMubGVuZ3RofSBvdGhlciBydW5uaW5nICR7dXRpbC5wbHVyYWxpemUoJ1NpbXVsYXRvcicsIG90aGVyQm9vdGVkRGV2aWNlcy5sZW5ndGgpfS5gICtcbiAgICBgU2h1dHRpbmcgdGhlbSBkb3duLi4uYCk7XG4gIGZvciAoY29uc3Qge3VkaWR9IG9mIG90aGVyQm9vdGVkRGV2aWNlcykge1xuICAgIC8vIEl0IGlzIG5lY2Vzc2FyeSB0byBzdG9wIHRoZSBjb3JyZXNwb25kaW5nIHhjb2RlYnVpbGQgcHJvY2VzcyBiZWZvcmUga2lsbGluZ1xuICAgIC8vIHRoZSBzaW11bGF0b3IsIG90aGVyd2lzZSBpdCB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgcmVzdGFydGVkXG4gICAgYXdhaXQgcmVzZXRUZXN0UHJvY2Vzc2VzKHVkaWQsIHRydWUpO1xuICAgIHNpbWN0bC51ZGlkID0gdWRpZDtcbiAgICBhd2FpdCBzaW1jdGwuc2h1dGRvd25EZXZpY2UoKTtcbiAgfVxufVxuXG4vKipcbiAqIENvbmZpZ3VyZXMgU2FmYXJpIG9wdGlvbnMgYmFzZWQgb24gdGhlIGdpdmVuIHNlc3Npb24gY2FwYWJpbGl0aWVzXG4gKlxuICogQHBhcmFtIHsqfSBzaW0gU2ltdWxhdG9yIGluc3RhbmNlXG4gKiBAcGFyYW0ge29iamVjdH0gb3B0cyBTZXNzaW9uIGNhcGFiaWxpdGllc1xuICogQHJldHVybiB7Ym9vbGVhbn0gdHJ1ZSBpZiBhbnkgcHJlZmVyZW5jZXMgaGF2ZSBiZWVuIHVwZGF0ZWRcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2V0U2FmYXJpUHJlZnMgKHNpbSwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHNhZmFyaVNldHRpbmdzID0gXy5jbG9uZURlZXAob3B0cy5zYWZhcmlHbG9iYWxQcmVmZXJlbmNlcyA/PyB7fSk7XG5cbiAgZm9yIChjb25zdCBbbmFtZSwgW2FsaWFzZXMsIHZhbHVlQ29udmVydGVyXV0gb2YgXy50b1BhaXJzKFNBRkFSSV9PUFRTX0FMSUFTRVNfTUFQKSkge1xuICAgIGlmICghXy5oYXMob3B0cywgbmFtZSkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgYWxpYXMgb2YgYWxpYXNlcykge1xuICAgICAgc2FmYXJpU2V0dGluZ3NbYWxpYXNdID0gdmFsdWVDb252ZXJ0ZXIob3B0c1tuYW1lXSk7XG4gICAgfVxuICB9XG4gIGlmIChfLmlzRW1wdHkoc2FmYXJpU2V0dGluZ3MpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgbG9nLmRlYnVnKGBBYm91dCB0byB1cGRhdGUgU2FmYXJpIHByZWZlcmVuY2VzOiAke0pTT04uc3RyaW5naWZ5KHNhZmFyaVNldHRpbmdzKX1gKTtcbiAgYXdhaXQgc2ltLnVwZGF0ZVNhZmFyaVNldHRpbmdzKHNhZmFyaVNldHRpbmdzKTtcbiAgcmV0dXJuIHRydWU7XG59XG5cbi8qKlxuICogQ2hhbmdlcyBTaW11bGF0b3IgbG9jYWxpemF0aW9uIHByZWZlcmVuY2VzXG4gKlxuICogQHBhcmFtIHsqfSBzaW0gU2ltdWxhdG9yIGluc3RhbmNlXG4gKiBAcGFyYW0ge29iamVjdH0gb3B0cyBTZXNzaW9uIGNhcGFiaWxpdGllc1xuICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgcHJlZmVyZW5jZXMgd2VyZSBjaGFuZ2VkXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNldExvY2FsaXphdGlvblByZWZzIChzaW0sIG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgbGFuZ3VhZ2UsXG4gICAgbG9jYWxlLFxuICAgIGNhbGVuZGFyRm9ybWF0LFxuICB9ID0gb3B0cztcbiAgY29uc3QgbDEwbkNvbmZpZyA9IHt9O1xuICBpZiAobGFuZ3VhZ2UpIHtcbiAgICBsMTBuQ29uZmlnLmxhbmd1YWdlID0ge25hbWU6IGxhbmd1YWdlfTtcbiAgfVxuICBpZiAobG9jYWxlKSB7XG4gICAgbDEwbkNvbmZpZy5sb2NhbGUgPSB7bmFtZTogbG9jYWxlfTtcbiAgICBpZiAoY2FsZW5kYXJGb3JtYXQpIHtcbiAgICAgIGwxMG5Db25maWcubG9jYWxlLmNhbGVuZGFyID0gY2FsZW5kYXJGb3JtYXQ7XG4gICAgfVxuICB9XG4gIGlmIChfLmlzRW1wdHkobDEwbkNvbmZpZykpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBsb2cuZGVidWcoYEFib3V0IHRvIHVwZGF0ZSBsb2NhbGl6YXRpb24gcHJlZmVyZW5jZXM6ICR7SlNPTi5zdHJpbmdpZnkobDEwbkNvbmZpZyl9YCk7XG4gIGF3YWl0IHNpbS5jb25maWd1cmVMb2NhbGl6YXRpb24obDEwbkNvbmZpZyk7XG4gIHJldHVybiB0cnVlO1xufVxuXG5cbmV4cG9ydCB7XG4gIGNyZWF0ZVNpbSwgZ2V0RXhpc3RpbmdTaW0sIHJ1blNpbXVsYXRvclJlc2V0LCBpbnN0YWxsVG9TaW11bGF0b3IsXG4gIHNodXRkb3duU2ltdWxhdG9yLCBzaHV0ZG93bk90aGVyU2ltdWxhdG9ycywgc2V0U2FmYXJpUHJlZnMsIHNldExvY2FsaXphdGlvblByZWZzXG59O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFBQSxtQkFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsV0FBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcscUJBQUEsR0FBQUgsT0FBQTtBQUNBLElBQUFJLE9BQUEsR0FBQUYsc0JBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFLLE9BQUEsR0FBQUgsc0JBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFN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