{"version":3,"file":"afcdecoder.js","names":["_stream","_interopRequireDefault","require","_protocol","AfcDecoder","Stream","Transform","constructor","objectMode","_transform","data","encoding","onData","_decode","magicNumber","slice","compare","MAGIC_NUMBER","Error","messageLength","readUInt64LE","thisLength","packetNumber","opCode","headerPayload","AFC_PACKET_HEADER_SIZE","content","push","buffer","index","readUInt32LE","exports","_default","default"],"sources":["../../../../lib/afc/transformer/afcdecoder.js"],"sourcesContent":["import Stream from 'stream';\nimport { MAGIC_NUMBER, AFC_PACKET_HEADER_SIZE } from '../protocol';\n\n\nclass AfcDecoder extends Stream.Transform {\n\n  constructor () {\n    super({ objectMode: true });\n  }\n\n  _transform (data, encoding, onData) {\n    this._decode(data);\n    onData();\n  }\n\n  _decode (data) {\n    const magicNumber = data.slice(0, 8);\n    if (magicNumber.compare(MAGIC_NUMBER) !== 0) {\n      throw new Error(`Unexpected magic number: ${magicNumber}`);\n    }\n    const messageLength = this.readUInt64LE(data, 8);\n    const thisLength = this.readUInt64LE(data, 16);\n    const packetNumber = this.readUInt64LE(data, 24);\n    const opCode = this.readUInt64LE(data, 32);\n\n    const headerPayload = data.slice(AFC_PACKET_HEADER_SIZE, thisLength);\n    const content = data.slice(thisLength, messageLength);\n\n    this.push({ messageLength, packetNumber, opCode, headerPayload, content });\n  }\n\n  readUInt64LE (buffer, index) {\n    // Ignore the first 4 bytes since we don't do anything with longs\n    return buffer.readUInt32LE(index);\n  }\n}\n\nexport { AfcDecoder };\nexport default AfcDecoder;\n"],"mappings":";;;;;;;;AAAA,IAAAA,OAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,SAAA,GAAAD,OAAA;AAGA,MAAME,UAAU,SAASC,eAAM,CAACC,SAAS,CAAC;EAExCC,WAAWA,CAAA,EAAI;IACb,KAAK,CAAC;MAAEC,UAAU,EAAE;IAAK,CAAC,CAAC;EAC7B;EAEAC,UAAUA,CAAEC,IAAI,EAAEC,QAAQ,EAAEC,MAAM,EAAE;IAClC,IAAI,CAACC,OAAO,CAACH,IAAI,CAAC;IAClBE,MAAM,EAAE;EACV;EAEAC,OAAOA,CAAEH,IAAI,EAAE;IACb,MAAMI,WAAW,GAAGJ,IAAI,CAACK,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;IACpC,IAAID,WAAW,CAACE,OAAO,CAACC,sBAAY,CAAC,KAAK,CAAC,EAAE;MAC3C,MAAM,IAAIC,KAAK,CAAE,4BAA2BJ,WAAY,EAAC,CAAC;IAC5D;IACA,MAAMK,aAAa,GAAG,IAAI,CAACC,YAAY,CAACV,IAAI,EAAE,CAAC,CAAC;IAChD,MAAMW,UAAU,GAAG,IAAI,CAACD,YAAY,CAACV,IAAI,EAAE,EAAE,CAAC;IAC9C,MAAMY,YAAY,GAAG,IAAI,CAACF,YAAY,CAACV,IAAI,EAAE,EAAE,CAAC;IAChD,MAAMa,MAAM,GAAG,IAAI,CAACH,YAAY,CAACV,IAAI,EAAE,EAAE,CAAC;IAE1C,MAAMc,aAAa,GAAGd,IAAI,CAACK,KAAK,CAACU,gCAAsB,EAAEJ,UAAU,CAAC;IACpE,MAAMK,OAAO,GAAGhB,IAAI,CAACK,KAAK,CAACM,UAAU,EAAEF,aAAa,CAAC;IAErD,IAAI,CAACQ,IAAI,CAAC;MAAER,aAAa;MAAEG,YAAY;MAAEC,MAAM;MAAEC,aAAa;MAAEE;IAAQ,CAAC,CAAC;EAC5E;EAEAN,YAAYA,CAAEQ,MAAM,EAAEC,KAAK,EAAE;IAE3B,OAAOD,MAAM,CAACE,YAAY,CAACD,KAAK,CAAC;EACnC;AACF;AAACE,OAAA,CAAA3B,UAAA,GAAAA,UAAA;AAAA,IAAA4B,QAAA,GAGc5B,UAAU;AAAA2B,OAAA,CAAAE,OAAA,GAAAD,QAAA"}