{"version":3,"file":"afcencoder.js","names":["_stream","_interopRequireDefault","require","_protocol","AfcEncoder","Stream","Transform","constructor","objectMode","_transform","data","encoding","onData","_encode","content","Buffer","alloc","thisLength","AFC_PACKET_HEADER_SIZE","headerPayload","length","messageLength","buffer","MAGIC_NUMBER","copy","writeUInt64LE","packetNumber","opCode","index","writeUInt32LE","exports","_default","default"],"sources":["../../../../lib/afc/transformer/afcencoder.js"],"sourcesContent":["import Stream from 'stream';\nimport { MAGIC_NUMBER, AFC_PACKET_HEADER_SIZE } from '../protocol';\n\n\nclass AfcEncoder extends Stream.Transform {\n\n  constructor () {\n    super({ objectMode: true });\n  }\n\n  _transform (data, encoding, onData) {\n    onData(null, this._encode(data));\n  }\n\n  _encode (data) {\n    data.content = data.content ? data.content : Buffer.alloc(0);\n\n    const thisLength = AFC_PACKET_HEADER_SIZE + data.headerPayload.length;\n    const messageLength = thisLength + data.content.length;\n\n    const buffer = Buffer.alloc(messageLength);\n    MAGIC_NUMBER.copy(buffer);\n    this.writeUInt64LE(buffer, 8, messageLength);\n    this.writeUInt64LE(buffer, 16, thisLength);\n    this.writeUInt64LE(buffer, 24, data.packetNumber);\n    this.writeUInt64LE(buffer, 32, data.opCode);\n    data.headerPayload.copy(buffer, AFC_PACKET_HEADER_SIZE);\n    data.content.copy(buffer, thisLength);\n    return buffer;\n  }\n\n  writeUInt64LE (buffer, index, content) {\n    // Ignore the first 4 bytes since we don't do anything with longs\n    buffer.writeUInt32LE(content, index);\n    buffer.writeUInt32LE(0, index + 4);\n  }\n\n}\n\nexport { AfcEncoder };\nexport default AfcEncoder;\n"],"mappings":";;;;;;;;AAAA,IAAAA,OAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,SAAA,GAAAD,OAAA;AAGA,MAAME,UAAU,SAASC,eAAM,CAACC,SAAS,CAAC;EAExCC,WAAWA,CAAA,EAAI;IACb,KAAK,CAAC;MAAEC,UAAU,EAAE;IAAK,CAAC,CAAC;EAC7B;EAEAC,UAAUA,CAAEC,IAAI,EAAEC,QAAQ,EAAEC,MAAM,EAAE;IAClCA,MAAM,CAAC,IAAI,EAAE,IAAI,CAACC,OAAO,CAACH,IAAI,CAAC,CAAC;EAClC;EAEAG,OAAOA,CAAEH,IAAI,EAAE;IACbA,IAAI,CAACI,OAAO,GAAGJ,IAAI,CAACI,OAAO,GAAGJ,IAAI,CAACI,OAAO,GAAGC,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC;IAE5D,MAAMC,UAAU,GAAGC,gCAAsB,GAAGR,IAAI,CAACS,aAAa,CAACC,MAAM;IACrE,MAAMC,aAAa,GAAGJ,UAAU,GAAGP,IAAI,CAACI,OAAO,CAACM,MAAM;IAEtD,MAAME,MAAM,GAAGP,MAAM,CAACC,KAAK,CAACK,aAAa,CAAC;IAC1CE,sBAAY,CAACC,IAAI,CAACF,MAAM,CAAC;IACzB,IAAI,CAACG,aAAa,CAACH,MAAM,EAAE,CAAC,EAAED,aAAa,CAAC;IAC5C,IAAI,CAACI,aAAa,CAACH,MAAM,EAAE,EAAE,EAAEL,UAAU,CAAC;IAC1C,IAAI,CAACQ,aAAa,CAACH,MAAM,EAAE,EAAE,EAAEZ,IAAI,CAACgB,YAAY,CAAC;IACjD,IAAI,CAACD,aAAa,CAACH,MAAM,EAAE,EAAE,EAAEZ,IAAI,CAACiB,MAAM,CAAC;IAC3CjB,IAAI,CAACS,aAAa,CAACK,IAAI,CAACF,MAAM,EAAEJ,gCAAsB,CAAC;IACvDR,IAAI,CAACI,OAAO,CAACU,IAAI,CAACF,MAAM,EAAEL,UAAU,CAAC;IACrC,OAAOK,MAAM;EACf;EAEAG,aAAaA,CAAEH,MAAM,EAAEM,KAAK,EAAEd,OAAO,EAAE;IAErCQ,MAAM,CAACO,aAAa,CAACf,OAAO,EAAEc,KAAK,CAAC;IACpCN,MAAM,CAACO,aAAa,CAAC,CAAC,EAAED,KAAK,GAAG,CAAC,CAAC;EACpC;AAEF;AAACE,OAAA,CAAA1B,UAAA,GAAAA,UAAA;AAAA,IAAA2B,QAAA,GAGc3B,UAAU;AAAA0B,OAAA,CAAAE,OAAA,GAAAD,QAAA"}