{"version":3,"file":"index.js","names":["_plistServiceDecoder","_interopRequireDefault","require","_plistServiceEncoder","_lengthBasedSplitter","_constants","_afc","_bluebird","_baseService","HOUSE_ARREST_SERVICE_NAME","exports","MAX_FRAME_SIZE","KB","HouseArrestService","BaseServiceSocket","constructor","socketClient","_decoder","PlistServiceDecoder","_splitter","LengthBasedSplitter","readableStream","littleEndian","maxFrameLength","lengthFieldOffset","lengthFieldLength","lengthAdjustment","_socketClient","pipe","_encoder","PlistServiceEncoder","_assignClientFailureHandlers","vendContainer","bundleId","responsePromise","_receivePlistPromise","write","Command","Identifier","response","Status","Error","unpipe","AfcService","vendDocuments","timeout","B","resolve","reject","once","setTimeout","_default","default"],"sources":["../../../lib/house-arrest/index.js"],"sourcesContent":["import PlistServiceDecoder from '../plist-service/transformer/plist-service-decoder';\nimport PlistServiceEncoder from '../plist-service/transformer/plist-service-encoder';\nimport LengthBasedSplitter from '../util/transformer/length-based-splitter';\nimport { KB } from '../constants';\nimport AfcService from '../afc';\nimport B from 'bluebird';\nimport { BaseServiceSocket } from '../base-service';\n\n\nconst HOUSE_ARREST_SERVICE_NAME = 'com.apple.mobile.house_arrest';\nconst MAX_FRAME_SIZE = 1 * KB;\n\nclass HouseArrestService extends BaseServiceSocket {\n  constructor (socketClient) {\n    super(socketClient);\n\n    this._decoder = new PlistServiceDecoder();\n    this._splitter = new LengthBasedSplitter({\n      readableStream: socketClient,\n      littleEndian: false,\n      maxFrameLength: MAX_FRAME_SIZE,\n      lengthFieldOffset: 0,\n      lengthFieldLength: 4,\n      lengthAdjustment: 4,\n    });\n    this._socketClient.pipe(this._splitter).pipe(this._decoder);\n\n    this._encoder = new PlistServiceEncoder();\n    this._encoder.pipe(this._socketClient);\n    this._assignClientFailureHandlers(this._encoder);\n  }\n\n  /**\n   * Vends into the application container and returns an AfcService\n   * @param {string} bundleId The bundle id of the app container that we will enter to\n   * @throws Will throw an error if house arrest fails to access the application's container\n   * @returns {AfcService}\n   */\n  async vendContainer (bundleId) {\n    const responsePromise = this._receivePlistPromise();\n    this._encoder.write({\n      Command: 'VendContainer',\n      Identifier: bundleId,\n    });\n    const response = await responsePromise;\n    if (response.Status !== 'Complete') {\n      throw new Error(`Failed to vend into the application container. Error: ${response.Error}`);\n    }\n    this._socketClient.unpipe(this._splitter);\n    this._splitter.unpipe(this._decoder);\n    return new AfcService(this._socketClient);\n  }\n\n  /**\n   * Vends into the application documents and returns an AfcService\n   * @param {string} bundleId The bundle id of the app documents that we will enter to\n   * @throws Will throw an error if house arrest fails to access the application's documents\n   * @returns {AfcService}\n   */\n  async vendDocuments (bundleId) {\n    const responsePromise = this._receivePlistPromise();\n    this._encoder.write({\n      Command: 'VendDocuments',\n      Identifier: bundleId,\n    });\n    const response = await responsePromise;\n    if (response.Status !== 'Complete') {\n      throw new Error(`Failed to vend into the application documents. Error: ${response.Error}`);\n    }\n    this._socketClient.unpipe(this._splitter);\n    this._splitter.unpipe(this._decoder);\n    return new AfcService(this._socketClient);\n  }\n\n  _receivePlistPromise (timeout = 10000) {\n    return new B((resolve, reject) => {\n      this._decoder.once('data', resolve);\n      setTimeout(() => reject(new Error(`Failed to receive any data within the timeout: ${timeout}`)), timeout);\n    });\n  }\n}\n\nexport { HouseArrestService, HOUSE_ARREST_SERVICE_NAME };\nexport default HouseArrestService;\n"],"mappings":"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"}