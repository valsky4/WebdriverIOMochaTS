"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.FLAG_TYPES = exports.DTX_MESSAGE_PAYLOAD_HEADER_LENGTH = exports.DTX_MESSAGE_HEADER_MAGIC_LEN = exports.DTX_MESSAGE_HEADER_MAGIC = exports.DTX_MESSAGE_HEADER_LENGTH = exports.DTXMessagePayloadHeader = exports.DTXMessageHeader = exports.DTXMessageAuxBuffer = exports.DTXMessageAux = exports.DTXMessage = void 0;
require("source-map-support/register");
var _nskeyed = require("./transformer/nskeyed");
var _bplistParser = _interopRequireDefault(require("bplist-parser"));
var _lodash = _interopRequireDefault(require("lodash"));
const DTX_MESSAGE_PAYLOAD_HEADER_LENGTH = 16;
exports.DTX_MESSAGE_PAYLOAD_HEADER_LENGTH = DTX_MESSAGE_PAYLOAD_HEADER_LENGTH;
const DTX_MESSAGE_HEADER_LENGTH = 32;
exports.DTX_MESSAGE_HEADER_LENGTH = DTX_MESSAGE_HEADER_LENGTH;
const DTX_MESSAGE_HEADER_MAGIC = 0x1F3D5B79;
exports.DTX_MESSAGE_HEADER_MAGIC = DTX_MESSAGE_HEADER_MAGIC;
const DTX_MESSAGE_HEADER_MAGIC_LEN = 4;
exports.DTX_MESSAGE_HEADER_MAGIC_LEN = DTX_MESSAGE_HEADER_MAGIC_LEN;
const DTX_MESSAGE_AUX_HEADER = 0x01F0;
const DTX_AUXILIARY_MAGIC = 0xa;
const FLAG_TYPES = Object.freeze({
  push: 0,
  recv: 1,
  send: 2,
  reply: 3
});
exports.FLAG_TYPES = FLAG_TYPES;
const AUX_TYPES = Object.freeze({
  Text: 1,
  NSKeyed: 2,
  UInt32LE: 3,
  BigUInt64LE: 4,
  BigInt64LE: 6
});
class DTXMessageHeader {
  static build(data) {
    const messageHeader = Buffer.alloc(DTX_MESSAGE_HEADER_LENGTH);
    messageHeader.writeUInt32LE(DTX_MESSAGE_HEADER_MAGIC, 0);
    messageHeader.writeUInt32LE(DTX_MESSAGE_HEADER_LENGTH, 4);
    messageHeader.writeUInt16LE(0, 8);
    messageHeader.writeUInt16LE(1, 10);
    messageHeader.writeUInt32LE(data.payloadLength, 12);
    messageHeader.writeUInt32LE(data.identifier, 16);
    messageHeader.writeUInt32LE(data.conversationIndex, 20);
    messageHeader.writeUInt32LE(data.channelCode, 24);
    messageHeader.writeUInt32LE(data.expectsReply, 28);
    return messageHeader;
  }
  static parse(headerBuffer) {
    return {
      magic: headerBuffer.readUInt32LE(0),
      headerLength: headerBuffer.readUInt32LE(4),
      fragmentId: headerBuffer.readUInt16LE(8),
      fragmentCount: headerBuffer.readUInt16LE(10),
      payloadLength: headerBuffer.readUInt32LE(12),
      identifier: headerBuffer.readUInt32LE(16),
      conversationIndex: headerBuffer.readUInt32LE(20),
      channel: headerBuffer.readUInt32LE(24),
      expectsReply: headerBuffer.readUInt32LE(28)
    };
  }
}
exports.DTXMessageHeader = DTXMessageHeader;
class DTXMessagePayloadHeader {
  static build(data) {
    const messageHeader = Buffer.alloc(DTX_MESSAGE_PAYLOAD_HEADER_LENGTH);
    messageHeader.writeUInt32LE(data.flags, 0);
    messageHeader.writeUInt32LE(data.auxLength, 4);
    messageHeader.writeBigUInt64LE(data.totalLength, 8);
    return messageHeader;
  }
  static parse(headerBuffer) {
    return {
      flags: headerBuffer.readUInt32LE(0),
      auxLength: headerBuffer.readUInt32LE(4),
      totalLength: headerBuffer.readBigInt64LE(8)
    };
  }
}
exports.DTXMessagePayloadHeader = DTXMessagePayloadHeader;
class DTXMessageAux {
  constructor(data = []) {
    this.data = data;
  }
  build() {
    const messageAux = new DTXMessageAuxBuffer();
    let buf = Buffer.alloc(0);
    if (this.data.length === 0) {
      return buf;
    }
    for (const arg of this.data) {
      if (arg instanceof DTXMessageAuxBuffer) {
        buf = Buffer.concat([buf, arg.getBytes()]);
      } else if (_lodash.default.isNumber(arg)) {
        messageAux.appendInt(arg);
      } else if (typeof arg == 'bigint') {
        messageAux.appendLong(arg);
      } else {
        messageAux.appendObject(arg);
      }
    }
    return Buffer.concat([buf, messageAux.getBytes()]);
  }
  static parse(headerBuffer, payloadHeader) {
    let cursor = 0;
    const data = [];
    const length = headerBuffer.readBigInt64LE(8);
    cursor += 16;
    while (cursor <= length) {
      if (payloadHeader.flags !== FLAG_TYPES.push) {
        const m = headerBuffer.readUInt32LE(cursor);
        cursor += 4;
        if (m !== DTX_AUXILIARY_MAGIC) {
          throw new Error(`incorrect auxiliary magic: ${m}`);
        }
      }
      const type = headerBuffer.readUInt32LE(cursor);
      cursor += 4;
      switch (type) {
        case AUX_TYPES.Text:
          {
            const strLen = headerBuffer.readUInt32LE(cursor);
            cursor += 4;
            data.push(headerBuffer.slice(cursor, cursor + strLen));
            cursor += strLen;
            break;
          }
        case AUX_TYPES.NSKeyed:
          {
            const strLen = headerBuffer.readUInt32LE(cursor);
            cursor += 4;
            const archived_data = headerBuffer.slice(cursor, cursor + strLen);
            data.push((0, _nskeyed.unarchive)(archived_data));
            cursor += strLen;
            break;
          }
        case AUX_TYPES.UInt32LE:
          data.push(headerBuffer.readUInt32LE(cursor));
          cursor += 4;
          break;
        case AUX_TYPES.BigUInt64LE:
          data.push(headerBuffer.readBigUInt64LE(cursor));
          cursor += 8;
          break;
        case AUX_TYPES.BigInt64LE:
          data.push(headerBuffer.readBigInt64LE(cursor));
          cursor += 8;
          break;
        default:
          throw new Error(`Unknown type ${type}`);
      }
    }
    return data;
  }
}
exports.DTXMessageAux = DTXMessageAux;
class InstrumentRPCParseError {
  constructor(data) {
    this.data = data;
  }
}
class DTXMessageAuxBuffer {
  constructor() {
    this._buf = Buffer.alloc(0);
  }
  appendInt(value) {
    const buf = Buffer.alloc(12);
    buf.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf.writeUInt32LE(3, 4);
    buf.writeUInt32LE(value, 8);
    this._buf = Buffer.concat([this._buf, buf]);
  }
  appendLong(value) {
    const buf = Buffer.alloc(16);
    buf.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf.writeUInt32LE(4, 4);
    buf.writeBigUInt64LE(value, 8);
    this._buf = Buffer.concat([this._buf, buf]);
  }
  appendSignedInt(value) {
    const buf = Buffer.alloc(12);
    buf.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf.writeUInt32LE(3, 4);
    buf.writeInt32LE(value, 8);
    this._buf = Buffer.concat([this._buf, buf]);
  }
  appendSignedLong(value) {
    const buf = Buffer.alloc(16);
    buf.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf.writeUInt32LE(6, 4);
    buf.writeBigInt64LE(value, 8);
    this._buf = Buffer.concat([this._buf, buf]);
  }
  appendObject(value) {
    const buf = (0, _nskeyed.archive)(value);
    const buf2 = Buffer.alloc(12);
    buf2.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf2.writeUInt32LE(2, 4);
    buf2.writeUInt32LE(buf.length, 8);
    this._buf = Buffer.concat([this._buf, buf2, buf]);
  }
  getBytes() {
    const out = Buffer.alloc(16);
    out.writeUInt32LE(DTX_MESSAGE_AUX_HEADER, 0);
    out.writeUInt32LE(this._buf.length, 8);
    return Buffer.concat([out, this._buf]);
  }
}
exports.DTXMessageAuxBuffer = DTXMessageAuxBuffer;
class DTXMessage {
  constructor(opts = {}) {
    const {
      identifier,
      channelCode,
      selector,
      expectsReply,
      conversationIndex = 0,
      flags = FLAG_TYPES.send
    } = opts;
    this._messageHeader = undefined;
    this._payloadHeader = undefined;
    this._identifier = identifier;
    this._channelCode = channelCode;
    this._expectsReply = expectsReply;
    this._selector = selector;
    this._conversationIndex = conversationIndex;
    this._flags = flags;
    this.auxiliaries = new DTXMessageAux();
  }
  get identifier() {
    var _this$_messageHeader;
    return (_this$_messageHeader = this._messageHeader) === null || _this$_messageHeader === void 0 ? void 0 : _this$_messageHeader.identifier;
  }
  get channelCode() {
    var _this$_messageHeader2;
    return (_this$_messageHeader2 = this._messageHeader) === null || _this$_messageHeader2 === void 0 ? void 0 : _this$_messageHeader2.channel;
  }
  get expectsReply() {
    var _this$_messageHeader3;
    return (_this$_messageHeader3 = this._messageHeader) === null || _this$_messageHeader3 === void 0 ? void 0 : _this$_messageHeader3.expectsReply;
  }
  get selector() {
    return this._selector;
  }
  set selector(data) {
    this._selector = data;
  }
  get conversationIndex() {
    var _this$_messageHeader4;
    return (_this$_messageHeader4 = this._messageHeader) === null || _this$_messageHeader4 === void 0 ? void 0 : _this$_messageHeader4.conversationIndex;
  }
  build() {
    const sel = this._selector ? (0, _nskeyed.archive)(this._selector) : Buffer.alloc(0);
    const aux = this.auxiliaries.build();
    const payloadHeader = DTXMessagePayloadHeader.build({
      flags: this._flags,
      auxLength: aux.length,
      totalLength: BigInt(aux.length + sel.length)
    });
    const messageHeader = DTXMessageHeader.build({
      payloadLength: DTX_MESSAGE_PAYLOAD_HEADER_LENGTH + aux.length + sel.length,
      identifier: this._identifier,
      conversationIndex: this._conversationIndex,
      channelCode: this._channelCode,
      expectsReply: this._expectsReply
    });
    return Buffer.concat([messageHeader, payloadHeader, aux, sel]);
  }
  static parse(headerBuf, payloadBuf) {
    let cursor = 0;
    const ret = new DTXMessage();
    ret._messageHeader = DTXMessageHeader.parse(headerBuf);
    if (ret._messageHeader.payloadLength === 0) {
      return ret;
    }
    ret._payloadHeader = DTXMessagePayloadHeader.parse(payloadBuf.slice(cursor, DTX_MESSAGE_PAYLOAD_HEADER_LENGTH));
    cursor += DTX_MESSAGE_PAYLOAD_HEADER_LENGTH;
    if (ret._payloadHeader.totalLength === 0n) {
      return ret;
    }
    if (ret._payloadHeader.auxLength > 0) {
      ret.auxiliaries = DTXMessageAux.parse(payloadBuf.slice(cursor, cursor + ret._payloadHeader.auxLength), ret._payloadHeader);
      cursor += ret._payloadHeader.auxLength;
    }
    const data = payloadBuf.slice(cursor, cursor + payloadBuf.length);
    ret.selector = data;
    if (data.length > 0) {
      for (const fun of [_nskeyed.unarchive, _bplistParser.default.parseBuffer]) {
        try {
          ret.selector = fun(data);
          break;
        } catch (e) {
          ret.selector = new InstrumentRPCParseError(data);
        }
      }
    }
    return ret;
  }
}
exports.DTXMessage = DTXMessage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbnNrZXllZCIsInJlcXVpcmUiLCJfYnBsaXN0UGFyc2VyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9sb2Rhc2giLCJEVFhfTUVTU0FHRV9QQVlMT0FEX0hFQURFUl9MRU5HVEgiLCJleHBvcnRzIiwiRFRYX01FU1NBR0VfSEVBREVSX0xFTkdUSCIsIkRUWF9NRVNTQUdFX0hFQURFUl9NQUdJQyIsIkRUWF9NRVNTQUdFX0hFQURFUl9NQUdJQ19MRU4iLCJEVFhfTUVTU0FHRV9BVVhfSEVBREVSIiwiRFRYX0FVWElMSUFSWV9NQUdJQyIsIkZMQUdfVFlQRVMiLCJPYmplY3QiLCJmcmVlemUiLCJwdXNoIiwicmVjdiIsInNlbmQiLCJyZXBseSIsIkFVWF9UWVBFUyIsIlRleHQiLCJOU0tleWVkIiwiVUludDMyTEUiLCJCaWdVSW50NjRMRSIsIkJpZ0ludDY0TEUiLCJEVFhNZXNzYWdlSGVhZGVyIiwiYnVpbGQiLCJkYXRhIiwibWVzc2FnZUhlYWRlciIsIkJ1ZmZlciIsImFsbG9jIiwid3JpdGVVSW50MzJMRSIsIndyaXRlVUludDE2TEUiLCJwYXlsb2FkTGVuZ3RoIiwiaWRlbnRpZmllciIsImNvbnZlcnNhdGlvbkluZGV4IiwiY2hhbm5lbENvZGUiLCJleHBlY3RzUmVwbHkiLCJwYXJzZSIsImhlYWRlckJ1ZmZlciIsIm1hZ2ljIiwicmVhZFVJbnQzMkxFIiwiaGVhZGVyTGVuZ3RoIiwiZnJhZ21lbnRJZCIsInJlYWRVSW50MTZMRSIsImZyYWdtZW50Q291bnQiLCJjaGFubmVsIiwiRFRYTWVzc2FnZVBheWxvYWRIZWFkZXIiLCJmbGFncyIsImF1eExlbmd0aCIsIndyaXRlQmlnVUludDY0TEUiLCJ0b3RhbExlbmd0aCIsInJlYWRCaWdJbnQ2NExFIiwiRFRYTWVzc2FnZUF1eCIsImNvbnN0cnVjdG9yIiwibWVzc2FnZUF1eCIsIkRUWE1lc3NhZ2VBdXhCdWZmZXIiLCJidWYiLCJsZW5ndGgiLCJhcmciLCJjb25jYXQiLCJnZXRCeXRlcyIsIl8iLCJpc051bWJlciIsImFwcGVuZEludCIsImFwcGVuZExvbmciLCJhcHBlbmRPYmplY3QiLCJwYXlsb2FkSGVhZGVyIiwiY3Vyc29yIiwibSIsIkVycm9yIiwidHlwZSIsInN0ckxlbiIsInNsaWNlIiwiYXJjaGl2ZWRfZGF0YSIsInVuYXJjaGl2ZSIsInJlYWRCaWdVSW50NjRMRSIsIkluc3RydW1lbnRSUENQYXJzZUVycm9yIiwiX2J1ZiIsInZhbHVlIiwiYXBwZW5kU2lnbmVkSW50Iiwid3JpdGVJbnQzMkxFIiwiYXBwZW5kU2lnbmVkTG9uZyIsIndyaXRlQmlnSW50NjRMRSIsImFyY2hpdmUiLCJidWYyIiwib3V0IiwiRFRYTWVzc2FnZSIsIm9wdHMiLCJzZWxlY3RvciIsIl9tZXNzYWdlSGVhZGVyIiwidW5kZWZpbmVkIiwiX3BheWxvYWRIZWFkZXIiLCJfaWRlbnRpZmllciIsIl9jaGFubmVsQ29kZSIsIl9leHBlY3RzUmVwbHkiLCJfc2VsZWN0b3IiLCJfY29udmVyc2F0aW9uSW5kZXgiLCJfZmxhZ3MiLCJhdXhpbGlhcmllcyIsIl90aGlzJF9tZXNzYWdlSGVhZGVyIiwiX3RoaXMkX21lc3NhZ2VIZWFkZXIyIiwiX3RoaXMkX21lc3NhZ2VIZWFkZXIzIiwiX3RoaXMkX21lc3NhZ2VIZWFkZXI0Iiwic2VsIiwiYXV4IiwiQmlnSW50IiwiaGVhZGVyQnVmIiwicGF5bG9hZEJ1ZiIsInJldCIsImZ1biIsInBsaXN0bGliIiwicGFyc2VCdWZmZXIiLCJlIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2luc3RydW1lbnQvaGVhZGVycy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2FyY2hpdmUsIHVuYXJjaGl2ZX0gZnJvbSAnLi90cmFuc2Zvcm1lci9uc2tleWVkJztcbmltcG9ydCBwbGlzdGxpYiBmcm9tICdicGxpc3QtcGFyc2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmNvbnN0IERUWF9NRVNTQUdFX1BBWUxPQURfSEVBREVSX0xFTkdUSCA9IDE2O1xuY29uc3QgRFRYX01FU1NBR0VfSEVBREVSX0xFTkdUSCA9IDMyO1xuY29uc3QgRFRYX01FU1NBR0VfSEVBREVSX01BR0lDID0gMHgxRjNENUI3OTtcbmNvbnN0IERUWF9NRVNTQUdFX0hFQURFUl9NQUdJQ19MRU4gPSA0O1xuY29uc3QgRFRYX01FU1NBR0VfQVVYX0hFQURFUiA9IDB4MDFGMDtcbmNvbnN0IERUWF9BVVhJTElBUllfTUFHSUMgPSAweGE7XG5cbmNvbnN0IEZMQUdfVFlQRVMgPSBPYmplY3QuZnJlZXplKHtcbiAgcHVzaDogMCxcbiAgcmVjdjogMSxcbiAgc2VuZDogMixcbiAgcmVwbHk6IDNcbn0pO1xuXG5jb25zdCBBVVhfVFlQRVMgPSBPYmplY3QuZnJlZXplKHtcbiAgVGV4dDogMSxcbiAgTlNLZXllZDogMixcbiAgVUludDMyTEU6IDMsXG4gIEJpZ1VJbnQ2NExFOiA0LFxuICBCaWdJbnQ2NExFOiA2XG59KTtcblxuLyoqXG4gKiBEVFhNZXNzYWdlSGVhZGVyIGxlbmd0aCAzMlxuICogc3RydWN0IERUWE1lc3NhZ2VIZWFkZXIge1xuICogICAgIHUzMiBtYWdpYyBEVFhfTUVTU0FHRV9IRUFERVJfTUFHSUNcbiAqICAgICB1MzIgaGVhZGVyTGVuZ3RoXG4gKiAgICAgdTE2IGZyYWdtZW50SWQgICBwYWNrZXQgbnVtYmVyXG4gKiAgICAgdTE2IGZyYWdtZW50Q291bnQgIHBhY2tldHMgdG90YWwgbnVtYmVyXG4gKiAgICAgdTMyIHBheWxvYWRMZW5ndGhcbiAqICAgICB1MzIgaWRlbnRpZmllclxuICogICAgIHUzMiBjb252ZXJzYXRpb25JbmRleFxuICogICAgIHUzMiBjaGFubmVsXG4gKiAgICAgdTMyIGV4cGVjdHNSZXBseVxuICogICAgIH1cbiAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IERUWE1lc3NhZ2VPcHRpb25zXG4gKiBAcHJvcGVydHkge251bWJlcn0gaWRlbnRpZmllciBwYWNrZXQgdHJhbnNtaXNzaW9uIHNlcXVlbmNlLCB0aGlzIHZhbHVlIGlzIGluY3JlbWVudGVkIGZvciBlYWNoIHJlcXVlc3RcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBjaGFubmVsQ29kZSB0aGUgZGF0YSB0cmFuc21pc3Npb24gb2YgdGhlIHNlcnZpY2Ugd2lsbCB1c2UgdGhpcyBjaGFubmVsIGNvZGUuXG4gKiBFYWNoIHNlcnZpY2UgaGFzIGEgc2VwYXJhdGUgY2hhbm5lbFxuICogQHByb3BlcnR5IHs/bnVtYmVyfSBwYXlsb2FkTGVuZ3RoIERUWE1lc3NhZ2VBdXhCdWZmZXIubGVuZ3RoKG51bGxhYmxlKSArIHNlbGVjdG9yQnVmZmVyLmxlbmd0aChudWxsYWJsZSlcbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gZXhwZWN0c1JlcGx5IGlmIHRydWUgcmVwbHkgYSBhY2sgbWVzc2FnZVxuICogQHByb3BlcnR5IHtudW1iZXJ9IGNvbnZlcnNhdGlvbkluZGV4ICByYXcgZGF0YSArMSBpbmRpY2F0ZSBhIHJlcGx5IG1lc3NhZ2VcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBmbGFncyBtZXNzYWdlIHN0YXR1c1xuICovXG5cbmNsYXNzIERUWE1lc3NhZ2VIZWFkZXIge1xuICAvKipcbiAgICogQHBhcmFtIHtEVFhNZXNzYWdlT3B0aW9uc30gZGF0YVxuICAgKiBAcmV0dXJucyB7QnVmZmVyfSBEVFhNZXNzYWdlSGVhZGVyQnVmZmVyXG4gICAqL1xuICBzdGF0aWMgYnVpbGQgKGRhdGEpIHtcbiAgICBjb25zdCBtZXNzYWdlSGVhZGVyID0gQnVmZmVyLmFsbG9jKERUWF9NRVNTQUdFX0hFQURFUl9MRU5HVEgpO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVVSW50MzJMRShEVFhfTUVTU0FHRV9IRUFERVJfTUFHSUMsIDApO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVVSW50MzJMRShEVFhfTUVTU0FHRV9IRUFERVJfTEVOR1RILCA0KTtcbiAgICBtZXNzYWdlSGVhZGVyLndyaXRlVUludDE2TEUoMCwgOCk7XG4gICAgbWVzc2FnZUhlYWRlci53cml0ZVVJbnQxNkxFKDEsIDEwKTtcbiAgICBtZXNzYWdlSGVhZGVyLndyaXRlVUludDMyTEUoZGF0YS5wYXlsb2FkTGVuZ3RoLCAxMik7XG4gICAgbWVzc2FnZUhlYWRlci53cml0ZVVJbnQzMkxFKGRhdGEuaWRlbnRpZmllciwgMTYpO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVVSW50MzJMRShkYXRhLmNvbnZlcnNhdGlvbkluZGV4LCAyMCk7XG4gICAgbWVzc2FnZUhlYWRlci53cml0ZVVJbnQzMkxFKGRhdGEuY2hhbm5lbENvZGUsIDI0KTtcbiAgICBtZXNzYWdlSGVhZGVyLndyaXRlVUludDMyTEUoZGF0YS5leHBlY3RzUmVwbHksIDI4KTtcbiAgICByZXR1cm4gbWVzc2FnZUhlYWRlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0gaGVhZGVyQnVmZmVyIERUWE1lc3NhZ2VIZWFkZXJCdWZmZXJcbiAgICogQHJldHVybnMge09iamVjdH1cbiAgICovXG4gIHN0YXRpYyBwYXJzZSAoaGVhZGVyQnVmZmVyKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1hZ2ljOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDApLFxuICAgICAgaGVhZGVyTGVuZ3RoOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDQpLFxuICAgICAgZnJhZ21lbnRJZDogaGVhZGVyQnVmZmVyLnJlYWRVSW50MTZMRSg4KSxcbiAgICAgIGZyYWdtZW50Q291bnQ6IGhlYWRlckJ1ZmZlci5yZWFkVUludDE2TEUoMTApLFxuICAgICAgcGF5bG9hZExlbmd0aDogaGVhZGVyQnVmZmVyLnJlYWRVSW50MzJMRSgxMiksXG4gICAgICBpZGVudGlmaWVyOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDE2KSxcbiAgICAgIGNvbnZlcnNhdGlvbkluZGV4OiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDIwKSxcbiAgICAgIGNoYW5uZWw6IGhlYWRlckJ1ZmZlci5yZWFkVUludDMyTEUoMjQpLFxuICAgICAgZXhwZWN0c1JlcGx5OiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDI4KSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogRFRYTWVzc2FnZVBheWxvYWRIZWFkZXIgbGVuZ3RoIDE2XG4gKiBzdHJ1Y3QgRFRYTWVzc2FnZUhlYWRlciB7XG4gKiAgICAgdTMyIGZsYWdzIEZMQUdfVFlQRVNcbiAqICAgICB1MzIgYXV4TGVuZ3RoXG4gKiAgICAgdTY0IHRvdGFsTGVuZ3RoXG4gKiAgICAgfVxuICovXG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gRFRYTWVzc2FnZVBheWxvYWRIZWFkZXJPYmplY3RcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBmbGFncyBtZXNzYWdlIHN0YXR1c1xuICogQHByb3BlcnR5IHtudW1iZXJ9IGF1eExlbmd0aCBEVFhNZXNzYWdlQXV4QnVmZmVyLmxlbmd0aChudWxsYWJsZSlcbiAqIEBwcm9wZXJ0eSB7YmlnaW50fSB0b3RhbExlbmd0aCBEVFhNZXNzYWdlQXV4QnVmZmVyLmxlbmd0aChudWxsYWJsZSkgKyBzZWxlY3RvckJ1ZmZlci5sZW5ndGhcbiAqL1xuY2xhc3MgRFRYTWVzc2FnZVBheWxvYWRIZWFkZXIge1xuICAvKipcbiAgICogQHBhcmFtIGRhdGEge0RUWE1lc3NhZ2VQYXlsb2FkSGVhZGVyT2JqZWN0fVxuICAgKiBAcmV0dXJucyB7QnVmZmVyfSBEVFhNZXNzYWdlUGF5bG9hZEhlYWRlckJ1ZmZlclxuICAgKi9cbiAgc3RhdGljIGJ1aWxkIChkYXRhKSB7XG4gICAgY29uc3QgbWVzc2FnZUhlYWRlciA9IEJ1ZmZlci5hbGxvYyhEVFhfTUVTU0FHRV9QQVlMT0FEX0hFQURFUl9MRU5HVEgpO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVVSW50MzJMRShkYXRhLmZsYWdzLCAwKTtcbiAgICBtZXNzYWdlSGVhZGVyLndyaXRlVUludDMyTEUoZGF0YS5hdXhMZW5ndGgsIDQpO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVCaWdVSW50NjRMRShkYXRhLnRvdGFsTGVuZ3RoLCA4KTtcbiAgICByZXR1cm4gbWVzc2FnZUhlYWRlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0gaGVhZGVyQnVmZmVyXG4gICAqIEByZXR1cm5zIHtEVFhNZXNzYWdlUGF5bG9hZEhlYWRlck9iamVjdH1cbiAgICovXG4gIHN0YXRpYyBwYXJzZSAoaGVhZGVyQnVmZmVyKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGZsYWdzOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDApLFxuICAgICAgYXV4TGVuZ3RoOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDQpLFxuICAgICAgdG90YWxMZW5ndGg6IGhlYWRlckJ1ZmZlci5yZWFkQmlnSW50NjRMRSg4KVxuICAgIH07XG4gIH1cbn1cblxuXG5jbGFzcyBEVFhNZXNzYWdlQXV4IHtcbiAgY29uc3RydWN0b3IgKGRhdGEgPSBbXSkge1xuICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gIH1cblxuICAvKipcbiAgICogSlMgQXJyYXkgdG8gQXBwbGUgTlNLZXllZCBCdWZmZXJcbiAgICogQHJldHVybnMge0J1ZmZlcn1cbiAgICovXG4gIGJ1aWxkICgpIHtcbiAgICBjb25zdCBtZXNzYWdlQXV4ID0gbmV3IERUWE1lc3NhZ2VBdXhCdWZmZXIoKTtcbiAgICBsZXQgYnVmID0gQnVmZmVyLmFsbG9jKDApO1xuICAgIGlmICh0aGlzLmRhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gYnVmO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGFyZyBvZiB0aGlzLmRhdGEpIHtcbiAgICAgIGlmIChhcmcgaW5zdGFuY2VvZiBEVFhNZXNzYWdlQXV4QnVmZmVyKSB7XG4gICAgICAgIGJ1ZiA9IEJ1ZmZlci5jb25jYXQoW2J1ZiwgYXJnLmdldEJ5dGVzKCldKTtcbiAgICAgIH0gZWxzZSBpZiAoXy5pc051bWJlcihhcmcpKSB7XG4gICAgICAgIG1lc3NhZ2VBdXguYXBwZW5kSW50KGFyZyk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmcgPT0gJ2JpZ2ludCcpIHtcbiAgICAgICAgbWVzc2FnZUF1eC5hcHBlbmRMb25nKGFyZyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtZXNzYWdlQXV4LmFwcGVuZE9iamVjdChhcmcpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gQnVmZmVyLmNvbmNhdChbYnVmLCBtZXNzYWdlQXV4LmdldEJ5dGVzKCldKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZXMgbnNrZXllZCBCdWZmZXIgaW50byBqcyBhcnJheVxuICAgKiBAcGFyYW0ge0J1ZmZlcn0gaGVhZGVyQnVmZmVyXG4gICAqIEBwYXJhbSB7RFRYTWVzc2FnZVBheWxvYWRIZWFkZXJPYmplY3R9IHBheWxvYWRIZWFkZXJcbiAgICogQHJldHVybnMge0FycmF5fVxuICAgKi9cbiAgc3RhdGljIHBhcnNlIChoZWFkZXJCdWZmZXIsIHBheWxvYWRIZWFkZXIpIHtcbiAgICBsZXQgY3Vyc29yID0gMDtcbiAgICBjb25zdCBkYXRhID0gW107XG4gICAgY29uc3QgbGVuZ3RoID0gaGVhZGVyQnVmZmVyLnJlYWRCaWdJbnQ2NExFKDgpO1xuICAgIGN1cnNvciArPSAxNjtcbiAgICB3aGlsZSAoY3Vyc29yIDw9IGxlbmd0aCkge1xuICAgICAgaWYgKHBheWxvYWRIZWFkZXIuZmxhZ3MgIT09IEZMQUdfVFlQRVMucHVzaCkge1xuICAgICAgICBjb25zdCBtID0gaGVhZGVyQnVmZmVyLnJlYWRVSW50MzJMRShjdXJzb3IpO1xuICAgICAgICBjdXJzb3IgKz0gNDtcbiAgICAgICAgaWYgKG0gIT09IERUWF9BVVhJTElBUllfTUFHSUMpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGluY29ycmVjdCBhdXhpbGlhcnkgbWFnaWM6ICR7bX1gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3QgdHlwZSA9IGhlYWRlckJ1ZmZlci5yZWFkVUludDMyTEUoY3Vyc29yKTtcbiAgICAgIGN1cnNvciArPSA0O1xuICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgIGNhc2UgQVVYX1RZUEVTLlRleHQ6IHtcbiAgICAgICAgICBjb25zdCBzdHJMZW4gPSBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKGN1cnNvcik7XG4gICAgICAgICAgY3Vyc29yICs9IDQ7XG4gICAgICAgICAgZGF0YS5wdXNoKGhlYWRlckJ1ZmZlci5zbGljZShjdXJzb3IsIGN1cnNvciArIHN0ckxlbikpO1xuICAgICAgICAgIGN1cnNvciArPSBzdHJMZW47XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBBVVhfVFlQRVMuTlNLZXllZDoge1xuICAgICAgICAgIGNvbnN0IHN0ckxlbiA9IGhlYWRlckJ1ZmZlci5yZWFkVUludDMyTEUoY3Vyc29yKTtcbiAgICAgICAgICBjdXJzb3IgKz0gNDtcbiAgICAgICAgICBjb25zdCBhcmNoaXZlZF9kYXRhID0gaGVhZGVyQnVmZmVyLnNsaWNlKGN1cnNvciwgY3Vyc29yICsgc3RyTGVuKTtcbiAgICAgICAgICBkYXRhLnB1c2godW5hcmNoaXZlKGFyY2hpdmVkX2RhdGEpKTtcbiAgICAgICAgICBjdXJzb3IgKz0gc3RyTGVuO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgQVVYX1RZUEVTLlVJbnQzMkxFOlxuICAgICAgICAgIGRhdGEucHVzaChoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKGN1cnNvcikpO1xuICAgICAgICAgIGN1cnNvciArPSA0O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEFVWF9UWVBFUy5CaWdVSW50NjRMRTpcbiAgICAgICAgICBkYXRhLnB1c2goaGVhZGVyQnVmZmVyLnJlYWRCaWdVSW50NjRMRShjdXJzb3IpKTtcbiAgICAgICAgICBjdXJzb3IgKz0gODtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBVVhfVFlQRVMuQmlnSW50NjRMRTpcbiAgICAgICAgICBkYXRhLnB1c2goaGVhZGVyQnVmZmVyLnJlYWRCaWdJbnQ2NExFKGN1cnNvcikpO1xuICAgICAgICAgIGN1cnNvciArPSA4O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biB0eXBlICR7dHlwZX1gKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cbn1cblxuY2xhc3MgSW5zdHJ1bWVudFJQQ1BhcnNlRXJyb3Ige1xuICBjb25zdHJ1Y3RvciAoZGF0YSkge1xuICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gIH1cbn1cblxuY2xhc3MgRFRYTWVzc2FnZUF1eEJ1ZmZlciB7XG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICB0aGlzLl9idWYgPSBCdWZmZXIuYWxsb2MoMCk7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlXG4gICAqL1xuICBhcHBlbmRJbnQgKHZhbHVlKSB7XG4gICAgY29uc3QgYnVmID0gQnVmZmVyLmFsbG9jKDEyKTtcbiAgICBidWYud3JpdGVVSW50MzJMRShEVFhfQVVYSUxJQVJZX01BR0lDLCAwKTtcbiAgICBidWYud3JpdGVVSW50MzJMRSgzLCA0KTtcbiAgICBidWYud3JpdGVVSW50MzJMRSh2YWx1ZSwgOCk7XG4gICAgdGhpcy5fYnVmID0gQnVmZmVyLmNvbmNhdChbdGhpcy5fYnVmLCBidWZdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge2JpZ2ludH0gdmFsdWVcbiAgICovXG4gIGFwcGVuZExvbmcgKHZhbHVlKSB7XG4gICAgY29uc3QgYnVmID0gQnVmZmVyLmFsbG9jKDE2KTtcbiAgICBidWYud3JpdGVVSW50MzJMRShEVFhfQVVYSUxJQVJZX01BR0lDLCAwKTtcbiAgICBidWYud3JpdGVVSW50MzJMRSg0LCA0KTtcbiAgICBidWYud3JpdGVCaWdVSW50NjRMRSh2YWx1ZSwgOCk7XG4gICAgdGhpcy5fYnVmID0gQnVmZmVyLmNvbmNhdChbdGhpcy5fYnVmLCBidWZdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWVcbiAgICovXG4gIGFwcGVuZFNpZ25lZEludCAodmFsdWUpIHtcbiAgICBjb25zdCBidWYgPSBCdWZmZXIuYWxsb2MoMTIpO1xuICAgIGJ1Zi53cml0ZVVJbnQzMkxFKERUWF9BVVhJTElBUllfTUFHSUMsIDApO1xuICAgIGJ1Zi53cml0ZVVJbnQzMkxFKDMsIDQpO1xuICAgIGJ1Zi53cml0ZUludDMyTEUodmFsdWUsIDgpO1xuICAgIHRoaXMuX2J1ZiA9IEJ1ZmZlci5jb25jYXQoW3RoaXMuX2J1ZiwgYnVmXSk7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtiaWdpbnR9IHZhbHVlXG4gICAqL1xuICBhcHBlbmRTaWduZWRMb25nICh2YWx1ZSkge1xuICAgIGNvbnN0IGJ1ZiA9IEJ1ZmZlci5hbGxvYygxNik7XG4gICAgYnVmLndyaXRlVUludDMyTEUoRFRYX0FVWElMSUFSWV9NQUdJQywgMCk7XG4gICAgYnVmLndyaXRlVUludDMyTEUoNiwgNCk7XG4gICAgYnVmLndyaXRlQmlnSW50NjRMRSh2YWx1ZSwgOCk7XG4gICAgdGhpcy5fYnVmID0gQnVmZmVyLmNvbmNhdChbdGhpcy5fYnVmLCBidWZdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge09iamVjdH0gdmFsdWVcbiAgICovXG4gIGFwcGVuZE9iamVjdCAodmFsdWUpIHtcbiAgICBjb25zdCBidWYgPSBhcmNoaXZlKHZhbHVlKTtcbiAgICBjb25zdCBidWYyID0gQnVmZmVyLmFsbG9jKDEyKTtcbiAgICBidWYyLndyaXRlVUludDMyTEUoRFRYX0FVWElMSUFSWV9NQUdJQywgMCk7XG4gICAgYnVmMi53cml0ZVVJbnQzMkxFKDIsIDQpO1xuICAgIGJ1ZjIud3JpdGVVSW50MzJMRShidWYubGVuZ3RoLCA4KTtcbiAgICB0aGlzLl9idWYgPSBCdWZmZXIuY29uY2F0KFt0aGlzLl9idWYsIGJ1ZjIsIGJ1Zl0pO1xuICB9XG5cbiAgZ2V0Qnl0ZXMgKCkge1xuICAgIGNvbnN0IG91dCA9IEJ1ZmZlci5hbGxvYygxNik7XG4gICAgb3V0LndyaXRlVUludDMyTEUoRFRYX01FU1NBR0VfQVVYX0hFQURFUiwgMCk7XG4gICAgb3V0LndyaXRlVUludDMyTEUodGhpcy5fYnVmLmxlbmd0aCwgOCk7XG4gICAgcmV0dXJuIEJ1ZmZlci5jb25jYXQoW291dCwgdGhpcy5fYnVmXSk7XG4gIH1cbn1cblxuXG5cbmNsYXNzIERUWE1lc3NhZ2Uge1xuICAvKipcbiAgICogQHBhcmFtIHtEVFhNZXNzYWdlT3B0aW9uc30gb3B0c1xuICAgKi9cbiAgY29uc3RydWN0b3IgKG9wdHMgPSB7fSkge1xuICAgIGNvbnN0IHtcbiAgICAgIGlkZW50aWZpZXIsXG4gICAgICBjaGFubmVsQ29kZSxcbiAgICAgIHNlbGVjdG9yLFxuICAgICAgZXhwZWN0c1JlcGx5LFxuICAgICAgY29udmVyc2F0aW9uSW5kZXggPSAwLFxuICAgICAgZmxhZ3MgPSBGTEFHX1RZUEVTLnNlbmRcbiAgICB9ID0gb3B0cztcbiAgICB0aGlzLl9tZXNzYWdlSGVhZGVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuX3BheWxvYWRIZWFkZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5faWRlbnRpZmllciA9IGlkZW50aWZpZXI7XG4gICAgdGhpcy5fY2hhbm5lbENvZGUgPSBjaGFubmVsQ29kZTtcbiAgICB0aGlzLl9leHBlY3RzUmVwbHkgPSBleHBlY3RzUmVwbHk7XG4gICAgdGhpcy5fc2VsZWN0b3IgPSBzZWxlY3RvcjtcbiAgICB0aGlzLl9jb252ZXJzYXRpb25JbmRleCA9IGNvbnZlcnNhdGlvbkluZGV4O1xuICAgIHRoaXMuX2ZsYWdzID0gZmxhZ3M7XG4gICAgdGhpcy5hdXhpbGlhcmllcyA9IG5ldyBEVFhNZXNzYWdlQXV4KCk7XG4gIH1cblxuICAvKipcbiAgICogZ2V0IERUWE1lc3NhZ2VIZWFkZXIgaWRlbnRpZmllci4gUGFja2V0IHRyYW5zbWlzc2lvbiBzZXF1ZW5jZVxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgKi9cbiAgZ2V0IGlkZW50aWZpZXIgKCkge1xuICAgIHJldHVybiB0aGlzLl9tZXNzYWdlSGVhZGVyPy5pZGVudGlmaWVyO1xuICB9XG5cbiAgLyoqXG4gICAqIGdldCBEVFhNZXNzYWdlSGVhZGVyIGNoYW5uZWxDb2RlLlxuICAgKiBQYWNrZXQgdHJhbnNtaXNzaW9uIGNoYW5uZWxDb2RlLiBVc2UgdGhpcyB2YWx1ZSB0byBkaXN0aW5ndWlzaCB3aGVuIHRoZXJlIGFyZSBtdWx0aXBsZSBjaGFubmVsc1xuICAgKiBjYWxsIHRoaXMgbWV0aG9kIGBJbnN0cnVtZW50U2VydmljZS5yZWdpc3RlckNoYW5uZWxDYWxsYmFja2AgZ2V0IHRoZSBjaGFubmVsIG1lc3NhZ2VcbiAgICogQHJldHVybnMge251bWJlcn1cbiAgICovXG4gIGdldCBjaGFubmVsQ29kZSAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21lc3NhZ2VIZWFkZXI/LmNoYW5uZWw7XG4gIH1cblxuICAvKipcbiAgICogZ2V0IERUWE1lc3NhZ2VIZWFkZXIgZXhwZWN0c1JlcGx5LiBXaGV0aGVyIHRvIG5lZWQgYWNrIG1lc3NhZ2VcbiAgICogaWYgZXhwZWN0c1JlcGx5IGlzIHRydWUgbXVzdCByZXBseSBhY2sgbWVzc2FnZVxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICovXG4gIGdldCBleHBlY3RzUmVwbHkgKCkge1xuICAgIHJldHVybiB0aGlzLl9tZXNzYWdlSGVhZGVyPy5leHBlY3RzUmVwbHk7XG4gIH1cblxuICAvKipcbiAgICogY2FsbCB0aGlzIG1ldGhvZCBgSW5zdHJ1bWVudFNlcnZpY2UucmVnaXN0ZXJTZWxlY3RvckNhbGxiYWNrYCBnZXQgdGhlIHNlbGVjdG9yIG1lc3NhZ2VcbiAgICogQHJldHVybnMgeyp9IFVua25vd24gZGF0YVxuICAgKi9cbiAgZ2V0IHNlbGVjdG9yICgpIHtcbiAgICByZXR1cm4gdGhpcy5fc2VsZWN0b3I7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIGRhdGFcbiAgICovXG4gIHNldCBzZWxlY3RvciAoZGF0YSkge1xuICAgIHRoaXMuX3NlbGVjdG9yID0gZGF0YTtcbiAgfVxuXG4gIC8qKlxuICAgKiBnZXQgRFRYTWVzc2FnZUhlYWRlciBjb252ZXJzYXRpb25JbmRleFxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgKi9cbiAgZ2V0IGNvbnZlcnNhdGlvbkluZGV4ICgpIHtcbiAgICByZXR1cm4gdGhpcy5fbWVzc2FnZUhlYWRlcj8uY29udmVyc2F0aW9uSW5kZXg7XG4gIH1cblxuICAvKipcbiAgICogRFRYTWVzc2FnZSBCdWZmZXI6IERUWE1lc3NhZ2VIZWFkZXIgKyBQYXlsb2FkSGVhZGVyICsgRFRYTWVzc2FnZUF1eEJ1ZmZlcihudWxsYWJsZSkgKyBzZWxlY3RvcihudWxsYWJsZSlcbiAgICogQHJldHVybnMge0J1ZmZlcn1cbiAgICovXG4gIGJ1aWxkICgpIHtcbiAgICBjb25zdCBzZWwgPSB0aGlzLl9zZWxlY3RvciA/IGFyY2hpdmUodGhpcy5fc2VsZWN0b3IpIDogQnVmZmVyLmFsbG9jKDApO1xuICAgIGNvbnN0IGF1eCA9IHRoaXMuYXV4aWxpYXJpZXMuYnVpbGQoKTtcbiAgICBjb25zdCBwYXlsb2FkSGVhZGVyID0gRFRYTWVzc2FnZVBheWxvYWRIZWFkZXIuYnVpbGQoe1xuICAgICAgZmxhZ3M6IHRoaXMuX2ZsYWdzLFxuICAgICAgYXV4TGVuZ3RoOiBhdXgubGVuZ3RoLFxuICAgICAgLy8gbmVlZCB0byBjb252ZXJ0IHRvIGJpZ2ludCBpbiBhbnkgY2FzZVxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVuZGVmXG4gICAgICB0b3RhbExlbmd0aDogQmlnSW50KGF1eC5sZW5ndGggKyBzZWwubGVuZ3RoKSxcbiAgICB9KTtcblxuICAgIGNvbnN0IG1lc3NhZ2VIZWFkZXIgPSBEVFhNZXNzYWdlSGVhZGVyLmJ1aWxkKHtcbiAgICAgIHBheWxvYWRMZW5ndGg6IERUWF9NRVNTQUdFX1BBWUxPQURfSEVBREVSX0xFTkdUSCArIGF1eC5sZW5ndGggKyBzZWwubGVuZ3RoLFxuICAgICAgaWRlbnRpZmllcjogdGhpcy5faWRlbnRpZmllcixcbiAgICAgIGNvbnZlcnNhdGlvbkluZGV4OiB0aGlzLl9jb252ZXJzYXRpb25JbmRleCxcbiAgICAgIGNoYW5uZWxDb2RlOiB0aGlzLl9jaGFubmVsQ29kZSxcbiAgICAgIGV4cGVjdHNSZXBseTogdGhpcy5fZXhwZWN0c1JlcGx5XG4gICAgfSk7XG4gICAgcmV0dXJuIEJ1ZmZlci5jb25jYXQoW21lc3NhZ2VIZWFkZXIsIHBheWxvYWRIZWFkZXIsIGF1eCwgc2VsXSk7XG4gIH1cblxuICAvKipcbiAgICogUGFyc2VzIERUWCBidWZmZXIgaW50byBhbiBqcyBvYmplY3QuIFJldHVybmVkIGluIERUWERlY29kZXIgU3RyZWFtLlRyYW5zZm9ybVxuICAgKiBAcGFyYW0ge0J1ZmZlcn0gaGVhZGVyQnVmICBEVFhNZXNzYWdlSGVhZGVyIGJ1ZmZlclxuICAgKiBAcGFyYW0ge0J1ZmZlcn0gcGF5bG9hZEJ1ZiAgUGF5bG9hZEhlYWRlckJ1ZmZlciArIERUWE1lc3NhZ2VBdXhCdWZmZXIobnVsbGFibGUpICsgc2VsZWN0b3JCdWZmZXIobnVsbGFibGUpXG4gICAqIEByZXR1cm5zIHtEVFhNZXNzYWdlfVxuICAgKi9cbiAgc3RhdGljIHBhcnNlIChoZWFkZXJCdWYsIHBheWxvYWRCdWYpIHtcbiAgICBsZXQgY3Vyc29yID0gMDtcbiAgICBjb25zdCByZXQgPSBuZXcgRFRYTWVzc2FnZSgpO1xuICAgIHJldC5fbWVzc2FnZUhlYWRlciA9IERUWE1lc3NhZ2VIZWFkZXIucGFyc2UoaGVhZGVyQnVmKTtcbiAgICBpZiAocmV0Ll9tZXNzYWdlSGVhZGVyLnBheWxvYWRMZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuICAgIHJldC5fcGF5bG9hZEhlYWRlciA9IERUWE1lc3NhZ2VQYXlsb2FkSGVhZGVyLnBhcnNlKHBheWxvYWRCdWYuc2xpY2UoY3Vyc29yLCBEVFhfTUVTU0FHRV9QQVlMT0FEX0hFQURFUl9MRU5HVEgpKTtcbiAgICBjdXJzb3IgKz0gRFRYX01FU1NBR0VfUEFZTE9BRF9IRUFERVJfTEVOR1RIO1xuICAgIC8vIHRvdGFsTGVuZ3RoIGlzIGJpZ2ludCB1c2UgMG5cbiAgICBpZiAocmV0Ll9wYXlsb2FkSGVhZGVyLnRvdGFsTGVuZ3RoID09PSAwbikge1xuICAgICAgcmV0dXJuIHJldDtcbiAgICB9XG4gICAgaWYgKHJldC5fcGF5bG9hZEhlYWRlci5hdXhMZW5ndGggPiAwKSB7XG4gICAgICByZXQuYXV4aWxpYXJpZXMgPSBEVFhNZXNzYWdlQXV4LnBhcnNlKHBheWxvYWRCdWYuc2xpY2UoY3Vyc29yLCBjdXJzb3IgKyByZXQuX3BheWxvYWRIZWFkZXIuYXV4TGVuZ3RoKSwgcmV0Ll9wYXlsb2FkSGVhZGVyKTtcbiAgICAgIGN1cnNvciArPSByZXQuX3BheWxvYWRIZWFkZXIuYXV4TGVuZ3RoO1xuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSBwYXlsb2FkQnVmLnNsaWNlKGN1cnNvciwgY3Vyc29yICsgcGF5bG9hZEJ1Zi5sZW5ndGgpO1xuICAgIHJldC5zZWxlY3RvciA9IGRhdGE7XG4gICAgaWYgKGRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgZm9yIChjb25zdCBmdW4gb2YgW3VuYXJjaGl2ZSwgcGxpc3RsaWIucGFyc2VCdWZmZXJdKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmV0LnNlbGVjdG9yID0gZnVuKGRhdGEpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgcmV0LnNlbGVjdG9yID0gbmV3IEluc3RydW1lbnRSUENQYXJzZUVycm9yKGRhdGEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG4gIH1cbn1cblxuZXhwb3J0IHsgRFRYTWVzc2FnZUhlYWRlciwgRFRYTWVzc2FnZVBheWxvYWRIZWFkZXIsIERUWE1lc3NhZ2VBdXhCdWZmZXIsIERUWE1lc3NhZ2VBdXgsIERUWE1lc3NhZ2UsXG4gIERUWF9NRVNTQUdFX1BBWUxPQURfSEVBREVSX0xFTkdUSCwgRFRYX01FU1NBR0VfSEVBREVSX0xFTkdUSCwgRFRYX01FU1NBR0VfSEVBREVSX01BR0lDLCBEVFhfTUVTU0FHRV9IRUFERVJfTUFHSUNfTEVOLFxuICBGTEFHX1RZUEVTfTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxJQUFBQSxRQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxhQUFBLEdBQUFDLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBRyxPQUFBLEdBQUFELHNCQUFBLENBQUFGLE9BQUE7QUFFQSxNQUFNSSxpQ0FBaUMsR0FBRyxFQUFFO0FBQUNDLE9BQUEsQ0FBQUQsaUNBQUEsR0FBQUEsaUNBQUE7QUFDN0MsTUFBTUUseUJBQXlCLEdBQUcsRUFBRTtBQUFDRCxPQUFBLENBQUFDLHlCQUFBLEdBQUFBLHlCQUFBO0FBQ3JDLE1BQU1DLHdCQUF3QixHQUFHLFVBQVU7QUFBQ0YsT0FBQSxDQUFBRSx3QkFBQSxHQUFBQSx3QkFBQTtBQUM1QyxNQUFNQyw0QkFBNEIsR0FBRyxDQUFDO0FBQUNILE9BQUEsQ0FBQUcsNEJBQUEsR0FBQUEsNEJBQUE7QUFDdkMsTUFBTUMsc0JBQXNCLEdBQUcsTUFBTTtBQUNyQyxNQUFNQyxtQkFBbUIsR0FBRyxHQUFHO0FBRS9CLE1BQU1DLFVBQVUsR0FBR0MsTUFBTSxDQUFDQyxNQUFNLENBQUM7RUFDL0JDLElBQUksRUFBRSxDQUFDO0VBQ1BDLElBQUksRUFBRSxDQUFDO0VBQ1BDLElBQUksRUFBRSxDQUFDO0VBQ1BDLEtBQUssRUFBRTtBQUNULENBQUMsQ0FBQztBQUFDWixPQUFBLENBQUFNLFVBQUEsR0FBQUEsVUFBQTtBQUVILE1BQU1PLFNBQVMsR0FBR04sTUFBTSxDQUFDQyxNQUFNLENBQUM7RUFDOUJNLElBQUksRUFBRSxDQUFDO0VBQ1BDLE9BQU8sRUFBRSxDQUFDO0VBQ1ZDLFFBQVEsRUFBRSxDQUFDO0VBQ1hDLFdBQVcsRUFBRSxDQUFDO0VBQ2RDLFVBQVUsRUFBRTtBQUNkLENBQUMsQ0FBQztBQTRCRixNQUFNQyxnQkFBZ0IsQ0FBQztFQUtyQixPQUFP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