"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DTXEncoder = void 0;
require("source-map-support/register");
var _stream = _interopRequireDefault(require("stream"));
var _headers = require("../headers");
class DTXEncoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }
  _transform(data, encoding, onData) {
    this.push(this._encode(data), 'buffer');
    onData();
  }
  _encode(data) {
    const {
      sync,
      channelCode,
      selector,
      auxiliaries,
      identifier
    } = data;
    const dtx = new _headers.DTXMessage({
      identifier,
      channelCode,
      selector,
      expectsReply: sync
    });
    if (auxiliaries instanceof _headers.DTXMessageAuxBuffer) {
      dtx.auxiliaries = auxiliaries;
    } else {
      dtx.auxiliaries.data = auxiliaries;
    }
    return dtx.build();
  }
}
exports.DTXEncoder = DTXEncoder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc3RyZWFtIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfaGVhZGVycyIsIkRUWEVuY29kZXIiLCJTdHJlYW0iLCJUcmFuc2Zvcm0iLCJjb25zdHJ1Y3RvciIsIm9iamVjdE1vZGUiLCJfdHJhbnNmb3JtIiwiZGF0YSIsImVuY29kaW5nIiwib25EYXRhIiwicHVzaCIsIl9lbmNvZGUiLCJzeW5jIiwiY2hhbm5lbENvZGUiLCJzZWxlY3RvciIsImF1eGlsaWFyaWVzIiwiaWRlbnRpZmllciIsImR0eCIsIkRUWE1lc3NhZ2UiLCJleHBlY3RzUmVwbHkiLCJEVFhNZXNzYWdlQXV4QnVmZmVyIiwiYnVpbGQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vbGliL2luc3RydW1lbnQvdHJhbnNmb3JtZXIvZHR4LWVuY29kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU3RyZWFtIGZyb20gJ3N0cmVhbSc7XG5pbXBvcnQge0RUWE1lc3NhZ2UsIERUWE1lc3NhZ2VBdXhCdWZmZXJ9IGZyb20gJy4uL2hlYWRlcnMnO1xuXG5cbmNsYXNzIERUWEVuY29kZXIgZXh0ZW5kcyBTdHJlYW0uVHJhbnNmb3JtIHtcblxuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgc3VwZXIoeyBvYmplY3RNb2RlOiB0cnVlIH0pO1xuICB9XG5cbiAgX3RyYW5zZm9ybSAoZGF0YSwgZW5jb2RpbmcsIG9uRGF0YSkge1xuICAgIHRoaXMucHVzaCh0aGlzLl9lbmNvZGUoZGF0YSksICdidWZmZXInKTtcbiAgICBvbkRhdGEoKTtcbiAgfVxuXG4gIF9lbmNvZGUgKGRhdGEpIHtcbiAgICBjb25zdCB7c3luYywgY2hhbm5lbENvZGUsIHNlbGVjdG9yLCBhdXhpbGlhcmllcywgaWRlbnRpZmllcn0gPSBkYXRhO1xuICAgIGNvbnN0IGR0eCA9IG5ldyBEVFhNZXNzYWdlKHtcbiAgICAgIGlkZW50aWZpZXIsXG4gICAgICBjaGFubmVsQ29kZSxcbiAgICAgIHNlbGVjdG9yLFxuICAgICAgZXhwZWN0c1JlcGx5OiBzeW5jXG4gICAgfSk7XG4gICAgaWYgKGF1eGlsaWFyaWVzIGluc3RhbmNlb2YgRFRYTWVzc2FnZUF1eEJ1ZmZlcikge1xuICAgICAgZHR4LmF1eGlsaWFyaWVzID0gYXV4aWxpYXJpZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIGR0eC5hdXhpbGlhcmllcy5kYXRhID0gYXV4aWxpYXJpZXM7XG4gICAgfVxuICAgIHJldHVybiBkdHguYnVpbGQoKTtcbiAgfVxufVxuXG5leHBvcnQgeyBEVFhFbmNvZGVyIH07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsSUFBQUEsT0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsUUFBQSxHQUFBRCxPQUFBO0FBR0EsTUFBTUUsVUFBVSxTQUFTQyxlQUFNLENBQUNDLFNBQVMsQ0FBQztFQUV4Q0MsV0FBV0EsQ0FBQSxFQUFJO0lBQ2IsS0FBSyxDQUFDO01BQUVDLFVBQVUsRUFBRTtJQUFLLENBQUMsQ0FBQztFQUM3QjtFQUVBQyxVQUFVQSxDQUFFQyxJQUFJLEVBQUVDLFFBQVEsRUFBRUMsTUFBTSxFQUFFO0lBQ2xDLElBQUksQ0FBQ0MsSUFBSSxDQUFDLElBQUksQ0FBQ0MsT0FBTyxDQUFDSixJQUFJLENBQUMsRUFBRSxRQUFRLENBQUM7SUFDdkNFLE1BQU0sRUFBRTtFQUNWO0VBRUFFLE9BQU9BLENBQUVKLElBQUksRUFBRTtJQUNiLE1BQU07TUFBQ0ssSUFBSTtNQUFFQyxXQUFXO01BQUVDLFFBQVE7TUFBRUMsV0FBVztNQUFFQztJQUFVLENBQUMsR0FBR1QsSUFBSTtJQUNuRSxNQUFNVSxHQUFHLEdBQUcsSUFBSUMsbUJBQVUsQ0FBQztNQUN6QkYsVUFBVTtNQUNWSCxXQUFXO01BQ1hDLFFBQVE7TUFDUkssWUFBWSxFQUFFUDtJQUNoQixDQUFDLENBQUM7SUFDRixJQUFJRyxXQUFXLFlBQVlLLDRCQUFtQixFQUFFO01BQzlDSCxHQUFHLENBQUNGLFdBQVcsR0FBR0EsV0FBVztJQUMvQixDQUFDLE1BQU07TUFDTEUsR0FBRyxDQUFDRixXQUFXLENBQUNSLElBQUksR0FBR1EsV0FBVztJQUNwQztJQUNBLE9BQU9FLEdBQUcsQ0FBQ0ksS0FBSyxFQUFFO0VBQ3BCO0FBQ0Y7QUFBQ0MsT0FBQSxDQUFBckIsVUFBQSxHQUFBQSxVQUFBIn0=