"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.NSUUID = exports.NSURL = exports.NSDate = exports.BaseArchiveHandler = void 0;
exports.archive = archive;
exports.unarchive = unarchive;
exports.updateNSKeyedArchiveClass = updateNSKeyedArchiveClass;
require("source-map-support/register");
var _bplistParser = _interopRequireDefault(require("bplist-parser"));
var _bplistCreator = _interopRequireDefault(require("bplist-creator"));
var _uuid = require("uuid");
var _lodash = _interopRequireDefault(require("lodash"));
const NSKEYED_ARCHIVE_VERSION = 100_000;
const NULL_UID = new _bplistParser.default.UID(0);
const CYCLE_TOKEN = 'CycleToken';
const PRIMITIVE_TYPES = ['Number', 'String', 'Boolean', 'UID', 'Buffer'];
const NON_ENCODABLE_TYPES = ['number', 'boolean'];
const NSKEYEDARCHIVER = 'NSKeyedArchiver';
const UNIX2APPLE_TIMESTAMP_SECOND = 978307200;
class ArchivedObject {
  constructor(object, unarchiver) {
    this.object = object;
    this._unarchiver = unarchiver;
  }
  decodeIndex(index) {
    return this._unarchiver.decodeObject(index);
  }
  decode(key) {
    return this._unarchiver.decodeKey(this.object, key);
  }
}
class ArchivingObject {
  constructor(object, archiver) {
    this._archiveObj = object;
    this._archiver = archiver;
  }
  encode(key, val) {
    this._archiveObj[key] = this._archiver.encode(val);
  }
}
class BaseArchiveHandler {
  decodeArchive(archive) {
    throw new Error(`Did not know how to decode the object`);
  }
  encodeArchive(obj, archive) {
    throw new Error(`Did not know how to encode the object`);
  }
}
exports.BaseArchiveHandler = BaseArchiveHandler;
class DictArchive extends BaseArchiveHandler {
  decodeArchive(archive) {
    const keyUids = archive.decode('NS.keys');
    const valUids = archive.decode('NS.objects');
    const d = {};
    for (let i = 0; i < keyUids.length; i++) {
      const key = archive.decodeIndex(keyUids[i]);
      d[key] = archive.decodeIndex(valUids[i]);
    }
    return d;
  }
}
class ListArchive extends BaseArchiveHandler {
  decodeArchive(archive) {
    const uids = archive.decode('NS.objects');
    return uids.map(archive.decodeIndex.bind(archive));
  }
}
class DTTapMessagePlist extends BaseArchiveHandler {
  decodeArchive(archive) {
    return archive.decode('DTTapMessagePlist');
  }
}
class NSError extends BaseArchiveHandler {
  decodeArchive(archive) {
    return {
      '$class': 'NSError',
      'domain': archive.decode('NSDomain'),
      'userinfo': archive.decode('NSUserInfo'),
      'code': archive.decode('NSCode')
    };
  }
}
class NSException extends BaseArchiveHandler {
  decodeArchive(archive) {
    return {
      '$class': 'NSException',
      'reason': archive.decode('NS.reason'),
      'userinfo': archive.decode('userinfo'),
      'name': archive.decode('NS.name')
    };
  }
}
class NSURL extends BaseArchiveHandler {
  constructor(base, relative) {
    super();
    this._base = base;
    this._relative = relative;
  }
  decodeArchive(archive) {
    return {
      $class: 'NSURL',
      base: archive.decode('NS.base'),
      relative: archive.decode('NS.relative')
    };
  }
  encodeArchive(obj, archive) {
    archive.encode('NS.base', obj._base);
    archive.encode('NS.relative', obj._relative);
  }
}
exports.NSURL = NSURL;
class NSDate extends BaseArchiveHandler {
  constructor(data) {
    super();
    this._data = data;
  }
  decodeArchive(archive) {
    return UNIX2APPLE_TIMESTAMP_SECOND + archive.decode('NS.time');
  }
  encodeArchive(obj, archive) {
    archive.encode('NS.time', obj._data - UNIX2APPLE_TIMESTAMP_SECOND);
  }
}
exports.NSDate = NSDate;
class NSMutableString extends BaseArchiveHandler {
  decodeArchive(archive) {
    return archive.decode('NS.string');
  }
}
class NSMutableData extends BaseArchiveHandler {
  decodeArchive(archive) {
    return archive.decode('NS.data');
  }
}
class NSUUID extends BaseArchiveHandler {
  constructor(data) {
    super();
    this._data = data;
  }
  decodeArchive(archive) {
    return (0, _uuid.stringify)(archive.decode('NS.uuidbytes'));
  }
  encodeArchive(obj, archive) {
    archive._archiveObj['NS.uuidbytes'] = Buffer.from((0, _uuid.parse)(obj._data).buffer);
  }
}
exports.NSUUID = NSUUID;
class XCTCapabilities extends BaseArchiveHandler {
  decodeArchive(archive) {
    return archive.decode('capabilities-dictionary');
  }
}
class NSNull extends BaseArchiveHandler {
  decodeArchive() {
    return null;
  }
}
const UNARCHIVE_CLASS_MAP = {
  DTTapMessagePlist,
  DTSysmonTapMessage: DTTapMessagePlist,
  DTTapHeartbeatMessage: DTTapMessagePlist,
  DTTapMessageArchive: DTTapMessagePlist,
  DTKTraceTapMessage: DTTapMessagePlist,
  ErrorArchive: NSError,
  ExceptionArchive: NSException,
  NSDictionary: DictArchive,
  NSMutableDictionary: DictArchive,
  NSArray: ListArchive,
  NSMutableArray: ListArchive,
  NSMutableSet: ListArchive,
  NSSet: ListArchive,
  NSDate,
  NSError,
  NSException,
  NSMutableString,
  NSMutableData,
  NSNull,
  NSUUID,
  NSURL,
  XCTCapabilities
};
class Unarchive {
  constructor(inputBytes) {
    this.input = inputBytes;
    this.unpackedUids = {};
    this.topUID = NULL_UID;
    this.objects = [];
  }
  unpackArchiveHeader() {
    const plist = _bplistParser.default.parseBuffer(this.input)[0];
    if (plist.$archiver !== NSKEYEDARCHIVER) {
      throw new Error(`unsupported encoder: ${plist.$archiver}`);
    }
    if (plist.$version !== NSKEYED_ARCHIVE_VERSION) {
      throw new Error(`expected ${NSKEYED_ARCHIVE_VERSION}, got ${plist.$version}`);
    }
    const top = plist.$top;
    const topUID = top.root;
    if (!topUID) {
      throw new Error(`top object did not have a UID! dump: ${JSON.stringify(top)}`);
    }
    this.topUID = topUID;
    this.objects = plist.$objects;
  }
  classForUid(index) {
    const meta = this.objects[index.UID];
    const name = meta.$classname;
    const klass = UNARCHIVE_CLASS_MAP[name];
    if (!klass) {
      throw new Error(`no mapping for ${name} in UNARCHIVE_CLASS_MAP`);
    }
    return klass;
  }
  decodeKey(obj, key) {
    const val = obj[key];
    return _lodash.default.isNil(val === null || val === void 0 ? void 0 : val.UID) ? val : this.decodeObject(val);
  }
  decodeObject(index) {
    if (index === NULL_UID) {
      return null;
    }
    const obj = this.unpackedUids[index];
    if (obj === CYCLE_TOKEN) {
      throw new Error(`archive has a cycle with ${index}`);
    }
    if (!_lodash.default.isUndefined(obj)) {
      return obj;
    }
    const rawObj = this.objects[index.UID];
    this.unpackedUids[index.UID] = CYCLE_TOKEN;
    if (!(rawObj !== null && rawObj !== void 0 && rawObj.$class)) {
      this.unpackedUids[index.UID] = obj;
      return rawObj;
    }
    const klass = this.classForUid(rawObj.$class);
    const klassObj = new klass().decodeArchive(new ArchivedObject(rawObj, this));
    this.unpackedUids[index.UID] = klassObj;
    return klassObj;
  }
  toObject() {
    this.unpackArchiveHeader();
    return this.decodeObject(this.topUID);
  }
}
class Archive {
  constructor(inputObject) {
    this.input = inputObject;
    this.classMap = {};
    this.objects = ['$null'];
  }
  uidForArchiver(archiver) {
    let val = this.classMap[archiver];
    if (val) {
      return new _bplistParser.default.UID(val);
    }
    this.classMap[archiver] = this.objects.length;
    val = new _bplistParser.default.UID(this.objects.length);
    this.objects.push({
      '$classes': [archiver],
      '$classname': archiver
    });
    return val;
  }
  archive(obj) {
    if (_lodash.default.isUndefined(obj) || _lodash.default.isNull(obj)) {
      return NULL_UID;
    }
    const index = new _bplistParser.default.UID(this.objects.length);
    if (PRIMITIVE_TYPES.includes(obj.constructor.name)) {
      this.objects.push(obj);
      return index;
    }
    const archiveObj = {};
    this.objects.push(archiveObj);
    this.encodeTopLevel(obj, archiveObj);
    return index;
  }
  encode(val) {
    if (NON_ENCODABLE_TYPES.includes(typeof val)) {
      return val;
    }
    return this.archive(val);
  }
  encodeTopLevel(obj, archiveObj) {
    if (obj instanceof Array) {
      return this.encodeArray(obj, archiveObj);
    } else if (obj instanceof Set) {
      return this.encodeSet(obj, archiveObj);
    } else if (obj instanceof Object) {
      const objName = obj.constructor.name;
      if (objName in UNARCHIVE_CLASS_MAP) {
        archiveObj.$class = this.uidForArchiver(objName);
        obj.encodeArchive(obj, new ArchivingObject(archiveObj, this));
      } else {
        return this.encodeDict(obj, archiveObj);
      }
    } else {
      throw Error(`Unable to encode types: ${typeof obj}`);
    }
  }
  encodeArray(objs, archiveObj) {
    archiveObj.$class = this.uidForArchiver('NSArray');
    archiveObj['NS.objects'] = objs.map(this.archive.bind(this));
  }
  encodeSet(objs, archiveObj) {
    archiveObj.$class = this.uidForArchiver('NSSet');
    archiveObj['NS.objects'] = objs.map(this.archive.bind(this));
  }
  encodeDict(obj, archiveObj) {
    archiveObj.$class = this.uidForArchiver('NSDictionary');
    archiveObj['NS.keys'] = _lodash.default.keys(obj).map(this.archive.bind(this));
    archiveObj['NS.objects'] = _lodash.default.values(obj).map(this.archive.bind(this));
  }
  toBytes() {
    if (this.objects.length === 1) {
      this.archive(this.input);
    }
    const d = {
      '$version': NSKEYED_ARCHIVE_VERSION,
      '$archiver': NSKEYEDARCHIVER,
      '$top': {
        'root': new _bplistParser.default.UID(1)
      },
      '$objects': this.objects
    };
    return (0, _bplistCreator.default)(d);
  }
}
function archive(inputObject) {
  return new Archive(inputObject).toBytes();
}
function unarchive(inputBytes) {
  return new Unarchive(inputBytes).toObject();
}
function updateNSKeyedArchiveClass(name, subClass) {
  var _subClass$prototype, _subClass$prototype2;
  if (!_lodash.default.isFunction((_subClass$prototype = subClass.prototype) === null || _subClass$prototype === void 0 ? void 0 : _subClass$prototype.decodeArchive) && !_lodash.default.isFunction((_subClass$prototype2 = subClass.prototype) === null || _subClass$prototype2 === void 0 ? void 0 : _subClass$prototype2.encodeArchive)) {
    throw Error('subClass must have decodeArchive or encodeArchive methods');
  }
  if (!(name in UNARCHIVE_CLASS_MAP)) {
    UNARCHIVE_CLASS_MAP[name] = subClass;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYnBsaXN0UGFyc2VyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfYnBsaXN0Q3JlYXRvciIsIl91dWlkIiwiX2xvZGFzaCIsIk5TS0VZRURfQVJDSElWRV9WRVJTSU9OIiwiTlVMTF9VSUQiLCJwbGlzdGxpYiIsIlVJRCIsIkNZQ0xFX1RPS0VOIiwiUFJJTUlUSVZFX1RZUEVTIiwiTk9OX0VOQ09EQUJMRV9UWVBFUyIsIk5TS0VZRURBUkNISVZFUiIsIlVOSVgyQVBQTEVfVElNRVNUQU1QX1NFQ09ORCIsIkFyY2hpdmVkT2JqZWN0IiwiY29uc3RydWN0b3IiLCJvYmplY3QiLCJ1bmFyY2hpdmVyIiwiX3VuYXJjaGl2ZXIiLCJkZWNvZGVJbmRleCIsImluZGV4IiwiZGVjb2RlT2JqZWN0IiwiZGVjb2RlIiwia2V5IiwiZGVjb2RlS2V5IiwiQXJjaGl2aW5nT2JqZWN0IiwiYXJjaGl2ZXIiLCJfYXJjaGl2ZU9iaiIsIl9hcmNoaXZlciIsImVuY29kZSIsInZhbCIsIkJhc2VBcmNoaXZlSGFuZGxlciIsImRlY29kZUFyY2hpdmUiLCJhcmNoaXZlIiwiRXJyb3IiLCJlbmNvZGVBcmNoaXZlIiwib2JqIiwiZXhwb3J0cyIsIkRpY3RBcmNoaXZlIiwia2V5VWlkcyIsInZhbFVpZHMiLCJkIiwiaSIsImxlbmd0aCIsIkxpc3RBcmNoaXZlIiwidWlkcyIsIm1hcCIsImJpbmQiLCJEVFRhcE1lc3NhZ2VQbGlzdCIsIk5TRXJyb3IiLCJOU0V4Y2VwdGlvbiIsIk5TVVJMIiwiYmFzZSIsInJlbGF0aXZlIiwiX2Jhc2UiLCJfcmVsYXRpdmUiLCIkY2xhc3MiLCJOU0RhdGUiLCJkYXRhIiwiX2RhdGEiLCJOU011dGFibGVTdHJpbmciLCJOU011dGFibGVEYXRhIiwiTlNVVUlEIiwidXVpZFN0cmluZ2lmeSIsIkJ1ZmZlciIsImZyb20iLCJ1dWlkUGFyc2UiLCJidWZmZXIiLCJYQ1RDYXBhYmlsaXRpZXMiLCJOU051bGwiLCJVTkFSQ0hJVkVfQ0xBU1NfTUFQIiwiRFRTeXNtb25UYXBNZXNzYWdlIiwiRFRUYXBIZWFydGJlYXRNZXNzYWdlIiwiRFRUYXBNZXNzYWdlQXJjaGl2ZSIsIkRUS1RyYWNlVGFwTWVzc2FnZSIsIkVycm9yQXJjaGl2ZSIsIkV4Y2VwdGlvbkFyY2hpdmUiLCJOU0RpY3Rpb25hcnkiLCJOU011dGFibGVEaWN0aW9uYXJ5IiwiTlNBcnJheSIsIk5TTXV0YWJsZUFycmF5IiwiTlNNdXRhYmxlU2V0IiwiTlNTZXQiLCJVbmFyY2hpdmUiLCJpbnB1dEJ5dGVzIiwiaW5wdXQiLCJ1bnBhY2tlZFVpZHMiLCJ0b3BVSUQiLCJvYmplY3RzIiwidW5wYWNrQXJjaGl2ZUhlYWRlciIsInBsaXN0IiwicGFyc2VCdWZmZXIiLCIkYXJjaGl2ZXIiLCIkdmVyc2lvbiIsInRvcCIsIiR0b3AiLCJyb290IiwiSlNPTiIsInN0cmluZ2lmeSIsIiRvYmplY3RzIiwiY2xhc3NGb3JVaWQiLCJtZXRhIiwibmFtZSIsIiRjbGFzc25hbWUiLCJrbGFzcyIsIl8iLCJpc05pbCIsImlzVW5kZWZpbmVkIiwicmF3T2JqIiwia2xhc3NPYmoiLCJ0b09iamVjdCIsIkFyY2hpdmUiLCJpbnB1dE9iamVjdCIsImNsYXNzTWFwIiwidWlkRm9yQXJjaGl2ZXIiLCJwdXNoIiwiaXNOdWxsIiwiaW5jbHVkZXMiLCJhcmNoaXZlT2JqIiwiZW5jb2RlVG9wTGV2ZWwiLCJBcnJheSIsImVuY29kZUFycmF5IiwiU2V0IiwiZW5jb2RlU2V0IiwiT2JqZWN0Iiwib2JqTmFtZSIsImVuY29kZURpY3QiLCJvYmpzIiwia2V5cyIsInZhbHVlcyIsInRvQnl0ZXMiLCJicGxpc3RDcmVhdGUiLCJ1bmFyY2hpdmUiLCJ1cGRhdGVOU0tleWVkQXJjaGl2ZUNsYXNzIiwic3ViQ2xhc3MiLCJfc3ViQ2xhc3MkcHJvdG90eXBlIiwiX3N1YkNsYXNzJHByb3RvdHlwZTIiLCJpc0Z1bmN0aW9uIiwicHJvdG90eXBlIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vbGliL2luc3RydW1lbnQvdHJhbnNmb3JtZXIvbnNrZXllZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGxpc3RsaWIgZnJvbSAnYnBsaXN0LXBhcnNlcic7XG5pbXBvcnQgYnBsaXN0Q3JlYXRlIGZyb20gJ2JwbGlzdC1jcmVhdG9yJztcbmltcG9ydCB7cGFyc2UgYXMgdXVpZFBhcnNlLCBzdHJpbmdpZnkgYXMgdXVpZFN0cmluZ2lmeX0gZnJvbSAndXVpZCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuXG5jb25zdCBOU0tFWUVEX0FSQ0hJVkVfVkVSU0lPTiA9IDEwMF8wMDA7XG5jb25zdCBOVUxMX1VJRCA9IG5ldyBwbGlzdGxpYi5VSUQoMCk7XG5jb25zdCBDWUNMRV9UT0tFTiA9ICdDeWNsZVRva2VuJztcbmNvbnN0IFBSSU1JVElWRV9UWVBFUyA9IFsnTnVtYmVyJywgJ1N0cmluZycsICdCb29sZWFuJywgJ1VJRCcsICdCdWZmZXInXTtcbmNvbnN0IE5PTl9FTkNPREFCTEVfVFlQRVMgPSBbJ251bWJlcicsICdib29sZWFuJ107XG5jb25zdCBOU0tFWUVEQVJDSElWRVIgPSAnTlNLZXllZEFyY2hpdmVyJztcbmNvbnN0IFVOSVgyQVBQTEVfVElNRVNUQU1QX1NFQ09ORCA9IDk3ODMwNzIwMDtcblxuXG5jbGFzcyBBcmNoaXZlZE9iamVjdCB7XG4gIC8qKlxuICAgKiBTdGF0ZWZ1bCB3cmFwcGVyIGFyb3VuZCBBcmNoaXZlIGZvciBhbiBvYmplY3QgYmVpbmcgYXJjaGl2ZWQuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3RcbiAgICogQHBhcmFtIHtVbmFyY2hpdmV9IHVuYXJjaGl2ZXJcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqL1xuICBjb25zdHJ1Y3RvciAob2JqZWN0LCB1bmFyY2hpdmVyKSB7XG4gICAgdGhpcy5vYmplY3QgPSBvYmplY3Q7XG4gICAgdGhpcy5fdW5hcmNoaXZlciA9IHVuYXJjaGl2ZXI7XG4gIH1cblxuICBkZWNvZGVJbmRleCAoaW5kZXgpIHtcbiAgICByZXR1cm4gdGhpcy5fdW5hcmNoaXZlci5kZWNvZGVPYmplY3QoaW5kZXgpO1xuICB9XG5cbiAgZGVjb2RlIChrZXkpIHtcbiAgICByZXR1cm4gdGhpcy5fdW5hcmNoaXZlci5kZWNvZGVLZXkodGhpcy5vYmplY3QsIGtleSk7XG4gIH1cbn1cblxuY2xhc3MgQXJjaGl2aW5nT2JqZWN0IHtcbiAgLyoqXG4gICAqIFN0YXRlZnVsIHdyYXBwZXIgYXJvdW5kIFVuYXJjaGl2ZSBmb3IgYW4gYXJjaGl2ZWQgb2JqZWN0XG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3RcbiAgICogQHBhcmFtIHtBcmNoaXZlfSBhcmNoaXZlclxuICAgKiBAY29uc3RydWN0b3JcbiAgICovXG4gIGNvbnN0cnVjdG9yIChvYmplY3QsIGFyY2hpdmVyKSB7XG4gICAgdGhpcy5fYXJjaGl2ZU9iaiA9IG9iamVjdDtcbiAgICB0aGlzLl9hcmNoaXZlciA9IGFyY2hpdmVyO1xuICB9XG5cbiAgZW5jb2RlIChrZXksIHZhbCkge1xuICAgIHRoaXMuX2FyY2hpdmVPYmpba2V5XSA9IHRoaXMuX2FyY2hpdmVyLmVuY29kZSh2YWwpO1xuICB9XG59XG5cbi8qKlxuICogVGhpcyBjbGFzcyBtdXN0IGJlIGluaGVyaXRlZCB3aGVuIGNyZWF0aW5nIGFuIGFyY2hpdmUvdW5hcmNoaXZlIHN1YmNsYXNzXG4gKiBBbmQgeW91IG5lZWQgdG8gY2FsbCBgdXBkYXRlTlNLZXllZEFyY2hpdmVDbGFzc2AgYWRkIHN1YmNsYXNzIHRvIGFyY2hpdmUvdW5hcmNoaXZlIG9iamVjdFxuICovXG5jbGFzcyBCYXNlQXJjaGl2ZUhhbmRsZXIge1xuICAvKipcbiAgICogQHBhcmFtIHtBcmNoaXZlZE9iamVjdH0gYXJjaGl2ZVxuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gIGRlY29kZUFyY2hpdmUgKGFyY2hpdmUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYERpZCBub3Qga25vdyBob3cgdG8gZGVjb2RlIHRoZSBvYmplY3RgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqICBhbiBpbnN0YW5jZSBvZiB0aGlzIGNsYXNzXG4gICAqIEBwYXJhbSB7QXJjaGl2aW5nT2JqZWN0fSBhcmNoaXZlXG4gICAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgZW5jb2RlQXJjaGl2ZSAob2JqLCBhcmNoaXZlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBEaWQgbm90IGtub3cgaG93IHRvIGVuY29kZSB0aGUgb2JqZWN0YCk7XG4gIH1cbn1cblxuLyoqXG4gKiBcIkRlbGVnYXRlIGZvciBwYWNraW5nL3VucGFja2luZyBOUyhNdXRhYmxlKURpY3Rpb25hcnkgb2JqZWN0c1wiXG4gKi9cbmNsYXNzIERpY3RBcmNoaXZlIGV4dGVuZHMgQmFzZUFyY2hpdmVIYW5kbGVyIHtcbiAgZGVjb2RlQXJjaGl2ZSAoYXJjaGl2ZSkge1xuICAgIGNvbnN0IGtleVVpZHMgPSBhcmNoaXZlLmRlY29kZSgnTlMua2V5cycpO1xuICAgIGNvbnN0IHZhbFVpZHMgPSBhcmNoaXZlLmRlY29kZSgnTlMub2JqZWN0cycpO1xuICAgIGNvbnN0IGQgPSB7fTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleVVpZHMubGVuZ3RoIDsgaSsrKSB7XG4gICAgICBjb25zdCBrZXkgPSBhcmNoaXZlLmRlY29kZUluZGV4KGtleVVpZHNbaV0pO1xuICAgICAgZFtrZXldID0gYXJjaGl2ZS5kZWNvZGVJbmRleCh2YWxVaWRzW2ldKTtcbiAgICB9XG4gICAgcmV0dXJuIGQ7XG4gIH1cbn1cblxuLyoqXG4gKiBEZWxlZ2F0ZSBmb3IgcGFja2luZy91bnBhY2tpbmcgTlMoTXV0YWJsZSlBcnJheSBvYmplY3RzXG4gKi9cbmNsYXNzIExpc3RBcmNoaXZlIGV4dGVuZHMgQmFzZUFyY2hpdmVIYW5kbGVyIHtcbiAgZGVjb2RlQXJjaGl2ZSAoYXJjaGl2ZSkge1xuICAgIGNvbnN0IHVpZHMgPSBhcmNoaXZlLmRlY29kZSgnTlMub2JqZWN0cycpO1xuICAgIHJldHVybiB1aWRzLm1hcChhcmNoaXZlLmRlY29kZUluZGV4LmJpbmQoYXJjaGl2ZSkpO1xuICB9XG59XG5cbmNsYXNzIERUVGFwTWVzc2FnZVBsaXN0IGV4dGVuZHMgQmFzZUFyY2hpdmVIYW5kbGVyIHtcbiAgZGVjb2RlQXJjaGl2ZSAoYXJjaGl2ZSkge1xuICAgIHJldHVybiBhcmNoaXZlLmRlY29kZSgnRFRUYXBNZXNzYWdlUGxpc3QnKTtcbiAgfVxufVxuXG5jbGFzcyBOU0Vycm9yIGV4dGVuZHMgQmFzZUFyY2hpdmVIYW5kbGVyIHtcbiAgZGVjb2RlQXJjaGl2ZSAoYXJjaGl2ZSkge1xuICAgIHJldHVybiB7XG4gICAgICAnJGNsYXNzJzogJ05TRXJyb3InLFxuICAgICAgJ2RvbWFpbic6IGFyY2hpdmUuZGVjb2RlKCdOU0RvbWFpbicpLFxuICAgICAgJ3VzZXJpbmZvJzogYXJjaGl2ZS5kZWNvZGUoJ05TVXNlckluZm8nKSxcbiAgICAgICdjb2RlJzogYXJjaGl2ZS5kZWNvZGUoJ05TQ29kZScpXG4gICAgfTtcbiAgfVxufVxuXG5jbGFzcyBOU0V4Y2VwdGlvbiBleHRlbmRzIEJhc2VBcmNoaXZlSGFuZGxlciB7XG4gIGRlY29kZUFyY2hpdmUgKGFyY2hpdmUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgJyRjbGFzcyc6ICdOU0V4Y2VwdGlvbicsXG4gICAgICAncmVhc29uJzogYXJjaGl2ZS5kZWNvZGUoJ05TLnJlYXNvbicpLFxuICAgICAgJ3VzZXJpbmZvJzogYXJjaGl2ZS5kZWNvZGUoJ3VzZXJpbmZvJyksXG4gICAgICAnbmFtZSc6IGFyY2hpdmUuZGVjb2RlKCdOUy5uYW1lJylcbiAgICB9O1xuICB9XG59XG5cbmNsYXNzIE5TVVJMIGV4dGVuZHMgQmFzZUFyY2hpdmVIYW5kbGVyIHtcbiAgLyoqXG4gICAqIEBwYXJhbSB7Kn0gYmFzZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gcmVsYXRpdmUgdXN1YWxseSBpb3MgZGV2aWNlIHJlbGF0aXZlIHBhdGggZS5nOiBmaWxlOi8veHgvXG4gICAqL1xuICBjb25zdHJ1Y3RvciAoYmFzZSwgcmVsYXRpdmUpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX2Jhc2UgPSBiYXNlO1xuICAgIHRoaXMuX3JlbGF0aXZlID0gcmVsYXRpdmU7XG4gIH1cblxuICBkZWNvZGVBcmNoaXZlIChhcmNoaXZlKSB7XG4gICAgcmV0dXJuIHskY2xhc3M6ICdOU1VSTCcsIGJhc2U6IGFyY2hpdmUuZGVjb2RlKCdOUy5iYXNlJyksIHJlbGF0aXZlOiBhcmNoaXZlLmRlY29kZSgnTlMucmVsYXRpdmUnKX07XG4gIH1cblxuICBlbmNvZGVBcmNoaXZlIChvYmosIGFyY2hpdmUpIHtcbiAgICBhcmNoaXZlLmVuY29kZSgnTlMuYmFzZScsIG9iai5fYmFzZSk7XG4gICAgYXJjaGl2ZS5lbmNvZGUoJ05TLnJlbGF0aXZlJywgb2JqLl9yZWxhdGl2ZSk7XG4gIH1cbn1cblxuY2xhc3MgTlNEYXRlIGV4dGVuZHMgQmFzZUFyY2hpdmVIYW5kbGVyIHtcbiAgLyoqXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBkYXRhIHRpbWVzdGFtcCBpbiBzZWNvbmRzXG4gICAqL1xuICBjb25zdHJ1Y3RvciAoZGF0YSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fZGF0YSA9IGRhdGE7XG4gIH1cblxuICBkZWNvZGVBcmNoaXZlIChhcmNoaXZlKSB7XG4gICAgcmV0dXJuIFVOSVgyQVBQTEVfVElNRVNUQU1QX1NFQ09ORCArIGFyY2hpdmUuZGVjb2RlKCdOUy50aW1lJyk7XG4gIH1cblxuICBlbmNvZGVBcmNoaXZlIChvYmosIGFyY2hpdmUpIHtcbiAgICBhcmNoaXZlLmVuY29kZSgnTlMudGltZScsIG9iai5fZGF0YSAtIFVOSVgyQVBQTEVfVElNRVNUQU1QX1NFQ09ORCk7XG4gIH1cbn1cblxuY2xhc3MgTlNNdXRhYmxlU3RyaW5nIGV4dGVuZHMgQmFzZUFyY2hpdmVIYW5kbGVyIHtcbiAgZGVjb2RlQXJjaGl2ZSAoYXJjaGl2ZSkge1xuICAgIHJldHVybiBhcmNoaXZlLmRlY29kZSgnTlMuc3RyaW5nJyk7XG4gIH1cbn1cblxuY2xhc3MgTlNNdXRhYmxlRGF0YSBleHRlbmRzIEJhc2VBcmNoaXZlSGFuZGxlciB7XG4gIGRlY29kZUFyY2hpdmUgKGFyY2hpdmUpIHtcbiAgICByZXR1cm4gYXJjaGl2ZS5kZWNvZGUoJ05TLmRhdGEnKTtcbiAgfVxufVxuXG5jbGFzcyBOU1VVSUQgZXh0ZW5kcyBCYXNlQXJjaGl2ZUhhbmRsZXIge1xuICAvKipcbiAgICogQHBhcmFtIHtzdHJpbmd9IGRhdGEgdXVpZCBmb3JtYXQgZGF0YSBlLmc6MDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwXG4gICAqL1xuICBjb25zdHJ1Y3RvciAoZGF0YSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fZGF0YSA9IGRhdGE7XG4gIH1cblxuICBkZWNvZGVBcmNoaXZlIChhcmNoaXZlKSB7XG4gICAgcmV0dXJuIHV1aWRTdHJpbmdpZnkoYXJjaGl2ZS5kZWNvZGUoJ05TLnV1aWRieXRlcycpKTtcbiAgfVxuXG4gIGVuY29kZUFyY2hpdmUgKG9iaiwgYXJjaGl2ZSkge1xuICAgIGFyY2hpdmUuX2FyY2hpdmVPYmpbJ05TLnV1aWRieXRlcyddID0gQnVmZmVyLmZyb20odXVpZFBhcnNlKG9iai5fZGF0YSkuYnVmZmVyKTtcbiAgfVxufVxuXG5jbGFzcyBYQ1RDYXBhYmlsaXRpZXMgZXh0ZW5kcyBCYXNlQXJjaGl2ZUhhbmRsZXIge1xuICBkZWNvZGVBcmNoaXZlIChhcmNoaXZlKSB7XG4gICAgcmV0dXJuIGFyY2hpdmUuZGVjb2RlKCdjYXBhYmlsaXRpZXMtZGljdGlvbmFyeScpO1xuICB9XG59XG5cbmNsYXNzIE5TTnVsbCBleHRlbmRzIEJhc2VBcmNoaXZlSGFuZGxlciB7XG4gIGRlY29kZUFyY2hpdmUgKCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8qKlxuICogZGVjb2RlIGFuZCBlbmNvZGUgQXJjaGl2ZSBvZiBjdXJyZW50bHkga25vd24gZGF0YSBmb3JtYXRzXG4gKi9cbmNvbnN0IFVOQVJDSElWRV9DTEFTU19NQVAgPSB7XG4gIERUVGFwTWVzc2FnZVBsaXN0LFxuICBEVFN5c21vblRhcE1lc3NhZ2U6IERUVGFwTWVzc2FnZVBsaXN0LFxuICBEVFRhcEhlYXJ0YmVhdE1lc3NhZ2U6IERUVGFwTWVzc2FnZVBsaXN0LFxuICBEVFRhcE1lc3NhZ2VBcmNoaXZlOiBEVFRhcE1lc3NhZ2VQbGlzdCxcbiAgRFRLVHJhY2VUYXBNZXNzYWdlOiBEVFRhcE1lc3NhZ2VQbGlzdCxcbiAgRXJyb3JBcmNoaXZlOiBOU0Vycm9yLFxuICBFeGNlcHRpb25BcmNoaXZlOiBOU0V4Y2VwdGlvbixcbiAgTlNEaWN0aW9uYXJ5OiBEaWN0QXJjaGl2ZSxcbiAgTlNNdXRhYmxlRGljdGlvbmFyeTogRGljdEFyY2hpdmUsXG4gIE5TQXJyYXk6IExpc3RBcmNoaXZlLFxuICBOU011dGFibGVBcnJheTogTGlzdEFyY2hpdmUsXG4gIE5TTXV0YWJsZVNldDogTGlzdEFyY2hpdmUsXG4gIE5TU2V0OiBMaXN0QXJjaGl2ZSxcbiAgTlNEYXRlLFxuICBOU0Vycm9yLFxuICBOU0V4Y2VwdGlvbixcbiAgTlNNdXRhYmxlU3RyaW5nLFxuICBOU011dGFibGVEYXRhLFxuICBOU051bGwsXG4gIE5TVVVJRCxcbiAgTlNVUkwsXG4gIFhDVENhcGFiaWxpdGllc1xufTtcblxuLyoqXG4gKiBDYXBhYmxlIG9mIHVucGFja2luZyBhbiBhcmNoaXZlZCBvYmplY3QgdHJlZSBpbiB0aGUgTlNLZXllZEFyY2hpdmUgZm9ybWF0LlxuICogQXBwbGUncyBpbXBsZW1lbnRhdGlvbiBjYW4gYmUgZm91bmQgaGVyZTpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBsZS9zd2lmdC1jb3JlbGlicy1mb3VuZGF0aW9uL2Jsb2IvbWFpbi9Tb3VyY2VzL0ZvdW5kYXRpb24vTlNLZXllZFVuYXJjaGl2ZXIuc3dpZnRcbiAqL1xuY2xhc3MgVW5hcmNoaXZlIHtcbiAgY29uc3RydWN0b3IgKGlucHV0Qnl0ZXMpIHtcbiAgICB0aGlzLmlucHV0ID0gaW5wdXRCeXRlcztcbiAgICB0aGlzLnVucGFja2VkVWlkcyA9IHt9O1xuICAgIHRoaXMudG9wVUlEID0gTlVMTF9VSUQ7XG4gICAgdGhpcy5vYmplY3RzID0gW107XG4gIH1cblxuICB1bnBhY2tBcmNoaXZlSGVhZGVyICgpIHtcbiAgICBjb25zdCBwbGlzdCA9IHBsaXN0bGliLnBhcnNlQnVmZmVyKHRoaXMuaW5wdXQpWzBdO1xuICAgIGlmIChwbGlzdC4kYXJjaGl2ZXIgIT09IE5TS0VZRURBUkNISVZFUikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGB1bnN1cHBvcnRlZCBlbmNvZGVyOiAke3BsaXN0LiRhcmNoaXZlcn1gKTtcbiAgICB9XG4gICAgaWYgKHBsaXN0LiR2ZXJzaW9uICE9PSBOU0tFWUVEX0FSQ0hJVkVfVkVSU0lPTikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBleHBlY3RlZCAke05TS0VZRURfQVJDSElWRV9WRVJTSU9OfSwgZ290ICR7cGxpc3QuJHZlcnNpb24gfWApO1xuICAgIH1cbiAgICBjb25zdCB0b3AgPSBwbGlzdC4kdG9wO1xuICAgIGNvbnN0IHRvcFVJRCA9IHRvcC5yb290O1xuICAgIGlmICghdG9wVUlEKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYHRvcCBvYmplY3QgZGlkIG5vdCBoYXZlIGEgVUlEISBkdW1wOiAke0pTT04uc3RyaW5naWZ5KHRvcCl9YCk7XG4gICAgfVxuICAgIHRoaXMudG9wVUlEID0gdG9wVUlEO1xuICAgIHRoaXMub2JqZWN0cyA9IHBsaXN0LiRvYmplY3RzO1xuICB9XG5cbiAgLyoqXG4gICAqIHVzZSB0aGUgVU5BUkNISVZFX0NMQVNTX01BUCB0byBmaW5kIHRoZSB1bmFyY2hpdmluZyBkZWxlZ2F0ZSBvZiBhIHVpZFxuICAgKi9cbiAgY2xhc3NGb3JVaWQgKGluZGV4KSB7XG4gICAgY29uc3QgbWV0YSA9IHRoaXMub2JqZWN0c1tpbmRleC5VSURdO1xuICAgIGNvbnN0IG5hbWUgPSBtZXRhLiRjbGFzc25hbWU7XG4gICAgY29uc3Qga2xhc3MgPSBVTkFSQ0hJVkVfQ0xBU1NfTUFQW25hbWVdO1xuICAgIGlmICgha2xhc3MpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgbm8gbWFwcGluZyBmb3IgJHtuYW1lfSBpbiBVTkFSQ0hJVkVfQ0xBU1NfTUFQYCk7XG4gICAgfVxuICAgIHJldHVybiBrbGFzcztcbiAgfVxuXG4gIGRlY29kZUtleSAob2JqLCBrZXkpIHtcbiAgICBjb25zdCB2YWwgPSBvYmpba2V5XTtcbiAgICByZXR1cm4gXy5pc05pbCh2YWw/LlVJRCkgPyB2YWwgOiB0aGlzLmRlY29kZU9iamVjdCh2YWwpO1xuICB9XG5cbiAgZGVjb2RlT2JqZWN0IChpbmRleCkge1xuICAgIGlmIChpbmRleCA9PT0gTlVMTF9VSUQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBvYmogPSB0aGlzLnVucGFja2VkVWlkc1tpbmRleF07XG4gICAgaWYgKG9iaiA9PT0gQ1lDTEVfVE9LRU4pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgYXJjaGl2ZSBoYXMgYSBjeWNsZSB3aXRoICR7aW5kZXh9YCk7XG4gICAgfVxuICAgIGlmICghXy5pc1VuZGVmaW5lZChvYmopKSB7XG4gICAgICByZXR1cm4gb2JqO1xuICAgIH1cbiAgICBjb25zdCByYXdPYmogPSB0aGlzLm9iamVjdHNbaW5kZXguVUlEXTtcbiAgICB0aGlzLnVucGFja2VkVWlkc1tpbmRleC5VSURdID0gQ1lDTEVfVE9LRU47XG5cbiAgICBpZiAoIXJhd09iaj8uJGNsYXNzKSB7XG4gICAgICB0aGlzLnVucGFja2VkVWlkc1tpbmRleC5VSURdID0gb2JqO1xuICAgICAgcmV0dXJuIHJhd09iajtcbiAgICB9XG4gICAgY29uc3Qga2xhc3MgPSB0aGlzLmNsYXNzRm9yVWlkKHJhd09iai4kY2xhc3MpO1xuICAgIGNvbnN0IGtsYXNzT2JqID0gbmV3IGtsYXNzKCkuZGVjb2RlQXJjaGl2ZShuZXcgQXJjaGl2ZWRPYmplY3QocmF3T2JqLCB0aGlzKSk7XG4gICAgdGhpcy51bnBhY2tlZFVpZHNbaW5kZXguVUlEXSA9IGtsYXNzT2JqO1xuICAgIHJldHVybiBrbGFzc09iajtcbiAgfVxuXG4gIHRvT2JqZWN0ICgpIHtcbiAgICB0aGlzLnVucGFja0FyY2hpdmVIZWFkZXIoKTtcbiAgICByZXR1cm4gdGhpcy5kZWNvZGVPYmplY3QodGhpcy50b3BVSUQpO1xuICB9XG59XG5cbi8qKlxuICogQ2FwYWJsZSBvZiBwYWNraW5nIGFuIG9iamVjdCB0cmVlIGludG8gdGhlIE5TS2V5ZWRBcmNoaXZlIGZvcm1hdC5cbiAqIEFwcGxlJ3MgaW1wbGVtZW50YXRpb24gY2FuIGJlIGZvdW5kIGhlcmU6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vYXBwbGUvc3dpZnQtY29yZWxpYnMtZm91bmRhdGlvbi9ibG9iL21haW4vU291cmNlcy9Gb3VuZGF0aW9uL05TS2V5ZWRBcmNoaXZlci5zd2lmdFxuICovXG5jbGFzcyBBcmNoaXZlIHtcbiAgY29uc3RydWN0b3IgKGlucHV0T2JqZWN0KSB7XG4gICAgdGhpcy5pbnB1dCA9IGlucHV0T2JqZWN0O1xuICAgIHRoaXMuY2xhc3NNYXAgPSB7fTtcbiAgICB0aGlzLm9iamVjdHMgPSBbJyRudWxsJ107IC8vIG9iamVjdHMgdGhhdCBnbyBkaXJlY3RseSBpbnRvIHRoZSBhcmNoaXZlLCBhbHdheXMgc3RhcnQgd2l0aCAkbnVsbFxuICB9XG5cbiAgdWlkRm9yQXJjaGl2ZXIgKGFyY2hpdmVyKSB7XG4gICAgbGV0IHZhbCA9IHRoaXMuY2xhc3NNYXBbYXJjaGl2ZXJdO1xuICAgIGlmICh2YWwpIHtcbiAgICAgIHJldHVybiBuZXcgcGxpc3RsaWIuVUlEKHZhbCk7XG4gICAgfVxuICAgIHRoaXMuY2xhc3NNYXBbYXJjaGl2ZXJdID0gdGhpcy5vYmplY3RzLmxlbmd0aDtcbiAgICB2YWwgPSBuZXcgcGxpc3RsaWIuVUlEKHRoaXMub2JqZWN0cy5sZW5ndGgpO1xuICAgIHRoaXMub2JqZWN0cy5wdXNoKHtcbiAgICAgICckY2xhc3Nlcyc6IFthcmNoaXZlcl0sXG4gICAgICAnJGNsYXNzbmFtZSc6IGFyY2hpdmVyXG4gICAgfSk7XG4gICAgcmV0dXJuIHZhbDtcbiAgfVxuXG4gIGFyY2hpdmUgKG9iaikge1xuICAgIGlmIChfLmlzVW5kZWZpbmVkKG9iaikgfHwgXy5pc051bGwob2JqKSkge1xuICAgICAgcmV0dXJuIE5VTExfVUlEO1xuICAgIH1cbiAgICBjb25zdCBpbmRleCA9IG5ldyBwbGlzdGxpYi5VSUQodGhpcy5vYmplY3RzLmxlbmd0aCk7XG4gICAgaWYgKFBSSU1JVElWRV9UWVBFUy5pbmNsdWRlcyhvYmouY29uc3RydWN0b3IubmFtZSkpIHtcbiAgICAgIHRoaXMub2JqZWN0cy5wdXNoKG9iaik7XG4gICAgICByZXR1cm4gaW5kZXg7XG4gICAgfVxuICAgIGNvbnN0IGFyY2hpdmVPYmogPSB7fTtcbiAgICB0aGlzLm9iamVjdHMucHVzaChhcmNoaXZlT2JqKTtcbiAgICB0aGlzLmVuY29kZVRvcExldmVsKG9iaiwgYXJjaGl2ZU9iaik7XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgZW5jb2RlICh2YWwpIHtcbiAgICBpZiAoTk9OX0VOQ09EQUJMRV9UWVBFUy5pbmNsdWRlcyh0eXBlb2YgdmFsKSkge1xuICAgICAgcmV0dXJuIHZhbDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuYXJjaGl2ZSh2YWwpO1xuICB9XG5cbiAgZW5jb2RlVG9wTGV2ZWwgKG9iaiwgYXJjaGl2ZU9iaikge1xuICAgIGlmIChvYmogaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlQXJyYXkob2JqLCBhcmNoaXZlT2JqKTtcbiAgICB9IGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIFNldCkge1xuICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlU2V0KG9iaiwgYXJjaGl2ZU9iaik7XG4gICAgfSBlbHNlIGlmIChvYmogaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICAgIGNvbnN0IG9iak5hbWUgPSBvYmouY29uc3RydWN0b3IubmFtZTtcbiAgICAgIC8vIE9ubHkgc3BlY2lhbCBjbGFzcyBpbnN0YW5jZSBhcmUgdXNlZnVsLCBzdWNoIGFzIE5TVVJMLCBOU1VVSUQsIE5TRGF0ZS5cbiAgICAgIC8vIEFuZCB0aGlzIGNsYXNzIG11c3QgYWxzbyBoYXZlIHRoZSBlbmNvZGVBcmNoaXZlIG1ldGhvZFxuICAgICAgaWYgKG9iak5hbWUgaW4gVU5BUkNISVZFX0NMQVNTX01BUCkge1xuICAgICAgICBhcmNoaXZlT2JqLiRjbGFzcyA9IHRoaXMudWlkRm9yQXJjaGl2ZXIob2JqTmFtZSk7XG4gICAgICAgIG9iai5lbmNvZGVBcmNoaXZlKG9iaiwgbmV3IEFyY2hpdmluZ09iamVjdChhcmNoaXZlT2JqLCB0aGlzKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVEaWN0KG9iaiwgYXJjaGl2ZU9iaik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IEVycm9yKGBVbmFibGUgdG8gZW5jb2RlIHR5cGVzOiAke3R5cGVvZiBvYmp9YCk7XG4gICAgfVxuICB9XG5cbiAgZW5jb2RlQXJyYXkgKG9ianMsIGFyY2hpdmVPYmopIHtcbiAgICBhcmNoaXZlT2JqLiRjbGFzcyA9IHRoaXMudWlkRm9yQXJjaGl2ZXIoJ05TQXJyYXknKTtcbiAgICBhcmNoaXZlT2JqWydOUy5vYmplY3RzJ10gPSBvYmpzLm1hcCh0aGlzLmFyY2hpdmUuYmluZCh0aGlzKSk7XG4gIH1cblxuICBlbmNvZGVTZXQgKG9ianMsIGFyY2hpdmVPYmopIHtcbiAgICBhcmNoaXZlT2JqLiRjbGFzcyA9IHRoaXMudWlkRm9yQXJjaGl2ZXIoJ05TU2V0Jyk7XG4gICAgYXJjaGl2ZU9ialsnTlMub2JqZWN0cyddID0gb2Jqcy5tYXAodGhpcy5hcmNoaXZlLmJpbmQodGhpcykpO1xuICB9XG5cbiAgZW5jb2RlRGljdCAob2JqLCBhcmNoaXZlT2JqKSB7XG4gICAgYXJjaGl2ZU9iai4kY2xhc3MgPSB0aGlzLnVpZEZvckFyY2hpdmVyKCdOU0RpY3Rpb25hcnknKTtcbiAgICBhcmNoaXZlT2JqWydOUy5rZXlzJ10gPSBfLmtleXMob2JqKS5tYXAodGhpcy5hcmNoaXZlLmJpbmQodGhpcykpO1xuICAgIGFyY2hpdmVPYmpbJ05TLm9iamVjdHMnXSA9IF8udmFsdWVzKG9iaikubWFwKHRoaXMuYXJjaGl2ZS5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIHRvQnl0ZXMgKCkge1xuICAgIGlmICh0aGlzLm9iamVjdHMubGVuZ3RoID09PSAxKSB7XG4gICAgICB0aGlzLmFyY2hpdmUodGhpcy5pbnB1dCk7XG4gICAgfVxuICAgIGNvbnN0IGQgPSB7XG4gICAgICAnJHZlcnNpb24nOiBOU0tFWUVEX0FSQ0hJVkVfVkVSU0lPTixcbiAgICAgICckYXJjaGl2ZXInOiBOU0tFWUVEQVJDSElWRVIsXG4gICAgICAnJHRvcCc6IHsncm9vdCc6IG5ldyBwbGlzdGxpYi5VSUQoMSl9LFxuICAgICAgJyRvYmplY3RzJzogdGhpcy5vYmplY3RzXG4gICAgfTtcbiAgICByZXR1cm4gYnBsaXN0Q3JlYXRlKGQpO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBOU0tleWVkIEJ1ZmZlciBmcm9tIGFuIG9iamVjdFxuICogQHBhcmFtIHtPYmplY3R9IGlucHV0T2JqZWN0XG4gKiBAcmV0dXJucyB7QnVmZmVyfSBOU0tleWVkIEJ1ZmZlclxuICovXG5mdW5jdGlvbiBhcmNoaXZlIChpbnB1dE9iamVjdCkge1xuICByZXR1cm4gbmV3IEFyY2hpdmUoaW5wdXRPYmplY3QpLnRvQnl0ZXMoKTtcbn1cblxuLyoqXG4gKiBQYXJzZXMgTlNLZXllZCBCdWZmZXIgaW50byBKUyBPYmplY3RcbiAqIEBwYXJhbSB7QnVmZmVyfSBpbnB1dEJ5dGVzIE5TS2V5ZWQgQnVmZmVyXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBKUyBPYmplY3RcbiAqL1xuZnVuY3Rpb24gdW5hcmNoaXZlIChpbnB1dEJ5dGVzKSB7XG4gIHJldHVybiBuZXcgVW5hcmNoaXZlKGlucHV0Qnl0ZXMpLnRvT2JqZWN0KCk7XG59XG5cbi8qKlxuICogVXBkYXRlIHVua25vd24gTlNLZXllZEFyY2hpdmUgdHlwZXMgZm9yIHBhY2tpbmcvdW5wYWNraW5nXG4gKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBwYWNraW5nL3VucGFja2luZyBrZXkgbmFtZVxuICogQHBhcmFtIHtCYXNlQXJjaGl2ZUhhbmRsZXJ9IHN1YkNsYXNzIGluaGVyaXQgZnJvbSBCYXNlQXJjaGl2ZUhhbmRsZXIgY2xhc3NcbiAqL1xuZnVuY3Rpb24gdXBkYXRlTlNLZXllZEFyY2hpdmVDbGFzcyAobmFtZSwgc3ViQ2xhc3MpIHtcbiAgaWYgKCFfLmlzRnVuY3Rpb24oc3ViQ2xhc3MucHJvdG90eXBlPy5kZWNvZGVBcmNoaXZlKSAmJiAhXy5pc0Z1bmN0aW9uKHN1YkNsYXNzLnByb3RvdHlwZT8uZW5jb2RlQXJjaGl2ZSkpIHtcbiAgICB0aHJvdyBFcnJvcignc3ViQ2xhc3MgbXVzdCBoYXZlIGRlY29kZUFyY2hpdmUgb3IgZW5jb2RlQXJjaGl2ZSBtZXRob2RzJyk7XG4gIH1cbiAgaWYgKCEobmFtZSBpbiBVTkFSQ0hJVkVfQ0xBU1NfTUFQKSkge1xuICAgIFVOQVJDSElWRV9DTEFTU19NQVBbbmFtZV0gPSBzdWJDbGFzcztcbiAgfVxufVxuXG5leHBvcnQgeyB1cGRhdGVOU0tleWVkQXJjaGl2ZUNsYXNzLCBCYXNlQXJjaGl2ZUhhbmRsZXIsIE5TVVJMLCBOU1VVSUQsIE5TRGF0ZSwgdW5hcmNoaXZlLCBhcmNoaXZlfTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSxJQUFBQSxhQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxjQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxLQUFBLEdBQUFGLE9BQUE7QUFDQSxJQUFBRyxPQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7QUFFQSxNQUFNSSx1QkFBdUIsR0FBRyxPQUFPO0FBQ3ZDLE1BQU1DLFFB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