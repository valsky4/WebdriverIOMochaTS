"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.PlistServiceDecoder = void 0;
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _stream = _interopRequireDefault(require("stream"));
var _support = require("@appium/support");
const HEADER_LENGTH = 4;
class PlistServiceDecoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }
  _transform(data, encoding, onData) {
    this._decode(data);
    onData();
  }
  _decode(data) {
    const payload = data.slice(HEADER_LENGTH, data.length);
    if (_lodash.default.isEmpty(payload)) {
      return;
    }
    const object = _support.plist.parsePlist(payload);
    if (!object) {
      return;
    }
    this.push(object);
  }
}
exports.PlistServiceDecoder = PlistServiceDecoder;
var _default = PlistServiceDecoder;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfc3RyZWFtIiwiX3N1cHBvcnQiLCJIRUFERVJfTEVOR1RIIiwiUGxpc3RTZXJ2aWNlRGVjb2RlciIsIlN0cmVhbSIsIlRyYW5zZm9ybSIsImNvbnN0cnVjdG9yIiwib2JqZWN0TW9kZSIsIl90cmFuc2Zvcm0iLCJkYXRhIiwiZW5jb2RpbmciLCJvbkRhdGEiLCJfZGVjb2RlIiwicGF5bG9hZCIsInNsaWNlIiwibGVuZ3RoIiwiXyIsImlzRW1wdHkiLCJvYmplY3QiLCJwbGlzdCIsInBhcnNlUGxpc3QiLCJwdXNoIiwiZXhwb3J0cyIsIl9kZWZhdWx0IiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2xpYi9wbGlzdC1zZXJ2aWNlL3RyYW5zZm9ybWVyL3BsaXN0LXNlcnZpY2UtZGVjb2Rlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IFN0cmVhbSBmcm9tICdzdHJlYW0nO1xuaW1wb3J0IHsgcGxpc3QgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuXG5jb25zdCBIRUFERVJfTEVOR1RIID0gNDtcblxuY2xhc3MgUGxpc3RTZXJ2aWNlRGVjb2RlciBleHRlbmRzIFN0cmVhbS5UcmFuc2Zvcm0ge1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcih7IG9iamVjdE1vZGU6IHRydWUgfSk7XG4gIH1cblxuICBfdHJhbnNmb3JtIChkYXRhLCBlbmNvZGluZywgb25EYXRhKSB7XG4gICAgdGhpcy5fZGVjb2RlKGRhdGEpO1xuICAgIG9uRGF0YSgpO1xuICB9XG5cbiAgX2RlY29kZSAoZGF0YSkge1xuICAgIGNvbnN0IHBheWxvYWQgPSBkYXRhLnNsaWNlKEhFQURFUl9MRU5HVEgsIGRhdGEubGVuZ3RoKTtcbiAgICBpZiAoXy5pc0VtcHR5KHBheWxvYWQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG9iamVjdCA9IHBsaXN0LnBhcnNlUGxpc3QocGF5bG9hZCk7XG4gICAgaWYgKCFvYmplY3QpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5wdXNoKG9iamVjdCk7XG4gIH1cbn1cblxuZXhwb3J0IHsgUGxpc3RTZXJ2aWNlRGVjb2RlciB9O1xuZXhwb3J0IGRlZmF1bHQgUGxpc3RTZXJ2aWNlRGVjb2RlcjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxJQUFBQSxPQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxPQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxRQUFBLEdBQUFGLE9BQUE7QUFFQSxNQUFNRyxhQUFhLEdBQUcsQ0FBQztBQUV2QixNQUFNQyxtQkFBbUIsU0FBU0MsZUFBTSxDQUFDQyxTQUFTLENBQUM7RUFFakRDLFdBQVdBLENBQUEsRUFBSTtJQUNiLEtBQUssQ0FBQztNQUFFQyxVQUFVLEVBQUU7SUFBSyxDQUFDLENBQUM7RUFDN0I7RUFFQUMsVUFBVUEsQ0FBRUMsSUFBSSxFQUFFQyxRQUFRLEVBQUVDLE1BQU0sRUFBRTtJQUNsQyxJQUFJLENBQUNDLE9BQU8sQ0FBQ0gsSUFBSSxDQUFDO0lBQ2xCRSxNQUFNLEVBQUU7RUFDVjtFQUVBQyxPQUFPQSxDQUFFSCxJQUFJLEVBQUU7SUFDYixNQUFNSSxPQUFPLEdBQUdKLElBQUksQ0FBQ0ssS0FBSyxDQUFDWixhQUFhLEVBQUVPLElBQUksQ0FBQ00sTUFBTSxDQUFDO0lBQ3RELElBQUlDLGVBQUMsQ0FBQ0MsT0FBTyxDQUFDSixPQUFPLENBQUMsRUFBRTtNQUN0QjtJQUNGO0lBQ0EsTUFBTUssTUFBTSxHQUFHQyxjQUFLLENBQUNDLFVBQVUsQ0FBQ1AsT0FBTyxDQUFDO0lBQ3hDLElBQUksQ0FBQ0ssTUFBTSxFQUFFO01BQ1g7SUFDRjtJQUNBLElBQUksQ0FBQ0csSUFBSSxDQUFDSCxNQUFNLENBQUM7RUFDbkI7QUFDRjtBQUFDSSxPQUFBLENBQUFuQixtQkFBQSxHQUFBQSxtQkFBQTtBQUFBLElBQUFvQixRQUFBLEdBR2NwQixtQkFBbUI7QUFBQW1CLE9BQUEsQ0FBQUUsT0FBQSxHQUFBRCxRQUFBIn0=