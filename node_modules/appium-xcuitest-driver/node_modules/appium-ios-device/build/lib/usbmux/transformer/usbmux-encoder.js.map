{"version":3,"file":"usbmux-encoder.js","names":["_stream","_interopRequireDefault","require","_support","HEADER_LENGTH","VERSION","TYPE","UsbmuxEncoder","Stream","Transform","constructor","objectMode","_transform","data","encoding","onData","_encode","payloadBuffer","Buffer","from","plist","createPlist","payload","header","length","version","type","tag","headerBuffer","allocUnsafe","writeUInt32LE","push","concat","exports","_default","default"],"sources":["../../../../lib/usbmux/transformer/usbmux-encoder.js"],"sourcesContent":["import Stream from 'stream';\nimport { plist } from '@appium/support';\n\nconst HEADER_LENGTH = 16;\nconst VERSION = 1;\nconst TYPE = 8;\n\nclass UsbmuxEncoder extends Stream.Transform {\n  constructor () {\n    super({ objectMode: true });\n  }\n\n  _transform (data, encoding, onData) {\n    this._encode(data);\n    onData();\n  }\n\n  _encode (data) {\n    const payloadBuffer = Buffer.from(plist.createPlist(data.payload, false));\n\n    const header = {\n      length: HEADER_LENGTH + payloadBuffer.length,\n      version: VERSION,\n      type: TYPE,\n      tag: data.tag\n    };\n\n    const headerBuffer = Buffer.allocUnsafe(HEADER_LENGTH);\n    headerBuffer.writeUInt32LE(header.length, 0);\n    headerBuffer.writeUInt32LE(header.version, 4);\n    headerBuffer.writeUInt32LE(header.type, 8);\n    headerBuffer.writeUInt32LE(header.tag, 12);\n\n    this.push(Buffer.concat([headerBuffer, payloadBuffer], headerBuffer.length + payloadBuffer.length));\n  }\n}\n\nexport { UsbmuxEncoder};\nexport default UsbmuxEncoder;\n"],"mappings":";;;;;;;;AAAA,IAAAA,OAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,QAAA,GAAAD,OAAA;AAEA,MAAME,aAAa,GAAG,EAAE;AACxB,MAAMC,OAAO,GAAG,CAAC;AACjB,MAAMC,IAAI,GAAG,CAAC;AAEd,MAAMC,aAAa,SAASC,eAAM,CAACC,SAAS,CAAC;EAC3CC,WAAWA,CAAA,EAAI;IACb,KAAK,CAAC;MAAEC,UAAU,EAAE;IAAK,CAAC,CAAC;EAC7B;EAEAC,UAAUA,CAAEC,IAAI,EAAEC,QAAQ,EAAEC,MAAM,EAAE;IAClC,IAAI,CAACC,OAAO,CAACH,IAAI,CAAC;IAClBE,MAAM,EAAE;EACV;EAEAC,OAAOA,CAAEH,IAAI,EAAE;IACb,MAAMI,aAAa,GAAGC,MAAM,CAACC,IAAI,CAACC,cAAK,CAACC,WAAW,CAACR,IAAI,CAACS,OAAO,EAAE,KAAK,CAAC,CAAC;IAEzE,MAAMC,MAAM,GAAG;MACbC,MAAM,EAAEpB,aAAa,GAAGa,aAAa,CAACO,MAAM;MAC5CC,OAAO,EAAEpB,OAAO;MAChBqB,IAAI,EAAEpB,IAAI;MACVqB,GAAG,EAAEd,IAAI,CAACc;IACZ,CAAC;IAED,MAAMC,YAAY,GAAGV,MAAM,CAACW,WAAW,CAACzB,aAAa,CAAC;IACtDwB,YAAY,CAACE,aAAa,CAACP,MAAM,CAACC,MAAM,EAAE,CAAC,CAAC;IAC5CI,YAAY,CAACE,aAAa,CAACP,MAAM,CAACE,OAAO,EAAE,CAAC,CAAC;IAC7CG,YAAY,CAACE,aAAa,CAACP,MAAM,CAACG,IAAI,EAAE,CAAC,CAAC;IAC1CE,YAAY,CAACE,aAAa,CAACP,MAAM,CAACI,GAAG,EAAE,EAAE,CAAC;IAE1C,IAAI,CAACI,IAAI,CAACb,MAAM,CAACc,MAAM,CAAC,CAACJ,YAAY,EAAEX,aAAa,CAAC,EAAEW,YAAY,CAACJ,MAAM,GAAGP,aAAa,CAACO,MAAM,CAAC,CAAC;EACrG;AACF;AAACS,OAAA,CAAA1B,aAAA,GAAAA,aAAA;AAAA,IAAA2B,QAAA,GAGc3B,aAAa;AAAA0B,OAAA,CAAAE,OAAA,GAAAD,QAAA"}