"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.StreamLogger = void 0;
require("source-map-support/register");
var _stream = _interopRequireDefault(require("stream"));
var _lodash = _interopRequireDefault(require("lodash"));
var _logger = _interopRequireDefault(require("../../logger"));
const MIN_PRINTABLE_CHAR = 32;
const MAX_PRINTABLE_CHAR = 126;
const CHARACTERS_PER_LINE = 19;
class StreamLogger extends _stream.default.Transform {
  constructor(direction, verbose = false) {
    super({
      objectMode: true
    });
    this._direction = direction;
    this._verbose = verbose;
  }
  _transform(data, encoding, onData) {
    if (this._verbose) {
      try {
        this._log(data);
      } catch (err) {
        _logger.default.debug(`Error logging data: ${err.message}`);
      }
    }
    this.push(data);
    onData();
  }
  _log(data) {
    _logger.default.debug(`Data ${this._direction === StreamLogger.SEND ? 'sent' : 'received'}, length: ${data.length}`);
    let i = 0;
    while (i < data.length) {
      let hex = [],
        char = [];
      for (let j = 0; j < CHARACTERS_PER_LINE; j++) {
        if (i >= data.length) {
          hex[j] = '  ';
          continue;
        }
        const charCode = data[i++];
        hex[j] = _lodash.default.padStart(charCode.toString(16).toUpperCase(), 2, '0');
        char[j] = charCode < MIN_PRINTABLE_CHAR || charCode > MAX_PRINTABLE_CHAR ? '.' : String.fromCharCode(charCode);
      }
      _logger.default.debug(`${hex.join(' ')} ${char.join('')}`);
    }
  }
}
exports.StreamLogger = StreamLogger;
StreamLogger.SEND = 0;
StreamLogger.RECEIVE = 1;
var _default = StreamLogger;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc3RyZWFtIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfbG9kYXNoIiwiX2xvZ2dlciIsIk1JTl9QUklOVEFCTEVfQ0hBUiIsIk1BWF9QUklOVEFCTEVfQ0hBUiIsIkNIQVJBQ1RFUlNfUEVSX0xJTkUiLCJTdHJlYW1Mb2dnZXIiLCJTdHJlYW0iLCJUcmFuc2Zvcm0iLCJjb25zdHJ1Y3RvciIsImRpcmVjdGlvbiIsInZlcmJvc2UiLCJvYmplY3RNb2RlIiwiX2RpcmVjdGlvbiIsIl92ZXJib3NlIiwiX3RyYW5zZm9ybSIsImRhdGEiLCJlbmNvZGluZyIsIm9uRGF0YSIsIl9sb2ciLCJlcnIiLCJsb2ciLCJkZWJ1ZyIsIm1lc3NhZ2UiLCJwdXNoIiwiU0VORCIsImxlbmd0aCIsImkiLCJoZXgiLCJjaGFyIiwiaiIsImNoYXJDb2RlIiwiXyIsInBhZFN0YXJ0IiwidG9TdHJpbmciLCJ0b1VwcGVyQ2FzZSIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImpvaW4iLCJleHBvcnRzIiwiUkVDRUlWRSIsIl9kZWZhdWx0IiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2xpYi91dGlsL3RyYW5zZm9ybWVyL3N0cmVhbS1sb2dnZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFN0cmVhbSBmcm9tICdzdHJlYW0nO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vLi4vbG9nZ2VyJztcblxuXG5jb25zdCBNSU5fUFJJTlRBQkxFX0NIQVIgPSAzMjtcbmNvbnN0IE1BWF9QUklOVEFCTEVfQ0hBUiA9IDEyNjtcblxuY29uc3QgQ0hBUkFDVEVSU19QRVJfTElORSA9IDE5O1xuXG5jbGFzcyBTdHJlYW1Mb2dnZXIgZXh0ZW5kcyBTdHJlYW0uVHJhbnNmb3JtIHtcbiAgY29uc3RydWN0b3IgKGRpcmVjdGlvbiwgdmVyYm9zZSA9IGZhbHNlKSB7XG4gICAgc3VwZXIoeyBvYmplY3RNb2RlOiB0cnVlIH0pO1xuXG4gICAgdGhpcy5fZGlyZWN0aW9uID0gZGlyZWN0aW9uO1xuICAgIHRoaXMuX3ZlcmJvc2UgPSB2ZXJib3NlO1xuICB9XG5cbiAgX3RyYW5zZm9ybSAoZGF0YSwgZW5jb2RpbmcsIG9uRGF0YSkge1xuICAgIGlmICh0aGlzLl92ZXJib3NlKSB7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLl9sb2coZGF0YSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gaW4gY2FzZSBzb21ldGhpbmcgZ29lcyB3cm9uZywgbG9nIGl0IHNvIHdlIGNhbiBmaXggdGhlIHBhcnNpbmdcbiAgICAgICAgLy8gYW5kIGFsc28gYWxsb3cgZXZlcnl0aGluZyB0byBjb250aW51ZSB3aXRob3V0IGludGVycnVwdGlvblxuICAgICAgICBsb2cuZGVidWcoYEVycm9yIGxvZ2dpbmcgZGF0YTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnB1c2goZGF0YSk7XG4gICAgb25EYXRhKCk7XG4gIH1cblxuICBfbG9nIChkYXRhKSB7XG4gICAgbG9nLmRlYnVnKGBEYXRhICR7dGhpcy5fZGlyZWN0aW9uID09PSBTdHJlYW1Mb2dnZXIuU0VORCA/ICdzZW50JyA6ICdyZWNlaXZlZCd9LCBsZW5ndGg6ICR7ZGF0YS5sZW5ndGh9YCk7XG5cbiAgICAvLyBmb3JtYXQgYXMgdXNlZCBieSBpb3Mtd2Via2l0LWRlYnVnLXByb3h5IGFzIHdlbGwgYXMgdG9vbHMgbGlrZSBzb2NhdFxuICAgIC8vIHByaW50IG91dCB0aGUgZGF0YSBpbiB0d28gc2VjdGlvbnMsIG9uZSB0aGUgaGV4YWRlY2ltYWwgcmVuZGVyaW5ncyBvZiB0aGUgY2hhcmFjdGVycyxcbiAgICAvLyB0aGUgb3RoZXIgdGhlIHByaW50YWJsZSBjaGFyYWN0ZXJzICh3aXRoICcuJyBmb3IgdW5wcmludGFibGUgY2hhcmFjdGVycykuXG4gICAgbGV0IGkgPSAwO1xuICAgIHdoaWxlIChpIDwgZGF0YS5sZW5ndGgpIHtcbiAgICAgIGxldCBoZXggPSBbXSwgY2hhciA9IFtdO1xuICAgICAgLy8gY3JlYXRlIGVhY2ggbGluZSBvZiB0ZXh0IHRvIG91dHB1dFxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBDSEFSQUNURVJTX1BFUl9MSU5FOyBqKyspIHtcbiAgICAgICAgaWYgKGkgPj0gZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAvLyBmaWxsIGluIHRoZSBjaGFyY29kZSBzZWN0aW9uIHdpdGggYmxhbmtzLCBmb3IgZm9ybWF0dGluZyxcbiAgICAgICAgICAvLyB3aGVuIHRoZXJlIGlzIG5vIG1vcmUgZGF0YVxuICAgICAgICAgIGhleFtqXSA9ICcgICc7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhckNvZGUgPSBkYXRhW2krK107XG4gICAgICAgIC8vIGhleGFkZWNpbWFsIHJlcHJlc2VudGF0aW9uLCBmb3JjZWQgaW50byAyIHBsYWNlc1xuICAgICAgICBoZXhbal0gPSBfLnBhZFN0YXJ0KGNoYXJDb2RlLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpLCAyLCAnMCcpO1xuICAgICAgICAvLyBjaGFyYWN0ZXIgcmVwcmVzZW50YXRpb24sIHdpdGggJy4nIHdoZW4gdW5wcmludGFibGVcbiAgICAgICAgY2hhcltqXSA9IGNoYXJDb2RlIDwgTUlOX1BSSU5UQUJMRV9DSEFSIHx8IGNoYXJDb2RlID4gTUFYX1BSSU5UQUJMRV9DSEFSXG4gICAgICAgICAgPyAnLidcbiAgICAgICAgICA6IFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpO1xuICAgICAgfVxuICAgICAgbG9nLmRlYnVnKGAke2hleC5qb2luKCcgJyl9ICR7Y2hhci5qb2luKCcnKX1gKTtcbiAgICB9XG4gIH1cbn1cblxuU3RyZWFtTG9nZ2VyLlNFTkQgPSAwO1xuU3RyZWFtTG9nZ2VyLlJFQ0VJVkUgPSAxO1xuXG5leHBvcnQgeyBTdHJlYW1Mb2dnZXIgfTtcbmV4cG9ydCBkZWZhdWx0IFN0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