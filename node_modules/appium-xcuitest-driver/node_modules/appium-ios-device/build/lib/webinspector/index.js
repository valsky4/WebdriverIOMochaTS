"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.WebInspectorService = exports.WEB_INSPECTOR_SERVICE_NAME = void 0;
exports.cleanupRpcObject = cleanupRpcObject;
exports.default = void 0;
require("source-map-support/register");
var _webinspectorDecoder = _interopRequireDefault(require("./transformer/webinspector-decoder"));
var _webinspectorEncoder = _interopRequireDefault(require("./transformer/webinspector-encoder"));
var _plistServiceDecoder = _interopRequireDefault(require("../plist-service/transformer/plist-service-decoder"));
var _plistServiceEncoder = _interopRequireDefault(require("../plist-service/transformer/plist-service-encoder"));
var _lengthBasedSplitter = _interopRequireDefault(require("../util/transformer/length-based-splitter"));
var _streamLogger = _interopRequireDefault(require("../util/transformer/stream-logger"));
var _lodash = _interopRequireDefault(require("lodash"));
var _support = require("@appium/support");
var _constants = require("../constants");
var _logger = _interopRequireDefault(require("../logger"));
var _baseService = require("../base-service");
const WEB_INSPECTOR_SERVICE_NAME = 'com.apple.webinspector';
exports.WEB_INSPECTOR_SERVICE_NAME = WEB_INSPECTOR_SERVICE_NAME;
const MAX_FRAME_SIZE = 20 * _constants.MB;
const PARTIAL_MESSAGE_SUPPORT_DEPRECATION_VERSION = 11;
function cleanupRpcObject(obj) {
  const isArray = _lodash.default.isArray(obj);
  if (!_lodash.default.isPlainObject(obj) && !isArray) {
    return obj;
  }
  if (isArray) {
    return _lodash.default.filter(obj, _lodash.default.negate(_lodash.default.isNil));
  }
  return _lodash.default.reduce(obj, (result, value, key) => {
    if (!_lodash.default.isNil(value)) {
      result[key] = cleanupRpcObject(value);
    }
    return result;
  }, {});
}
class WebInspectorService extends _baseService.BaseServiceSocket {
  constructor(opts = {}) {
    const {
      majorOsVersion,
      isSimulator = false,
      socketChunkSize,
      verbose = false,
      verboseHexDump = false,
      socketClient,
      maxFrameLength = MAX_FRAME_SIZE
    } = opts;
    super(socketClient);
    if (_lodash.default.isFunction(socketClient.setMaxSendFragment) && !_lodash.default.isNil(socketChunkSize) && socketChunkSize > 0) {
      if (socketClient.setMaxSendFragment(socketChunkSize)) {
        _logger.default.debug(`Maximum TLS fragment size set to '${socketChunkSize}'`);
      } else {
        _logger.default.warn(`Unable to set TLS fragment size to '${socketChunkSize}'`);
      }
    }
    this._verbose = verbose;
    this._isSimulator = isSimulator;
    this._majorOsVersion = majorOsVersion;
    if (!isSimulator && majorOsVersion < PARTIAL_MESSAGE_SUPPORT_DEPRECATION_VERSION) {
      this._initializePartialMessageSupport(verboseHexDump, maxFrameLength);
    } else {
      this._initializeFullMessageSupport(verboseHexDump, maxFrameLength);
    }
  }
  _initializeFullMessageSupport(verbose, maxFrameLength) {
    this._decoder = new _plistServiceDecoder.default();
    this._socketClient.pipe(new _streamLogger.default(_streamLogger.default.RECEIVE, verbose)).pipe(this._splitter = new _lengthBasedSplitter.default({
      readableStream: this._socketClient,
      littleEndian: false,
      maxFrameLength,
      lengthFieldOffset: 0,
      lengthFieldLength: 4,
      lengthAdjustment: 4
    })).pipe(this._decoder);
    this._encoder = new _plistServiceEncoder.default();
    this._encoder.pipe(new _streamLogger.default(_streamLogger.default.SEND, verbose)).pipe(this._socketClient);
  }
  _initializePartialMessageSupport(verbose, maxFrameLength) {
    this._decoder = new _webinspectorDecoder.default(_constants.MB);
    this._socketClient.pipe(new _streamLogger.default(_streamLogger.default.RECEIVE, verbose)).pipe(this._splitter = new _lengthBasedSplitter.default({
      readableStream: this._socketClient,
      littleEndian: false,
      maxFrameLength,
      lengthFieldOffset: 0,
      lengthFieldLength: 4,
      lengthAdjustment: 4
    })).pipe(new _plistServiceDecoder.default()).pipe(this._decoder);
    this._encoder = new _webinspectorEncoder.default();
    this._encoder.pipe(new _plistServiceEncoder.default()).pipe(new _streamLogger.default(_streamLogger.default.SEND, verbose)).pipe(this._socketClient);
  }
  sendMessage(rpcObject) {
    if (_lodash.default.isNil(rpcObject)) {
      throw new Error('Cannot send a null object');
    }
    let message = rpcObject;
    let lastError;
    try {
      try {
        this._encoder.write(message);
      } catch (e) {
        if (e instanceof TypeError) {
          message = cleanupRpcObject(message);
          this._encoder.write(message);
        } else {
          throw e;
        }
      }
    } catch (err) {
      lastError = err;
    }
    if (this._verbose || lastError) {
      _logger.default.debug('Sent message to Web Inspector:');
      _logger.default.debug(_support.util.jsonStringify(message));
      if (!_lodash.default.isEqual(message, rpcObject)) {
        _logger.default.debug('Original message:');
        _logger.default.debug(_support.util.jsonStringify(rpcObject));
      }
    }
    if (lastError) {
      throw lastError;
    }
    if (!this._isSimulator && this._majorOsVersion >= PARTIAL_MESSAGE_SUPPORT_DEPRECATION_VERSION) {
      this._encoder.write(' ');
    }
  }
  listenMessage(onData) {
    this._decoder.on('data', data => {
      if (this._verbose) {
        _logger.default.debug('Received message from Web Inspector:');
        _logger.default.debug(_support.util.jsonStringify(data));
      }
      onData(data);
    });
  }
}
exports.WebInspectorService = WebInspectorService;
var _default = WebInspectorService;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfd2ViaW5zcGVjdG9yRGVjb2RlciIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX3dlYmluc3BlY3RvckVuY29kZXIiLCJfcGxpc3RTZXJ2aWNlRGVjb2RlciIsIl9wbGlzdFNlcnZpY2VFbmNvZGVyIiwiX2xlbmd0aEJhc2VkU3BsaXR0ZXIiLCJfc3RyZWFtTG9nZ2VyIiwiX2xvZGFzaCIsIl9zdXBwb3J0IiwiX2NvbnN0YW50cyIsIl9sb2dnZXIiLCJfYmFzZVNlcnZpY2UiLCJXRUJfSU5TUEVDVE9SX1NFUlZJQ0VfTkFNRSIsImV4cG9ydHMiLCJNQVhfRlJBTUVfU0laRSIsIk1CIiwiUEFSVElBTF9NRVNTQUdFX1NVUFBPUlRfREVQUkVDQVRJT05fVkVSU0lPTiIsImNsZWFudXBScGNPYmplY3QiLCJvYmoiLCJpc0FycmF5IiwiXyIsImlzUGxhaW5PYmplY3QiLCJmaWx0ZXIiLCJuZWdhdGUiLCJpc05pbCIsInJlZHVjZSIsInJlc3VsdCIsInZhbHVlIiwia2V5IiwiV2ViSW5zcGVjdG9yU2VydmljZSIsIkJhc2VTZXJ2aWNlU29ja2V0IiwiY29uc3RydWN0b3IiLCJvcHRzIiwibWFqb3JPc1ZlcnNpb24iLCJpc1NpbXVsYXRvciIsInNvY2tldENodW5rU2l6ZSIsInZlcmJvc2UiLCJ2ZXJib3NlSGV4RHVtcCIsInNvY2tldENsaWVudCIsIm1heEZyYW1lTGVuZ3RoIiwiaXNGdW5jdGlvbiIsInNldE1heFNlbmRGcmFnbWVudCIsImxvZyIsImRlYnVnIiwid2FybiIsIl92ZXJib3NlIiwiX2lzU2ltdWxhdG9yIiwiX21ham9yT3NWZXJzaW9uIiwiX2luaXRpYWxpemVQYXJ0aWFsTWVzc2FnZVN1cHBvcnQiLCJfaW5pdGlhbGl6ZUZ1bGxNZXNzYWdlU3VwcG9ydCIsIl9kZWNvZGVyIiwiUGxpc3RTZXJ2aWNlRGVjb2RlciIsIl9zb2NrZXRDbGllbnQiLCJwaXBlIiwiU3RyZWFtTG9nZ2VyIiwiUkVDRUlWRSIsIl9zcGxpdHRlciIsIkxlbmd0aEJhc2VkU3BsaXR0ZXIiLCJyZWFkYWJsZVN0cmVhbSIsImxpdHRsZUVuZGlhbiIsImxlbmd0aEZpZWxkT2Zmc2V0IiwibGVuZ3RoRmllbGRMZW5ndGgiLCJsZW5ndGhBZGp1c3RtZW50IiwiX2VuY29kZXIiLCJQbGlzdFNlcnZpY2VFbmNvZGVyIiwiU0VORCIsIldlYkluc3BlY3RvckRlY29kZXIiLCJXZWJJbnNwZWN0b3JFbmNvZGVyIiwic2VuZE1lc3NhZ2UiLCJycGNPYmplY3QiLCJFcnJvciIsIm1lc3NhZ2UiLCJsYXN0RXJyb3IiLCJ3cml0ZSIsImUiLCJUeXBlRXJyb3IiLCJlcnIiLCJ1dGlsIiwianNvblN0cmluZ2lmeSIsImlzRXF1YWwiLCJsaXN0ZW5NZXNzYWdlIiwib25EYXRhIiwib24iLCJkYXRhIiwiX2RlZmF1bHQiLCJkZWZhdWx0Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL3dlYmluc3BlY3Rvci9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgV2ViSW5zcGVjdG9yRGVjb2RlciBmcm9tICcuL3RyYW5zZm9ybWVyL3dlYmluc3BlY3Rvci1kZWNvZGVyJztcbmltcG9ydCBXZWJJbnNwZWN0b3JFbmNvZGVyIGZyb20gJy4vdHJhbnNmb3JtZXIvd2ViaW5zcGVjdG9yLWVuY29kZXInO1xuaW1wb3J0IFBsaXN0U2VydmljZURlY29kZXIgZnJvbSAnLi4vcGxpc3Qtc2VydmljZS90cmFuc2Zvcm1lci9wbGlzdC1zZXJ2aWNlLWRlY29kZXInO1xuaW1wb3J0IFBsaXN0U2VydmljZUVuY29kZXIgZnJvbSAnLi4vcGxpc3Qtc2VydmljZS90cmFuc2Zvcm1lci9wbGlzdC1zZXJ2aWNlLWVuY29kZXInO1xuaW1wb3J0IExlbmd0aEJhc2VkU3BsaXR0ZXIgZnJvbSAnLi4vdXRpbC90cmFuc2Zvcm1lci9sZW5ndGgtYmFzZWQtc3BsaXR0ZXInO1xuaW1wb3J0IFN0cmVhbUxvZ2dlciBmcm9tICcuLi91dGlsL3RyYW5zZm9ybWVyL3N0cmVhbS1sb2dnZXInO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHsgTUIgfSBmcm9tICcuLi9jb25zdGFudHMnO1xuaW1wb3J0IGxvZyBmcm9tICcuLi9sb2dnZXInO1xuaW1wb3J0IHsgQmFzZVNlcnZpY2VTb2NrZXQgfSBmcm9tICcuLi9iYXNlLXNlcnZpY2UnO1xuXG5cbmNvbnN0IFdFQl9JTlNQRUNUT1JfU0VSVklDRV9OQU1FID0gJ2NvbS5hcHBsZS53ZWJpbnNwZWN0b3InO1xuY29uc3QgTUFYX0ZSQU1FX1NJWkUgPSAyMCAqIE1CO1xuXG5jb25zdCBQQVJUSUFMX01FU1NBR0VfU1VQUE9SVF9ERVBSRUNBVElPTl9WRVJTSU9OID0gMTE7XG5cbmZ1bmN0aW9uIGNsZWFudXBScGNPYmplY3QgKG9iaikge1xuICBjb25zdCBpc0FycmF5ID0gXy5pc0FycmF5KG9iaik7XG4gIGlmICghXy5pc1BsYWluT2JqZWN0KG9iaikgJiYgIWlzQXJyYXkpIHtcbiAgICByZXR1cm4gb2JqO1xuICB9XG5cbiAgaWYgKGlzQXJyYXkpIHtcbiAgICByZXR1cm4gXy5maWx0ZXIob2JqLCBfLm5lZ2F0ZShfLmlzTmlsKSk7XG4gIH1cblxuICByZXR1cm4gXy5yZWR1Y2Uob2JqLCAocmVzdWx0LCB2YWx1ZSwga2V5KSA9PiB7XG4gICAgaWYgKCFfLmlzTmlsKHZhbHVlKSkge1xuICAgICAgcmVzdWx0W2tleV0gPSBjbGVhbnVwUnBjT2JqZWN0KHZhbHVlKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSwge30pO1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFdlYkluc3BlY3RvclNlcnZpY2VPcHRpb25zXG4gKlxuICogQHByb3BlcnR5IHtudW1iZXJ9IG1ham9yT3NWZXJzaW9uIFRoZSBtYWpvciB2ZXJzaW9uIG9mIHRoZSBvcyB2ZXJzaW9uXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGlzU2ltdWxhdG9yIFdoZXRoZXIgdGhlIGRldmljZSBpcyBhIHNpbXVsYXRvclxuICogQHByb3BlcnR5IHs/bnVtYmVyfSBzb2NrZXRDaHVua1NpemUgU2l6ZSwgaW4gYnl0ZXMgb2YgdGhlIGNodW5rcyB0byBzZW5kIHRvXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFsIGRldmljZSAob25seSBpT1MgMTErKS4gRGVmYXVsdHMgdG9cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDE2Mzg0IGJ5dGVzICh0aGUgVExTU29ja2V0IG1heCkuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IHZlcmJvc2UgVHVybiBvbiBsb2dnaW5nIG9mIGVhY2ggbWVzc2FnZSBzZW50IG9yIHJlY2VpdmVkLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHRzIHRvIGZhbHNlXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IHZlcmJvc2VIZXhEdW1wIFR1cm4gb24gbG9nZ2luZyBvZiBfYWxsXyBjb21tdW5pY2F0aW9uIGFzXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhleCBkdW1wLiBEZWZhdWx0cyB0byBmYWxzZVxuICogQHByb3BlcnR5IHsqfSBzb2NrZXRDbGllbnQgVGhlIHNvY2tldCBjbGllbnQgd2hlcmUgdGhlIGNvbW11bmljYXRpb24gd2lsbCBoYXBwZW5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBtYXhGcmFtZUxlbmd0aCBbMjAgKiAxMDI0ICogMTAyNF0gLSBUaGUgbWF4aW11bSBzaXplXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW4gYnl0ZXMgb2YgYSBzaW5nbGUgZGF0YSBmcmFtZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIHRoZSBkZXZpY2UgY29tbXVuaWNhdGlvbiBwcm90b2NvbFxuICovXG5cbmNsYXNzIFdlYkluc3BlY3RvclNlcnZpY2UgZXh0ZW5kcyBCYXNlU2VydmljZVNvY2tldCB7XG4gIC8qKlxuICAgKiBUaGUgbWFpbiBzZXJ2aWNlIGZvciBjb21tdW5pY2F0aW9uIHdpdGggdGhlIHdlYmluc3BlY3RvcmRcbiAgICpcbiAgICogQHBhcmFtIHtXZWJJbnNwZWN0b3JTZXJ2aWNlT3B0aW9uc31cbiAgICovXG4gIGNvbnN0cnVjdG9yIChvcHRzID0ge30pIHtcbiAgICBjb25zdCB7XG4gICAgICBtYWpvck9zVmVyc2lvbixcbiAgICAgIGlzU2ltdWxhdG9yID0gZmFsc2UsXG4gICAgICBzb2NrZXRDaHVua1NpemUsXG4gICAgICB2ZXJib3NlID0gZmFsc2UsXG4gICAgICB2ZXJib3NlSGV4RHVtcCA9IGZhbHNlLFxuICAgICAgc29ja2V0Q2xpZW50LFxuICAgICAgbWF4RnJhbWVMZW5ndGggPSBNQVhfRlJBTUVfU0laRSxcbiAgICB9ID0gb3B0cztcblxuICAgIHN1cGVyKHNvY2tldENsaWVudCk7XG5cbiAgICAvLyBzZXQgdGhlIGxhcmdlc3QgZnJhZ21lbnQgc2l6ZSBmb3IgdGhlIHNvY2tldCwgaWYgdGhlIG9wdGlvbiBpcyB0aGVyZVxuICAgIGlmIChfLmlzRnVuY3Rpb24oc29ja2V0Q2xpZW50LnNldE1heFNlbmRGcmFnbWVudCkgJiYgIV8uaXNOaWwoc29ja2V0Q2h1bmtTaXplKSAmJiBzb2NrZXRDaHVua1NpemUgPiAwKSB7XG4gICAgICBpZiAoc29ja2V0Q2xpZW50LnNldE1heFNlbmRGcmFnbWVudChzb2NrZXRDaHVua1NpemUpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgTWF4aW11bSBUTFMgZnJhZ21lbnQgc2l6ZSBzZXQgdG8gJyR7c29ja2V0Q2h1bmtTaXplfSdgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGFueXRoaW5nIG92ZXIgdGhlIF9hY3R1YWxfIG1heGltdW0gd2lsbCBmYWlsLCBhbmQgdGhpbmdzIHdpbGwgcmVtYWluIHRoZSBzYW1lXG4gICAgICAgIGxvZy53YXJuKGBVbmFibGUgdG8gc2V0IFRMUyBmcmFnbWVudCBzaXplIHRvICcke3NvY2tldENodW5rU2l6ZX0nYCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5fdmVyYm9zZSA9IHZlcmJvc2U7XG4gICAgdGhpcy5faXNTaW11bGF0b3IgPSBpc1NpbXVsYXRvcjtcbiAgICB0aGlzLl9tYWpvck9zVmVyc2lvbiA9IG1ham9yT3NWZXJzaW9uO1xuXG4gICAgaWYgKCFpc1NpbXVsYXRvciAmJiBtYWpvck9zVmVyc2lvbiA8IFBBUlRJQUxfTUVTU0FHRV9TVVBQT1JUX0RFUFJFQ0FUSU9OX1ZFUlNJT04pIHtcbiAgICAgIHRoaXMuX2luaXRpYWxpemVQYXJ0aWFsTWVzc2FnZVN1cHBvcnQodmVyYm9zZUhleER1bXAsIG1heEZyYW1lTGVuZ3RoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faW5pdGlhbGl6ZUZ1bGxNZXNzYWdlU3VwcG9ydCh2ZXJib3NlSGV4RHVtcCwgbWF4RnJhbWVMZW5ndGgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbnRpYWxpemVzIHRoZSBkYXRhIGZsb3cgZm9yIGlPUyAxMSsuXG4gICAqXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gdmVyYm9zZSAtIHdoZXRoZXIgdG8gcHJpbnQgb3V0IHRoZSBoZXggZHVtcCBmb3IgY29tbXVuaWNhdGlvblxuICAgKiBAcGFyYW0ge251bWJlcn0gbWF4RnJhbWVMZW5ndGggLSBUaGUgbWF4aW11bSBzaXplIGluIGJ5dGVzIG9mIGEgc2luZ2xlIGRhdGEgZnJhbWVcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW4gdGhlIGRldmljZSBjb21tdW5pY2F0aW9uIHByb3RvY29sXG4gICAqL1xuICBfaW5pdGlhbGl6ZUZ1bGxNZXNzYWdlU3VwcG9ydCAodmVyYm9zZSwgbWF4RnJhbWVMZW5ndGgpIHtcbiAgICB0aGlzLl9kZWNvZGVyID0gbmV3IFBsaXN0U2VydmljZURlY29kZXIoKTtcbiAgICB0aGlzLl9zb2NrZXRDbGllbnRcbiAgICAgIC8vIGxvZyBmaXJzdCwgaW4gY2FzZSB0aGVyZSBpcyBhIHByb2JsZW0gaW4gcHJvY2Vzc2luZ1xuICAgICAgLnBpcGUobmV3IFN0cmVhbUxvZ2dlcihTdHJlYW1Mb2dnZXIuUkVDRUlWRSwgdmVyYm9zZSkpXG4gICAgICAucGlwZSh0aGlzLl9zcGxpdHRlciA9IG5ldyBMZW5ndGhCYXNlZFNwbGl0dGVyKHtcbiAgICAgICAgcmVhZGFibGVTdHJlYW06IHRoaXMuX3NvY2tldENsaWVudCxcbiAgICAgICAgbGl0dGxlRW5kaWFuOiBmYWxzZSxcbiAgICAgICAgbWF4RnJhbWVMZW5ndGgsXG4gICAgICAgIGxlbmd0aEZpZWxkT2Zmc2V0OiAwLFxuICAgICAgICBsZW5ndGhGaWVsZExlbmd0aDogNCxcbiAgICAgICAgbGVuZ3RoQWRqdXN0bWVudDogNCxcbiAgICAgIH0pKVxuICAgICAgLnBpcGUodGhpcy5fZGVjb2Rlcik7XG5cbiAgICB0aGlzLl9lbmNvZGVyID0gbmV3IFBsaXN0U2VydmljZUVuY29kZXIoKTtcbiAgICB0aGlzLl9lbmNvZGVyXG4gICAgICAucGlwZShuZXcgU3RyZWFtTG9nZ2VyKFN0cmVhbUxvZ2dlci5TRU5ELCB2ZXJib3NlKSlcbiAgICAgIC5waXBlKHRoaXMuX3NvY2tldENsaWVudCk7XG4gIH1cblxuICAvKipcbiAgICogSW50aWFsaXplcyB0aGUgZGF0YSBmbG93IGZvciBpT1MgPCAxMSwgd2hlcmUgZGF0YSBpcyBzZXBhcmF0ZWQgaW50byBwYXJ0aWFsXG4gICAqIG1lc3NhZ2VzIGJlZm9yZSBzZW5kaW5nLlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHZlcmJvc2UgLSB3aGV0aGVyIHRvIHByaW50IG91dCB0aGUgaGV4IGR1bXAgZm9yIGNvbW11bmljYXRpb25cbiAgICogQHBhcmFtIHtudW1iZXJ9IG1heEZyYW1lTGVuZ3RoIC0gVGhlIG1heGltdW0gc2l6ZSBpbiBieXRlcyBvZiBhIHNpbmdsZSBkYXRhIGZyYW1lXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIHRoZSBkZXZpY2UgY29tbXVuaWNhdGlvbiBwcm90b2NvbFxuICAgKi9cbiAgX2luaXRpYWxpemVQYXJ0aWFsTWVzc2FnZVN1cHBvcnQgKHZlcmJvc2UsIG1heEZyYW1lTGVuZ3RoKSB7XG4gICAgLy8gMU1CIGFzIGJ1ZmZlciBmb3IgYnVsZGluZyB3ZWJpbnNwZWN0b3IgZnVsbCBtZXNzYWdlcy4gV2UgY2FuIGluY3JlYXNlIHRoZSB2YWx1ZSBpZiBtb3JlIGJ1ZmZlciBpcyBuZWVkZWRcbiAgICB0aGlzLl9kZWNvZGVyID0gbmV3IFdlYkluc3BlY3RvckRlY29kZXIoTUIpO1xuICAgIHRoaXMuX3NvY2tldENsaWVudFxuICAgICAgLy8gbG9nIGZpcnN0LCBpbiBjYXNlIHRoZXJlIGlzIGEgcHJvYmxlbSBpbiBwcm9jZXNzaW5nXG4gICAgICAucGlwZShuZXcgU3RyZWFtTG9nZ2VyKFN0cmVhbUxvZ2dlci5SRUNFSVZFLCB2ZXJib3NlKSlcbiAgICAgIC5waXBlKHRoaXMuX3NwbGl0dGVyID0gbmV3IExlbmd0aEJhc2VkU3BsaXR0ZXIoe1xuICAgICAgICByZWFkYWJsZVN0cmVhbTogdGhpcy5fc29ja2V0Q2xpZW50LFxuICAgICAgICBsaXR0bGVFbmRpYW46IGZhbHNlLFxuICAgICAgICBtYXhGcmFtZUxlbmd0aCxcbiAgICAgICAgbGVuZ3RoRmllbGRPZmZzZXQ6IDAsXG4gICAgICAgIGxlbmd0aEZpZWxkTGVuZ3RoOiA0LFxuICAgICAgICBsZW5ndGhBZGp1c3RtZW50OiA0LFxuICAgICAgfSkpXG4gICAgICAucGlwZShuZXcgUGxpc3RTZXJ2aWNlRGVjb2RlcigpKVxuICAgICAgLnBpcGUodGhpcy5fZGVjb2Rlcik7XG5cbiAgICB0aGlzLl9lbmNvZGVyID0gbmV3IFdlYkluc3BlY3RvckVuY29kZXIoKTtcbiAgICB0aGlzLl9lbmNvZGVyXG4gICAgICAucGlwZShuZXcgUGxpc3RTZXJ2aWNlRW5jb2RlcigpKVxuICAgICAgLnBpcGUobmV3IFN0cmVhbUxvZ2dlcihTdHJlYW1Mb2dnZXIuU0VORCwgdmVyYm9zZSkpXG4gICAgICAucGlwZSh0aGlzLl9zb2NrZXRDbGllbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmRzIGFuIG9iamVjdCB0byB0aGUgd2ViaW5zcGVjdG9yZCBzb2NrZXRcbiAgICogQHBhcmFtIHtPYmplY3R9IHJwY09iamVjdCBUaGUgb2JqZWN0IHRoYXQgd2lsbCBiZSBzZW50XG4gICAqIEB0aHJvd3MgV2lsbCB0aHJvdyBhbiBlcnJvciB3aGVuIHRoZSBvYmplY3QgaXMgbnVsbCBvciB1bmRlZmluZWRcbiAgICovXG4gIHNlbmRNZXNzYWdlIChycGNPYmplY3QpIHtcbiAgICBpZiAoXy5pc05pbChycGNPYmplY3QpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBzZW5kIGEgbnVsbCBvYmplY3QnKTtcbiAgICB9XG5cbiAgICBsZXQgbWVzc2FnZSA9IHJwY09iamVjdDtcbiAgICBsZXQgbGFzdEVycm9yO1xuICAgIHRyeSB7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLl9lbmNvZGVyLndyaXRlKG1lc3NhZ2UpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAvLyBXb3JrYXJvdW5kIGZvciBodHRwczovL2dpdGh1Yi5jb20vam9lZmVybmVyL25vZGUtYnBsaXN0LWNyZWF0b3IvaXNzdWVzLzI5XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgVHlwZUVycm9yKSB7XG4gICAgICAgICAgbWVzc2FnZSA9IGNsZWFudXBScGNPYmplY3QobWVzc2FnZSk7XG4gICAgICAgICAgdGhpcy5fZW5jb2Rlci53cml0ZShtZXNzYWdlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsYXN0RXJyb3IgPSBlcnI7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX3ZlcmJvc2UgfHwgbGFzdEVycm9yKSB7XG4gICAgICBsb2cuZGVidWcoJ1NlbnQgbWVzc2FnZSB0byBXZWIgSW5zcGVjdG9yOicpO1xuICAgICAgbG9nLmRlYnVnKHV0aWwuanNvblN0cmluZ2lmeShtZXNzYWdlKSk7XG4gICAgICBpZiAoIV8uaXNFcXVhbChtZXNzYWdlLCBycGNPYmplY3QpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZygnT3JpZ2luYWwgbWVzc2FnZTonKTtcbiAgICAgICAgbG9nLmRlYnVnKHV0aWwuanNvblN0cmluZ2lmeShycGNPYmplY3QpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobGFzdEVycm9yKSB7XG4gICAgICB0aHJvdyBsYXN0RXJyb3I7XG4gICAgfVxuXG4gICAgLy8gd3JpdGUgYW4gZW1wdHkgbWVzc2FnZSwgd2hpY2ggb24gcmVhbCBkZXZpY2VzIGVuc3VyZXMgdGhlIGFjdHVhbCBtZXNzYWdlXG4gICAgLy8gZ2V0cyBzZW50IHRvIHRoZSBkZXZpY2UuIHdpdGhvdXQgdGhpcyBpdCB3aWxsIHBlcmlvZGljYWxseSBoYW5nIHdpdGhcbiAgICAvLyBub3RoaW5nIHNlbnRcbiAgICAvLyBob3dldmVyLCB0aGlzIGNhdXNlcyB3ZWJpbnNwZWN0b3JkIHRvIGNyYXNoIG9uIGRldmljZXMgcnVubmluZyBpT1MgMTBcbiAgICBpZiAoIXRoaXMuX2lzU2ltdWxhdG9yICYmIHRoaXMuX21ham9yT3NWZXJzaW9uID49IFBBUlRJQUxfTUVTU0FHRV9TVVBQT1JUX0RFUFJFQ0FUSU9OX1ZFUlNJT04pIHtcbiAgICAgIHRoaXMuX2VuY29kZXIud3JpdGUoJyAnKTtcbiAgICB9XG4gIH1cblxuICAvKiogVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHdoaWNoIHdpbGwgYmUgY2FsbGVkIGR1cmluZyBtZXNzYWdlIGxpc3RlbmluZ1xuICAgKiBAbmFtZSBNZXNzYWdlQ2FsbGJhY2tcbiAgICogQGZ1bmN0aW9uXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIHJwYyBvYmplY3QgdGhhdCBpcyBzZW50IGZyb20gdGhlIHdlYmluc3BlY3RvcmRcbiAgKi9cblxuICAvKipcbiAgICogTGlzdGVuIHRvIG1lc3NhZ2VzIGNvbWluZyBmcm9tIHdlYmluc3BlY3RvcmRcbiAgICogQHBhcmFtIHtNZXNzYWdlQ2FsbGJhY2t9IGNhbGxiYWNrXG4gICAqL1xuICBsaXN0ZW5NZXNzYWdlIChvbkRhdGEpIHtcbiAgICB0aGlzLl9kZWNvZGVyLm9uKCdkYXRhJywgKGRhdGEpID0+IHtcbiAgICAgIGlmICh0aGlzLl92ZXJib3NlKSB7XG4gICAgICAgIGxvZy5kZWJ1ZygnUmVjZWl2ZWQgbWVzc2FnZSBmcm9tIFdlYiBJbnNwZWN0b3I6Jyk7XG4gICAgICAgIGxvZy5kZWJ1Zyh1dGlsLmpzb25TdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgfVxuICAgICAgb25EYXRhKGRhdGEpO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCB7IFdlYkluc3BlY3RvclNlcnZpY2UsIFdFQl9JTlNQRUNUT1JfU0VSVklDRV9OQU1FLCBjbGVhbnVwUnBjT2JqZWN0IH07XG5leHBvcnQgZGVmYXVsdCBXZWJJbnNwZWN0b3JTZXJ2aWNlO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUEsSUFBQUEsb0JBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLG9CQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxvQkFBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUcsb0JBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFJLG9CQUFBLEdBQUFMLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBSyxhQUFBLEdBQUFOLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBTSxPQUFBLEdBQUFQLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBTyxRQUFBLEdBQUFQLE9BQUE7QUFDQSxJQUFBUSxVQUFBLEdBQUFSLE9BQUE7QUFDQSxJQUFBUyxPQUFBLEdBQUFWLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBVSxZQUFBLEdBQUFWLE9BQUE7QUFHQSxNQUFNVywwQkFBMEIsR0FBRyx3QkFBd0I7QUFBQ0MsT0FBQSxDQUFBRCwwQkFBQSxHQUFBQSwwQkFBQTtBQUM1RCxNQUFNRSxjQUFjLEdBQUcsRUFBRSxHQUFHQyxhQUFFO0FBRTlCLE1BQU1DLDJDQUEyQyxHQUFHLEVBQUU7QUFFdEQsU0FBU0MsZ0JBQWdCQSxDQUFFQyxHQUFHLEVBQUU7RUFDOUIsTUFBTUMsT0FBTyxHQUFHQyxlQUFDLENBQUNELE9BQU8sQ0FBQ0QsR0FBRyxDQUFDO0VBQzlCLElBQUksQ0FBQ0UsZUFBQyxDQUFDQyxhQUFhLENBQUNILEdBQUcsQ0FBQyxJQUFJLENBQUNDLE9BQU8sRUFBRTtJQUNyQyxPQUFPRCxHQUFHO0VBQ1o7RUFFQSxJQUFJQyxPQUFPLEVBQUU7SUFDWCxPQUFPQyxlQUFDLENBQUNFLE1BQU0sQ0FBQ0osR0FBRyxFQUFFRSxlQUFDLENBQUNHLE1BQU0sQ0FBQ0gsZUFBQyxDQUFDSSxLQUFLLENBQUMsQ0FBQztFQUN6QztFQUVBLE9BQU9KLGVBQUMsQ0FBQ0ssTUFBTSxDQUFDUCxHQUFHLEVBQUUsQ0FBQ1EsTUFBTSxFQUFFQyxLQUFLLEVBQUVDLEdBQUcsS0FBSztJQUMzQyxJQUFJLENBQUNSLGVBQUMsQ0FBQ0ksS0FBSyxDQUFDRyxLQUFLLENBQUMsRUFBRTtNQUNuQkQsTUFBTSxDQUFDRSxHQUFHLENBQUMsR0FBR1gsZ0JBQWdCLENBQUNVLEtBQUssQ0FBQztJQUN2QztJQUNBLE9BQU9ELE1BQU07RUFDZixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDUjtBQW9CQSxNQUFNRyxtQkFBbUIsU0FBU0MsOEJBQWlCLENBQUM7RUFNbERDLFdBQVdBLENBQUVDLElBQUksR0FBRyxDQUFDLENBQUMsRUFBRTtJQUN0QixNQUFNO01BQ0pDLGNBQWM7TUFDZEMsV0FBVyxHQUFHLEtBQUs7TUFDbkJDLGVBQWU7TUFDZkMsT0FBTyxHQUFHLEtBQUs7TUFDZkMsY0FBYyxHQUFHLEtBQUs7TUFDdEJDLFlBQVk7TUFDWkMsY0FBYyxHQUFHekI7SUFDbkIsQ0FBQyxHQUFHa0IsSUFBSTtJQUVSLEtBQUssQ0FBQ00sWUFBWSxDQUFDO0lBR25CLElBQUlsQixlQUFDLENBQUNvQixVQUFVLENBQUNGLFlBQVksQ0FBQ0csa0JBQWtCLENBQUMsSUFBSSxDQUFDckIsZUFBQyxDQUFDSSxLQUFLLENBQUNXLGVBQWUsQ0FBQyxJQUFJQSxlQUFlLEdBQUcsQ0FBQyxFQUFFO01BQ3JHLElBQUlHLFlBQVksQ0FBQ0csa0JBQWtCLENBQUNOLGVBQWUsQ0FBQyxFQUFFO1FBQ3BETyxlQUFHLENBQUNDLEtBQUssQ0FBRSxxQ0FBb0NSLGVBQWdCLEdBQUUsQ0FBQztNQUNwRSxDQUFDLE1BQU07UUFFTE8sZUFBRyxDQUFDRSxJQUFJLENBQUUsdUNBQXNDVCxlQUFnQixHQUFFLENBQUM7TUFDckU7SUFDRjtJQUVBLElBQUksQ0FBQ1UsUUFBUSxHQUFHVCxPQUFPO0lBQ3ZCLElBQUksQ0FBQ1UsWUFBWSxHQUFHWixXQUFXO0lBQy9CLElBQUksQ0FBQ2EsZUFBZSxHQUFHZCxjQUFjO0lBRXJDLElBQUksQ0FBQ0MsV0FBVyxJQUFJRCxjQUFjLEdBQUdqQiwyQ0FBMkMsRUFBRTtNQUNoRixJQUFJLENBQUNnQyxnQ0FBZ0MsQ0FBQ1gsY0FBYyxFQUFFRSxjQUFjLENBQUM7SUFDdkUsQ0FBQyxNQUFNO01BQ0wsSUFBSSxDQUFDVSw2QkFBNkIsQ0FBQ1osY0FBYyxFQUFFRSxjQUFjLENBQUM7SUFDcEU7RUFDRjtFQVNBVSw2QkFBNkJBLENBQUViLE9BQU8sRUFBRUcsY0FBYyxFQUFFO0lBQ3RELElBQUksQ0FBQ1csUUFBUSxHQUFHLElBQUlDLDRCQUFtQixFQUFFO0lBQ3pDLElBQUksQ0FBQ0MsYUFBYSxDQUVmQyxJQUFJLENBQUMsSUFBSUMscUJBQVksQ0FBQ0EscUJBQVksQ0FBQ0MsT0FBTyxFQUFFbkIsT0FBTyxDQUFDLENBQUMsQ0FDckRpQixJQUFJLENBQUMsSUFBSSxDQUFDRyxTQUFTLEdBQUcsSUFBSUMsNEJBQW1CLENBQUM7TUFDN0NDLGNBQWMsRUFBRSxJQUFJLENBQUNOLGFBQWE7TUFDbENPLFlBQVksRUFBRSxLQUFLO01BQ25CcEIsY0FBYztNQUNkcUIsaUJBQWlCLEVBQUUsQ0FBQztNQUNwQkMsaUJBQWlCLEVBQUUsQ0FBQztNQUNwQkMsZ0JBQWdCLEVBQUU7SUFDcEIsQ0FBQyxDQUFDLENBQUMsQ0FDRlQsSUFBSSxDQUFDLElBQUksQ0FBQ0gsUUFBUSxDQUFDO0lBRXRCLElBQUksQ0FBQ2EsUUFBUSxHQUFHLElBQUlDLDRCQUFtQixFQUFFO0lBQ3pDLElBQUksQ0FBQ0QsUUFBUSxDQUNWVixJQUFJLENBQUMsSUFBSUMscUJBQVksQ0FBQ0EscUJBQVksQ0FBQ1csSUFBSSxFQUFFN0IsT0FBTyxDQUFDLENBQUMsQ0FDbERpQixJQUFJLENBQUMsSUFBSSxDQUFDRCxhQUFhLENBQUM7RUFDN0I7RUFVQUosZ0NBQWdDQSxDQUFFWixPQUFPLEVBQUVHLGNBQWMsRUFBRTtJQUV6RCxJQUFJLENBQUNXLFFBQVEsR0FBRyxJQUFJZ0IsNEJBQW1CLENBQUNuRCxhQUFFLENBQUM7SUFDM0MsSUFBSSxDQUFDcUMsYUFBYSxDQUVmQyxJQUFJLENBQUMsSUFBSUMscUJBQVksQ0FBQ0EscUJBQVksQ0FBQ0MsT0FBTyxFQUFFbkIsT0FBTyxDQUFDLENBQUMsQ0FDckRpQixJQUFJLENBQUMsSUFBSSxDQUFDRyxTQUFTLEdBQUcsSUFBSUMsNEJBQW1CLENBQUM7TUFDN0NDLGNBQWMsRUFBRSxJQUFJLENBQUNOLGFBQWE7TUFDbENPLFlBQVksRUFBRSxLQUFLO01BQ25CcEIsY0FBYztNQUNkcUIsaUJBQWlCLEVBQUUsQ0FBQztNQUNwQkMsaUJBQWlCLEVBQUUsQ0FBQztNQUNwQkMsZ0JBQWdCLEVBQUU7SUFDcEIsQ0FBQyxDQUFDLENBQUMsQ0FDRlQsSUFBSSxDQUFDLElBQUlGLDRCQUFtQixFQUFFLENBQUMsQ0FDL0JFLElBQUksQ0FBQyxJQUFJLENBQUNILFFBQVEsQ0FBQztJQUV0QixJQUFJLENBQUNhLFFBQVEsR0FBRyxJQUFJSSw0QkFBbUIsRUFBRTtJQUN6QyxJQUFJLENBQUNKLFFBQVEsQ0FDVlYsSUFBSSxDQUFDLElBQUlXLDRCQUFtQixFQUFFLENBQUMsQ0FDL0JYLElBQUksQ0FBQyxJQUFJQyxxQkFBWSxDQUFDQSxxQkFBWSxDQUFDVyxJQUFJLEVBQUU3QixPQUFPLENBQUMsQ0FBQyxDQUNsRGlCLElBQUksQ0FBQyxJQUFJLENBQUNELGFBQWEsQ0FBQztFQUM3QjtFQU9BZ0IsV0FBV0EsQ0FBRUMsU0FBUyxFQUFFO0lBQ3RCLElBQUlqRCxlQUFDLENBQUNJLEtBQUssQ0FBQzZDLFNBQVMsQ0FBQyxFQUFFO01BQ3RCLE1BQU0sSUFBSUMsS0FBSyxDQUFDLDJCQUEyQixDQUFDO0lBQzlDO0lBRUEsSUFBSUMsT0FBTyxHQUFHRixTQUFTO0lBQ3ZCLElBQUlHLFNBQVM7SUFDYixJQUFJO01BQ0YsSUFBSTtRQUNGLElBQUksQ0FBQ1QsUUFBUSxDQUFDVSxLQUFLLENBQUNGLE9BQU8sQ0FBQztNQUM5QixDQUFDLENBQUMsT0FBT0csQ0FBQyxFQUFFO1FBRVYsSUFBSUEsQ0FBQyxZQUFZQyxTQUFTLEVBQUU7VUFDMUJKLE9BQU8sR0FBR3RELGdCQUFnQixDQUFDc0QsT0FBTyxDQUFDO1VBQ25DLElBQUksQ0FBQ1IsUUFBUSxDQUFDVSxLQUFLLENBQUNGLE9BQU8sQ0FBQztRQUM5QixDQUFDLE1BQU07VUFDTCxNQUFNRyxDQUFDO1FBQ1Q7TUFDRjtJQUNGLENBQUMsQ0FBQyxPQUFPRSxHQUFHLEVBQUU7TUFDWkosU0FBUyxHQUFHSSxHQUFHO0lBQ2pCO0lBRUEsSUFBSSxJQUFJLENBQUMvQixRQUFRLElBQUkyQixTQUFTLEVBQUU7TUFDOUI5QixlQUFHLENBQUNDLEtBQUssQ0FBQyxnQ0FBZ0MsQ0FBQztNQUMzQ0QsZUFBRyxDQUFDQyxLQUFLLENBQUNrQyxhQUFJLENBQUNDLGFBQWEsQ0FBQ1AsT0FBTyxDQUFDLENBQUM7TUFDdEMsSUFBSSxDQUFDbkQsZUFBQyxDQUFDMkQsT0FBTyxDQUFDUixPQUFPLEVBQUVGLFNBQVMsQ0FBQyxFQUFFO1FBQ2xDM0IsZUFBRyxDQUFDQyxLQUFLLENBQUMsbUJBQW1CLENBQUM7UUFDOUJELGVBQUcsQ0FBQ0MsS0FBSyxDQUFDa0MsYUFBSSxDQUFDQyxhQUFhLENBQUNULFNBQVMsQ0FBQyxDQUFDO01BQzFDO0lBQ0Y7SUFFQSxJQUFJRyxTQUFTLEVBQUU7TUFDYixNQUFNQSxTQUFTO0lBQ2pCO0lBTUEsSUFBSSxDQUFDLElBQUksQ0FBQzFCLFlBQVksSUFBSSxJQUFJLENBQUNDLGVBQWUsSUFBSS9CLDJDQUEyQyxFQUFFO01BQzdGLElBQUksQ0FBQytDLFFBQVEsQ0FBQ1UsS0FBSyxDQUFDLEdBQUcsQ0FBQztJQUMxQjtFQUNGO0VBWUFPLGFBQWFBLENBQUVDLE1BQU0sRUFBRTtJQUNyQixJQUFJLENBQUMvQixRQUFRLENBQUNnQyxFQUFFLENBQUMsTUFBTSxFQUFHQyxJQUFJLElBQUs7TUFDakMsSUFBSSxJQUFJLENBQUN0QyxRQUFRLEVBQUU7UUFDakJILGVBQUcsQ0FBQ0MsS0FBSyxDQUFDLHNDQUFzQyxDQUFDO1FBQ2pERCxlQUFHLENBQUNDLEtBQUssQ0FBQ2tDLGFBQUksQ0FBQ0MsYUFBYSxDQUFDSyxJQUFJLENBQUMsQ0FBQztNQUNyQztNQUNBRixNQUFNLENBQUNFLElBQUksQ0FBQztJQUNkLENBQUMsQ0FBQztFQUNKO0FBQ0Y7QUFBQ3RFLE9BQUEsQ0FBQWdCLG1CQUFBLEdBQUFBLG1CQUFBO0FBQUEsSUFBQXVELFFBQUEsR0FHY3ZELG1CQUFtQjtBQUFBaEIsT0FBQSxDQUFBd0UsT0FBQSxHQUFBRCxRQUFBIn0=