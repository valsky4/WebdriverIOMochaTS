{"version":3,"file":"webinspector-decoder.js","names":["_stream","_interopRequireDefault","require","_support","WebInspectorDecoder","Stream","Transform","constructor","maxLength","objectMode","_frameBufferIndex","_frameBuffer","Buffer","allocUnsafeSlow","_transform","data","encoding","onData","_decode","WIRFinalMessageKey","buffer","_readBytes","length","pref","plist","parsePlist","slice","push","_resetBuffers","WIRPartialMessageKey","src","srcIndex","target","targetIndex","nBytesToBeRead","availableBytes","Math","min","copy","exports","_default","default"],"sources":["../../../../lib/webinspector/transformer/webinspector-decoder.js"],"sourcesContent":["import Stream from 'stream';\nimport { plist } from '@appium/support';\n\n\nclass WebInspectorDecoder extends Stream.Transform {\n  constructor (maxLength) {\n    super({ objectMode: true });\n    this._frameBufferIndex = 0;\n    this._frameBuffer = Buffer.allocUnsafeSlow(maxLength);\n  }\n\n  _transform (data, encoding, onData) {\n    this._decode(data);\n    onData();\n  }\n\n  _decode (data) {\n    if (data.WIRFinalMessageKey) {\n      const buffer = data.WIRFinalMessageKey;\n      this._frameBufferIndex += this._readBytes(buffer, 0, this._frameBuffer, this._frameBufferIndex, buffer.length);\n      const pref = plist.parsePlist(this._frameBuffer.slice(0, this._frameBufferIndex));\n      this.push(pref);\n      this._resetBuffers();\n    } else {\n      const buffer = data.WIRPartialMessageKey;\n      this._frameBufferIndex += this._readBytes(buffer, 0, this._frameBuffer, this._frameBufferIndex, buffer.length);\n    }\n  }\n\n  _readBytes (src, srcIndex, target, targetIndex, nBytesToBeRead) {\n    let availableBytes = Math.min(nBytesToBeRead, src.length - srcIndex);\n    src.copy(target, targetIndex, srcIndex, srcIndex + availableBytes);\n    return availableBytes;\n  }\n\n  _resetBuffers () {\n    this._frameBufferIndex = 0;\n  }\n}\n\nexport { WebInspectorDecoder };\nexport default WebInspectorDecoder;\n"],"mappings":";;;;;;;;AAAA,IAAAA,OAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,QAAA,GAAAD,OAAA;AAGA,MAAME,mBAAmB,SAASC,eAAM,CAACC,SAAS,CAAC;EACjDC,WAAWA,CAAEC,SAAS,EAAE;IACtB,KAAK,CAAC;MAAEC,UAAU,EAAE;IAAK,CAAC,CAAC;IAC3B,IAAI,CAACC,iBAAiB,GAAG,CAAC;IAC1B,IAAI,CAACC,YAAY,GAAGC,MAAM,CAACC,eAAe,CAACL,SAAS,CAAC;EACvD;EAEAM,UAAUA,CAAEC,IAAI,EAAEC,QAAQ,EAAEC,MAAM,EAAE;IAClC,IAAI,CAACC,OAAO,CAACH,IAAI,CAAC;IAClBE,MAAM,EAAE;EACV;EAEAC,OAAOA,CAAEH,IAAI,EAAE;IACb,IAAIA,IAAI,CAACI,kBAAkB,EAAE;MAC3B,MAAMC,MAAM,GAAGL,IAAI,CAACI,kBAAkB;MACtC,IAAI,CAACT,iBAAiB,IAAI,IAAI,CAACW,UAAU,CAACD,MAAM,EAAE,CAAC,EAAE,IAAI,CAACT,YAAY,EAAE,IAAI,CAACD,iBAAiB,EAAEU,MAAM,CAACE,MAAM,CAAC;MAC9G,MAAMC,IAAI,GAAGC,cAAK,CAACC,UAAU,CAAC,IAAI,CAACd,YAAY,CAACe,KAAK,CAAC,CAAC,EAAE,IAAI,CAAChB,iBAAiB,CAAC,CAAC;MACjF,IAAI,CAACiB,IAAI,CAACJ,IAAI,CAAC;MACf,IAAI,CAACK,aAAa,EAAE;IACtB,CAAC,MAAM;MACL,MAAMR,MAAM,GAAGL,IAAI,CAACc,oBAAoB;MACxC,IAAI,CAACnB,iBAAiB,IAAI,IAAI,CAACW,UAAU,CAACD,MAAM,EAAE,CAAC,EAAE,IAAI,CAACT,YAAY,EAAE,IAAI,CAACD,iBAAiB,EAAEU,MAAM,CAACE,MAAM,CAAC;IAChH;EACF;EAEAD,UAAUA,CAAES,GAAG,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,WAAW,EAAEC,cAAc,EAAE;IAC9D,IAAIC,cAAc,GAAGC,IAAI,CAACC,GAAG,CAACH,cAAc,EAAEJ,GAAG,CAACR,MAAM,GAAGS,QAAQ,CAAC;IACpED,GAAG,CAACQ,IAAI,CAACN,MAAM,EAAEC,WAAW,EAAEF,QAAQ,EAAEA,QAAQ,GAAGI,cAAc,CAAC;IAClE,OAAOA,cAAc;EACvB;EAEAP,aAAaA,CAAA,EAAI;IACf,IAAI,CAAClB,iBAAiB,GAAG,CAAC;EAC5B;AACF;AAAC6B,OAAA,CAAAnC,mBAAA,GAAAA,mBAAA;AAAA,IAAAoC,QAAA,GAGcpC,mBAAmB;AAAAmC,OAAA,CAAAE,OAAA,GAAAD,QAAA"}