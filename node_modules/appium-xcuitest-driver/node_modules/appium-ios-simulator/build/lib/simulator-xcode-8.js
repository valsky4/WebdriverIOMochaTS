"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _logger = _interopRequireDefault(require("./logger"));
var _teen_process = require("teen_process");
var _utils = require("./utils");
var _path = _interopRequireDefault(require("path"));
var _appiumXcode = require("appium-xcode");
var _support = require("@appium/support");
var _asyncLock = _interopRequireDefault(require("async-lock"));
var _asyncbox = require("asyncbox");
var _events = require("events");
var _nodeSimctl = _interopRequireDefault(require("node-simctl"));
var _index = _interopRequireDefault(require("./extensions/index"));
const BOOT_COMPLETED_EVENT = 'bootCompleted';
const STARTUP_TIMEOUT_MS = 120 * 1000;
const UI_CLIENT_ACCESS_GUARD = new _asyncLock.default();
const UI_CLIENT_BUNDLE_ID = 'com.apple.iphonesimulator';
class SimulatorXcode8 extends _events.EventEmitter {
  constructor(udid, xcodeVersion) {
    super(udid, xcodeVersion);
    this.udid = String(udid);
    this.simctl = new _nodeSimctl.default({
      udid: this.udid
    });
    this.xcodeVersion = xcodeVersion;
    this._platformVersion = null;
    this.keychainPath = _path.default.resolve(this.getDir(), 'Library', 'Keychains');
    this._idb = null;
    this._locationMenu = 'Debug';
  }
  get uiClientBundleId() {
    return UI_CLIENT_BUNDLE_ID;
  }
  get devicesSetPath() {
    return this.simctl.devicesSetPath;
  }
  set devicesSetPath(value) {
    this.simctl.devicesSetPath = value;
  }
  async getUIClientPid() {
    let stdout;
    try {
      ({
        stdout
      } = await (0, _teen_process.exec)('pgrep', ['-fn', `${_utils.SIMULATOR_APP_NAME}/Contents/MacOS/`]));
    } catch (e) {
      return null;
    }
    if (isNaN(parseInt(stdout, 10))) {
      return null;
    }
    stdout = stdout.trim();
    _logger.default.debug(`Got Simulator UI client PID: ${stdout}`);
    return stdout;
  }
  async isUIClientRunning() {
    return !_lodash.default.isNull(await this.getUIClientPid());
  }
  async getPlatformVersion() {
    if (!this._platformVersion) {
      const {
        sdk
      } = await this.stat();
      this._platformVersion = sdk;
    }
    return this._platformVersion;
  }
  getRootDir() {
    return _path.default.resolve(process.env.HOME, 'Library', 'Developer', 'CoreSimulator', 'Devices');
  }
  getDir() {
    return _path.default.resolve(this.getRootDir(), this.udid, 'data');
  }
  getLogDir() {
    return _path.default.resolve(process.env.HOME, 'Library', 'Logs', 'CoreSimulator', this.udid);
  }
  async stat() {
    for (const [sdk, deviceArr] of _lodash.default.toPairs(await this.simctl.getDevices())) {
      for (let device of deviceArr) {
        if (device.udid === this.udid) {
          device.sdk = sdk;
          return device;
        }
      }
    }
    return {};
  }
  async isFresh() {
    const cachesRoot = _path.default.resolve(this.getDir(), 'Library', 'Caches');
    return (await _support.fs.exists(cachesRoot)) ? (await _support.fs.glob('*', {
      cwd: cachesRoot,
      nosort: true,
      strict: false
    })).length === 0 : true;
  }
  async isRunning() {
    try {
      await this.simctl.getEnv('dummy');
      return true;
    } catch (e) {
      return false;
    }
  }
  async isShutdown() {
    try {
      await this.simctl.getEnv('dummy');
      return false;
    } catch (e) {
      return _lodash.default.includes(e.stderr, 'Current state: Shutdown');
    }
  }
  async startUIClient(opts = {}) {
    opts = _lodash.default.cloneDeep(opts);
    _lodash.default.defaultsDeep(opts, {
      scaleFactor: null,
      startupTimeout: this.startupTimeout
    });
    const simulatorApp = _path.default.resolve(await (0, _appiumXcode.getPath)(), 'Applications', _utils.SIMULATOR_APP_NAME);
    const args = ['-Fn', simulatorApp, '--args', '-CurrentDeviceUDID', this.udid];
    if (opts.scaleFactor) {
      const {
        name
      } = await this.stat();
      const formattedDeviceName = name.replace(/\s+/g, '-');
      const argumentName = `-SimulatorWindowLastScale-com.apple.CoreSimulator.SimDeviceType.${formattedDeviceName}`;
      args.push(argumentName, opts.scaleFactor);
    }
    _logger.default.info(`Starting Simulator UI with command: open ${args.join(' ')}`);
    try {
      await (0, _teen_process.exec)('open', args, {
        timeout: opts.startupTimeout
      });
    } catch (err) {
      if (!(err.stdout || '').includes('-10825') && !(err.stderr || '').includes('-10825')) {
        throw err;
      }
      _logger.default.warn(`Error while opening UI: ${err.stdout || err.stderr}. Continuing`);
    }
  }
  async run(opts = {}) {
    opts = Object.assign({
      startupTimeout: this.startupTimeout
    }, opts);
    const isServerRunning = await this.isRunning();
    const isUIClientRunning = await this.isUIClientRunning();
    if (isServerRunning && isUIClientRunning) {
      _logger.default.info(`Both Simulator with UDID ${this.udid} and the UI client are currently running`);
      return;
    }
    const timer = new _support.timing.Timer().start();
    try {
      await this.shutdown();
    } catch (err) {
      _logger.default.warn(`Error on Simulator shutdown: ${err.message}`);
    }
    await this.startUIClient(opts);
    await this.waitForBoot(opts.startupTimeout);
    _logger.default.info(`Simulator with UDID ${this.udid} booted in ${timer.getDuration().asSeconds.toFixed(3)}s`);
  }
  async clean() {
    _logger.default.info(`Cleaning simulator ${this.udid}`);
    await this.simctl.eraseDevice(10000);
  }
  async shutdown(opts = {}) {
    if (await this.isShutdown()) {
      return;
    }
    await (0, _asyncbox.retryInterval)(5, 500, this.simctl.shutdownDevice.bind(this.simctl));
    const waitMs = parseInt(opts.timeout, 10);
    if (waitMs > 0) {
      try {
        await (0, _asyncbox.waitForCondition)(async () => await this.isShutdown(), {
          waitMs,
          intervalMs: 100
        });
      } catch (err) {
        throw new Error(`Simulator is not in 'Shutdown' state after ${waitMs}ms`);
      }
    }
  }
  async delete() {
    await this.simctl.deleteDevice();
  }
  async _activateWindow() {
    const pid = await this.getUIClientPid();
    if (pid) {
      try {
        return await (0, _utils.activateApp)(pid);
      } catch (e) {
        _logger.default.debug(e.stderr || e.message);
      }
    }
    return `
      tell application "System Events"
        tell process "Simulator"
          set frontmost to false
          set frontmost to true
        end tell
      end tell
    `;
  }
  async executeUIClientScript(appleScript) {
    const windowActivationScript = await this._activateWindow();
    const resultScript = `${windowActivationScript ? windowActivationScript + '\n' : ''}${appleScript}`;
    _logger.default.debug(`Executing UI Apple Script on Simulator with UDID ${this.udid}: ${resultScript}`);
    return await UI_CLIENT_ACCESS_GUARD.acquire(_utils.SIMULATOR_APP_NAME, async () => {
      try {
        const {
          stdout
        } = await (0, _teen_process.exec)('osascript', ['-e', resultScript]);
        return stdout;
      } catch (err) {
        _logger.default.errorAndThrow(`Could not complete operation. Make sure Simulator UI is running and the parent Appium application (e. g. Appium.app or Terminal.app) ` + `is present in System Preferences > Security & Privacy > Privacy > Accessibility list. If the operation is still unsuccessful then ` + `it is not supported by this Simulator. Original error: ${err.message}`);
      }
    });
  }
  async ps() {
    const {
      stdout
    } = await this.simctl.spawnProcess(['launchctl', 'print', 'system']);
    const servicesMatch = /^\s*services\s*=\s*{([^}]+)/m.exec(stdout);
    if (!servicesMatch) {
      _logger.default.debug(stdout);
      throw new Error(`The list of active processes cannot be retrieved`);
    }
    const result = [];
    const pattern = /^\s*(\d+)\s+[\d-]+\s+([\w\-.]+:)?([\w\-.]+)/gm;
    let match;
    while (match = pattern.exec(servicesMatch[1])) {
      result.push({
        pid: parseInt(match[1], 10),
        group: _lodash.default.trimEnd(match[2], ':') || null,
        name: match[3]
      });
    }
    return result;
  }
  async getWebInspectorSocket() {
    return null;
  }
  set idb(value) {
    this._idb = value;
  }
  get idb() {
    return this._idb;
  }
  async killUIClient(opts = {}) {
    let {
      pid,
      signal = 2
    } = opts;
    pid = pid || (await this.getUIClientPid());
    if (!pid) {
      return false;
    }
    _logger.default.debug(`Sending ${signal} kill signal to Simulator UI client with PID ${pid}`);
    try {
      await (0, _teen_process.exec)('kill', [`-${signal}`, pid]);
      return true;
    } catch (e) {
      if (e.code === 1) {
        return false;
      }
      throw new Error(`Cannot kill the Simulator UI client. Original error: ${e.message}`);
    }
  }
  get startupTimeout() {
    return STARTUP_TIMEOUT_MS;
  }
  async waitForBoot(startupTimeout) {
    await this.simctl.startBootMonitor({
      timeout: startupTimeout
    });
    this.emit(BOOT_COMPLETED_EVENT);
  }
}
for (const [cmd, fn] of _lodash.default.toPairs(_index.default)) {
  SimulatorXcode8.prototype[cmd] = fn;
}
var _default = SimulatorXcode8;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCT09UX0NPTVBMRVRFRF9FVkVOVCIsIlNUQVJUVVBfVElNRU9VVF9NUyIsIlVJX0NMSUVOVF9BQ0NFU1NfR1VBUkQiLCJBc3luY0xvY2siLCJVSV9DTElFTlRfQlVORExFX0lEIiwiU2ltdWxhdG9yWGNvZGU4IiwiRXZlbnRFbWl0dGVyIiwiY29uc3RydWN0b3IiLCJ1ZGlkIiwieGNvZGVWZXJzaW9uIiwiU3RyaW5nIiwic2ltY3RsIiwiU2ltY3RsIiwiX3BsYXRmb3JtVmVyc2lvbiIsImtleWNoYWluUGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiZ2V0RGlyIiwiX2lkYiIsIl9sb2NhdGlvbk1lbnUiLCJ1aUNsaWVudEJ1bmRsZUlkIiwiZGV2aWNlc1NldFBhdGgiLCJ2YWx1ZSIsImdldFVJQ2xpZW50UGlkIiwic3Rkb3V0IiwiZXhlYyIsIlNJTVVMQVRPUl9BUFBfTkFNRSIsImUiLCJpc05hTiIsInBhcnNlSW50IiwidHJpbSIsImxvZyIsImRlYnVnIiwiaXNVSUNsaWVudFJ1bm5pbmciLCJfIiwiaXNOdWxsIiwiZ2V0UGxhdGZvcm1WZXJzaW9uIiwic2RrIiwic3RhdCIsImdldFJvb3REaXIiLCJwcm9jZXNzIiwiZW52IiwiSE9NRSIsImdldExvZ0RpciIsImRldmljZUFyciIsInRvUGFpcnMiLCJnZXREZXZpY2VzIiwiZGV2aWNlIiwiaXNGcmVzaCIsImNhY2hlc1Jvb3QiLCJmcyIsImV4aXN0cyIsImdsb2IiLCJjd2QiLCJub3NvcnQiLCJzdHJpY3QiLCJsZW5ndGgiLCJpc1J1bm5pbmciLCJnZXRFbnYiLCJpc1NodXRkb3duIiwiaW5jbHVkZXMiLCJzdGRlcnIiLCJzdGFydFVJQ2xpZW50Iiwib3B0cyIsImNsb25lRGVlcCIsImRlZmF1bHRzRGVlcCIsInNjYWxlRmFjdG9yIiwic3RhcnR1cFRpbWVvdXQiLCJzaW11bGF0b3JBcHAiLCJnZXRYY29kZVBhdGgiLCJhcmdzIiwibmFtZSIsImZvcm1hdHRlZERldmljZU5hbWUiLCJyZXBsYWNlIiwiYXJndW1lbnROYW1lIiwicHVzaCIsImluZm8iLCJqb2luIiwidGltZW91dCIsImVyciIsIndhcm4iLCJydW4iLCJPYmplY3QiLCJhc3NpZ24iLCJpc1NlcnZlclJ1bm5pbmciLCJ0aW1lciIsInRpbWluZyIsIlRpbWVyIiwic3RhcnQiLCJzaHV0ZG93biIsIm1lc3NhZ2UiLCJ3YWl0Rm9yQm9vdCIsImdldER1cmF0aW9uIiwiYXNTZWNvbmRzIiwidG9GaXhlZCIsImNsZWFuIiwiZXJhc2VEZXZpY2UiLCJyZXRyeUludGVydmFsIiwic2h1dGRvd25EZXZpY2UiLCJiaW5kIiwid2FpdE1zIiwid2FpdEZvckNvbmRpdGlvbiIsImludGVydmFsTXMiLCJFcnJvciIsImRlbGV0ZSIsImRlbGV0ZURldmljZSIsIl9hY3RpdmF0ZVdpbmRvdyIsInBpZCIsImFjdGl2YXRlQXBwIiwiZXhlY3V0ZVVJQ2xpZW50U2NyaXB0IiwiYXBwbGVTY3JpcHQiLCJ3aW5kb3dBY3RpdmF0aW9uU2NyaXB0IiwicmVzdWx0U2NyaXB0IiwiYWNxdWlyZSIsImVycm9yQW5kVGhyb3ciLCJwcyIsInNwYXduUHJvY2VzcyIsInNlcnZpY2VzTWF0Y2giLCJyZXN1bHQiLCJwYXR0ZXJuIiwibWF0Y2giLCJncm91cCIsInRyaW1FbmQiLCJnZXRXZWJJbnNwZWN0b3JTb2NrZXQiLCJpZGIiLCJraWxsVUlDbGllbnQiLCJzaWduYWwiLCJjb2RlIiwic3RhcnRCb290TW9uaXRvciIsImVtaXQiLCJjbWQiLCJmbiIsImV4dGVuc2lvbnMiLCJwcm90b3R5cGUiXSwic291cmNlcyI6WyIuLi8uLi9saWIvc2ltdWxhdG9yLXhjb2RlLTguanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeyBhY3RpdmF0ZUFwcCwgU0lNVUxBVE9SX0FQUF9OQU1FIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGdldFBhdGggYXMgZ2V0WGNvZGVQYXRoIH0gZnJvbSAnYXBwaXVtLXhjb2RlJztcbmltcG9ydCB7IGZzLCB0aW1pbmcgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IEFzeW5jTG9jayBmcm9tICdhc3luYy1sb2NrJztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwsIHdhaXRGb3JDb25kaXRpb24gfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0IFNpbWN0bCBmcm9tICdub2RlLXNpbWN0bCc7XG5pbXBvcnQgZXh0ZW5zaW9ucyBmcm9tICcuL2V4dGVuc2lvbnMvaW5kZXgnO1xuXG4vKlxuICogVGhpcyBldmVudCBpcyBlbWl0dGVkIGFzIHNvb24gYXMgaU9TIFNpbXVsYXRvclxuICogaGFzIGZpbmlzaGVkIGJvb3RpbmcgYW5kIGl0IGlzIHJlYWR5IHRvIGFjY2VwdCB4Y3J1biBjb21tYW5kcy5cbiAqIFRoZSBldmVudCBoYW5kbGVyIGlzIGNhbGxlZCBhZnRlciAncnVuJyBtZXRob2QgaXMgY29tcGxldGVkXG4gKiBmb3IgWGNvZGUgNyBhbmQgb2xkZXIgYW5kIGlzIG9ubHkgdXNlZnVsIGluIFhjb2RlIDgrLFxuICogc2luY2Ugb25lIGNhbiBzdGFydCBkb2luZyBzdHVmZiAoZm9yIGV4YW1wbGUgaW5zdGFsbC91bmluc3RhbGwgYW4gYXBwKSBpbiBwYXJhbGxlbFxuICogd2l0aCBTaW11bGF0b3IgVUkgc3RhcnR1cCwgd2hpY2ggc2hvcnRlbnMgc2Vzc2lvbiBzdGFydHVwIHRpbWUuXG4gKi9cbmNvbnN0IEJPT1RfQ09NUExFVEVEX0VWRU5UID0gJ2Jvb3RDb21wbGV0ZWQnO1xuXG5jb25zdCBTVEFSVFVQX1RJTUVPVVRfTVMgPSAxMjAgKiAxMDAwO1xuY29uc3QgVUlfQ0xJRU5UX0FDQ0VTU19HVUFSRCA9IG5ldyBBc3luY0xvY2soKTtcbmNvbnN0IFVJX0NMSUVOVF9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLmlwaG9uZXNpbXVsYXRvcic7XG5cblxuY2xhc3MgU2ltdWxhdG9yWGNvZGU4IGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgLyoqXG4gICAqIENvbnN0cnVjdHMgdGhlIG9iamVjdCB3aXRoIHRoZSBgdWRpZGAgYW5kIHZlcnNpb24gb2YgWGNvZGUuIFVzZSB0aGUgZXhwb3J0ZWQgYGdldFNpbXVsYXRvcih1ZGlkKWAgbWV0aG9kIGluc3RlYWQuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFNpbXVsYXRvciBJRC5cbiAgICogQHBhcmFtIHtvYmplY3R9IHhjb2RlVmVyc2lvbiAtIFRoZSB0YXJnZXQgWGNvZGUgdmVyc2lvbiBpbiBmb3JtYXQge21ham9yLCBtaW5vciwgYnVpbGR9LlxuICAgKi9cbiAgY29uc3RydWN0b3IgKHVkaWQsIHhjb2RlVmVyc2lvbikge1xuICAgIHN1cGVyKHVkaWQsIHhjb2RlVmVyc2lvbik7XG5cbiAgICB0aGlzLnVkaWQgPSBTdHJpbmcodWRpZCk7XG4gICAgdGhpcy5zaW1jdGwgPSBuZXcgU2ltY3RsKHtcbiAgICAgIHVkaWQ6IHRoaXMudWRpZCxcbiAgICB9KTtcbiAgICB0aGlzLnhjb2RlVmVyc2lvbiA9IHhjb2RlVmVyc2lvbjtcblxuICAgIC8vIHBsYXRmb3JtVmVyc2lvbiBjYW5ub3QgYmUgZm91bmQgaW5pdGlhbGx5LCBzaW5jZSBnZXR0aW5nIGl0IGhhcyBzaWRlIGVmZmVjdHMgZm9yXG4gICAgLy8gb3VyIGxvZ2ljIGZvciBmaWd1cmluZyBvdXQgaWYgYSBzaW0gaGFzIGJlZW4gcnVuXG4gICAgLy8gaXQgd2lsbCBiZSBzZXQgd2hlbiBpdCBpcyBuZWVkZWRcbiAgICB0aGlzLl9wbGF0Zm9ybVZlcnNpb24gPSBudWxsO1xuXG4gICAgdGhpcy5rZXljaGFpblBhdGggPSBwYXRoLnJlc29sdmUodGhpcy5nZXREaXIoKSwgJ0xpYnJhcnknLCAnS2V5Y2hhaW5zJyk7XG4gICAgdGhpcy5faWRiID0gbnVsbDtcblxuICAgIC8vIGZvciBzZXR0aW5nIHRoZSBsb2NhdGlvbiB1c2luZyBBcHBsZVNjcmlwdCwgdGhlIHRvcC1sZXZlbCBtZW51IHRocm91Z2ggd2hpY2hcbiAgICAvLyB0aGUgJ0xvY2F0aW9uJyBvcHRpb24gaXMgZm91bmRcbiAgICB0aGlzLl9sb2NhdGlvbk1lbnUgPSAnRGVidWcnO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gQnVuZGxlIGlkZW50aWZpZXIgb2YgU2ltdWxhdG9yIFVJIGNsaWVudC5cbiAgICovXG4gIGdldCB1aUNsaWVudEJ1bmRsZUlkICgpIHtcbiAgICByZXR1cm4gVUlfQ0xJRU5UX0JVTkRMRV9JRDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBkZXZpY2VzIHNldCB3aGVyZSB0aGUgY3VycmVudCBzaW11bGF0b3IgaXMgbG9jYXRlZC5cbiAgICogYG51bGxgIHZhbHVlIG1lYW5zIHRoYXQgdGhlIGRlZmF1bHQgcGF0aCBpcyB1c2VkLCB3aGljaCBpcyB1c3VhbGx5IGB+L0xpYnJhcnkvRGV2ZWxvcGVyL0NvcmVTaW11bGF0b3IvRGV2aWNlc2BcbiAgICovXG4gIGdldCBkZXZpY2VzU2V0UGF0aCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2ltY3RsLmRldmljZXNTZXRQYXRoO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgZnVsbCBwYXRoIHRvIHRoZSBkZXZpY2VzIHNldC4gSXQgaXMgcmVjb21tZW5kZWQgdG8gc2V0IHRoaXMgdmFsdWVcbiAgICogb25jZSByaWdodCBhZnRlciBTaW11bGF0b3IgaW5zdGFuY2UgaXMgY3JlYXRlZCBhbmQgdG8gbm90IGNoYW5nZSBpdCBkdXJpbmdcbiAgICogdGhlIGluc3RhbmNlIGxpZmVjeWNsZVxuICAgKlxuICAgKiBAcGFyYW0gez9zdHJpbmd9IHZhbHVlIFRoZSBmdWxsIHBhdGggdG8gdGhlIGRldmljZXMgc2V0IHJvb3Qgb24gdGhlXG4gICAqIGxvY2FsIGZpbGUgc3lzdGVtXG4gICAqL1xuICBzZXQgZGV2aWNlc1NldFBhdGggKHZhbHVlKSB7XG4gICAgdGhpcy5zaW1jdGwuZGV2aWNlc1NldFBhdGggPSB2YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgdGhlIGN1cnJlbnQgcHJvY2VzcyBpZCBvZiB0aGUgVUkgY2xpZW50XG4gICAqXG4gICAqIEByZXR1cm4gez9zdHJpbmd9IFRoZSBwcm9jZXNzIElEIG9yIG51bGwgaWYgdGhlIFVJIGNsaWVudCBpcyBub3QgcnVubmluZ1xuICAgKi9cbiAgYXN5bmMgZ2V0VUlDbGllbnRQaWQgKCkge1xuICAgIGxldCBzdGRvdXQ7XG4gICAgdHJ5IHtcbiAgICAgICh7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ3BncmVwJywgWyctZm4nLCBgJHtTSU1VTEFUT1JfQVBQX05BTUV9L0NvbnRlbnRzL01hY09TL2BdKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlmIChpc05hTihwYXJzZUludChzdGRvdXQsIDEwKSkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBzdGRvdXQgPSBzdGRvdXQudHJpbSgpO1xuICAgIGxvZy5kZWJ1ZyhgR290IFNpbXVsYXRvciBVSSBjbGllbnQgUElEOiAke3N0ZG91dH1gKTtcbiAgICByZXR1cm4gc3Rkb3V0O1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIHRoZSBzdGF0ZSBvZiBTaW11bGF0b3IgVUkgY2xpZW50LlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIG9mIGlmIFVJIGNsaWVudCBpcyBydW5uaW5nIG9yIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIGFzeW5jIGlzVUlDbGllbnRSdW5uaW5nICgpIHtcbiAgICByZXR1cm4gIV8uaXNOdWxsKGF3YWl0IHRoaXMuZ2V0VUlDbGllbnRQaWQoKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBwbGF0Zm9ybSB2ZXJzaW9uIG9mIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBTREsgdmVyc2lvbiwgZm9yIGV4YW1wbGUgJzguMycuXG4gICAqL1xuICBhc3luYyBnZXRQbGF0Zm9ybVZlcnNpb24gKCkge1xuICAgIGlmICghdGhpcy5fcGxhdGZvcm1WZXJzaW9uKSB7XG4gICAgICBjb25zdCB7c2RrfSA9IGF3YWl0IHRoaXMuc3RhdCgpO1xuICAgICAgdGhpcy5fcGxhdGZvcm1WZXJzaW9uID0gc2RrO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fcGxhdGZvcm1WZXJzaW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSBmdWxsIHBhdGggdG8gdGhlIGRpcmVjdG9yeSB3aGVyZSBTaW11bGF0b3Igc3R1ZmYgaXMgbG9jYXRlZC5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgcGF0aCBzdHJpbmcuXG4gICAqL1xuICBnZXRSb290RGlyICgpIHtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKHByb2Nlc3MuZW52LkhPTUUsICdMaWJyYXJ5JywgJ0RldmVsb3BlcicsICdDb3JlU2ltdWxhdG9yJywgJ0RldmljZXMnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgZnVsbCBwYXRoIHRvIHRoZSBkaXJlY3Rvcnkgd2hlcmUgU2ltdWxhdG9yIGFwcGxpY2F0aW9ucyBkYXRhIGlzIGxvY2F0ZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHBhdGggc3RyaW5nLlxuICAgKi9cbiAgZ2V0RGlyICgpIHtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0Um9vdERpcigpLCB0aGlzLnVkaWQsICdkYXRhJyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIGZ1bGwgcGF0aCB0byB0aGUgZGlyZWN0b3J5IHdoZXJlIFNpbXVsYXRvciBsb2dzIGFyZSBzdG9yZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHBhdGggc3RyaW5nLlxuICAgKi9cbiAgZ2V0TG9nRGlyICgpIHtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKHByb2Nlc3MuZW52LkhPTUUsICdMaWJyYXJ5JywgJ0xvZ3MnLCAnQ29yZVNpbXVsYXRvcicsIHRoaXMudWRpZCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBzdGF0ZSBhbmQgc3BlY2lmaWNzIG9mIHRoaXMgc2ltLlxuICAgKlxuICAgKiBAcmV0dXJuIHtvYmplY3R9IFNpbXVsYXRvciBzdGF0cyBtYXBwaW5nLCBmb3IgZXhhbXBsZTpcbiAgICogeyBuYW1lOiAnaVBob25lIDRzJyxcbiAgICogICB1ZGlkOiAnQzA5QjM0RTUtN0RDQi00NDJFLUI3OUMtQUI2QkMwMzU3NDE3JyxcbiAgICogICBzdGF0ZTogJ1NodXRkb3duJyxcbiAgICogICBzZGs6ICc4LjMnXG4gICAqIH1cbiAgICovXG4gIGFzeW5jIHN0YXQgKCkge1xuICAgIGZvciAoY29uc3QgW3NkaywgZGV2aWNlQXJyXSBvZiBfLnRvUGFpcnMoYXdhaXQgdGhpcy5zaW1jdGwuZ2V0RGV2aWNlcygpKSkge1xuICAgICAgZm9yIChsZXQgZGV2aWNlIG9mIGRldmljZUFycikge1xuICAgICAgICBpZiAoZGV2aWNlLnVkaWQgPT09IHRoaXMudWRpZCkge1xuICAgICAgICAgIGRldmljZS5zZGsgPSBzZGs7XG4gICAgICAgICAgcmV0dXJuIGRldmljZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiB0aGUgU2ltdWxhdG9yIGhhcyBiZWVuIGJvb3RlZCBhdCBsZWFzdCBvbmNlXG4gICAqIGFuZCBoYXMgbm90IGJlZW4gZXJhc2VkIGJlZm9yZVxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBjdXJyZW50IFNpbXVsYXRvciBoYXMgbmV2ZXIgYmVlbiBzdGFydGVkIGJlZm9yZVxuICAgKi9cbiAgYXN5bmMgaXNGcmVzaCAoKSB7XG4gICAgY29uc3QgY2FjaGVzUm9vdCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnTGlicmFyeScsICdDYWNoZXMnKTtcbiAgICByZXR1cm4gKGF3YWl0IGZzLmV4aXN0cyhjYWNoZXNSb290KSlcbiAgICAgID8gKGF3YWl0IGZzLmdsb2IoJyonLCB7Y3dkOiBjYWNoZXNSb290LCBub3NvcnQ6IHRydWUsIHN0cmljdDogZmFsc2V9KSkubGVuZ3RoID09PSAwXG4gICAgICA6IHRydWU7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHRoZSBzdGF0ZSBvZiB0aGUgY3VycmVudCBTaW11bGF0b3IuIE9uZSBzaG91bGQgZGlzdGluZ3Vpc2ggdGhlXG4gICAqIHN0YXRlcyBvZiBTaW11bGF0b3IgVUkgYW5kIHRoZSBTaW11bGF0b3IgaXRzZWxmLlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBjdXJyZW50IFNpbXVsYXRvciBpcyBydW5uaW5nLlxuICAgKi9cbiAgYXN5bmMgaXNSdW5uaW5nICgpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zaW1jdGwuZ2V0RW52KCdkdW1teScpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgdGhlIHNpbXVsYXRvciBpcyBpbiBzaHV0ZG93biBzdGF0ZS5cbiAgICogVGhpcyBtZXRob2QgaXMgbmVjZXNzYXJ5LCBiZWNhdXNlIFNpbXVsYXRvciBtaWdodCBhbHNvIGJlXG4gICAqIGluIHRoZSB0cmFuc2l0aW9uYWwgU2h1dHRpbmcgRG93biBzdGF0ZSByaWdodCBhZnRlciB0aGUgYHNodXRkb3duYFxuICAgKiBjb21tYW5kIGhhcyBiZWVuIGlzc3VlZC5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgY3VycmVudCBTaW11bGF0b3IgaXMgc2h1dCBkb3duLlxuICAgKi9cbiAgYXN5bmMgaXNTaHV0ZG93biAoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2ltY3RsLmdldEVudignZHVtbXknKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gXy5pbmNsdWRlcyhlLnN0ZGVyciwgJ0N1cnJlbnQgc3RhdGU6IFNodXRkb3duJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IFNpbXVsYXRvck9wdGlvbnNcbiAgICogQHByb3BlcnR5IHs/c3RyaW5nfSBzY2FsZUZhY3RvciBbbnVsbF0gLSBEZWZpbmVzIHRoZSB3aW5kb3cgc2NhbGUgdmFsdWUgZm9yIHRoZSBVSSBjbGllbnQgd2luZG93IGZvciB0aGUgY3VycmVudCBTaW11bGF0b3IuXG4gICAqICAgRXF1YWxzIHRvIG51bGwgYnkgZGVmYXVsdCwgd2hpY2gga2VlcHMgdGhlIGN1cnJlbnQgc2NhbGUgdW5jaGFuZ2VkLlxuICAgKiAgIEl0IHNob3VsZCBiZSBvbmUgb2YgWycxLjAnLCAnMC43NScsICcwLjUnLCAnMC4zMycsICcwLjI1J10uXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBzdGFydHVwVGltZW91dCBbNjAwMDBdIC0gTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIFNpbXVsYXRvciBib290aW5nXG4gICAqICAgcHJvY2VzcyBpcyBjb21wbGV0ZWQuIFRoZSBkZWZhdWx0IHRpbWVvdXQgd2lsbCBiZSB1c2VkIGlmIG5vdCBzZXQgZXhwbGljaXRseS5cbiAgICovXG5cbiAgLyoqXG4gICAqIFN0YXJ0IHRoZSBTaW11bGF0b3IgVUkgY2xpZW50IHdpdGggdGhlIGdpdmVuIGFyZ3VtZW50c1xuICAgKiBAcGFyYW0ge1NpbXVsYXRvck9wdGlvbnN9IG9wdHMgLSBTaW11bGF0b3Igc3RhcnR1cCBvcHRpb25zXG4gICAqL1xuICBhc3luYyBzdGFydFVJQ2xpZW50IChvcHRzID0ge30pIHtcbiAgICBvcHRzID0gXy5jbG9uZURlZXAob3B0cyk7XG4gICAgXy5kZWZhdWx0c0RlZXAob3B0cywge1xuICAgICAgc2NhbGVGYWN0b3I6IG51bGwsXG4gICAgICBzdGFydHVwVGltZW91dDogdGhpcy5zdGFydHVwVGltZW91dCxcbiAgICB9KTtcblxuICAgIGNvbnN0IHNpbXVsYXRvckFwcCA9IHBhdGgucmVzb2x2ZShhd2FpdCBnZXRYY29kZVBhdGgoKSwgJ0FwcGxpY2F0aW9ucycsIFNJTVVMQVRPUl9BUFBfTkFNRSk7XG4gICAgY29uc3QgYXJncyA9IFtcbiAgICAgICctRm4nLCBzaW11bGF0b3JBcHAsXG4gICAgICAnLS1hcmdzJywgJy1DdXJyZW50RGV2aWNlVURJRCcsIHRoaXMudWRpZCxcbiAgICBdO1xuXG4gICAgaWYgKG9wdHMuc2NhbGVGYWN0b3IpIHtcbiAgICAgIGNvbnN0IHtuYW1lfSA9IGF3YWl0IHRoaXMuc3RhdCgpO1xuICAgICAgY29uc3QgZm9ybWF0dGVkRGV2aWNlTmFtZSA9IG5hbWUucmVwbGFjZSgvXFxzKy9nLCAnLScpO1xuICAgICAgY29uc3QgYXJndW1lbnROYW1lID0gYC1TaW11bGF0b3JXaW5kb3dMYXN0U2NhbGUtY29tLmFwcGxlLkNvcmVTaW11bGF0b3IuU2ltRGV2aWNlVHlwZS4ke2Zvcm1hdHRlZERldmljZU5hbWV9YDtcbiAgICAgIGFyZ3MucHVzaChhcmd1bWVudE5hbWUsIG9wdHMuc2NhbGVGYWN0b3IpO1xuICAgIH1cblxuICAgIGxvZy5pbmZvKGBTdGFydGluZyBTaW11bGF0b3IgVUkgd2l0aCBjb21tYW5kOiBvcGVuICR7YXJncy5qb2luKCcgJyl9YCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGV4ZWMoJ29wZW4nLCBhcmdzLCB7dGltZW91dDogb3B0cy5zdGFydHVwVGltZW91dH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKCEoZXJyLnN0ZG91dCB8fCAnJykuaW5jbHVkZXMoJy0xMDgyNScpICYmICEoZXJyLnN0ZGVyciB8fCAnJykuaW5jbHVkZXMoJy0xMDgyNScpKSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICAgIGxvZy53YXJuKGBFcnJvciB3aGlsZSBvcGVuaW5nIFVJOiAke2Vyci5zdGRvdXQgfHwgZXJyLnN0ZGVycn0uIENvbnRpbnVpbmdgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZXMgZ2l2ZW4gU2ltdWxhdG9yIHdpdGggb3B0aW9ucy4gVGhlIFNpbXVsYXRvciB3aWxsIG5vdCBiZSByZXN0YXJ0ZWQgaWZcbiAgICogaXQgaXMgYWxyZWFkeSBydW5uaW5nLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gb3B0cyAtIE9uZSBvciBtb3JlIG9mIGF2YWlsYWJsZSBTaW11bGF0b3Igb3B0aW9ucy5cbiAgICogICBTZWUgeyNzdGFydFVJQ2xpZW50KG9wdHMpfSBkb2N1bWVudGF0aW9uIGZvciBtb3JlIGRldGFpbHMgb24gb3RoZXIgc3VwcG9ydGVkIGtleXMuXG4gICAqL1xuICBhc3luYyBydW4gKG9wdHMgPSB7fSkge1xuICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHtcbiAgICAgIHN0YXJ0dXBUaW1lb3V0OiB0aGlzLnN0YXJ0dXBUaW1lb3V0LFxuICAgIH0sIG9wdHMpO1xuICAgIGNvbnN0IGlzU2VydmVyUnVubmluZyA9IGF3YWl0IHRoaXMuaXNSdW5uaW5nKCk7XG4gICAgY29uc3QgaXNVSUNsaWVudFJ1bm5pbmcgPSBhd2FpdCB0aGlzLmlzVUlDbGllbnRSdW5uaW5nKCk7XG4gICAgaWYgKGlzU2VydmVyUnVubmluZyAmJiBpc1VJQ2xpZW50UnVubmluZykge1xuICAgICAgbG9nLmluZm8oYEJvdGggU2ltdWxhdG9yIHdpdGggVURJRCAke3RoaXMudWRpZH0gYW5kIHRoZSBVSSBjbGllbnQgYXJlIGN1cnJlbnRseSBydW5uaW5nYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2h1dGRvd24oKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBFcnJvciBvbiBTaW11bGF0b3Igc2h1dGRvd246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMuc3RhcnRVSUNsaWVudChvcHRzKTtcblxuICAgIGF3YWl0IHRoaXMud2FpdEZvckJvb3Qob3B0cy5zdGFydHVwVGltZW91dCk7XG4gICAgbG9nLmluZm8oYFNpbXVsYXRvciB3aXRoIFVESUQgJHt0aGlzLnVkaWR9IGJvb3RlZCBpbiAke3RpbWVyLmdldER1cmF0aW9uKCkuYXNTZWNvbmRzLnRvRml4ZWQoMyl9c2ApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IHRoZSBjdXJyZW50IFNpbXVsYXRvciB0byB0aGUgY2xlYW4gc3RhdGUuXG4gICAqIEl0IGlzIGV4cGVjdGVkIHRoZSBzaW11bGF0b3IgaXMgaW4gc2h1dGRvd24gc3RhdGUgd2hlbiB0aGlzIEFQSSBpcyBjYWxsZWQuXG4gICAqL1xuICBhc3luYyBjbGVhbiAoKSB7XG4gICAgbG9nLmluZm8oYENsZWFuaW5nIHNpbXVsYXRvciAke3RoaXMudWRpZH1gKTtcbiAgICBhd2FpdCB0aGlzLnNpbWN0bC5lcmFzZURldmljZSgxMDAwMCk7XG4gIH1cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gU2h1dGRvd25PcHRpb25zXG4gICAqIEBwcm9wZXJ0eSB7P251bWJlcnxzdHJpbmd9IHRpbWVvdXQgVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbFxuICAgKiBTaW11bGF0b3IgaXMgc2h1dCBkb3duIGNvbXBsZXRlbHkuIE5vIHdhaXQgaGFwcGVucyBpZiB0aGUgdGltZW91dCB2YWx1ZSBpcyBub3Qgc2V0XG4gICAqL1xuXG4gIC8qKlxuICAgKiBTaHV0IGRvd24gdGhlIGN1cnJlbnQgU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0gez9TaHV0ZG93bk9wdGlvbnN9IG9wdHNcbiAgICogQHRocm93cyB7RXJyb3J9IElmIFNpbXVsYXRvciBmYWlscyB0byB0cmFuc2l0aW9uIGludG8gU2h1dGRvd24gc3RhdGUgYWZ0ZXJcbiAgICogdGhlIGdpdmVuIHRpbWVvdXRcbiAgICovXG4gIGFzeW5jIHNodXRkb3duIChvcHRzID0ge30pIHtcbiAgICBpZiAoYXdhaXQgdGhpcy5pc1NodXRkb3duKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBhd2FpdCByZXRyeUludGVydmFsKDUsIDUwMCwgdGhpcy5zaW1jdGwuc2h1dGRvd25EZXZpY2UuYmluZCh0aGlzLnNpbWN0bCkpO1xuICAgIGNvbnN0IHdhaXRNcyA9IHBhcnNlSW50KG9wdHMudGltZW91dCwgMTApO1xuICAgIGlmICh3YWl0TXMgPiAwKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFzeW5jICgpID0+IGF3YWl0IHRoaXMuaXNTaHV0ZG93bigpLCB7XG4gICAgICAgICAgd2FpdE1zLFxuICAgICAgICAgIGludGVydmFsTXM6IDEwMCxcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBTaW11bGF0b3IgaXMgbm90IGluICdTaHV0ZG93bicgc3RhdGUgYWZ0ZXIgJHt3YWl0TXN9bXNgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlIHRoZSBwYXJ0aWN1bGFyIFNpbXVsYXRvciBmcm9tIGRldmljZXMgbGlzdFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlICgpIHtcbiAgICBhd2FpdCB0aGlzLnNpbWN0bC5kZWxldGVEZXZpY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBY3RpdmF0ZXMgU2ltdWxhdG9yIHdpbmRvdy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHJldHVybnMgez9zdHJpbmd9IElmIHRoZSBtZXRob2QgcmV0dXJucyBhIHN0cmluZyB0aGVuIGl0IHNob3VsZCBiZSBhIHZhbGlkIEFwcGxlIFNjcmlwdCB3aGljaFxuICAgKiBpcyBhcHBlbmRlZCBiZWZvcmUgZWFjaCBVSSBjbGllbnQgY29tbWFuZCBpcyBleGVjdXRlZC4gT3RoZXJ3aXNlIHRoZSBtZXRob2Qgc2hvdWxkIGFjdGl2YXRlIHRoZSB3aW5kb3dcbiAgICogaXRzZWxmIGFuZCByZXR1cm4gbm90aGluZy5cbiAgICovXG4gIGFzeW5jIF9hY3RpdmF0ZVdpbmRvdyAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIGNvbnN0IHBpZCA9IGF3YWl0IHRoaXMuZ2V0VUlDbGllbnRQaWQoKTtcbiAgICBpZiAocGlkKSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gYXdhaXQgYWN0aXZhdGVBcHAocGlkKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLmRlYnVnKGUuc3RkZXJyIHx8IGUubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGZyb250bW9zdCB0byBmYWxzZVxuICAgICAgICAgIHNldCBmcm9udG1vc3QgdG8gdHJ1ZVxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgZ2l2ZW4gQXBwbGUgU2NyaXB0IGluc2lkZSBhIGNyaXRpY2FsIHNlY3Rpb24sIHNvIG90aGVyXG4gICAqIHNlc3Npb25zIGNhbm5vdCBpbmZsdWVuY2UgdGhlIFVJIGNsaWVudCBhdCB0aGUgc2FtZSB0aW1lLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwbGVTY3JpcHQgLSBUaGUgdmFsaWQgQXBwbGUgU2NyaXB0IHNuaXBwZXQgdG8gYmUgZXhlY3V0ZWQuXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHN0ZG91dCBvdXRwdXQgcHJvZHVjZWQgYnkgdGhlIHNjcmlwdC5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIG9zYXNjcmlwdCB0b29sIHJldHVybnMgbm9uLXplcm8gZXhpdCBjb2RlLlxuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZVVJQ2xpZW50U2NyaXB0IChhcHBsZVNjcmlwdCkge1xuICAgIGNvbnN0IHdpbmRvd0FjdGl2YXRpb25TY3JpcHQgPSBhd2FpdCB0aGlzLl9hY3RpdmF0ZVdpbmRvdygpO1xuICAgIGNvbnN0IHJlc3VsdFNjcmlwdCA9IGAke3dpbmRvd0FjdGl2YXRpb25TY3JpcHQgPyB3aW5kb3dBY3RpdmF0aW9uU2NyaXB0ICsgJ1xcbicgOiAnJ30ke2FwcGxlU2NyaXB0fWA7XG4gICAgbG9nLmRlYnVnKGBFeGVjdXRpbmcgVUkgQXBwbGUgU2NyaXB0IG9uIFNpbXVsYXRvciB3aXRoIFVESUQgJHt0aGlzLnVkaWR9OiAke3Jlc3VsdFNjcmlwdH1gKTtcbiAgICByZXR1cm4gYXdhaXQgVUlfQ0xJRU5UX0FDQ0VTU19HVUFSRC5hY3F1aXJlKFNJTVVMQVRPUl9BUFBfTkFNRSwgYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKCdvc2FzY3JpcHQnLCBbJy1lJywgcmVzdWx0U2NyaXB0XSk7XG4gICAgICAgIHJldHVybiBzdGRvdXQ7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coXG4gICAgICAgICAgYENvdWxkIG5vdCBjb21wbGV0ZSBvcGVyYXRpb24uIE1ha2Ugc3VyZSBTaW11bGF0b3IgVUkgaXMgcnVubmluZyBhbmQgdGhlIHBhcmVudCBBcHBpdW0gYXBwbGljYXRpb24gKGUuIGcuIEFwcGl1bS5hcHAgb3IgVGVybWluYWwuYXBwKSBgICtcbiAgICAgICAgICBgaXMgcHJlc2VudCBpbiBTeXN0ZW0gUHJlZmVyZW5jZXMgPiBTZWN1cml0eSAmIFByaXZhY3kgPiBQcml2YWN5ID4gQWNjZXNzaWJpbGl0eSBsaXN0LiBJZiB0aGUgb3BlcmF0aW9uIGlzIHN0aWxsIHVuc3VjY2Vzc2Z1bCB0aGVuIGAgK1xuICAgICAgICAgIGBpdCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgU2ltdWxhdG9yLiBPcmlnaW5hbCBlcnJvcjogJHtlcnIubWVzc2FnZX1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gUHJvY2Vzc0luZm9cbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IHBpZCBUaGUgYWN0dWFsIHByb2Nlc3MgaWRlbnRpZmllci5cbiAgICogQ291bGQgYmUgemVybyBpZiB0aGUgcHJvY2VzcyBpcyB0aGUgc3lzdGVtIG9uZS5cbiAgICogQHByb3BlcnR5IHs/c3RyaW5nfSBncm91cCBUaGUgcHJvY2VzcyBncm91cCBpZGVudGlmaWVyLlxuICAgKiBUaGlzIGNvdWxkIGJlIGBudWxsYCBpZiB0aGUgcHJvY2VzcyBpcyBub3QgYSBwYXJ0IG9mIHRoZVxuICAgKiBwYXJ0aWN1bGFyIGdyb3VwLiBGb3IgYG5vcm1hbGAgYXBwbGljYXRpb24gcHJvY2Vzc2VzIHRoZSBncm91cFxuICAgKiBuYW1lIHVzdWFsbHkgZXF1YWxzIHRvIGBVSUtpdEFwcGxpY2F0aW9uYC5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IG5hbWUgVGhlIHByb2Nlc3MgbmFtZSwgZm9yIGV4YW1wbGVcbiAgICogYGNvbS5hcHBsZS5QcmVmZXJlbmNlc2BcbiAgICovXG5cbiAgLyoqXG4gICAqIExpc3RzIHByb2Nlc3NlcyB0aGF0IGFyZSBjdXJyZW50bHkgcnVubmluZyBvbiB0aGUgZ2l2ZW4gU2ltdWxhdG9yLlxuICAgKiBUaGUgc2ltdWxhdG9yIG11c3QgYmUgaW4gcnVubmluZyBzdGF0ZSBpbiBvcmRlciBmb3IgdGhpc1xuICAgKiBtZXRob2QgdG8gd29yayBwcm9wZXJseS5cbiAgICpcbiAgICogQHJldHVybiB7QXJyYXk8UHJvY2Vzc0luZm8+fSBUaGUgbGlzdCBvZiByZXRyaWV2ZWQgcHJvY2Vzc1xuICAgKiBpbmZvcm1hdGlvblxuICAgKiBAdGhyb3dzIHtFcnJvcn0gaWYgbm8gcHJvY2VzcyBpbmZvcm1hdGlvbiBjb3VsZCBiZSByZXRyaWV2ZWQuXG4gICAqL1xuICBhc3luYyBwcyAoKSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCB0aGlzLnNpbWN0bC5zcGF3blByb2Nlc3MoW1xuICAgICAgJ2xhdW5jaGN0bCcsXG4gICAgICAncHJpbnQnLFxuICAgICAgJ3N5c3RlbScsXG4gICAgXSk7XG5cbiAgICBjb25zdCBzZXJ2aWNlc01hdGNoID0gL15cXHMqc2VydmljZXNcXHMqPVxccyp7KFtefV0rKS9tLmV4ZWMoc3Rkb3V0KTtcbiAgICBpZiAoIXNlcnZpY2VzTWF0Y2gpIHtcbiAgICAgIGxvZy5kZWJ1ZyhzdGRvdXQpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgbGlzdCBvZiBhY3RpdmUgcHJvY2Vzc2VzIGNhbm5vdCBiZSByZXRyaWV2ZWRgKTtcbiAgICB9XG4gICAgLypcbiAgICBFeGFtcGxlIG1hdGNoOlxuICAgICAgICAwICAgICA3OCBcdGNvbS5hcHBsZS5yZXNvdXJjZWdyYWJiZXJkXG4gICAgODIxNTggICAgICAtIFx0Y29tLmFwcGxlLmFzc2lzdGFudF9zZXJ2aWNlXG4gICAgODIxMjAgICAgICAtIFx0Y29tLmFwcGxlLm5hbm9yZWdpc3RyeWRcbiAgICA4MjA4NyAgICAgIC0gXHRjb20uYXBwbGUubm90aWZ5ZFxuICAgIDgyMjY0ICAgICAgLSBcdFVJS2l0QXBwbGljYXRpb246Y29tLmFwcGxlLlByZWZlcmVuY2VzWzcwNGJdW3JiLWxlZ2FjeV1cbiAgICAqL1xuICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgIGNvbnN0IHBhdHRlcm4gPSAvXlxccyooXFxkKylcXHMrW1xcZC1dK1xccysoW1xcd1xcLS5dKzopPyhbXFx3XFwtLl0rKS9nbTtcbiAgICBsZXQgbWF0Y2g7XG4gICAgd2hpbGUgKChtYXRjaCA9IHBhdHRlcm4uZXhlYyhzZXJ2aWNlc01hdGNoWzFdKSkpIHtcbiAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgcGlkOiBwYXJzZUludChtYXRjaFsxXSwgMTApLFxuICAgICAgICBncm91cDogXy50cmltRW5kKG1hdGNoWzJdLCAnOicpIHx8IG51bGwsXG4gICAgICAgIG5hbWU6IG1hdGNoWzNdLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiB7P3N0cmluZ30gVGhlIGZ1bGwgcGF0aCB0byB0aGUgc2ltdWxhdG9yJ3MgV2ViSW5zcGVjdG9yIFVuaXggRG9tYWluIFNvY2tldFxuICAgKiAgIG9yIGBudWxsYCBpZiB0aGVyZSBpcyBubyBzb2NrZXQuXG4gICAqL1xuICBhc3luYyBnZXRXZWJJbnNwZWN0b3JTb2NrZXQgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICAvLyB0aGVyZSBpcyBubyBXZWJJbnNwZWN0b3Igc29ja2V0IGZvciB0aGlzIHZlcnNpb24gb2YgWGNvZGVcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBJREIgaW5zdGFuY2Ugc2V0dGVyXG4gICAqXG4gICAqIEBwYXJhbSB7SURCfSB2YWx1ZVxuICAgKi9cbiAgc2V0IGlkYiAodmFsdWUpIHtcbiAgICB0aGlzLl9pZGIgPSB2YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJuIHtJREJ9IGlkYiBpbnN0YW5jZVxuICAgKi9cbiAgZ2V0IGlkYiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lkYjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBraWxsT3B0c1xuICAgKiBAcHJvcGVydHkgez9udW1iZXJ8c3RyaW5nfSBwaWQgLSBQcm9jZXNzIGlkIG9mIHRoZSBVSSBTaW11bGF0b3Igd2luZG93XG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfHN0cmluZ30gc2lnbmFsIFsyXSAtIFRoZSBzaWduYWwgbnVtYmVyIHRvIHNlbmQgdG8gdGhlXG4gICAqIGBraWxsYCBjb21tYW5kXG4gICAqL1xuXG4gIC8qKlxuICAgKiBLaWxsIHRoZSBVSSBjbGllbnQgaWYgaXQgaXMgcnVubmluZy5cbiAgICpcbiAgICogQHBhcmFtIHs/a2lsbE9wdHN9IG9wdHNcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgVUkgY2xpZW50IHdhcyBzdWNjZXNzZnVsbHkga2lsbGVkIG9yIGZhbHNlXG4gICAqICAgICAgICAgICAgICAgICAgIGlmIGl0IGlzIG5vdCBydW5uaW5nLlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgc2VuZGluZyB0aGUgc2lnbmFsIHRvIHRoZSBjbGllbnQgcHJvY2VzcyBmYWlsc1xuICAgKi9cbiAgYXN5bmMga2lsbFVJQ2xpZW50IChvcHRzID0ge30pIHtcbiAgICBsZXQge1xuICAgICAgcGlkLFxuICAgICAgc2lnbmFsID0gMixcbiAgICB9ID0gb3B0cztcbiAgICBwaWQgPSBwaWQgfHwgYXdhaXQgdGhpcy5nZXRVSUNsaWVudFBpZCgpO1xuICAgIGlmICghcGlkKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKGBTZW5kaW5nICR7c2lnbmFsfSBraWxsIHNpZ25hbCB0byBTaW11bGF0b3IgVUkgY2xpZW50IHdpdGggUElEICR7cGlkfWApO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBleGVjKCdraWxsJywgW2AtJHtzaWduYWx9YCwgcGlkXSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpZiAoZS5jb2RlID09PSAxKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGtpbGwgdGhlIFNpbXVsYXRvciBVSSBjbGllbnQuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiB7bnVtYmVyfSBUaGUgbWF4IG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCBTaW11bGF0b3IgYm9vdGluZyBpcyBjb21wbGV0ZWQuXG4gICAqL1xuICBnZXQgc3RhcnR1cFRpbWVvdXQgKCkge1xuICAgIHJldHVybiBTVEFSVFVQX1RJTUVPVVRfTVM7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZ5IHdoZXRoZXIgdGhlIFNpbXVsYXRvciBib290aW5nIGlzIGNvbXBsZXRlZCBhbmQvb3Igd2FpdCBmb3IgaXRcbiAgICogdW50aWwgdGhlIHRpbWVvdXQgZXhwaXJlcy5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0dXBUaW1lb3V0IC0gdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCBib290aW5nIGlzIGNvbXBsZXRlZC5cbiAgICogQGVtaXRzIEJPT1RfQ09NUExFVEVEX0VWRU5UIGlmIHRoZSBjdXJyZW50IFNpbXVsYXRvciBpcyByZWFkeSB0byBhY2NlcHQgc2ltY3RsIGNvbW1hbmRzLCBsaWtlICdpbnN0YWxsJy5cbiAgICovXG4gIGFzeW5jIHdhaXRGb3JCb290IChzdGFydHVwVGltZW91dCkge1xuICAgIGF3YWl0IHRoaXMuc2ltY3RsLnN0YXJ0Qm9vdE1vbml0b3Ioe3RpbWVvdXQ6IHN0YXJ0dXBUaW1lb3V0fSk7XG4gICAgdGhpcy5lbWl0KEJPT1RfQ09NUExFVEVEX0VWRU5UKTtcbiAgfVxufVxuXG5mb3IgKGNvbnN0IFtjbWQsIGZuXSBvZiBfLnRvUGFpcnMoZXh0ZW5zaW9ucykpIHtcbiAgU2ltdWxhdG9yWGNvZGU4LnByb3RvdHlwZVtjbWRdID0gZm47XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNpbXVsYXRvclhjb2RlODtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtB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