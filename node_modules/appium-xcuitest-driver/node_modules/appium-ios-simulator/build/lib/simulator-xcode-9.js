"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _simulatorXcode = _interopRequireDefault(require("./simulator-xcode-8"));
var _lodash = _interopRequireDefault(require("lodash"));
var _path = _interopRequireDefault(require("path"));
var _support = require("@appium/support");
var _asyncLock = _interopRequireDefault(require("async-lock"));
var _logger = _interopRequireDefault(require("./logger"));
var _asyncbox = require("asyncbox");
var _utils = require("./utils.js");
var _defaultsUtils = require("./defaults-utils");
var _bluebird = _interopRequireDefault(require("bluebird"));
var _events = require("events");
var _appiumXcode = require("appium-xcode");
var _teen_process = require("teen_process");
const SIMULATOR_SHUTDOWN_TIMEOUT = 15 * 1000;
const startupLock = new _asyncLock.default();
const preferencesPlistGuard = new _asyncLock.default();
const ENROLLMENT_NOTIFICATION_RECEIVER = 'com.apple.BiometricKit.enrollmentChanged';
const DOMAIN_KEYBOARD_PREFERENCES = 'com.apple.keyboard.preferences';
function compileSimulatorPreferences(opts = {}) {
  const {
    connectHardwareKeyboard,
    tracePointer,
    pasteboardAutomaticSync,
    scaleFactor
  } = opts;
  const commonPreferences = {
    RotateWindowWhenSignaledByGuest: true,
    StartLastDeviceOnLaunch: false,
    DetachOnWindowClose: false,
    AttachBootedOnStart: true
  };
  const devicePreferences = opts.devicePreferences ? _lodash.default.cloneDeep(opts.devicePreferences) : {};
  if (scaleFactor) {
    devicePreferences.SimulatorWindowLastScale = parseFloat(scaleFactor);
  }
  if (_lodash.default.isBoolean(connectHardwareKeyboard) || _lodash.default.isNil(connectHardwareKeyboard)) {
    devicePreferences.ConnectHardwareKeyboard = connectHardwareKeyboard ?? false;
    commonPreferences.ConnectHardwareKeyboard = connectHardwareKeyboard ?? false;
  }
  if (_lodash.default.isBoolean(tracePointer)) {
    commonPreferences.ShowSingleTouches = tracePointer;
    commonPreferences.ShowPinches = tracePointer;
    commonPreferences.ShowPinchPivotPoint = tracePointer;
    commonPreferences.HighlightEdgeGestures = tracePointer;
  }
  switch (_lodash.default.lowerCase(pasteboardAutomaticSync)) {
    case 'on':
      commonPreferences.PasteboardAutomaticSync = true;
      break;
    case 'off':
      commonPreferences.PasteboardAutomaticSync = false;
      break;
    case 'system':
      break;
    default:
      _logger.default.info(`['on', 'off' or 'system'] are available as the pasteboard automatic sync option. Defaulting to 'off'`);
      commonPreferences.PasteboardAutomaticSync = false;
  }
  return [devicePreferences, commonPreferences];
}
class SimulatorXcode9 extends _simulatorXcode.default {
  constructor(udid, xcodeVersion) {
    super(udid, xcodeVersion);
  }
  async run(opts = {}) {
    opts = _lodash.default.cloneDeep(opts);
    _lodash.default.defaultsDeep(opts, {
      isHeadless: false,
      startupTimeout: this.startupTimeout
    });
    const [devicePreferences, commonPreferences] = compileSimulatorPreferences(opts);
    await this.updatePreferences(devicePreferences, commonPreferences);
    const timer = new _support.timing.Timer().start();
    const shouldWaitForBoot = await startupLock.acquire(this.uiClientBundleId, async () => {
      const isServerRunning = await this.isRunning();
      const uiClientPid = await this.getUIClientPid();
      if (opts.isHeadless) {
        if (isServerRunning && !uiClientPid) {
          _logger.default.info(`Simulator with UDID '${this.udid}' is already booted in headless mode.`);
          return false;
        }
        if (await this.killUIClient({
          pid: uiClientPid
        })) {
          _logger.default.info(`Detected the Simulator UI client was running and killed it. Verifying the current Simulator state`);
        }
        try {
          await (0, _asyncbox.waitForCondition)(async () => await this.isShutdown(), {
            waitMs: 5000,
            intervalMs: 100
          });
        } catch (e) {
          if (!(await this.isRunning())) {
            throw new Error(`Simulator with UDID '${this.udid}' cannot be transitioned to headless mode`);
          }
          return false;
        }
        _logger.default.info(`Booting Simulator with UDID '${this.udid}' in headless mode. ` + `All UI-related capabilities are going to be ignored`);
        await this.boot();
      } else {
        if (isServerRunning && uiClientPid) {
          _logger.default.info(`Both Simulator with UDID '${this.udid}' and the UI client are currently running`);
          return false;
        }
        if (isServerRunning) {
          _logger.default.info(`Simulator '${this.udid}' is booted while its UI is not visible. ` + `Trying to restart it with the Simulator window visible`);
          await this.shutdown({
            timeout: SIMULATOR_SHUTDOWN_TIMEOUT
          });
        }
        await this.launchWindow(uiClientPid, opts);
      }
      return true;
    });
    if (shouldWaitForBoot) {
      await this.waitForBoot(opts.startupTimeout);
      _logger.default.info(`Simulator with UDID ${this.udid} booted in ${timer.getDuration().asSeconds.toFixed(3)}s`);
    }
    (async () => {
      try {
        await this.disableKeyboardIntroduction();
      } catch (e) {
        _logger.default.info(`Cannot disable Simulator keyboard introduction. Original error: ${e.message}`);
      }
    })();
  }
  async startUIClient(opts = {}) {
    opts = _lodash.default.cloneDeep(opts);
    _lodash.default.defaultsDeep(opts, {
      startupTimeout: this.startupTimeout
    });
    const simulatorApp = _path.default.resolve(await (0, _appiumXcode.getPath)(), 'Applications', _utils.SIMULATOR_APP_NAME);
    const args = ['-Fn', simulatorApp];
    _logger.default.info(`Starting Simulator UI: ${_support.util.quote(['open', ...args])}`);
    try {
      await (0, _teen_process.exec)('open', args, {
        timeout: opts.startupTimeout
      });
    } catch (err) {
      throw new Error(`Got an unexpected error while opening Simulator UI: ` + err.stderr || err.stdout || err.message);
    }
  }
  async disableKeyboardIntroduction() {
    const argChunks = (0, _defaultsUtils.generateDefaultsCommandArgs)({
      DidShowContinuousPathIntroduction: 1
    }, true);
    await _bluebird.default.all(argChunks.map(args => this.simctl.spawnProcess(['defaults', 'write', DOMAIN_KEYBOARD_PREFERENCES, ...args])));
  }
  async launchWindow(isUiClientRunning, opts = {}) {
    await this.boot();
    if (!isUiClientRunning) {
      await this.startUIClient(opts);
    }
  }
  async boot() {
    const bootEventsEmitter = new _events.EventEmitter();
    await this.simctl.startBootMonitor({
      onError: err => bootEventsEmitter.emit('failure', err),
      onFinished: () => bootEventsEmitter.emit('finish'),
      shouldPreboot: true
    });
    try {
      await new _bluebird.default((resolve, reject) => {
        setTimeout(resolve, 3000);
        bootEventsEmitter.once('failure', err => {
          if (_lodash.default.includes(err === null || err === void 0 ? void 0 : err.message, 'state: Booted')) {
            resolve();
          } else {
            reject(err);
          }
        });
        bootEventsEmitter.once('finish', resolve);
      });
    } finally {
      bootEventsEmitter.removeAllListeners();
    }
  }
  verifyDevicePreferences(prefs = {}) {
    if (_lodash.default.isEmpty(prefs)) {
      return;
    }
    if (!_lodash.default.isUndefined(prefs.SimulatorWindowLastScale)) {
      if (!_lodash.default.isNumber(prefs.SimulatorWindowLastScale) || prefs.SimulatorWindowLastScale <= 0) {
        _logger.default.errorAndThrow(`SimulatorWindowLastScale is expected to be a positive float value. ` + `'${prefs.SimulatorWindowLastScale}' is assigned instead.`);
      }
    }
    if (!_lodash.default.isUndefined(prefs.SimulatorWindowCenter)) {
      const verificationPattern = /{-?\d+(\.\d+)?,-?\d+(\.\d+)?}/;
      if (!_lodash.default.isString(prefs.SimulatorWindowCenter) || !verificationPattern.test(prefs.SimulatorWindowCenter)) {
        _logger.default.errorAndThrow(`SimulatorWindowCenter is expected to match "{floatXPosition,floatYPosition}" format (without spaces). ` + `'${prefs.SimulatorWindowCenter}' is assigned instead.`);
      }
    }
    if (!_lodash.default.isUndefined(prefs.SimulatorWindowOrientation)) {
      const acceptableValues = ['Portrait', 'LandscapeLeft', 'PortraitUpsideDown', 'LandscapeRight'];
      if (acceptableValues.indexOf(prefs.SimulatorWindowOrientation) === -1) {
        _logger.default.errorAndThrow(`SimulatorWindowOrientation is expected to be one of ${acceptableValues}. ` + `'${prefs.SimulatorWindowOrientation}' is assigned instead.`);
      }
    }
    if (!_lodash.default.isUndefined(prefs.SimulatorWindowRotationAngle)) {
      if (!_lodash.default.isNumber(prefs.SimulatorWindowRotationAngle)) {
        _logger.default.errorAndThrow(`SimulatorWindowRotationAngle is expected to be a valid number. ` + `'${prefs.SimulatorWindowRotationAngle}' is assigned instead.`);
      }
    }
  }
  async updatePreferences(devicePrefs = {}, commonPrefs = {}) {
    if (!_lodash.default.isEmpty(devicePrefs)) {
      _logger.default.debug(`Setting preferences of ${this.udid} Simulator to ${JSON.stringify(devicePrefs)}`);
    }
    if (!_lodash.default.isEmpty(commonPrefs)) {
      _logger.default.debug(`Setting common Simulator preferences to ${JSON.stringify(commonPrefs)}`);
    }
    const homeFolderPath = process.env.HOME;
    if (!homeFolderPath) {
      _logger.default.warn(`Cannot get the path to HOME folder from the process environment. ` + `Ignoring Simulator preferences update.`);
      return false;
    }
    this.verifyDevicePreferences(devicePrefs);
    const plistPath = _path.default.resolve(homeFolderPath, 'Library', 'Preferences', 'com.apple.iphonesimulator.plist');
    return await preferencesPlistGuard.acquire(SimulatorXcode9.name, async () => {
      const defaults = new _defaultsUtils.NSUserDefaults(plistPath);
      const prefsToUpdate = _lodash.default.clone(commonPrefs);
      try {
        if (!_lodash.default.isEmpty(devicePrefs)) {
          let existingDevicePrefs;
          const udidKey = this.udid.toUpperCase();
          if (await _support.fs.exists(plistPath)) {
            const currentPlistContent = await defaults.asJson();
            if (_lodash.default.isPlainObject(currentPlistContent.DevicePreferences) && _lodash.default.isPlainObject(currentPlistContent.DevicePreferences[udidKey])) {
              existingDevicePrefs = currentPlistContent.DevicePreferences[udidKey];
            }
          }
          Object.assign(prefsToUpdate, {
            DevicePreferences: {
              [udidKey]: Object.assign({}, existingDevicePrefs || {}, devicePrefs)
            }
          });
        }
        await defaults.update(prefsToUpdate);
        _logger.default.debug(`Updated ${this.udid} Simulator preferences at '${plistPath}' with ` + JSON.stringify(prefsToUpdate));
        return true;
      } catch (e) {
        _logger.default.warn(`Cannot update ${this.udid} Simulator preferences at '${plistPath}'. ` + `Try to delete the file manually in order to reset it. Original error: ${e.message}`);
        return false;
      }
    });
  }
  async _activateWindow() {
    let selfName;
    let selfSdk;
    let bootedDevicesCount = 0;
    for (const [sdk, deviceArr] of _lodash.default.toPairs(await this.simctl.getDevices())) {
      for (const {
        state,
        udid,
        name
      } of deviceArr) {
        if (state === 'Booted') {
          bootedDevicesCount++;
        }
        if (!selfName && udid === this.udid) {
          selfSdk = sdk;
          selfName = name;
        }
      }
    }
    if (bootedDevicesCount < 2) {
      return await super._activateWindow();
    }
    return `
      tell application "System Events"
        tell process "Simulator"
          set frontmost to false
          set frontmost to true
          click (menu item 1 where (its name contains "${selfName} " and its name contains "${selfSdk}")) of menu 1 of menu bar item "Window" of menu bar 1
        end tell
      end tell
    `;
  }
  async isBiometricEnrolled() {
    const {
      stdout
    } = await this.simctl.spawnProcess(['notifyutil', '-g', ENROLLMENT_NOTIFICATION_RECEIVER]);
    const match = new RegExp(`${_lodash.default.escapeRegExp(ENROLLMENT_NOTIFICATION_RECEIVER)}\\s+([01])`).exec(stdout);
    if (!match) {
      throw new Error(`Cannot parse biometric enrollment state from '${stdout}'`);
    }
    _logger.default.info(`Current biometric enrolled state for ${this.udid} Simulator: ${match[1]}`);
    return match[1] === '1';
  }
  async enrollBiometric(isEnabled = true) {
    _logger.default.debug(`Setting biometric enrolled state for ${this.udid} Simulator to '${isEnabled ? 'enabled' : 'disabled'}'`);
    await this.simctl.spawnProcess(['notifyutil', '-s', ENROLLMENT_NOTIFICATION_RECEIVER, isEnabled ? '1' : '0']);
    await this.simctl.spawnProcess(['notifyutil', '-p', ENROLLMENT_NOTIFICATION_RECEIVER]);
    if ((await this.isBiometricEnrolled()) !== isEnabled) {
      throw new Error(`Cannot set biometric enrolled state for ${this.udid} Simulator to '${isEnabled ? 'enabled' : 'disabled'}'`);
    }
  }
  async sendBiometricMatch(shouldMatch = true, biometricName = 'touchId') {
    const domainComponent = (0, _utils.toBiometricDomainComponent)(biometricName);
    const domain = `com.apple.BiometricKit_Sim.${domainComponent}.${shouldMatch ? '' : 'no'}match`;
    await this.simctl.spawnProcess(['notifyutil', '-p', domain]);
    _logger.default.info(`Sent notification ${domain} to ${shouldMatch ? 'match' : 'not match'} ${biometricName} biometric ` + `for ${this.udid} Simulator`);
  }
  async getLaunchDaemonsRoot() {
    const devRoot = await (0, _utils.getDeveloperRoot)();
    return _path.default.resolve(devRoot, 'Platforms/iPhoneOS.platform/Developer/Library/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot/System/Library/LaunchDaemons');
  }
  async configureLocalization(opts = {}) {
    if (_lodash.default.isEmpty(opts)) {
      return false;
    }
    const {
      language,
      locale,
      keyboard
    } = opts;
    const globalPrefs = {};
    let keyboardId = null;
    if (_lodash.default.isPlainObject(keyboard)) {
      const {
        name,
        layout,
        hardware
      } = keyboard;
      if (!name) {
        throw new Error(`The 'keyboard' field must have a valid name set`);
      }
      if (!layout) {
        throw new Error(`The 'keyboard' field must have a valid layout set`);
      }
      keyboardId = `${name}@sw=${layout}`;
      if (hardware) {
        keyboardId += `;@hw=${hardware}`;
      }
      globalPrefs.AppleKeyboards = [keyboardId];
    }
    if (_lodash.default.isPlainObject(language)) {
      const {
        name
      } = language;
      if (!name) {
        throw new Error(`The 'language' field must have a valid name set`);
      }
      globalPrefs.AppleLanguages = [name];
    }
    if (_lodash.default.isPlainObject(locale)) {
      const {
        name,
        calendar
      } = locale;
      if (!name) {
        throw new Error(`The 'locale' field must have a valid name set`);
      }
      let localeId = name;
      if (calendar) {
        localeId += `@calendar=${calendar}`;
      }
      globalPrefs.AppleLocale = localeId;
    }
    if (_lodash.default.isEmpty(globalPrefs)) {
      return false;
    }
    const argChunks = (0, _defaultsUtils.generateDefaultsCommandArgs)(globalPrefs, true);
    await _bluebird.default.all(argChunks.map(args => this.simctl.spawnProcess(['defaults', 'write', '.GlobalPreferences.plist', ...args])));
    if (keyboardId) {
      const argChunks = (0, _defaultsUtils.generateDefaultsCommandArgs)({
        KeyboardsCurrentAndNext: [keyboardId],
        KeyboardLastUsed: keyboardId,
        KeyboardLastUsedForLanguage: {
          [keyboard.name]: keyboardId
        }
      }, true);
      await _bluebird.default.all(argChunks.map(args => this.simctl.spawnProcess(['defaults', 'write', 'com.apple.Preferences', ...args])));
    }
    return true;
  }
}
var _default = SimulatorXcode9;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTSU1VTEFUT1JfU0hVVERPV05fVElNRU9VVCIsInN0YXJ0dXBMb2NrIiwiQXN5bmNMb2NrIiwicHJlZmVyZW5jZXNQbGlzdEd1YXJkIiwiRU5ST0xMTUVOVF9OT1RJRklDQVRJT05fUkVDRUlWRVIiLCJET01BSU5fS0VZQk9BUkRfUFJFRkVSRU5DRVMiLCJjb21waWxlU2ltdWxhdG9yUHJlZmVyZW5jZXMiLCJvcHRzIiwiY29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQiLCJ0cmFjZVBvaW50ZXIiLCJwYXN0ZWJvYXJkQXV0b21hdGljU3luYyIsInNjYWxlRmFjdG9yIiwiY29tbW9uUHJlZmVyZW5jZXMiLCJSb3RhdGVXaW5kb3dXaGVuU2lnbmFsZWRCeUd1ZXN0IiwiU3RhcnRMYXN0RGV2aWNlT25MYXVuY2giLCJEZXRhY2hPbldpbmRvd0Nsb3NlIiwiQXR0YWNoQm9vdGVkT25TdGFydCIsImRldmljZVByZWZlcmVuY2VzIiwiXyIsImNsb25lRGVlcCIsIlNpbXVsYXRvcldpbmRvd0xhc3RTY2FsZSIsInBhcnNlRmxvYXQiLCJpc0Jvb2xlYW4iLCJpc05pbCIsIkNvbm5lY3RIYXJkd2FyZUtleWJvYXJkIiwiU2hvd1NpbmdsZVRvdWNoZXMiLCJTaG93UGluY2hlcyIsIlNob3dQaW5jaFBpdm90UG9pbnQiLCJIaWdobGlnaHRFZGdlR2VzdHVyZXMiLCJsb3dlckNhc2UiLCJQYXN0ZWJvYXJkQXV0b21hdGljU3luYyIsImxvZyIsImluZm8iLCJTaW11bGF0b3JYY29kZTkiLCJTaW11bGF0b3JYY29kZTgiLCJjb25zdHJ1Y3RvciIsInVkaWQiLCJ4Y29kZVZlcnNpb24iLCJydW4iLCJkZWZhdWx0c0RlZXAiLCJpc0hlYWRsZXNzIiwic3RhcnR1cFRpbWVvdXQiLCJ1cGRhdGVQcmVmZXJlbmNlcyIsInRpbWVyIiwidGltaW5nIiwiVGltZXIiLCJzdGFydCIsInNob3VsZFdhaXRGb3JCb290IiwiYWNxdWlyZSIsInVpQ2xpZW50QnVuZGxlSWQiLCJpc1NlcnZlclJ1bm5pbmciLCJpc1J1bm5pbmciLCJ1aUNsaWVudFBpZCIsImdldFVJQ2xpZW50UGlkIiwia2lsbFVJQ2xpZW50IiwicGlkIiwid2FpdEZvckNvbmRpdGlvbiIsImlzU2h1dGRvd24iLCJ3YWl0TXMiLCJpbnRlcnZhbE1zIiwiZSIsIkVycm9yIiwiYm9vdCIsInNodXRkb3duIiwidGltZW91dCIsImxhdW5jaFdpbmRvdyIsIndhaXRGb3JCb290IiwiZ2V0RHVyYXRpb24iLCJhc1NlY29uZHMiLCJ0b0ZpeGVkIiwiZGlzYWJsZUtleWJvYXJkSW50cm9kdWN0aW9uIiwibWVzc2FnZSIsInN0YXJ0VUlDbGllbnQiLCJzaW11bGF0b3JBcHAiLCJwYXRoIiwicmVzb2x2ZSIsImdldFhjb2RlUGF0aCIsIlNJTVVMQVRPUl9BUFBfTkFNRSIsImFyZ3MiLCJ1dGlsIiwicXVvdGUiLCJleGVjIiwiZXJyIiwic3RkZXJyIiwic3Rkb3V0IiwiYXJnQ2h1bmtzIiwiZ2VuZXJhdGVEZWZhdWx0c0NvbW1hbmRBcmdzIiwiRGlkU2hvd0NvbnRpbnVvdXNQYXRoSW50cm9kdWN0aW9uIiwiQiIsImFsbCIsIm1hcCIsInNpbWN0bCIsInNwYXduUHJvY2VzcyIsImlzVWlDbGllbnRSdW5uaW5nIiwiYm9vdEV2ZW50c0VtaXR0ZXIiLCJFdmVudEVtaXR0ZXIiLCJzdGFydEJvb3RNb25pdG9yIiwib25FcnJvciIsImVtaXQiLCJvbkZpbmlzaGVkIiwic2hvdWxkUHJlYm9vdCIsInJlamVjdCIsInNldFRpbWVvdXQiLCJvbmNlIiwiaW5jbHVkZXMiLCJyZW1vdmVBbGxMaXN0ZW5lcnMiLCJ2ZXJpZnlEZXZpY2VQcmVmZXJlbmNlcyIsInByZWZzIiwiaXNFbXB0eSIsImlzVW5kZWZpbmVkIiwiaXNOdW1iZXIiLCJlcnJvckFuZFRocm93IiwiU2ltdWxhdG9yV2luZG93Q2VudGVyIiwidmVyaWZpY2F0aW9uUGF0dGVybiIsImlzU3RyaW5nIiwidGVzdCIsIlNpbXVsYXRvcldpbmRvd09yaWVudGF0aW9uIiwiYWNjZXB0YWJsZVZhbHVlcyIsImluZGV4T2YiLCJTaW11bGF0b3JXaW5kb3dSb3RhdGlvbkFuZ2xlIiwiZGV2aWNlUHJlZnMiLCJjb21tb25QcmVmcyIsImRlYnVnIiwiSlNPTiIsInN0cmluZ2lmeSIsImhvbWVGb2xkZXJQYXRoIiwicHJvY2VzcyIsImVudiIsIkhPTUUiLCJ3YXJuIiwicGxpc3RQYXRoIiwibmFtZSIsImRlZmF1bHRzIiwiTlNVc2VyRGVmYXVsdHMiLCJwcmVmc1RvVXBkYXRlIiwiY2xvbmUiLCJleGlzdGluZ0RldmljZVByZWZzIiwidWRpZEtleSIsInRvVXBwZXJDYXNlIiwiZnMiLCJleGlzdHMiLCJjdXJyZW50UGxpc3RDb250ZW50IiwiYXNKc29uIiwiaXNQbGFpbk9iamVjdCIsIkRldmljZVByZWZlcmVuY2VzIiwiT2JqZWN0IiwiYXNzaWduIiwidXBkYXRlIiwiX2FjdGl2YXRlV2luZG93Iiwic2VsZk5hbWUiLCJzZWxmU2RrIiwiYm9vdGVkRGV2aWNlc0NvdW50Iiwic2RrIiwiZGV2aWNlQXJyIiwidG9QYWlycyIsImdldERldmljZXMiLCJzdGF0ZSIsImlzQmlvbWV0cmljRW5yb2xsZWQiLCJtYXRjaCIsIlJlZ0V4cCIsImVzY2FwZVJlZ0V4cCIsImVucm9sbEJpb21ldHJpYyIsImlzRW5hYmxlZCIsInNlbmRCaW9tZXRyaWNNYXRjaCIsInNob3VsZE1hdGNoIiwiYmlvbWV0cmljTmFtZSIsImRvbWFpbkNvbXBvbmVudCIsInRvQmlvbWV0cmljRG9tYWluQ29tcG9uZW50IiwiZG9tYWluIiwiZ2V0TGF1bmNoRGFlbW9uc1Jvb3QiLCJkZXZSb290IiwiZ2V0RGV2ZWxvcGVyUm9vdCIsImNvbmZpZ3VyZUxvY2FsaXphdGlvbiIsImxhbmd1YWdlIiwibG9jYWxlIiwia2V5Ym9hcmQiLCJnbG9iYWxQcmVmcyIsImtleWJvYXJkSWQiLCJsYXlvdXQiLCJoYXJkd2FyZSIsIkFwcGxlS2V5Ym9hcmRzIiwiQXBwbGVMYW5ndWFnZXMiLCJjYWxlbmRhciIsImxvY2FsZUlkIiwiQXBwbGVMb2NhbGUiLCJLZXlib2FyZHNDdXJyZW50QW5kTmV4dCIsIktleWJvYXJkTGFzdFVzZWQiLCJLZXlib2FyZExhc3RVc2VkRm9yTGFuZ3VhZ2UiXSwic291cmNlcyI6WyIuLi8uLi9saWIvc2ltdWxhdG9yLXhjb2RlLTkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFNpbXVsYXRvclhjb2RlOCBmcm9tICcuL3NpbXVsYXRvci14Y29kZS04JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGZzLCB0aW1pbmcsIHV0aWwgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IEFzeW5jTG9jayBmcm9tICdhc3luYy1sb2NrJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgd2FpdEZvckNvbmRpdGlvbiB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCB7XG4gIHRvQmlvbWV0cmljRG9tYWluQ29tcG9uZW50LCBnZXREZXZlbG9wZXJSb290LCBTSU1VTEFUT1JfQVBQX05BTUVcbn0gZnJvbSAnLi91dGlscy5qcyc7XG5pbXBvcnQgeyBOU1VzZXJEZWZhdWx0cywgZ2VuZXJhdGVEZWZhdWx0c0NvbW1hbmRBcmdzIH0gZnJvbSAnLi9kZWZhdWx0cy11dGlscyc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0IHsgZ2V0UGF0aCBhcyBnZXRYY29kZVBhdGggfSBmcm9tICdhcHBpdW0teGNvZGUnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5cbmNvbnN0IFNJTVVMQVRPUl9TSFVURE9XTl9USU1FT1VUID0gMTUgKiAxMDAwO1xuY29uc3Qgc3RhcnR1cExvY2sgPSBuZXcgQXN5bmNMb2NrKCk7XG5jb25zdCBwcmVmZXJlbmNlc1BsaXN0R3VhcmQgPSBuZXcgQXN5bmNMb2NrKCk7XG5jb25zdCBFTlJPTExNRU5UX05PVElGSUNBVElPTl9SRUNFSVZFUiA9ICdjb20uYXBwbGUuQmlvbWV0cmljS2l0LmVucm9sbG1lbnRDaGFuZ2VkJztcbmNvbnN0IERPTUFJTl9LRVlCT0FSRF9QUkVGRVJFTkNFUyA9ICdjb20uYXBwbGUua2V5Ym9hcmQucHJlZmVyZW5jZXMnO1xuXG4vKipcbiAqIENyZWF0ZXMgZGV2aWNlIGFuZCBjb21tb24gU2ltdWxhdG9yIHByZWZlcmVuY2VzLCB3aGljaCBjb3VsZFxuICogYmUgbGF0ZXIgYXBwbGllZCB1c2luZyBgZGVmYXVsdHNgIENMSSB1dGlsaXR5LlxuICpcbiAqIEBwYXJhbSB7UnVuT3B0aW9uc30gb3B0c1xuICogQHJldHVybnMge29iamVjdFtdfSBUaGUgZmlyc3QgYXJyYXkgaXRlbSBpcyB0aGUgcmVzdWx0aW5nIGRldmljZSBwcmVmZXJlbmNlc1xuICogb2JqZWN0IGFuZCB0aGUgc2Vjb25kIG9uZSBpcyBjb21tb24gcHJlZmVyZW5jZXMgb2JqZWN0XG4gKi9cbmZ1bmN0aW9uIGNvbXBpbGVTaW11bGF0b3JQcmVmZXJlbmNlcyAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICBjb25uZWN0SGFyZHdhcmVLZXlib2FyZCxcbiAgICB0cmFjZVBvaW50ZXIsXG4gICAgcGFzdGVib2FyZEF1dG9tYXRpY1N5bmMsXG4gICAgc2NhbGVGYWN0b3IsXG4gIH0gPSBvcHRzO1xuICBjb25zdCBjb21tb25QcmVmZXJlbmNlcyA9IHtcbiAgICAvLyBUaGlzIG9wdGlvbiBpcyBuZWNlc3NhcnkgdG8gbWFrZSB0aGUgU2ltdWxhdG9yIHdpbmRvdyBmb2xsb3dcbiAgICAvLyB0aGUgYWN0dWFsIFhDVUlEZXZpY2Ugb3JpZW50YXRpb25cbiAgICBSb3RhdGVXaW5kb3dXaGVuU2lnbmFsZWRCeUd1ZXN0OiB0cnVlLFxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2lzc3Vlcy8xNjQxOFxuICAgIFN0YXJ0TGFzdERldmljZU9uTGF1bmNoOiBmYWxzZSxcbiAgICBEZXRhY2hPbldpbmRvd0Nsb3NlOiBmYWxzZSxcbiAgICBBdHRhY2hCb290ZWRPblN0YXJ0OiB0cnVlLFxuICB9O1xuICBjb25zdCBkZXZpY2VQcmVmZXJlbmNlcyA9IG9wdHMuZGV2aWNlUHJlZmVyZW5jZXMgPyBfLmNsb25lRGVlcChvcHRzLmRldmljZVByZWZlcmVuY2VzKSA6IHt9O1xuICBpZiAoc2NhbGVGYWN0b3IpIHtcbiAgICBkZXZpY2VQcmVmZXJlbmNlcy5TaW11bGF0b3JXaW5kb3dMYXN0U2NhbGUgPSBwYXJzZUZsb2F0KHNjYWxlRmFjdG9yKTtcbiAgfVxuICBpZiAoXy5pc0Jvb2xlYW4oY29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQpIHx8IF8uaXNOaWwoY29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQpKSB7XG4gICAgZGV2aWNlUHJlZmVyZW5jZXMuQ29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQgPSBjb25uZWN0SGFyZHdhcmVLZXlib2FyZCA/PyBmYWxzZTtcbiAgICBjb21tb25QcmVmZXJlbmNlcy5Db25uZWN0SGFyZHdhcmVLZXlib2FyZCA9IGNvbm5lY3RIYXJkd2FyZUtleWJvYXJkID8/IGZhbHNlO1xuICB9XG4gIGlmIChfLmlzQm9vbGVhbih0cmFjZVBvaW50ZXIpKSB7XG4gICAgY29tbW9uUHJlZmVyZW5jZXMuU2hvd1NpbmdsZVRvdWNoZXMgPSB0cmFjZVBvaW50ZXI7XG4gICAgY29tbW9uUHJlZmVyZW5jZXMuU2hvd1BpbmNoZXMgPSB0cmFjZVBvaW50ZXI7XG4gICAgY29tbW9uUHJlZmVyZW5jZXMuU2hvd1BpbmNoUGl2b3RQb2ludCA9IHRyYWNlUG9pbnRlcjtcbiAgICBjb21tb25QcmVmZXJlbmNlcy5IaWdobGlnaHRFZGdlR2VzdHVyZXMgPSB0cmFjZVBvaW50ZXI7XG4gIH1cbiAgc3dpdGNoIChfLmxvd2VyQ2FzZShwYXN0ZWJvYXJkQXV0b21hdGljU3luYykpIHtcbiAgICBjYXNlICdvbic6XG4gICAgICBjb21tb25QcmVmZXJlbmNlcy5QYXN0ZWJvYXJkQXV0b21hdGljU3luYyA9IHRydWU7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdvZmYnOlxuICAgICAgLy8gSW1wcm92ZSBsYXVuY2hpbmcgc2ltdWxhdG9yIHBlcmZvcm1hbmNlXG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vV2ViS2l0L3dlYmtpdC9ibG9iL21hc3Rlci9Ub29scy9TY3JpcHRzL3dlYmtpdHB5L3hjb2RlL3NpbXVsYXRlZF9kZXZpY2UucHkjTDQxM1xuICAgICAgY29tbW9uUHJlZmVyZW5jZXMuUGFzdGVib2FyZEF1dG9tYXRpY1N5bmMgPSBmYWxzZTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3N5c3RlbSc6XG4gICAgICAvLyBEbyBub3QgYWRkIC1QYXN0ZWJvYXJkQXV0b21hdGljU3luY1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGxvZy5pbmZvKGBbJ29uJywgJ29mZicgb3IgJ3N5c3RlbSddIGFyZSBhdmFpbGFibGUgYXMgdGhlIHBhc3RlYm9hcmQgYXV0b21hdGljIHN5bmMgb3B0aW9uLiBEZWZhdWx0aW5nIHRvICdvZmYnYCk7XG4gICAgICBjb21tb25QcmVmZXJlbmNlcy5QYXN0ZWJvYXJkQXV0b21hdGljU3luYyA9IGZhbHNlO1xuICB9XG4gIHJldHVybiBbZGV2aWNlUHJlZmVyZW5jZXMsIGNvbW1vblByZWZlcmVuY2VzXTtcbn1cblxuY2xhc3MgU2ltdWxhdG9yWGNvZGU5IGV4dGVuZHMgU2ltdWxhdG9yWGNvZGU4IHtcbiAgY29uc3RydWN0b3IgKHVkaWQsIHhjb2RlVmVyc2lvbikge1xuICAgIHN1cGVyKHVkaWQsIHhjb2RlVmVyc2lvbik7XG4gIH1cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gRGV2aWNlUHJlZmVyZW5jZXNcbiAgICogQHByb3BlcnR5IHs/bnVtYmVyfSBTaW11bGF0b3JFeHRlcm5hbERpc3BsYXkgLSBUQkQuIEV4YW1wbGUgdmFsdWU6IDIuMTE0XG4gICAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gQ2hyb21lVGludCAtIFRCRC4gRXhhbXBsZSB2YWx1ZTogJydcbiAgICogQHByb3BlcnR5IHs/bnVtYmVyfSBTaW11bGF0b3JXaW5kb3dMYXN0U2NhbGUgLSBTY2FsZSB2YWx1ZSBmb3IgdGhlIHBhcnRpY3VsYXIgU2ltdWxhdG9yIHdpbmRvdy5cbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxLjAgbWVhbnMgMTAwJSBzY2FsZS5cbiAgICogQHByb3BlcnR5IHs/c3RyaW5nfSBTaW11bGF0b3JXaW5kb3dPcmllbnRhdGlvbiAtIFNpbXVsYXRvciB3aW5kb3cgb3JpZW50YXRpb24uIFBvc3NpYmxlIHZhbHVlcyBhcmU6XG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUG9ydHJhaXQnLCAnTGFuZHNjYXBlTGVmdCcsICdQb3J0cmFpdFVwc2lkZURvd24nIGFuZCAnTGFuZHNjYXBlUmlnaHQnLlxuICAgKiBAcHJvcGVydHkgez9udW1iZXJ9IFNpbXVsYXRvcldpbmRvd1JvdGF0aW9uQW5nbGUgLSBXaW5kb3cgcm90YXRpb24gYW5nbGUuIFRoaXMgdmFsdWUgaXMgZXhwZWN0ZWQgdG8gYmUgaW4gc3luY1xuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIF9TaW11bGF0b3JXaW5kb3dPcmllbnRhdGlvbl8uIFRoZSBjb3JyZXNwb25kaW5nIHZhbHVlcyBhcmU6XG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsIDkwLCAxODAgYW5kIDI3MC5cbiAgICogQHByb3BlcnR5IHs/c3RyaW5nfSBTaW11bGF0b3JXaW5kb3dDZW50ZXIgLSBUaGUgY29vcmRpbmF0ZXMgb2YgU2ltdWxhdG9yJ3Mgd2luZG93IGNlbnRlciBpbiBwaXhlbHMsXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGV4YW1wbGUgJ3stMTI5NC41LCA3NzUuNX0nLlxuICAgKiBAcHJvcGVydHkgez9ib29sZWFufSBDb25uZWN0SGFyZHdhcmVLZXlib2FyZCAtIEVxdWFscyB0byAxIGlmIGhhcmR3YXJlIGtleWJvYXJkIHNob3VsZCBiZSBjb25uZWN0ZWQuXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT3RoZXJ3aXNlIDAuXG4gICAqL1xuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb21tb25QcmVmZXJlbmNlc1xuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IENvbm5lY3RIYXJkd2FyZUtleWJvYXJkIC0gV2hldGhlciB0byBjb25uZWN0IGhhcmR3YXJlIGtleWJvYXJkXG4gICAqL1xuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBSdW5PcHRpb25zXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzY2FsZUZhY3RvcjogQW55IHBvc2l0aXZlIGZsb2F0IHZhbHVlLiAxLjAgbWVhbnMgMToxIHNjYWxlLlxuICAgKiBEZWZpbmVzIHRoZSB3aW5kb3cgc2NhbGUgdmFsdWUgZm9yIHRoZSBVSSBjbGllbnQgd2luZG93IGZvciB0aGUgY3VycmVudCBTaW11bGF0b3IuXG4gICAqIEVxdWFscyB0byBgbnVsbGAgYnkgZGVmYXVsdCwgd2hpY2gga2VlcHMgdGhlIGN1cnJlbnQgc2NhbGUgdW5jaGFuZ2VkLlxuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IGNvbm5lY3RIYXJkd2FyZUtleWJvYXJkOiB3aGV0aGVyIHRvIGNvbm5lY3QgdGhlIGhhcmR3YXJlIGtleWJvYXJkIHRvIHRoZVxuICAgKiBTaW11bGF0b3IgVUkgY2xpZW50LiBFcXVhbHMgdG8gYGZhbHNlYCBieSBkZWZhdWx0LlxuICAgKiBAcHJvcGVydHkge251bWJlcn0gc3RhcnR1cFRpbWVvdXQ6IG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCBTaW11bGF0b3IgYm9vdGluZ1xuICAgKiBwcm9jZXNzIGlzIGNvbXBsZXRlZC4gVGhlIGRlZmF1bHQgdGltZW91dCB3aWxsIGJlIHVzZWQgaWYgbm90IHNldCBleHBsaWNpdGx5LlxuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IGlzSGVhZGxlc3M6IHdoZXRoZXIgdG8gc3RhcnQgdGhlIFNpbXVsYXRvciBpbiBoZWFkbGVzcyBtb2RlICh3aXRoIFVJXG4gICAqIGNsaWVudCBpbnZpc2libGUpLiBgZmFsc2VgIGJ5IGRlZmF1bHQuXG4gICAqIEBwcm9wZXJ0eSB7P2Jvb2xlYW59IHRyYWNlUG9pbnRlciBbZmFsc2VdIC0gV2hldGhlciB0byBoaWdobGlnaHQgdG91Y2hlcyBvbiBTaW11bGF0b3JcbiAgICogc2NyZWVuLiBUaGlzIGlzIGhlbHBmdWwgd2hpbGUgZGVidWdnaW5nIGF1dG9tYXRlZCB0ZXN0cyBvciB3aGlsZSBvYnNlcnZpbmcgdGhlIGF1dG9tYXRpb25cbiAgICogcmVjb3JkaW5ncy5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IHBhc3RlYm9hcmRBdXRvbWF0aWNTeW5jIFsnb2ZmJ10gLSBXaGV0aGVyIHRvIGRpc2FibGUgcGFzdGVib2FyZCBzeW5jIHdpdGggdGhlXG4gICAqIFNpbXVsYXRvciBVSSBjbGllbnQgb3IgcmVzcGVjdCB0aGUgc3lzdGVtIHdpZGUgcHJlZmVyZW5jZS4gJ29uJywgJ29mZicsIG9yICdzeXN0ZW0nIGlzIGF2YWlsYWJsZS5cbiAgICogVGhlIHN5bmMgaW5jcmVhc2VzIGxhdW5jaGluZyBzaW11bGF0b3IgcHJvY2VzcyB0aW1lLCBidXQgaXQgYWxsb3dzIHN5c3RlbSB0byBzeW5jIHBhc3RlYm9hcmRcbiAgICogd2l0aCBzaW11bGF0b3JzLiBGb2xsb3dzIHN5c3RlbS13aWRlIHByZWZlcmVuY2UgaWYgdGhlIHZhbHVlIGlzICdzeXN0ZW0nLlxuICAgKiBEZWZhdWx0cyB0byAnb2ZmJy5cbiAgICogQHByb3BlcnR5IHtEZXZpY2VQcmVmZXJlbmNlc30gZGV2aWNlUHJlZmVyZW5jZXM6IHByZWZlcmVuY2VzIG9mIHRoZSBuZXdseSBjcmVhdGVkIFNpbXVsYXRvclxuICAgKiBkZXZpY2VcbiAgICovXG5cbiAgLyoqXG4gICAqIEV4ZWN1dGVzIGdpdmVuIFNpbXVsYXRvciB3aXRoIG9wdGlvbnMuIFRoZSBTaW11bGF0b3Igd2lsbCBub3QgYmUgcmVzdGFydGVkIGlmXG4gICAqIGl0IGlzIGFscmVhZHkgcnVubmluZyBhbmQgdGhlIGN1cnJlbnQgVUkgc3RhdGUgbWF0Y2hlcyB0byBgaXNIZWFkbGVzc2Agb3B0aW9uLlxuICAgKiBAb3ZlcnJpZGVcbiAgICpcbiAgICogQHBhcmFtIHtSdW5PcHRpb25zfSBvcHRzIC0gT25lIG9yIG1vcmUgb2YgYXZhaWxhYmxlIFNpbXVsYXRvciBvcHRpb25zXG4gICAqL1xuICBhc3luYyBydW4gKG9wdHMgPSB7fSkge1xuICAgIG9wdHMgPSBfLmNsb25lRGVlcChvcHRzKTtcbiAgICBfLmRlZmF1bHRzRGVlcChvcHRzLCB7XG4gICAgICBpc0hlYWRsZXNzOiBmYWxzZSxcbiAgICAgIHN0YXJ0dXBUaW1lb3V0OiB0aGlzLnN0YXJ0dXBUaW1lb3V0LFxuICAgIH0pO1xuXG4gICAgY29uc3QgW2RldmljZVByZWZlcmVuY2VzLCBjb21tb25QcmVmZXJlbmNlc10gPSBjb21waWxlU2ltdWxhdG9yUHJlZmVyZW5jZXMob3B0cyk7XG4gICAgYXdhaXQgdGhpcy51cGRhdGVQcmVmZXJlbmNlcyhkZXZpY2VQcmVmZXJlbmNlcywgY29tbW9uUHJlZmVyZW5jZXMpO1xuXG4gICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgICBjb25zdCBzaG91bGRXYWl0Rm9yQm9vdCA9IGF3YWl0IHN0YXJ0dXBMb2NrLmFjcXVpcmUodGhpcy51aUNsaWVudEJ1bmRsZUlkLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpc1NlcnZlclJ1bm5pbmcgPSBhd2FpdCB0aGlzLmlzUnVubmluZygpO1xuICAgICAgY29uc3QgdWlDbGllbnRQaWQgPSBhd2FpdCB0aGlzLmdldFVJQ2xpZW50UGlkKCk7XG4gICAgICBpZiAob3B0cy5pc0hlYWRsZXNzKSB7XG4gICAgICAgIGlmIChpc1NlcnZlclJ1bm5pbmcgJiYgIXVpQ2xpZW50UGlkKSB7XG4gICAgICAgICAgbG9nLmluZm8oYFNpbXVsYXRvciB3aXRoIFVESUQgJyR7dGhpcy51ZGlkfScgaXMgYWxyZWFkeSBib290ZWQgaW4gaGVhZGxlc3MgbW9kZS5gKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGF3YWl0IHRoaXMua2lsbFVJQ2xpZW50KHtwaWQ6IHVpQ2xpZW50UGlkfSkpIHtcbiAgICAgICAgICBsb2cuaW5mbyhgRGV0ZWN0ZWQgdGhlIFNpbXVsYXRvciBVSSBjbGllbnQgd2FzIHJ1bm5pbmcgYW5kIGtpbGxlZCBpdC4gVmVyaWZ5aW5nIHRoZSBjdXJyZW50IFNpbXVsYXRvciBzdGF0ZWApO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gU3RvcHBpbmcgdGhlIFVJIGNsaWVudCBraWxscyBhbGwgcnVubmluZyBzZXJ2ZXJzIGZvciBzb21lIGVhcmx5IFhDb2RlIHZlcnNpb25zLiBUaGlzIGlzIGEga25vd24gYnVnXG4gICAgICAgICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbihhc3luYyAoKSA9PiBhd2FpdCB0aGlzLmlzU2h1dGRvd24oKSwge1xuICAgICAgICAgICAgd2FpdE1zOiA1MDAwLFxuICAgICAgICAgICAgaW50ZXJ2YWxNczogMTAwLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgaWYgKCFhd2FpdCB0aGlzLmlzUnVubmluZygpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFNpbXVsYXRvciB3aXRoIFVESUQgJyR7dGhpcy51ZGlkfScgY2Fubm90IGJlIHRyYW5zaXRpb25lZCB0byBoZWFkbGVzcyBtb2RlYCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBsb2cuaW5mbyhgQm9vdGluZyBTaW11bGF0b3Igd2l0aCBVRElEICcke3RoaXMudWRpZH0nIGluIGhlYWRsZXNzIG1vZGUuIGAgK1xuICAgICAgICAgIGBBbGwgVUktcmVsYXRlZCBjYXBhYmlsaXRpZXMgYXJlIGdvaW5nIHRvIGJlIGlnbm9yZWRgKTtcbiAgICAgICAgYXdhaXQgdGhpcy5ib290KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaXNTZXJ2ZXJSdW5uaW5nICYmIHVpQ2xpZW50UGlkKSB7XG4gICAgICAgICAgbG9nLmluZm8oYEJvdGggU2ltdWxhdG9yIHdpdGggVURJRCAnJHt0aGlzLnVkaWR9JyBhbmQgdGhlIFVJIGNsaWVudCBhcmUgY3VycmVudGx5IHJ1bm5pbmdgKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzU2VydmVyUnVubmluZykge1xuICAgICAgICAgIGxvZy5pbmZvKGBTaW11bGF0b3IgJyR7dGhpcy51ZGlkfScgaXMgYm9vdGVkIHdoaWxlIGl0cyBVSSBpcyBub3QgdmlzaWJsZS4gYCArXG4gICAgICAgICAgICBgVHJ5aW5nIHRvIHJlc3RhcnQgaXQgd2l0aCB0aGUgU2ltdWxhdG9yIHdpbmRvdyB2aXNpYmxlYCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5zaHV0ZG93bih7dGltZW91dDogU0lNVUxBVE9SX1NIVVRET1dOX1RJTUVPVVR9KTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB0aGlzLmxhdW5jaFdpbmRvdyh1aUNsaWVudFBpZCwgb3B0cyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcblxuICAgIGlmIChzaG91bGRXYWl0Rm9yQm9vdCkge1xuICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yQm9vdChvcHRzLnN0YXJ0dXBUaW1lb3V0KTtcbiAgICAgIGxvZy5pbmZvKGBTaW11bGF0b3Igd2l0aCBVRElEICR7dGhpcy51ZGlkfSBib290ZWQgaW4gJHt0aW1lci5nZXREdXJhdGlvbigpLmFzU2Vjb25kcy50b0ZpeGVkKDMpfXNgKTtcbiAgICB9XG5cbiAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5kaXNhYmxlS2V5Ym9hcmRJbnRyb2R1Y3Rpb24oKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLmluZm8oYENhbm5vdCBkaXNhYmxlIFNpbXVsYXRvciBrZXlib2FyZCBpbnRyb2R1Y3Rpb24uIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9KSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvdmVycmlkZVxuICAgKi9cbiAgYXN5bmMgc3RhcnRVSUNsaWVudCAob3B0cyA9IHt9KSB7XG4gICAgb3B0cyA9IF8uY2xvbmVEZWVwKG9wdHMpO1xuICAgIF8uZGVmYXVsdHNEZWVwKG9wdHMsIHtcbiAgICAgIHN0YXJ0dXBUaW1lb3V0OiB0aGlzLnN0YXJ0dXBUaW1lb3V0LFxuICAgIH0pO1xuXG4gICAgY29uc3Qgc2ltdWxhdG9yQXBwID0gcGF0aC5yZXNvbHZlKGF3YWl0IGdldFhjb2RlUGF0aCgpLCAnQXBwbGljYXRpb25zJywgU0lNVUxBVE9SX0FQUF9OQU1FKTtcbiAgICBjb25zdCBhcmdzID0gWyctRm4nLCBzaW11bGF0b3JBcHBdO1xuICAgIGxvZy5pbmZvKGBTdGFydGluZyBTaW11bGF0b3IgVUk6ICR7dXRpbC5xdW90ZShbJ29wZW4nLCAuLi5hcmdzXSl9YCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGV4ZWMoJ29wZW4nLCBhcmdzLCB7dGltZW91dDogb3B0cy5zdGFydHVwVGltZW91dH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBHb3QgYW4gdW5leHBlY3RlZCBlcnJvciB3aGlsZSBvcGVuaW5nIFNpbXVsYXRvciBVSTogYCArXG4gICAgICAgIGVyci5zdGRlcnIgfHwgZXJyLnN0ZG91dCB8fCBlcnIubWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERpc2FibGUga2V5Ym9hcmQgdHV0b3JpYWwgYXMgJ2NvbS5hcHBsZS5rZXlib2FyZC5wcmVmZXJlbmNlcycgZG9tYWluIHZpYSAnZGVmYXVsdHMnIGNvbW1hbmQuXG4gICAqL1xuICBhc3luYyBkaXNhYmxlS2V5Ym9hcmRJbnRyb2R1Y3Rpb24gKCkge1xuICAgIGNvbnN0IGFyZ0NodW5rcyA9IGdlbmVyYXRlRGVmYXVsdHNDb21tYW5kQXJncyh7XG4gICAgLy8gVG8gZGlzYWJsZSAnRGlkU2hvd0NvbnRpbnVvdXNQYXRoSW50cm9kdWN0aW9uJyBmb3IgaU9TIDE1KyBzaW11bGF0b3JzIHNpbmNlIGNoYW5naW5nIHRoZSBwcmVmZXJlbmNlIHZpYSBXREFcbiAgICAvLyBkb2VzIG5vdCB3b3JrIG9uIHRoZW0uIExvd2VyIHRoYW4gdGhlIHZlcnNpb25zIGFsc28gY2FuIGhhdmUgdGhpcyBwcmVmZXJlbmNlLCBidXQgbm90aGluZyBoYXBwZW4uXG4gICAgICBEaWRTaG93Q29udGludW91c1BhdGhJbnRyb2R1Y3Rpb246IDFcbiAgICB9LCB0cnVlKTtcbiAgICBhd2FpdCBCLmFsbChhcmdDaHVua3MubWFwKChhcmdzKSA9PiB0aGlzLnNpbWN0bC5zcGF3blByb2Nlc3MoW1xuICAgICAgJ2RlZmF1bHRzJywgJ3dyaXRlJywgRE9NQUlOX0tFWUJPQVJEX1BSRUZFUkVOQ0VTLCAuLi5hcmdzXG4gICAgXSkpKTtcbiAgfVxuXG4gIC8qKipcbiAgICogQm9vdHMgc2ltdWxhdG9yIGFuZCBvcGVucyBzaW11bGF0b3JzIFVJIENsaWVudCBpZiBub3QgYWxyZWFkeSBvcGVuZWQuXG4gICAqXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNVaUNsaWVudFJ1bm5pbmcgLSBwcm9jZXNzIGlkIG9mIHNpbXVsYXRvciBVSSBjbGllbnQuXG4gICAqIEBwYXJhbSB7UnVuT3B0aW9uc30gb3B0cyAtIGFyZ3VtZW50cyB0byBzdGFydCBzaW11bGF0b3IgVUkgY2xpZW50IHdpdGguXG4gICAqL1xuICBhc3luYyBsYXVuY2hXaW5kb3cgKGlzVWlDbGllbnRSdW5uaW5nLCBvcHRzID0ge30pIHtcbiAgICBhd2FpdCB0aGlzLmJvb3QoKTtcbiAgICBpZiAoIWlzVWlDbGllbnRSdW5uaW5nKSB7XG4gICAgICBhd2FpdCB0aGlzLnN0YXJ0VUlDbGllbnQob3B0cyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEJvb3RzIFNpbXVsYXRvciBpZiBub3QgYWxyZWFkeSBib290ZWQuXG4gICAqIERvZXMgbm90aGluZyBpZiBpdCBpcyBhbHJlYWR5IHJ1bm5pbmcuXG4gICAqIFRoaXMgQVBJIGRvZXMgTk9UIHdhaXQgdW50aWwgU2ltdWxhdG9yIGlzIGZ1bGx5IGJvb3RlZC5cbiAgICpcbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhIGZhaWx1cmUgd2hpbGUgYm9vdGluZyB0aGUgU2ltdWxhdG9yLlxuICAgKi9cbiAgYXN5bmMgYm9vdCAoKSB7XG4gICAgY29uc3QgYm9vdEV2ZW50c0VtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwuc3RhcnRCb290TW9uaXRvcih7XG4gICAgICBvbkVycm9yOiAoZXJyKSA9PiBib290RXZlbnRzRW1pdHRlci5lbWl0KCdmYWlsdXJlJywgZXJyKSxcbiAgICAgIG9uRmluaXNoZWQ6ICgpID0+IGJvb3RFdmVudHNFbWl0dGVyLmVtaXQoJ2ZpbmlzaCcpLFxuICAgICAgc2hvdWxkUHJlYm9vdDogdHJ1ZSxcbiAgICB9KTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgbmV3IEIoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAvLyBIaXN0b3JpY2FsbHkgdGhpcyBjYWxsIHdhcyBhbHdheXMgYXN5bmNocm9ub3VzLFxuICAgICAgICAvLyBlLmcuIGl0IHdhcyBub3Qgd2FpdGluZyB1bnRpbCBTaW11bGF0b3IgaXMgZnVsbHkgYm9vdGVkLlxuICAgICAgICAvLyBTbyB3ZSBwcmVzZXJ2ZSB0aGF0IGJlaGF2aW9yLCBhbmQgaWYgbm8gZXJyb3JzIGFyZSByZWNlaXZlZCBmb3IgYSB3aGlsZVxuICAgICAgICAvLyB0aGVuIHdlIGFzc3VtZSB0aGUgU2ltdWxhdG9yIGJvb3RpbmcgaXMgc3RpbGwgaW4gcHJvZ3Jlc3MuXG4gICAgICAgIHNldFRpbWVvdXQocmVzb2x2ZSwgMzAwMCk7XG4gICAgICAgIGJvb3RFdmVudHNFbWl0dGVyLm9uY2UoJ2ZhaWx1cmUnLCAoZXJyKSA9PiB7XG4gICAgICAgICAgaWYgKF8uaW5jbHVkZXMoZXJyPy5tZXNzYWdlLCAnc3RhdGU6IEJvb3RlZCcpKSB7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGJvb3RFdmVudHNFbWl0dGVyLm9uY2UoJ2ZpbmlzaCcsIHJlc29sdmUpO1xuICAgICAgfSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGJvb3RFdmVudHNFbWl0dGVyLnJlbW92ZUFsbExpc3RlbmVycygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtIHZlcmlmaWNhdGlvbiBvZiBkZXZpY2UgcHJlZmVyZW5jZXMgY29ycmVjdG5lc3MuXG4gICAqXG4gICAqIEBwYXJhbSB7RGV2aWNlUHJlZmVyZW5jZXN9IHByZWZzIFt7fV0gLSBUaGUgcHJlZmVyZW5jZXMgdG8gYmUgdmVyaWZpZWRcbiAgICogQHRocm93cyB7RXJyb3J9IElmIGFueSBvZiB0aGUgZ2l2ZW4gcHJlZmVyZW5jZSB2YWx1ZXMgZG9lcyBub3QgbWF0Y2ggdGhlIGV4cGVjdGVkXG4gICAqIGZvcm1hdC5cbiAgICovXG4gIHZlcmlmeURldmljZVByZWZlcmVuY2VzIChwcmVmcyA9IHt9KSB7XG4gICAgaWYgKF8uaXNFbXB0eShwcmVmcykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIV8uaXNVbmRlZmluZWQocHJlZnMuU2ltdWxhdG9yV2luZG93TGFzdFNjYWxlKSkge1xuICAgICAgaWYgKCFfLmlzTnVtYmVyKHByZWZzLlNpbXVsYXRvcldpbmRvd0xhc3RTY2FsZSkgfHwgcHJlZnMuU2ltdWxhdG9yV2luZG93TGFzdFNjYWxlIDw9IDApIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coYFNpbXVsYXRvcldpbmRvd0xhc3RTY2FsZSBpcyBleHBlY3RlZCB0byBiZSBhIHBvc2l0aXZlIGZsb2F0IHZhbHVlLiBgICtcbiAgICAgICAgICBgJyR7cHJlZnMuU2ltdWxhdG9yV2luZG93TGFzdFNjYWxlfScgaXMgYXNzaWduZWQgaW5zdGVhZC5gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIV8uaXNVbmRlZmluZWQocHJlZnMuU2ltdWxhdG9yV2luZG93Q2VudGVyKSkge1xuICAgICAgLy8gaHR0cHM6Ly9yZWdleDEwMS5jb20vci8yWlhPaWovMlxuICAgICAgY29uc3QgdmVyaWZpY2F0aW9uUGF0dGVybiA9IC97LT9cXGQrKFxcLlxcZCspPywtP1xcZCsoXFwuXFxkKyk/fS87XG4gICAgICBpZiAoIV8uaXNTdHJpbmcocHJlZnMuU2ltdWxhdG9yV2luZG93Q2VudGVyKSB8fCAhdmVyaWZpY2F0aW9uUGF0dGVybi50ZXN0KHByZWZzLlNpbXVsYXRvcldpbmRvd0NlbnRlcikpIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coYFNpbXVsYXRvcldpbmRvd0NlbnRlciBpcyBleHBlY3RlZCB0byBtYXRjaCBcIntmbG9hdFhQb3NpdGlvbixmbG9hdFlQb3NpdGlvbn1cIiBmb3JtYXQgKHdpdGhvdXQgc3BhY2VzKS4gYCArXG4gICAgICAgICAgYCcke3ByZWZzLlNpbXVsYXRvcldpbmRvd0NlbnRlcn0nIGlzIGFzc2lnbmVkIGluc3RlYWQuYCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCFfLmlzVW5kZWZpbmVkKHByZWZzLlNpbXVsYXRvcldpbmRvd09yaWVudGF0aW9uKSkge1xuICAgICAgY29uc3QgYWNjZXB0YWJsZVZhbHVlcyA9IFsnUG9ydHJhaXQnLCAnTGFuZHNjYXBlTGVmdCcsICdQb3J0cmFpdFVwc2lkZURvd24nLCAnTGFuZHNjYXBlUmlnaHQnXTtcbiAgICAgIGlmIChhY2NlcHRhYmxlVmFsdWVzLmluZGV4T2YocHJlZnMuU2ltdWxhdG9yV2luZG93T3JpZW50YXRpb24pID09PSAtMSkge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgU2ltdWxhdG9yV2luZG93T3JpZW50YXRpb24gaXMgZXhwZWN0ZWQgdG8gYmUgb25lIG9mICR7YWNjZXB0YWJsZVZhbHVlc30uIGAgK1xuICAgICAgICAgIGAnJHtwcmVmcy5TaW11bGF0b3JXaW5kb3dPcmllbnRhdGlvbn0nIGlzIGFzc2lnbmVkIGluc3RlYWQuYCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCFfLmlzVW5kZWZpbmVkKHByZWZzLlNpbXVsYXRvcldpbmRvd1JvdGF0aW9uQW5nbGUpKSB7XG4gICAgICBpZiAoIV8uaXNOdW1iZXIocHJlZnMuU2ltdWxhdG9yV2luZG93Um90YXRpb25BbmdsZSkpIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coYFNpbXVsYXRvcldpbmRvd1JvdGF0aW9uQW5nbGUgaXMgZXhwZWN0ZWQgdG8gYmUgYSB2YWxpZCBudW1iZXIuIGAgK1xuICAgICAgICAgIGAnJHtwcmVmcy5TaW11bGF0b3JXaW5kb3dSb3RhdGlvbkFuZ2xlfScgaXMgYXNzaWduZWQgaW5zdGVhZC5gKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBjb21tb24gaU9TIFNpbXVsYXRvciBwcmVmZXJlbmNlcyBmaWxlIHdpdGggbmV3IHZhbHVlcy5cbiAgICogSXQgaXMgbmVjZXNzYXJ5IHRvIHJlc3RhcnQgdGhlIGNvcnJlc3BvbmRpbmcgU2ltdWxhdG9yIGJlZm9yZVxuICAgKiB0aGVzZSBjaGFuZ2VzIGFyZSBhcHBsaWVkLlxuICAgKlxuICAgKiBAcGFyYW0ge0RldmljZVByZWZlcmVuY2VzfSBkZXZpY2VQcmVmcyBbe31dIC0gVGhlIG1hcHBpbmcsIHdoaWNoIHJlcHJlc2VudHMgbmV3IGRldmljZSBwcmVmZXJlbmNlIHZhbHVlc1xuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHRoZSBnaXZlbiBTaW11bGF0b3IuXG4gICAqIEBwYXJhbSB7Q29tbW9uUHJlZmVyZW5jZXN9IGNvbW1vblByZWZzIFt7fV0gLSBUaGUgbWFwcGluZywgd2hpY2ggcmVwcmVzZW50cyBuZXcgY29tbW9uIHByZWZlcmVuY2UgdmFsdWVzXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgYWxsIFNpbXVsYXRvcnMuXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIHByZWZlcmVuY2VzIHdlcmUgc3VjY2Vzc2Z1bGx5IHVwZGF0ZWQuXG4gICAqL1xuICBhc3luYyB1cGRhdGVQcmVmZXJlbmNlcyAoZGV2aWNlUHJlZnMgPSB7fSwgY29tbW9uUHJlZnMgPSB7fSkge1xuICAgIGlmICghXy5pc0VtcHR5KGRldmljZVByZWZzKSkge1xuICAgICAgbG9nLmRlYnVnKGBTZXR0aW5nIHByZWZlcmVuY2VzIG9mICR7dGhpcy51ZGlkfSBTaW11bGF0b3IgdG8gJHtKU09OLnN0cmluZ2lmeShkZXZpY2VQcmVmcyl9YCk7XG4gICAgfVxuICAgIGlmICghXy5pc0VtcHR5KGNvbW1vblByZWZzKSkge1xuICAgICAgbG9nLmRlYnVnKGBTZXR0aW5nIGNvbW1vbiBTaW11bGF0b3IgcHJlZmVyZW5jZXMgdG8gJHtKU09OLnN0cmluZ2lmeShjb21tb25QcmVmcyl9YCk7XG4gICAgfVxuICAgIGNvbnN0IGhvbWVGb2xkZXJQYXRoID0gcHJvY2Vzcy5lbnYuSE9NRTtcbiAgICBpZiAoIWhvbWVGb2xkZXJQYXRoKSB7XG4gICAgICBsb2cud2FybihgQ2Fubm90IGdldCB0aGUgcGF0aCB0byBIT01FIGZvbGRlciBmcm9tIHRoZSBwcm9jZXNzIGVudmlyb25tZW50LiBgICtcbiAgICAgICAgYElnbm9yaW5nIFNpbXVsYXRvciBwcmVmZXJlbmNlcyB1cGRhdGUuYCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHRoaXMudmVyaWZ5RGV2aWNlUHJlZmVyZW5jZXMoZGV2aWNlUHJlZnMpO1xuICAgIGNvbnN0IHBsaXN0UGF0aCA9IHBhdGgucmVzb2x2ZShob21lRm9sZGVyUGF0aCwgJ0xpYnJhcnknLCAnUHJlZmVyZW5jZXMnLCAnY29tLmFwcGxlLmlwaG9uZXNpbXVsYXRvci5wbGlzdCcpO1xuICAgIHJldHVybiBhd2FpdCBwcmVmZXJlbmNlc1BsaXN0R3VhcmQuYWNxdWlyZShTaW11bGF0b3JYY29kZTkubmFtZSwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGVmYXVsdHMgPSBuZXcgTlNVc2VyRGVmYXVsdHMocGxpc3RQYXRoKTtcbiAgICAgIGNvbnN0IHByZWZzVG9VcGRhdGUgPSBfLmNsb25lKGNvbW1vblByZWZzKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICghXy5pc0VtcHR5KGRldmljZVByZWZzKSkge1xuICAgICAgICAgIGxldCBleGlzdGluZ0RldmljZVByZWZzO1xuICAgICAgICAgIGNvbnN0IHVkaWRLZXkgPSB0aGlzLnVkaWQudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKHBsaXN0UGF0aCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQbGlzdENvbnRlbnQgPSBhd2FpdCBkZWZhdWx0cy5hc0pzb24oKTtcbiAgICAgICAgICAgIGlmIChfLmlzUGxhaW5PYmplY3QoY3VycmVudFBsaXN0Q29udGVudC5EZXZpY2VQcmVmZXJlbmNlcylcbiAgICAgICAgICAgICAgICAmJiBfLmlzUGxhaW5PYmplY3QoY3VycmVudFBsaXN0Q29udGVudC5EZXZpY2VQcmVmZXJlbmNlc1t1ZGlkS2V5XSkpIHtcbiAgICAgICAgICAgICAgZXhpc3RpbmdEZXZpY2VQcmVmcyA9IGN1cnJlbnRQbGlzdENvbnRlbnQuRGV2aWNlUHJlZmVyZW5jZXNbdWRpZEtleV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIE9iamVjdC5hc3NpZ24ocHJlZnNUb1VwZGF0ZSwge1xuICAgICAgICAgICAgRGV2aWNlUHJlZmVyZW5jZXM6IHtcbiAgICAgICAgICAgICAgW3VkaWRLZXldOiBPYmplY3QuYXNzaWduKHt9LCBleGlzdGluZ0RldmljZVByZWZzIHx8IHt9LCBkZXZpY2VQcmVmcylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBkZWZhdWx0cy51cGRhdGUocHJlZnNUb1VwZGF0ZSk7XG4gICAgICAgIGxvZy5kZWJ1ZyhgVXBkYXRlZCAke3RoaXMudWRpZH0gU2ltdWxhdG9yIHByZWZlcmVuY2VzIGF0ICcke3BsaXN0UGF0aH0nIHdpdGggYCArXG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkocHJlZnNUb1VwZGF0ZSkpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLndhcm4oYENhbm5vdCB1cGRhdGUgJHt0aGlzLnVkaWR9IFNpbXVsYXRvciBwcmVmZXJlbmNlcyBhdCAnJHtwbGlzdFBhdGh9Jy4gYCArXG4gICAgICAgICAgYFRyeSB0byBkZWxldGUgdGhlIGZpbGUgbWFudWFsbHkgaW4gb3JkZXIgdG8gcmVzZXQgaXQuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0ZG9jXG4gICAqIEBvdmVycmlkZVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgYXN5bmMgX2FjdGl2YXRlV2luZG93ICgpIHtcbiAgICBsZXQgc2VsZk5hbWU7XG4gICAgbGV0IHNlbGZTZGs7XG4gICAgbGV0IGJvb3RlZERldmljZXNDb3VudCA9IDA7XG4gICAgZm9yIChjb25zdCBbc2RrLCBkZXZpY2VBcnJdIG9mIF8udG9QYWlycyhhd2FpdCB0aGlzLnNpbWN0bC5nZXREZXZpY2VzKCkpKSB7XG4gICAgICBmb3IgKGNvbnN0IHtzdGF0ZSwgdWRpZCwgbmFtZX0gb2YgZGV2aWNlQXJyKSB7XG4gICAgICAgIGlmIChzdGF0ZSA9PT0gJ0Jvb3RlZCcpIHtcbiAgICAgICAgICBib290ZWREZXZpY2VzQ291bnQrKztcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXNlbGZOYW1lICYmIHVkaWQgPT09IHRoaXMudWRpZCkge1xuICAgICAgICAgIHNlbGZTZGsgPSBzZGs7XG4gICAgICAgICAgc2VsZk5hbWUgPSBuYW1lO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChib290ZWREZXZpY2VzQ291bnQgPCAyKSB7XG4gICAgICByZXR1cm4gYXdhaXQgc3VwZXIuX2FjdGl2YXRlV2luZG93KCk7XG4gICAgfVxuXG4gICAgLy8gVGhlcmUgYXJlIHBvdGVudGlhbGx5IG1vcmUgdGhhdCBvbmUgU2ltdWxhdG9yIHdpbmRvd1xuICAgIHJldHVybiBgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGZyb250bW9zdCB0byBmYWxzZVxuICAgICAgICAgIHNldCBmcm9udG1vc3QgdG8gdHJ1ZVxuICAgICAgICAgIGNsaWNrIChtZW51IGl0ZW0gMSB3aGVyZSAoaXRzIG5hbWUgY29udGFpbnMgXCIke3NlbGZOYW1lfSBcIiBhbmQgaXRzIG5hbWUgY29udGFpbnMgXCIke3NlbGZTZGt9XCIpKSBvZiBtZW51IDEgb2YgbWVudSBiYXIgaXRlbSBcIldpbmRvd1wiIG9mIG1lbnUgYmFyIDFcbiAgICAgICAgZW5kIHRlbGxcbiAgICAgIGVuZCB0ZWxsXG4gICAgYDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAaW5oZXJpdGRvY1xuICAgKiBAb3ZlcnJpZGVcbiAgICovXG4gIGFzeW5jIGlzQmlvbWV0cmljRW5yb2xsZWQgKCkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFtcbiAgICAgICdub3RpZnl1dGlsJyxcbiAgICAgICctZycsIEVOUk9MTE1FTlRfTk9USUZJQ0FUSU9OX1JFQ0VJVkVSXG4gICAgXSk7XG4gICAgY29uc3QgbWF0Y2ggPSAobmV3IFJlZ0V4cChgJHtfLmVzY2FwZVJlZ0V4cChFTlJPTExNRU5UX05PVElGSUNBVElPTl9SRUNFSVZFUil9XFxcXHMrKFswMV0pYCkpXG4gICAgICAuZXhlYyhzdGRvdXQpO1xuICAgIGlmICghbWF0Y2gpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHBhcnNlIGJpb21ldHJpYyBlbnJvbGxtZW50IHN0YXRlIGZyb20gJyR7c3Rkb3V0fSdgKTtcbiAgICB9XG4gICAgbG9nLmluZm8oYEN1cnJlbnQgYmlvbWV0cmljIGVucm9sbGVkIHN0YXRlIGZvciAke3RoaXMudWRpZH0gU2ltdWxhdG9yOiAke21hdGNoWzFdfWApO1xuICAgIHJldHVybiBtYXRjaFsxXSA9PT0gJzEnO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0ZG9jXG4gICAqIEBvdmVycmlkZVxuICAgKi9cbiAgYXN5bmMgZW5yb2xsQmlvbWV0cmljIChpc0VuYWJsZWQgPSB0cnVlKSB7XG4gICAgbG9nLmRlYnVnKGBTZXR0aW5nIGJpb21ldHJpYyBlbnJvbGxlZCBzdGF0ZSBmb3IgJHt0aGlzLnVkaWR9IFNpbXVsYXRvciB0byAnJHtpc0VuYWJsZWQgPyAnZW5hYmxlZCcgOiAnZGlzYWJsZWQnfSdgKTtcbiAgICBhd2FpdCB0aGlzLnNpbWN0bC5zcGF3blByb2Nlc3MoW1xuICAgICAgJ25vdGlmeXV0aWwnLFxuICAgICAgJy1zJywgRU5ST0xMTUVOVF9OT1RJRklDQVRJT05fUkVDRUlWRVIsIGlzRW5hYmxlZCA/ICcxJyA6ICcwJ1xuICAgIF0pO1xuICAgIGF3YWl0IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbXG4gICAgICAnbm90aWZ5dXRpbCcsXG4gICAgICAnLXAnLCBFTlJPTExNRU5UX05PVElGSUNBVElPTl9SRUNFSVZFUlxuICAgIF0pO1xuICAgIGlmIChhd2FpdCB0aGlzLmlzQmlvbWV0cmljRW5yb2xsZWQoKSAhPT0gaXNFbmFibGVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBzZXQgYmlvbWV0cmljIGVucm9sbGVkIHN0YXRlIGZvciAke3RoaXMudWRpZH0gU2ltdWxhdG9yIHRvICcke2lzRW5hYmxlZCA/ICdlbmFibGVkJyA6ICdkaXNhYmxlZCd9J2ApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kcyBhIG5vdGlmaWNhdGlvbiB0byBtYXRjaC9ub3QgbWF0Y2ggdGhlIHBhcnRpY3VsYXIgYmlvbWV0cmljLlxuICAgKiBAb3ZlcnJpZGVcbiAgICpcbiAgICogQHBhcmFtIHs/Ym9vbGVhbn0gc2hvdWxkTWF0Y2ggW3RydWVdIC0gU2V0IGl0IHRvIHRydWUgb3IgZmFsc2UgaW4gb3JkZXIgdG8gZW11bGF0ZVxuICAgKiBtYXRjaGluZy9ub3QgbWF0Y2hpbmcgdGhlIGNvcnJlc3BvbmRpbmcgYmlvbWV0cmljXG4gICAqIEBwYXJhbSB7P3N0cmluZ30gYmlvbWV0cmljTmFtZSBbdG91Y2hJZF0gLSBFaXRoZXIgdG91Y2hJZCBvciBmYWNlSWQgKGZhY2VJZCBpcyBvbmx5IGF2YWlsYWJsZSBzaW5jZSBpT1MgMTEpXG4gICAqL1xuICBhc3luYyBzZW5kQmlvbWV0cmljTWF0Y2ggKHNob3VsZE1hdGNoID0gdHJ1ZSwgYmlvbWV0cmljTmFtZSA9ICd0b3VjaElkJykge1xuICAgIGNvbnN0IGRvbWFpbkNvbXBvbmVudCA9IHRvQmlvbWV0cmljRG9tYWluQ29tcG9uZW50KGJpb21ldHJpY05hbWUpO1xuICAgIGNvbnN0IGRvbWFpbiA9IGBjb20uYXBwbGUuQmlvbWV0cmljS2l0X1NpbS4ke2RvbWFpbkNvbXBvbmVudH0uJHtzaG91bGRNYXRjaCA/ICcnIDogJ25vJ31tYXRjaGA7XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFtcbiAgICAgICdub3RpZnl1dGlsJyxcbiAgICAgICctcCcsIGRvbWFpblxuICAgIF0pO1xuICAgIGxvZy5pbmZvKGBTZW50IG5vdGlmaWNhdGlvbiAke2RvbWFpbn0gdG8gJHtzaG91bGRNYXRjaCA/ICdtYXRjaCcgOiAnbm90IG1hdGNoJ30gJHtiaW9tZXRyaWNOYW1lfSBiaW9tZXRyaWMgYCArXG4gICAgICBgZm9yICR7dGhpcy51ZGlkfSBTaW11bGF0b3JgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3ZlcnJpZGVcbiAgICovXG4gIGFzeW5jIGdldExhdW5jaERhZW1vbnNSb290ICgpIHtcbiAgICBjb25zdCBkZXZSb290ID0gYXdhaXQgZ2V0RGV2ZWxvcGVyUm9vdCgpO1xuICAgIHJldHVybiBwYXRoLnJlc29sdmUoZGV2Um9vdCxcbiAgICAgICdQbGF0Zm9ybXMvaVBob25lT1MucGxhdGZvcm0vRGV2ZWxvcGVyL0xpYnJhcnkvQ29yZVNpbXVsYXRvci9Qcm9maWxlcy9SdW50aW1lcy9pT1Muc2ltcnVudGltZS9Db250ZW50cy9SZXNvdXJjZXMvUnVudGltZVJvb3QvU3lzdGVtL0xpYnJhcnkvTGF1bmNoRGFlbW9ucycpO1xuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IEtleWJvYXJkT3B0aW9uc1xuICAgKiBAcHJvcGVydHkgeyFzdHJpbmd9IG5hbWUgVGhlIG5hbWUgb2YgdGhlIGtleWJvYXJkIGxvY2FsZSwgZm9yIGV4YW1wbGUgYGVuX1VTYCBvciBgZGVfQ0hgXG4gICAqIEBwcm9wZXJ0eSB7IXN0cmluZ30gbGF5b3V0IFRoZSBrZXlib2FyZCBsYXlvdXQsIGZvciBleGFtcGxlIGBRVUVSVFlgIG9yIGBVa3JhaW5pYW5gXG4gICAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gaGFyZHdhcmUgQ291bGQgZWl0aGVyIGJlIGBBdXRvbWF0aWNgIG9yIGBudWxsYFxuICAgKi9cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gTGFuZ3VhZ2VPcHRpb25zXG4gICAqIEBwcm9wZXJ0eSB7IXN0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiB0aGUgbGFuZ3VhZ2UsIGZvciBleGFtcGxlIGBkZWAgb3IgYHpoLUhhbnQtQ05gXG4gICAqL1xuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBMb2NhbGVPcHRpb25zXG4gICAqIEBwcm9wZXJ0eSB7IXN0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiB0aGUgc3lzdGVtIGxvY2FsZSwgZm9yIGV4YW1wbGUgYGRlX0NIYCBvciBgemhfQ05gXG4gICAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gY2FsZW5kYXIgT3B0aW9uYWwgY2FsZW5kYXIgZm9ybWF0LCBmb3IgZXhhbXBsZSBgZ3JlZ29yaWFuYCBvciBgcGVyc2lhbmBcbiAgICovXG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IExvY2FsaXphdGlvbk9wdGlvbnNcbiAgICogQHByb3BlcnR5IHs/S2V5Ym9hcmRPcHRpb25zfSBrZXlib2FyZFxuICAgKiBAcHJvcGVydHkgez9MYW5ndWFnZU9wdGlvbnN9IGxhbmd1YWdlXG4gICAqIEBwcm9wZXJ0eSB7P0xvY2FsZU9wdGlvbnN9IGxvY2FsZVxuICAgKi9cblxuICAvKipcbiAgICogQ2hhbmdlIGxvY2FsaXphdGlvbiBzZXR0aW5ncyBvbiB0aGUgY3VycmVudGx5IGJvb3RlZCBzaW11bGF0b3JcbiAgICpcbiAgICogQHBhcmFtIHs/TG9jYWxpemF0aW9uT3B0aW9uc30gb3B0c1xuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGEgZmFpbHVyZSB3aGlsZSBzZXR0aW5nIHRoZSBwcmVmZXJlbmNlc1xuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gYHRydWVgIGlmIGFueSBvZiBzZXR0aW5ncyBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgY2hhbmdlZFxuICAgKi9cbiAgYXN5bmMgY29uZmlndXJlTG9jYWxpemF0aW9uIChvcHRzID0ge30pIHtcbiAgICBpZiAoXy5pc0VtcHR5KG9wdHMpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3QgeyBsYW5ndWFnZSwgbG9jYWxlLCBrZXlib2FyZCB9ID0gb3B0cztcbiAgICBjb25zdCBnbG9iYWxQcmVmcyA9IHt9O1xuICAgIGxldCBrZXlib2FyZElkID0gbnVsbDtcbiAgICBpZiAoXy5pc1BsYWluT2JqZWN0KGtleWJvYXJkKSkge1xuICAgICAgY29uc3QgeyBuYW1lLCBsYXlvdXQsIGhhcmR3YXJlIH0gPSBrZXlib2FyZDtcbiAgICAgIGlmICghbmFtZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSAna2V5Ym9hcmQnIGZpZWxkIG11c3QgaGF2ZSBhIHZhbGlkIG5hbWUgc2V0YCk7XG4gICAgICB9XG4gICAgICBpZiAoIWxheW91dCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSAna2V5Ym9hcmQnIGZpZWxkIG11c3QgaGF2ZSBhIHZhbGlkIGxheW91dCBzZXRgKTtcbiAgICAgIH1cbiAgICAgIGtleWJvYXJkSWQgPSBgJHtuYW1lfUBzdz0ke2xheW91dH1gO1xuICAgICAgaWYgKGhhcmR3YXJlKSB7XG4gICAgICAgIGtleWJvYXJkSWQgKz0gYDtAaHc9JHtoYXJkd2FyZX1gO1xuICAgICAgfVxuICAgICAgZ2xvYmFsUHJlZnMuQXBwbGVLZXlib2FyZHMgPSBba2V5Ym9hcmRJZF07XG4gICAgfVxuICAgIGlmIChfLmlzUGxhaW5PYmplY3QobGFuZ3VhZ2UpKSB7XG4gICAgICBjb25zdCB7IG5hbWUgfSA9IGxhbmd1YWdlO1xuICAgICAgaWYgKCFuYW1lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlICdsYW5ndWFnZScgZmllbGQgbXVzdCBoYXZlIGEgdmFsaWQgbmFtZSBzZXRgKTtcbiAgICAgIH1cbiAgICAgIGdsb2JhbFByZWZzLkFwcGxlTGFuZ3VhZ2VzID0gW25hbWVdO1xuICAgIH1cbiAgICBpZiAoXy5pc1BsYWluT2JqZWN0KGxvY2FsZSkpIHtcbiAgICAgIGNvbnN0IHsgbmFtZSwgY2FsZW5kYXIgfSA9IGxvY2FsZTtcbiAgICAgIGlmICghbmFtZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSAnbG9jYWxlJyBmaWVsZCBtdXN0IGhhdmUgYSB2YWxpZCBuYW1lIHNldGApO1xuICAgICAgfVxuICAgICAgbGV0IGxvY2FsZUlkID0gbmFtZTtcbiAgICAgIGlmIChjYWxlbmRhcikge1xuICAgICAgICBsb2NhbGVJZCArPSBgQGNhbGVuZGFyPSR7Y2FsZW5kYXJ9YDtcbiAgICAgIH1cbiAgICAgIGdsb2JhbFByZWZzLkFwcGxlTG9jYWxlID0gbG9jYWxlSWQ7XG4gICAgfVxuICAgIGlmIChfLmlzRW1wdHkoZ2xvYmFsUHJlZnMpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3QgYXJnQ2h1bmtzID0gZ2VuZXJhdGVEZWZhdWx0c0NvbW1hbmRBcmdzKGdsb2JhbFByZWZzLCB0cnVlKTtcbiAgICBhd2FpdCBCLmFsbChhcmdDaHVua3MubWFwKChhcmdzKSA9PiB0aGlzLnNpbWN0bC5zcGF3blByb2Nlc3MoW1xuICAgICAgJ2RlZmF1bHRzJywgJ3dyaXRlJywgJy5HbG9iYWxQcmVmZXJlbmNlcy5wbGlzdCcsIC4uLmFyZ3NcbiAgICBdKSkpO1xuXG4gICAgaWYgKGtleWJvYXJkSWQpIHtcbiAgICAgIGNvbnN0IGFyZ0NodW5rcyA9IGdlbmVyYXRlRGVmYXVsdHNDb21tYW5kQXJncyh7XG4gICAgICAgIEtleWJvYXJkc0N1cnJlbnRBbmROZXh0OiBba2V5Ym9hcmRJZF0sXG4gICAgICAgIEtleWJvYXJkTGFzdFVzZWQ6IGtleWJvYXJkSWQsXG4gICAgICAgIEtleWJvYXJkTGFzdFVzZWRGb3JMYW5ndWFnZTogeyBba2V5Ym9hcmQubmFtZV06IGtleWJvYXJkSWQgfVxuICAgICAgfSwgdHJ1ZSk7XG4gICAgICBhd2FpdCBCLmFsbChhcmdDaHVua3MubWFwKChhcmdzKSA9PiB0aGlzLnNpbWN0bC5zcGF3blByb2Nlc3MoW1xuICAgICAgICAnZGVmYXVsdHMnLCAnd3JpdGUnLCAnY29tLmFwcGxlLlByZWZlcmVuY2VzJywgLi4uYXJnc1xuICAgICAgXSkpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTaW11bGF0b3JYY29kZTk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxNQUFNQSwwQkFBMEIsR0FBRyxFQUFFLEdBQUcsSUFBSTtBQUM1QyxNQUFNQyxXQUFXLEdBQUcsSUFBSUMsa0JBQVMsRUFBRTtBQUNuQyxNQUFNQyxxQkFBcUIsR0FBRyxJQUFJRCxrQkFBUyxFQUFFO0FBQzdDLE1BQU1FLGdDQUFnQyxHQUFHLDBDQUEwQztBQUNuRixNQUFNQywyQkFBMkIsR0FBRyxnQ0FBZ0M7QUFVcEUsU0FBU0MsMkJBQTJCLENBQUVDLElBQUksR0FBRyxDQUFDLENBQUMsRUFBRTtFQUMvQyxNQUFNO0lBQ0pDLHVCQUF1QjtJQUN2QkMsWUFBWTtJQUNaQyx1QkFBdUI7SUFDdkJDO0VBQ0YsQ0FBQyxHQUFHSixJQUFJO0VBQ1IsTUFBTUssaUJBQWlCLEdBQUc7SUFHeEJDLCtCQUErQixFQUFFLElBQUk7SUFFckNDLHVCQUF1QixFQUFFLEtBQUs7SUFDOUJDLG1CQUFtQixFQUFFLEtBQUs7SUFDMUJDLG1CQUFtQixFQUFFO0VBQ3ZCLENBQUM7RUFDRCxNQUFNQyxpQkFBaUIsR0FBR1YsSUFBSSxDQUFDVSxpQkFBaUIsR0FBR0MsZUFBQyxDQUFDQyxTQUFTLENBQUNaLElBQUksQ0FBQ1UsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUM7RUFDM0YsSUFBSU4sV0FBVyxFQUFFO0lBQ2ZNLGlCQUFpQixDQUFDRyx3QkFBd0IsR0FBR0MsVUFBVSxDQUFD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