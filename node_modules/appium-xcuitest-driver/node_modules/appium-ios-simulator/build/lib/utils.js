"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SIMULATOR_APP_NAME = exports.SAFARI_STARTUP_TIMEOUT_MS = exports.MOBILE_SAFARI_BUNDLE_ID = void 0;
exports.activateApp = activateApp;
exports.getDeveloperRoot = getDeveloperRoot;
exports.getSimulatorInfo = getSimulatorInfo;
exports.killAllSimulators = killAllSimulators;
exports.simExists = simExists;
exports.toBiometricDomainComponent = toBiometricDomainComponent;
require("source-map-support/register");
var _logger = _interopRequireDefault(require("./logger"));
var _lodash = _interopRequireDefault(require("lodash"));
var _teen_process = require("teen_process");
var _asyncbox = require("asyncbox");
var _appiumXcode = require("appium-xcode");
var _nodeSimctl = _interopRequireDefault(require("node-simctl"));
var _path = _interopRequireDefault(require("path"));
const DEFAULT_SIM_SHUTDOWN_TIMEOUT_MS = 30000;
const SAFARI_STARTUP_TIMEOUT_MS = 25 * 1000;
exports.SAFARI_STARTUP_TIMEOUT_MS = SAFARI_STARTUP_TIMEOUT_MS;
const MOBILE_SAFARI_BUNDLE_ID = 'com.apple.mobilesafari';
exports.MOBILE_SAFARI_BUNDLE_ID = MOBILE_SAFARI_BUNDLE_ID;
const SIMULATOR_APP_NAME = 'Simulator.app';
exports.SIMULATOR_APP_NAME = SIMULATOR_APP_NAME;
const APP_ACTIVATION_SCRIPT = pid => `
use framework "Foundation"
use framework "AppKit"
use scripting additions

set theApp to current application's NSRunningApplication's runningApplicationWithProcessIdentifier:${pid}
if theApp = null then
	log "Cannot find Simulator window under PID ${pid}. Is it running?"
	error number 1
end if
set result to theApp's activateWithOptions:3
if not result then
	log "Cannot activate Simulator window under PID ${pid}. Is it running?"
	error number 1
end if
`;
const BIOMETRICS = {
  touchId: 'fingerTouch',
  faceId: 'pearl'
};
function toBiometricDomainComponent(name) {
  if (!BIOMETRICS[name]) {
    throw new Error(`'${name}' is not a valid biometric. Use one of: ${JSON.stringify(_lodash.default.keys(BIOMETRICS))}`);
  }
  return BIOMETRICS[name];
}
async function pkill(appName, forceKill = false) {
  let args = forceKill ? ['-9'] : [];
  args.push('-x', appName);
  try {
    await (0, _teen_process.exec)('pkill', args);
    return 0;
  } catch (err) {
    if (!_lodash.default.isUndefined(err.code)) {
      throw new Error(`Cannot forcefully terminate ${appName}. pkill error code: ${err.code}`);
    }
    _logger.default.error(`Received unexpected error while trying to kill ${appName}: ${err.message}`);
    throw err;
  }
}
async function killAllSimulators(timeout = DEFAULT_SIM_SHUTDOWN_TIMEOUT_MS) {
  _logger.default.debug('Killing all iOS Simulators');
  const xcodeVersion = await (0, _appiumXcode.getVersion)(true);
  const appName = _path.default.parse(SIMULATOR_APP_NAME).name;
  timeout = timeout * (xcodeVersion.major >= 8 ? 2 : 1);
  try {
    await (0, _teen_process.exec)('xcrun', ['simctl', 'shutdown', xcodeVersion.major > 8 ? 'all' : 'booted'], {
      timeout
    });
  } catch (ign) {}
  const pids = [];
  try {
    const {
      stdout
    } = await (0, _teen_process.exec)('pgrep', ['-f', `${appName}.app/Contents/MacOS/`]);
    if (stdout.trim()) {
      pids.push(...stdout.trim().split(/\s+/));
    }
  } catch (e) {
    if (e.code === 1) {
      _logger.default.debug(`${appName} is not running. Continuing...`);
      return;
    }
    if (_lodash.default.isEmpty(pids)) {
      _logger.default.warn(`pgrep error ${e.code} while detecting whether ${appName} is running. Trying to kill anyway.`);
    }
  }
  if (!_lodash.default.isEmpty(pids)) {
    _logger.default.debug(`Killing processes: ${pids.join(', ')}`);
    try {
      await (0, _teen_process.exec)('kill', ['-9', ...pids.map(pid => `${pid}`)]);
    } catch (ign) {}
  }
  _logger.default.debug(`Using pkill to kill application: ${appName}`);
  try {
    await pkill(appName, true);
  } catch (ign) {}
  let remainingDevices = [];
  async function allSimsAreDown() {
    remainingDevices = [];
    let devices = await new _nodeSimctl.default().getDevices();
    devices = _lodash.default.flatten(_lodash.default.values(devices));
    return _lodash.default.every(devices, sim => {
      const state = sim.state.toLowerCase();
      const done = ['shutdown', 'unavailable', 'disconnected'].includes(state);
      if (!done) {
        remainingDevices.push(`${sim.name} (${sim.sdk}, udid: ${sim.udid}) is still in state '${state}'`);
      }
      return done;
    });
  }
  try {
    await (0, _asyncbox.waitForCondition)(allSimsAreDown, {
      waitMs: timeout,
      intervalMs: 200
    });
  } catch (err) {
    if (remainingDevices.length > 0) {
      _logger.default.warn(`The following devices are still not in the correct state after ${timeout} ms:`);
      for (let device of remainingDevices) {
        _logger.default.warn(`    ${device}`);
      }
    }
    throw err;
  }
}
async function getSimulatorInfo(udid, opts = {}) {
  const {
    devicesSetPath
  } = opts;
  let devices = await new _nodeSimctl.default({
    devicesSetPath
  }).getDevices();
  devices = _lodash.default.toPairs(devices).map(pair => pair[1]).reduce((a, b) => a.concat(b), []);
  return _lodash.default.find(devices, sim => sim.udid === udid);
}
async function simExists(udid) {
  return !!(await getSimulatorInfo(udid));
}
async function getDeveloperRoot() {
  const {
    stdout
  } = await (0, _teen_process.exec)('xcode-select', ['-p']);
  return stdout.trim();
}
async function activateApp(pid) {
  try {
    await (0, _teen_process.exec)('osascript', ['-e', APP_ACTIVATION_SCRIPT(pid)]);
  } catch (e) {
    throw new Error(`Simulator window cannot be activated. Original error: ${e.stderr || e.message}`);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJERUZBVUxUX1NJTV9TSFVURE9XTl9USU1FT1VUX01TIiwiU0FGQVJJX1NUQVJUVVBfVElNRU9VVF9NUyIsIk1PQklMRV9TQUZBUklfQlVORExFX0lEIiwiU0lNVUxBVE9SX0FQUF9OQU1FIiwiQVBQX0FDVElWQVRJT05fU0NSSVBUIiwicGlkIiwiQklPTUVUUklDUyIsInRvdWNoSWQiLCJmYWNlSWQiLCJ0b0Jpb21ldHJpY0RvbWFpbkNvbXBvbmVudCIsIm5hbWUiLCJFcnJvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJfIiwia2V5cyIsInBraWxsIiwiYXBwTmFtZSIsImZvcmNlS2lsbCIsImFyZ3MiLCJwdXNoIiwiZXhlYyIsImVyciIsImlzVW5kZWZpbmVkIiwiY29kZSIsImxvZyIsImVycm9yIiwibWVzc2FnZSIsImtpbGxBbGxTaW11bGF0b3JzIiwidGltZW91dCIsImRlYnVnIiwieGNvZGVWZXJzaW9uIiwiZ2V0VmVyc2lvbiIsInBhdGgiLCJwYXJzZSIsIm1ham9yIiwiaWduIiwicGlkcyIsInN0ZG91dCIsInRyaW0iLCJzcGxpdCIsImUiLCJpc0VtcHR5Iiwid2FybiIsImpvaW4iLCJtYXAiLCJyZW1haW5pbmdEZXZpY2VzIiwiYWxsU2ltc0FyZURvd24iLCJkZXZpY2VzIiwiU2ltY3RsIiwiZ2V0RGV2aWNlcyIsImZsYXR0ZW4iLCJ2YWx1ZXMiLCJldmVyeSIsInNpbSIsInN0YXRlIiwidG9Mb3dlckNhc2UiLCJkb25lIiwiaW5jbHVkZXMiLCJzZGsiLCJ1ZGlkIiwid2FpdEZvckNvbmRpdGlvbiIsIndhaXRNcyIsImludGVydmFsTXMiLCJsZW5ndGgiLCJkZXZpY2UiLCJnZXRTaW11bGF0b3JJbmZvIiwib3B0cyIsImRldmljZXNTZXRQYXRoIiwidG9QYWlycyIsInBhaXIiLCJyZWR1Y2UiLCJhIiwiYiIsImNvbmNhdCIsImZpbmQiLCJzaW1FeGlzdHMiLCJnZXREZXZlbG9wZXJSb290IiwiYWN0aXZhdGVBcHAiLCJzdGRlcnIiXSwic291cmNlcyI6WyIuLi8uLi9saWIvdXRpbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeyB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IHsgZ2V0VmVyc2lvbiB9IGZyb20gJ2FwcGl1bS14Y29kZSc7XG5pbXBvcnQgU2ltY3RsIGZyb20gJ25vZGUtc2ltY3RsJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG5cbmNvbnN0IERFRkFVTFRfU0lNX1NIVVRET1dOX1RJTUVPVVRfTVMgPSAzMDAwMDtcbmNvbnN0IFNBRkFSSV9TVEFSVFVQX1RJTUVPVVRfTVMgPSAyNSAqIDEwMDA7XG5jb25zdCBNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRCA9ICdjb20uYXBwbGUubW9iaWxlc2FmYXJpJztcbmNvbnN0IFNJTVVMQVRPUl9BUFBfTkFNRSA9ICdTaW11bGF0b3IuYXBwJztcbmNvbnN0IEFQUF9BQ1RJVkFUSU9OX1NDUklQVCA9IChwaWQpID0+IGBcbnVzZSBmcmFtZXdvcmsgXCJGb3VuZGF0aW9uXCJcbnVzZSBmcmFtZXdvcmsgXCJBcHBLaXRcIlxudXNlIHNjcmlwdGluZyBhZGRpdGlvbnNcblxuc2V0IHRoZUFwcCB0byBjdXJyZW50IGFwcGxpY2F0aW9uJ3MgTlNSdW5uaW5nQXBwbGljYXRpb24ncyBydW5uaW5nQXBwbGljYXRpb25XaXRoUHJvY2Vzc0lkZW50aWZpZXI6JHtwaWR9XG5pZiB0aGVBcHAgPSBudWxsIHRoZW5cblx0bG9nIFwiQ2Fubm90IGZpbmQgU2ltdWxhdG9yIHdpbmRvdyB1bmRlciBQSUQgJHtwaWR9LiBJcyBpdCBydW5uaW5nP1wiXG5cdGVycm9yIG51bWJlciAxXG5lbmQgaWZcbnNldCByZXN1bHQgdG8gdGhlQXBwJ3MgYWN0aXZhdGVXaXRoT3B0aW9uczozXG5pZiBub3QgcmVzdWx0IHRoZW5cblx0bG9nIFwiQ2Fubm90IGFjdGl2YXRlIFNpbXVsYXRvciB3aW5kb3cgdW5kZXIgUElEICR7cGlkfS4gSXMgaXQgcnVubmluZz9cIlxuXHRlcnJvciBudW1iZXIgMVxuZW5kIGlmXG5gO1xuXG5cbmNvbnN0IEJJT01FVFJJQ1MgPSB7XG4gIHRvdWNoSWQ6ICdmaW5nZXJUb3VjaCcsXG4gIGZhY2VJZDogJ3BlYXJsJyxcbn07XG5cbmZ1bmN0aW9uIHRvQmlvbWV0cmljRG9tYWluQ29tcG9uZW50IChuYW1lKSB7XG4gIGlmICghQklPTUVUUklDU1tuYW1lXSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJyR7bmFtZX0nIGlzIG5vdCBhIHZhbGlkIGJpb21ldHJpYy4gVXNlIG9uZSBvZjogJHtKU09OLnN0cmluZ2lmeShfLmtleXMoQklPTUVUUklDUykpfWApO1xuICB9XG4gIHJldHVybiBCSU9NRVRSSUNTW25hbWVdO1xufVxuXG4vLyBwZ3JlcC9wa2lsbCBleGl0IGNvZGVzOlxuLy8gMCAgICAgICBPbmUgb3IgbW9yZSBwcm9jZXNzZXMgd2VyZSBtYXRjaGVkLlxuLy8gMSAgICAgICBObyBwcm9jZXNzZXMgd2VyZSBtYXRjaGVkLlxuLy8gMiAgICAgICBJbnZhbGlkIG9wdGlvbnMgd2VyZSBzcGVjaWZpZWQgb24gdGhlIGNvbW1hbmQgbGluZS5cbi8vIDMgICAgICAgQW4gaW50ZXJuYWwgZXJyb3Igb2NjdXJyZWQuXG5hc3luYyBmdW5jdGlvbiBwa2lsbCAoYXBwTmFtZSwgZm9yY2VLaWxsID0gZmFsc2UpIHtcbiAgbGV0IGFyZ3MgPSBmb3JjZUtpbGwgPyBbJy05J10gOiBbXTtcbiAgYXJncy5wdXNoKCcteCcsIGFwcE5hbWUpO1xuICB0cnkge1xuICAgIGF3YWl0IGV4ZWMoJ3BraWxsJywgYXJncyk7XG4gICAgcmV0dXJuIDA7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmICghXy5pc1VuZGVmaW5lZChlcnIuY29kZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGZvcmNlZnVsbHkgdGVybWluYXRlICR7YXBwTmFtZX0uIHBraWxsIGVycm9yIGNvZGU6ICR7ZXJyLmNvZGV9YCk7XG4gICAgfVxuICAgIGxvZy5lcnJvcihgUmVjZWl2ZWQgdW5leHBlY3RlZCBlcnJvciB3aGlsZSB0cnlpbmcgdG8ga2lsbCAke2FwcE5hbWV9OiAke2Vyci5tZXNzYWdlfWApO1xuICAgIHRocm93IGVycjtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBraWxsQWxsU2ltdWxhdG9ycyAodGltZW91dCA9IERFRkFVTFRfU0lNX1NIVVRET1dOX1RJTUVPVVRfTVMpIHtcbiAgbG9nLmRlYnVnKCdLaWxsaW5nIGFsbCBpT1MgU2ltdWxhdG9ycycpO1xuICBjb25zdCB4Y29kZVZlcnNpb24gPSBhd2FpdCBnZXRWZXJzaW9uKHRydWUpO1xuICBjb25zdCBhcHBOYW1lID0gcGF0aC5wYXJzZShTSU1VTEFUT1JfQVBQX05BTUUpLm5hbWU7XG5cbiAgLy8gbGF0ZXIgdmVyc2lvbnMgYXJlIHNsb3dlciB0byBjbG9zZVxuICB0aW1lb3V0ID0gdGltZW91dCAqICh4Y29kZVZlcnNpb24ubWFqb3IgPj0gOCA/IDIgOiAxKTtcblxuICB0cnkge1xuICAgIGF3YWl0IGV4ZWMoJ3hjcnVuJywgWydzaW1jdGwnLCAnc2h1dGRvd24nLCB4Y29kZVZlcnNpb24ubWFqb3IgPiA4ID8gJ2FsbCcgOiAnYm9vdGVkJ10sIHt0aW1lb3V0fSk7XG4gIH0gY2F0Y2ggKGlnbikge31cblxuICBjb25zdCBwaWRzID0gW107XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKCdwZ3JlcCcsIFsnLWYnLCBgJHthcHBOYW1lfS5hcHAvQ29udGVudHMvTWFjT1MvYF0pO1xuICAgIGlmIChzdGRvdXQudHJpbSgpKSB7XG4gICAgICBwaWRzLnB1c2goLi4uKHN0ZG91dC50cmltKCkuc3BsaXQoL1xccysvKSkpO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmIChlLmNvZGUgPT09IDEpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgJHthcHBOYW1lfSBpcyBub3QgcnVubmluZy4gQ29udGludWluZy4uLmApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoXy5pc0VtcHR5KHBpZHMpKSB7XG4gICAgICBsb2cud2FybihgcGdyZXAgZXJyb3IgJHtlLmNvZGV9IHdoaWxlIGRldGVjdGluZyB3aGV0aGVyICR7YXBwTmFtZX0gaXMgcnVubmluZy4gVHJ5aW5nIHRvIGtpbGwgYW55d2F5LmApO1xuICAgIH1cbiAgfVxuICBpZiAoIV8uaXNFbXB0eShwaWRzKSkge1xuICAgIGxvZy5kZWJ1ZyhgS2lsbGluZyBwcm9jZXNzZXM6ICR7cGlkcy5qb2luKCcsICcpfWApO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBleGVjKCdraWxsJywgWyctOScsIC4uLihwaWRzLm1hcCgocGlkKSA9PiBgJHtwaWR9YCkpXSk7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICB9XG5cbiAgbG9nLmRlYnVnKGBVc2luZyBwa2lsbCB0byBraWxsIGFwcGxpY2F0aW9uOiAke2FwcE5hbWV9YCk7XG4gIHRyeSB7XG4gICAgYXdhaXQgcGtpbGwoYXBwTmFtZSwgdHJ1ZSk7XG4gIH0gY2F0Y2ggKGlnbikge31cblxuICAvLyB3YWl0IGZvciBhbGwgdGhlIGRldmljZXMgdG8gYmUgc2h1dGRvd24gYmVmb3JlIENvbnRpbnVpbmdcbiAgLy8gYnV0IG9ubHkgcHJpbnQgb3V0IHRoZSBmYWlsZWQgb25lcyB3aGVuIHRoZXkgYXJlIGFjdHVhbGx5IGZ1bGx5IGZhaWxlZFxuICBsZXQgcmVtYWluaW5nRGV2aWNlcyA9IFtdO1xuICBhc3luYyBmdW5jdGlvbiBhbGxTaW1zQXJlRG93biAoKSB7XG4gICAgcmVtYWluaW5nRGV2aWNlcyA9IFtdO1xuICAgIGxldCBkZXZpY2VzID0gYXdhaXQgbmV3IFNpbWN0bCgpLmdldERldmljZXMoKTtcbiAgICBkZXZpY2VzID0gXy5mbGF0dGVuKF8udmFsdWVzKGRldmljZXMpKTtcbiAgICByZXR1cm4gXy5ldmVyeShkZXZpY2VzLCAoc2ltKSA9PiB7XG4gICAgICBjb25zdCBzdGF0ZSA9IHNpbS5zdGF0ZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgY29uc3QgZG9uZSA9IFsnc2h1dGRvd24nLCAndW5hdmFpbGFibGUnLCAnZGlzY29ubmVjdGVkJ10uaW5jbHVkZXMoc3RhdGUpO1xuICAgICAgaWYgKCFkb25lKSB7XG4gICAgICAgIHJlbWFpbmluZ0RldmljZXMucHVzaChgJHtzaW0ubmFtZX0gKCR7c2ltLnNka30sIHVkaWQ6ICR7c2ltLnVkaWR9KSBpcyBzdGlsbCBpbiBzdGF0ZSAnJHtzdGF0ZX0nYCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZG9uZTtcbiAgICB9KTtcbiAgfVxuICB0cnkge1xuICAgIGF3YWl0IHdhaXRGb3JDb25kaXRpb24oYWxsU2ltc0FyZURvd24sIHtcbiAgICAgIHdhaXRNczogdGltZW91dCxcbiAgICAgIGludGVydmFsTXM6IDIwMFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBpZiAocmVtYWluaW5nRGV2aWNlcy5sZW5ndGggPiAwKSB7XG4gICAgICBsb2cud2FybihgVGhlIGZvbGxvd2luZyBkZXZpY2VzIGFyZSBzdGlsbCBub3QgaW4gdGhlIGNvcnJlY3Qgc3RhdGUgYWZ0ZXIgJHt0aW1lb3V0fSBtczpgKTtcbiAgICAgIGZvciAobGV0IGRldmljZSBvZiByZW1haW5pbmdEZXZpY2VzKSB7XG4gICAgICAgIGxvZy53YXJuKGAgICAgJHtkZXZpY2V9YCk7XG4gICAgICB9XG4gICAgfVxuICAgIHRocm93IGVycjtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRTaW11bGF0b3JJbmZvICh1ZGlkLCBvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIGRldmljZXNTZXRQYXRoXG4gIH0gPSBvcHRzO1xuICAvLyBzZWUgdGhlIFJFQURNRSBmb3IgZ2l0aHViLmNvbS9hcHBpdW0vbm9kZS1zaW1jdGwgZm9yIGV4YW1wbGUgb3V0cHV0IG9mIGdldERldmljZXMoKVxuICBsZXQgZGV2aWNlcyA9IGF3YWl0IG5ldyBTaW1jdGwoe1xuICAgIGRldmljZXNTZXRQYXRoXG4gIH0pLmdldERldmljZXMoKTtcblxuICBkZXZpY2VzID0gXy50b1BhaXJzKGRldmljZXMpXG4gICAgLm1hcCgocGFpcikgPT4gcGFpclsxXSlcbiAgICAucmVkdWNlKChhLCBiKSA9PiBhLmNvbmNhdChiKSwgW10pO1xuICByZXR1cm4gXy5maW5kKGRldmljZXMsIChzaW0pID0+IHNpbS51ZGlkID09PSB1ZGlkKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2ltRXhpc3RzICh1ZGlkKSB7XG4gIHJldHVybiAhIShhd2FpdCBnZXRTaW11bGF0b3JJbmZvKHVkaWQpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0RGV2ZWxvcGVyUm9vdCAoKSB7XG4gIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygneGNvZGUtc2VsZWN0JywgWyctcCddKTtcbiAgcmV0dXJuIHN0ZG91dC50cmltKCk7XG59XG5cbi8qKlxuICogQWN0aXZhdGVzIHRoZSBhcHAgaGF2aW5nIHRoZSBnaXZlbiBwcm9jZXNzIGlkZW50aWZpZXIuXG4gKiBTZWUgaHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2RvY3VtZW50YXRpb24vYXBwa2l0L25zcnVubmluZ2FwcGxpY2F0aW9uLzE1Mjg3MjUtYWN0aXZhdGV3aXRob3B0aW9ucz9sYW5ndWFnZT1vYmpjXG4gKiBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gcGlkIEFwcCBwcm9jZXNzIGlkZW50aWZpZXJcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgZ2l2ZW4gUElEIGlzIG5vdCBydW5uaW5nIG9yIHRoZXJlIHdhcyBhIGZhaWx1cmVcbiAqIHdoaWxlIGFjdGl2YXRpbmcgdGhlIGFwcFxuICovXG5hc3luYyBmdW5jdGlvbiBhY3RpdmF0ZUFwcCAocGlkKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgZXhlYygnb3Nhc2NyaXB0JywgWyctZScsIEFQUF9BQ1RJVkFUSU9OX1NDUklQVChwaWQpXSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFNpbXVsYXRvciB3aW5kb3cgY2Fubm90IGJlIGFjdGl2YXRlZC4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5zdGRlcnIgfHwgZS5tZXNzYWdlfWApO1xuICB9XG59XG5cbmV4cG9ydCB7XG4gIGtpbGxBbGxTaW11bGF0b3JzLFxuICBzaW1FeGlzdHMsXG4gIGdldFNpbXVsYXRvckluZm8sXG4gIHRvQmlvbWV0cmljRG9tYWluQ29tcG9uZW50LFxuICBnZXREZXZlbG9wZXJSb290LFxuICBhY3RpdmF0ZUFwcCxcbiAgU0FGQVJJX1NUQVJUVVBfVElNRU9VVF9NUyxcbiAgTU9CSUxFX1NBRkFSSV9CVU5ETEVfSUQsXG4gIFNJTVVMQVRPUl9BUFBfTkFNRSxcbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQSxNQUFNQSwrQkFBK0IsR0FBRyxLQUFLO0FBQzdDLE1BQU1DLHlCQUF5QixHQUFHLEVBQUUsR0FBRyxJQUFJO0FBQUM7QUFDNUMsTUFBTUMsdUJBQXVCLEdBQUcsd0JBQXdCO0FBQUM7QUFDekQsTUFBTUMsa0JBQWtCLEdBQUcsZUFBZTtBQUFDO0FBQzNDLE1BQU1DLHFCQUFxQixHQUFJQyxHQUFHLElBQU07QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxR0FBcUdBLEdBQUk7QUFDekc7QUFDQSwrQ0FBK0NBLEdBQUk7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbURBLEdBQUk7QUFDdkQ7QUFDQTtBQUNBLENBQUM7QUFHRCxNQUFNQyxVQUFVLEdBQUc7RUFDakJDLE9BQU8sRUFBRSxhQUFhO0VBQ3RCQyxNQUFNLEVBQUU7QUFDVixDQUFDO0FBRUQsU0FBU0MsMEJBQTBCLENBQUVDLElBQUksRUFBRTtFQUN6QyxJQUFJLENBQUNKLFVBQVUsQ0FBQ0ksSUFBSSxDQUFDLEVBQUU7SUFD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