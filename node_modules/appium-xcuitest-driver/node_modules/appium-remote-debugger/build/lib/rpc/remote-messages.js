"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.RemoteMessages = void 0;
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _protocol = _interopRequireDefault(require("../protocol"));
const OBJECT_GROUP = 'console';
const MINIMAL_COMMAND = 'getMinimalCommand';
const FULL_COMMAND = 'getFullCommand';
const DIRECT_COMMAND = 'getDirectCommand';
const COMMANDS = {
  'Page.getCookies': FULL_COMMAND,
  'Page.navigate': FULL_COMMAND,
  'Runtime.awaitPromise': FULL_COMMAND,
  'Runtime.callFunctionOn': FULL_COMMAND,
  'Runtime.evaluate': FULL_COMMAND,
  'Target.exists': DIRECT_COMMAND,
  'Timeline.start': FULL_COMMAND,
  'Timeline.stop': FULL_COMMAND
};
class RemoteMessages {
  constructor(isTargetBased = false) {
    this.isTargetBased = isTargetBased;
  }
  set isTargetBased(isTargetBased) {
    this._isTargetBased = isTargetBased;
  }
  get isTargetBased() {
    return this._isTargetBased;
  }
  setConnectionKey(connId) {
    return {
      __argument: {
        WIRConnectionIdentifierKey: connId
      },
      __selector: '_rpc_reportIdentifier:'
    };
  }
  connectToApp(connId, appIdKey) {
    return {
      __argument: {
        WIRConnectionIdentifierKey: connId,
        WIRApplicationIdentifierKey: appIdKey
      },
      __selector: '_rpc_forwardGetListing:'
    };
  }
  setSenderKey(connId, senderId, appIdKey, pageIdKey) {
    return {
      __argument: {
        WIRApplicationIdentifierKey: appIdKey,
        WIRConnectionIdentifierKey: connId,
        WIRSenderKey: senderId,
        WIRPageIdentifierKey: pageIdKey,
        WIRAutomaticallyPause: false
      },
      __selector: '_rpc_forwardSocketSetup:'
    };
  }
  indicateWebView(connId, appIdKey, pageIdKey, enabled) {
    return {
      __argument: {
        WIRApplicationIdentifierKey: appIdKey,
        WIRIndicateEnabledKey: _lodash.default.isNil(enabled) ? true : enabled,
        WIRConnectionIdentifierKey: connId,
        WIRPageIdentifierKey: pageIdKey
      },
      __selector: '_rpc_forwardIndicateWebView:'
    };
  }
  launchApplication(bundleId) {
    return {
      __argument: {
        WIRApplicationBundleIdentifierKey: bundleId
      },
      __selector: '_rpc_requestApplicationLaunch:'
    };
  }
  getFullCommand(opts = {}) {
    const {
      method,
      params,
      connId,
      senderId,
      appIdKey,
      pageIdKey,
      targetId,
      id
    } = opts;
    let realMethod;
    let realParams;
    if (this.isTargetBased) {
      realMethod = 'Target.sendMessageToTarget';
      realParams = {
        targetId,
        message: JSON.stringify({
          id,
          method,
          params: Object.assign({
            objectGroup: OBJECT_GROUP,
            includeCommandLineAPI: true,
            doNotPauseOnExceptionsAndMuteConsole: false,
            emulateUserGesture: false,
            generatePreview: false,
            saveResult: false
          }, params)
        })
      };
    } else {
      realMethod = method;
      realParams = Object.assign({
        objectGroup: OBJECT_GROUP,
        includeCommandLineAPI: true,
        doNotPauseOnExceptionsAndMuteConsole: false,
        emulateUserGesture: false
      }, params);
    }
    const plist = {
      __argument: {
        WIRSocketDataKey: {
          method: realMethod,
          params: realParams
        },
        WIRConnectionIdentifierKey: connId,
        WIRSenderKey: senderId,
        WIRApplicationIdentifierKey: appIdKey,
        WIRPageIdentifierKey: pageIdKey
      },
      __selector: '_rpc_forwardSocketData:'
    };
    return _lodash.default.omitBy(plist, _lodash.default.isNil);
  }
  getMinimalCommand(opts = {}) {
    const {
      method,
      params,
      connId,
      senderId,
      appIdKey,
      pageIdKey,
      targetId,
      id
    } = opts;
    let realMethod = method;
    let realParams = params;
    if (this.isTargetBased) {
      realMethod = 'Target.sendMessageToTarget';
      realParams = {
        targetId,
        message: JSON.stringify({
          id,
          method,
          params
        })
      };
    }
    const plist = {
      __argument: {
        WIRSocketDataKey: {
          method: realMethod,
          params: realParams
        },
        WIRConnectionIdentifierKey: connId,
        WIRSenderKey: senderId,
        WIRApplicationIdentifierKey: appIdKey,
        WIRPageIdentifierKey: pageIdKey
      },
      __selector: '_rpc_forwardSocketData:'
    };
    return _lodash.default.omitBy(plist, _lodash.default.isNil);
  }
  getDirectCommand(opts = {}) {
    const {
      method,
      params,
      connId,
      senderId,
      appIdKey,
      pageIdKey,
      id
    } = opts;
    const plist = {
      __argument: {
        WIRSocketDataKey: {
          id,
          method,
          params
        },
        WIRConnectionIdentifierKey: connId,
        WIRSenderKey: senderId,
        WIRApplicationIdentifierKey: appIdKey,
        WIRPageIdentifierKey: pageIdKey
      },
      __selector: '_rpc_forwardSocketData:'
    };
    return _lodash.default.omitBy(plist, _lodash.default.isNil);
  }
  getRemoteCommand(command, opts) {
    const {
      id,
      connId,
      appIdKey,
      senderId,
      pageIdKey,
      targetId
    } = opts;
    switch (command) {
      case 'setConnectionKey':
        return this.setConnectionKey(connId);
      case 'indicateWebView':
        return this.indicateWebView(connId, appIdKey, pageIdKey, opts.enabled);
      case 'connectToApp':
        return this.connectToApp(connId, appIdKey);
      case 'setSenderKey':
        return this.setSenderKey(connId, senderId, appIdKey, pageIdKey);
      case 'launchApplication':
        return this.launchApplication(opts.bundleId);
    }
    const builderFunction = COMMANDS[command] || MINIMAL_COMMAND;
    return this[builderFunction]({
      ...(0, _protocol.default)(id, command, opts),
      connId,
      appIdKey,
      senderId,
      pageIdKey,
      targetId
    });
  }
}
exports.RemoteMessages = RemoteMessages;
var _default = RemoteMessages;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfcHJvdG9jb2wiLCJPQkpFQ1RfR1JPVVAiLCJNSU5JTUFMX0NPTU1BTkQiLCJGVUxMX0NPTU1BTkQiLCJESVJFQ1RfQ09NTUFORCIsIkNPTU1BTkRTIiwiUmVtb3RlTWVzc2FnZXMiLCJjb25zdHJ1Y3RvciIsImlzVGFyZ2V0QmFzZWQiLCJfaXNUYXJnZXRCYXNlZCIsInNldENvbm5lY3Rpb25LZXkiLCJjb25uSWQiLCJfX2FyZ3VtZW50IiwiV0lSQ29ubmVjdGlvbklkZW50aWZpZXJLZXkiLCJfX3NlbGVjdG9yIiwiY29ubmVjdFRvQXBwIiwiYXBwSWRLZXkiLCJXSVJBcHBsaWNhdGlvbklkZW50aWZpZXJLZXkiLCJzZXRTZW5kZXJLZXkiLCJzZW5kZXJJZCIsInBhZ2VJZEtleSIsIldJUlNlbmRlcktleSIsIldJUlBhZ2VJZGVudGlmaWVyS2V5IiwiV0lSQXV0b21hdGljYWxseVBhdXNlIiwiaW5kaWNhdGVXZWJWaWV3IiwiZW5hYmxlZCIsIldJUkluZGljYXRlRW5hYmxlZEtleSIsIl8iLCJpc05pbCIsImxhdW5jaEFwcGxpY2F0aW9uIiwiYnVuZGxlSWQiLCJXSVJBcHBsaWNhdGlvbkJ1bmRsZUlkZW50aWZpZXJLZXkiLCJnZXRGdWxsQ29tbWFuZCIsIm9wdHMiLCJtZXRob2QiLCJwYXJhbXMiLCJ0YXJnZXRJZCIsImlkIiwicmVhbE1ldGhvZCIsInJlYWxQYXJhbXMiLCJtZXNzYWdlIiwiSlNPTiIsInN0cmluZ2lmeSIsIk9iamVjdCIsImFzc2lnbiIsIm9iamVjdEdyb3VwIiwiaW5jbHVkZUNvbW1hbmRMaW5lQVBJIiwiZG9Ob3RQYXVzZU9uRXhjZXB0aW9uc0FuZE11dGVDb25zb2xlIiwiZW11bGF0ZVVzZXJHZXN0dXJlIiwiZ2VuZXJhdGVQcmV2aWV3Iiwic2F2ZVJlc3VsdCIsInBsaXN0IiwiV0lSU29ja2V0RGF0YUtleSIsIm9taXRCeSIsImdldE1pbmltYWxDb21tYW5kIiwiZ2V0RGlyZWN0Q29tbWFuZCIsImdldFJlbW90ZUNvbW1hbmQiLCJjb21tYW5kIiwiYnVpbGRlckZ1bmN0aW9uIiwiZ2V0UHJvdG9jb2xDb21tYW5kIiwiZXhwb3J0cyIsIl9kZWZhdWx0IiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9ycGMvcmVtb3RlLW1lc3NhZ2VzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgZ2V0UHJvdG9jb2xDb21tYW5kIGZyb20gJy4uL3Byb3RvY29sJztcblxuXG5jb25zdCBPQkpFQ1RfR1JPVVAgPSAnY29uc29sZSc7XG5cbmNvbnN0IE1JTklNQUxfQ09NTUFORCA9ICdnZXRNaW5pbWFsQ29tbWFuZCc7XG5jb25zdCBGVUxMX0NPTU1BTkQgPSAnZ2V0RnVsbENvbW1hbmQnO1xuY29uc3QgRElSRUNUX0NPTU1BTkQgPSAnZ2V0RGlyZWN0Q29tbWFuZCc7XG5cbi8vIG1hcHBpbmcgb2YgY29tbWFuZHMgdG8gdGhlIGZ1bmN0aW9uIGZvciBnZXR0aW5nIHRoZSBjb21tYW5kXG4vLyBkZWZhdWx0cyB0byBgZ2V0TWluaW1hbENvbW1hbmRgLCBzbyBubyBuZWVkIHRvIGhhdmUgdGhvc2UgbGlzdGVkIGhlcmVcbmNvbnN0IENPTU1BTkRTID0ge1xuICAnUGFnZS5nZXRDb29raWVzJzogRlVMTF9DT01NQU5ELFxuICAnUGFnZS5uYXZpZ2F0ZSc6IEZVTExfQ09NTUFORCxcblxuICAnUnVudGltZS5hd2FpdFByb21pc2UnOiBGVUxMX0NPTU1BTkQsXG4gICdSdW50aW1lLmNhbGxGdW5jdGlvbk9uJzogRlVMTF9DT01NQU5ELFxuICAnUnVudGltZS5ldmFsdWF0ZSc6IEZVTExfQ09NTUFORCxcblxuICAnVGFyZ2V0LmV4aXN0cyc6IERJUkVDVF9DT01NQU5ELFxuXG4gICdUaW1lbGluZS5zdGFydCc6IEZVTExfQ09NTUFORCxcbiAgJ1RpbWVsaW5lLnN0b3AnOiBGVUxMX0NPTU1BTkQsXG59O1xuXG5jbGFzcyBSZW1vdGVNZXNzYWdlcyB7XG4gIGNvbnN0cnVjdG9yIChpc1RhcmdldEJhc2VkID0gZmFsc2UpIHtcbiAgICB0aGlzLmlzVGFyZ2V0QmFzZWQgPSBpc1RhcmdldEJhc2VkO1xuICB9XG5cbiAgc2V0IGlzVGFyZ2V0QmFzZWQgKGlzVGFyZ2V0QmFzZWQpIHtcbiAgICB0aGlzLl9pc1RhcmdldEJhc2VkID0gaXNUYXJnZXRCYXNlZDtcbiAgfVxuXG4gIGdldCBpc1RhcmdldEJhc2VkICgpIHtcbiAgICByZXR1cm4gdGhpcy5faXNUYXJnZXRCYXNlZDtcbiAgfVxuXG4gIC8qXG4gICAqIENvbm5lY3Rpb24gZnVuY3Rpb25zXG4gICAqL1xuXG4gIHNldENvbm5lY3Rpb25LZXkgKGNvbm5JZCkge1xuICAgIHJldHVybiB7XG4gICAgICBfX2FyZ3VtZW50OiB7XG4gICAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiBjb25uSWRcbiAgICAgIH0sXG4gICAgICBfX3NlbGVjdG9yOiAnX3JwY19yZXBvcnRJZGVudGlmaWVyOidcbiAgICB9O1xuICB9XG5cbiAgY29ubmVjdFRvQXBwIChjb25uSWQsIGFwcElkS2V5KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgICAgV0lSQ29ubmVjdGlvbklkZW50aWZpZXJLZXk6IGNvbm5JZCxcbiAgICAgICAgV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5OiBhcHBJZEtleVxuICAgICAgfSxcbiAgICAgIF9fc2VsZWN0b3I6ICdfcnBjX2ZvcndhcmRHZXRMaXN0aW5nOidcbiAgICB9O1xuICB9XG5cbiAgc2V0U2VuZGVyS2V5IChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgICAgV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5OiBhcHBJZEtleSxcbiAgICAgICAgV0lSQ29ubmVjdGlvbklkZW50aWZpZXJLZXk6IGNvbm5JZCxcbiAgICAgICAgV0lSU2VuZGVyS2V5OiBzZW5kZXJJZCxcbiAgICAgICAgV0lSUGFnZUlkZW50aWZpZXJLZXk6IHBhZ2VJZEtleSxcbiAgICAgICAgV0lSQXV0b21hdGljYWxseVBhdXNlOiBmYWxzZVxuICAgICAgfSxcbiAgICAgIF9fc2VsZWN0b3I6ICdfcnBjX2ZvcndhcmRTb2NrZXRTZXR1cDonXG4gICAgfTtcbiAgfVxuXG4gIGluZGljYXRlV2ViVmlldyAoY29ubklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBlbmFibGVkKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgICAgV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5OiBhcHBJZEtleSxcbiAgICAgICAgV0lSSW5kaWNhdGVFbmFibGVkS2V5OiBfLmlzTmlsKGVuYWJsZWQpID8gdHJ1ZSA6IGVuYWJsZWQsXG4gICAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiBjb25uSWQsXG4gICAgICAgIFdJUlBhZ2VJZGVudGlmaWVyS2V5OiBwYWdlSWRLZXlcbiAgICAgIH0sXG4gICAgICBfX3NlbGVjdG9yOiAnX3JwY19mb3J3YXJkSW5kaWNhdGVXZWJWaWV3OidcbiAgICB9O1xuICB9XG5cbiAgbGF1bmNoQXBwbGljYXRpb24gKGJ1bmRsZUlkKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgICAgV0lSQXBwbGljYXRpb25CdW5kbGVJZGVudGlmaWVyS2V5OiBidW5kbGVJZFxuICAgICAgfSxcbiAgICAgIF9fc2VsZWN0b3I6ICdfcnBjX3JlcXVlc3RBcHBsaWNhdGlvbkxhdW5jaDonXG4gICAgfTtcbiAgfVxuXG4gIGdldEZ1bGxDb21tYW5kIChvcHRzID0ge30pIHtcbiAgICBjb25zdCB7XG4gICAgICBtZXRob2QsXG4gICAgICBwYXJhbXMsXG4gICAgICBjb25uSWQsXG4gICAgICBzZW5kZXJJZCxcbiAgICAgIGFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5LFxuICAgICAgdGFyZ2V0SWQsXG4gICAgICBpZCxcbiAgICB9ID0gb3B0cztcblxuICAgIC8qIFRoZSBXZWIgSW5zcGVjdG9yIGhhcyBhIG51bWJlciBvZiBwYXJhbWV0ZXJzIHRoYXQgY2FuIGJlIHBhc3NlZCBpbiwgYXNcbiAgICAgKiBzZWVuIHdoZW4gZHVtcGluZyB3aGF0IFNhZmFyaSBpcyBkb2luZyB3aGVuIGNvbW11bmljYXRpbmcgd2l0aCBpdC4gTW9zdFxuICAgICAqIGFyZSBrZXB0IGFzIHRoZXkgYXJlIHNldCBmb3IgU2FmYXJpLiBUaGUgZXhjZXB0aW9uIGlzIGBlbXVsYXRlVXNlckdlc3R1cmVgXG4gICAgICogd2hpY2gsIG9uIGlPUyAxMyssIGJyZWFrcyBwb3B1cCBibG9ja2luZyAoaS5lLiwgZXZlbiB3aXRoIHRoZSBwb3B1cFxuICAgICAqIGJsb2NraW5nIHNldHRpbmcgb24sIG5ldyB3aW5kb3dzIGFyZSBvcGVuYWJsZSBib3RoIGZyb20gbGlua3MgYW5kIGZyb21cbiAgICAgKiBKYXZhU2NyaXB0KS5cbiAgICAgKi9cblxuICAgIGxldCByZWFsTWV0aG9kO1xuICAgIGxldCByZWFsUGFyYW1zO1xuICAgIGlmICh0aGlzLmlzVGFyZ2V0QmFzZWQpIHtcbiAgICAgIHJlYWxNZXRob2QgPSAnVGFyZ2V0LnNlbmRNZXNzYWdlVG9UYXJnZXQnO1xuICAgICAgcmVhbFBhcmFtcyA9IHtcbiAgICAgICAgdGFyZ2V0SWQsXG4gICAgICAgIG1lc3NhZ2U6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICBtZXRob2QsXG4gICAgICAgICAgcGFyYW1zOiBPYmplY3QuYXNzaWduKHtcbiAgICAgICAgICAgIG9iamVjdEdyb3VwOiBPQkpFQ1RfR1JPVVAsXG4gICAgICAgICAgICBpbmNsdWRlQ29tbWFuZExpbmVBUEk6IHRydWUsXG4gICAgICAgICAgICBkb05vdFBhdXNlT25FeGNlcHRpb25zQW5kTXV0ZUNvbnNvbGU6IGZhbHNlLFxuICAgICAgICAgICAgZW11bGF0ZVVzZXJHZXN0dXJlOiBmYWxzZSxcbiAgICAgICAgICAgIGdlbmVyYXRlUHJldmlldzogZmFsc2UsXG4gICAgICAgICAgICBzYXZlUmVzdWx0OiBmYWxzZSxcbiAgICAgICAgICB9LCBwYXJhbXMpXG4gICAgICAgIH0pLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVhbE1ldGhvZCA9IG1ldGhvZDtcbiAgICAgIHJlYWxQYXJhbXMgPSBPYmplY3QuYXNzaWduKHtcbiAgICAgICAgb2JqZWN0R3JvdXA6IE9CSkVDVF9HUk9VUCxcbiAgICAgICAgaW5jbHVkZUNvbW1hbmRMaW5lQVBJOiB0cnVlLFxuICAgICAgICBkb05vdFBhdXNlT25FeGNlcHRpb25zQW5kTXV0ZUNvbnNvbGU6IGZhbHNlLFxuICAgICAgICBlbXVsYXRlVXNlckdlc3R1cmU6IGZhbHNlLFxuICAgICAgfSwgcGFyYW1zKTtcbiAgICB9XG5cbiAgICBjb25zdCBwbGlzdCA9IHtcbiAgICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgICAgV0lSU29ja2V0RGF0YUtleToge1xuICAgICAgICAgIG1ldGhvZDogcmVhbE1ldGhvZCxcbiAgICAgICAgICBwYXJhbXM6IHJlYWxQYXJhbXMsXG4gICAgICAgIH0sXG4gICAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiBjb25uSWQsXG4gICAgICAgIFdJUlNlbmRlcktleTogc2VuZGVySWQsXG4gICAgICAgIFdJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleTogYXBwSWRLZXksXG4gICAgICAgIFdJUlBhZ2VJZGVudGlmaWVyS2V5OiBwYWdlSWRLZXksXG4gICAgICB9LFxuICAgICAgX19zZWxlY3RvcjogJ19ycGNfZm9yd2FyZFNvY2tldERhdGE6JyxcbiAgICB9O1xuICAgIHJldHVybiBfLm9taXRCeShwbGlzdCwgXy5pc05pbCk7XG4gIH1cblxuICBnZXRNaW5pbWFsQ29tbWFuZCAob3B0cyA9IHt9KSB7XG4gICAgY29uc3Qge21ldGhvZCwgcGFyYW1zLCBjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCB0YXJnZXRJZCwgaWR9ID0gb3B0cztcblxuICAgIGxldCByZWFsTWV0aG9kID0gbWV0aG9kO1xuICAgIGxldCByZWFsUGFyYW1zID0gcGFyYW1zO1xuICAgIGlmICh0aGlzLmlzVGFyZ2V0QmFzZWQpIHtcbiAgICAgIHJlYWxNZXRob2QgPSAnVGFyZ2V0LnNlbmRNZXNzYWdlVG9UYXJnZXQnO1xuICAgICAgcmVhbFBhcmFtcyA9IHtcbiAgICAgICAgdGFyZ2V0SWQsXG4gICAgICAgIG1lc3NhZ2U6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICBtZXRob2QsXG4gICAgICAgICAgcGFyYW1zLFxuICAgICAgICB9KSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgcGxpc3QgPSB7XG4gICAgICBfX2FyZ3VtZW50OiB7XG4gICAgICAgIFdJUlNvY2tldERhdGFLZXk6IHtcbiAgICAgICAgICBtZXRob2Q6IHJlYWxNZXRob2QsXG4gICAgICAgICAgcGFyYW1zOiByZWFsUGFyYW1zLFxuICAgICAgICB9LFxuICAgICAgICBXSVJDb25uZWN0aW9uSWRlbnRpZmllcktleTogY29ubklkLFxuICAgICAgICBXSVJTZW5kZXJLZXk6IHNlbmRlcklkLFxuICAgICAgICBXSVJBcHBsaWNhdGlvbklkZW50aWZpZXJLZXk6IGFwcElkS2V5LFxuICAgICAgICBXSVJQYWdlSWRlbnRpZmllcktleTogcGFnZUlkS2V5LFxuICAgICAgfSxcbiAgICAgIF9fc2VsZWN0b3I6ICdfcnBjX2ZvcndhcmRTb2NrZXREYXRhOidcbiAgICB9O1xuICAgIHJldHVybiBfLm9taXRCeShwbGlzdCwgXy5pc05pbCk7XG4gIH1cblxuICBnZXREaXJlY3RDb21tYW5kIChvcHRzID0ge30pIHtcbiAgICBjb25zdCB7bWV0aG9kLCBwYXJhbXMsIGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGlkfSA9IG9wdHM7XG5cbiAgICBjb25zdCBwbGlzdCA9IHtcbiAgICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgICAgV0lSU29ja2V0RGF0YUtleToge1xuICAgICAgICAgIGlkLFxuICAgICAgICAgIG1ldGhvZCxcbiAgICAgICAgICBwYXJhbXMsXG4gICAgICAgIH0sXG4gICAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiBjb25uSWQsXG4gICAgICAgIFdJUlNlbmRlcktleTogc2VuZGVySWQsXG4gICAgICAgIFdJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleTogYXBwSWRLZXksXG4gICAgICAgIFdJUlBhZ2VJZGVudGlmaWVyS2V5OiBwYWdlSWRLZXksXG4gICAgICB9LFxuICAgICAgX19zZWxlY3RvcjogJ19ycGNfZm9yd2FyZFNvY2tldERhdGE6J1xuICAgIH07XG4gICAgcmV0dXJuIF8ub21pdEJ5KHBsaXN0LCBfLmlzTmlsKTtcbiAgfVxuXG4gIGdldFJlbW90ZUNvbW1hbmQgKGNvbW1hbmQsIG9wdHMpIHtcbiAgICBjb25zdCB7XG4gICAgICBpZCxcbiAgICAgIGNvbm5JZCxcbiAgICAgIGFwcElkS2V5LFxuICAgICAgc2VuZGVySWQsXG4gICAgICBwYWdlSWRLZXksXG4gICAgICB0YXJnZXRJZCxcbiAgICB9ID0gb3B0cztcblxuICAgIC8vIGRlYWwgd2l0aCBTYWZhcmkgV2ViIEluc3BlY3RvciBjb21tYW5kc1xuICAgIHN3aXRjaCAoY29tbWFuZCkge1xuICAgICAgY2FzZSAnc2V0Q29ubmVjdGlvbktleSc6XG4gICAgICAgIHJldHVybiB0aGlzLnNldENvbm5lY3Rpb25LZXkoY29ubklkKTtcbiAgICAgIGNhc2UgJ2luZGljYXRlV2ViVmlldyc6XG4gICAgICAgIHJldHVybiB0aGlzLmluZGljYXRlV2ViVmlldyhjb25uSWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG9wdHMuZW5hYmxlZCk7XG4gICAgICBjYXNlICdjb25uZWN0VG9BcHAnOlxuICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0VG9BcHAoY29ubklkLCBhcHBJZEtleSk7XG4gICAgICBjYXNlICdzZXRTZW5kZXJLZXknOlxuICAgICAgICByZXR1cm4gdGhpcy5zZXRTZW5kZXJLZXkoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSk7XG4gICAgICBjYXNlICdsYXVuY2hBcHBsaWNhdGlvbic6XG4gICAgICAgIHJldHVybiB0aGlzLmxhdW5jaEFwcGxpY2F0aW9uKG9wdHMuYnVuZGxlSWQpO1xuICAgIH1cblxuICAgIC8vIGRlYWwgd2l0aCBXZWJLaXQgY29tbWFuZHNcbiAgICBjb25zdCBidWlsZGVyRnVuY3Rpb24gPSBDT01NQU5EU1tjb21tYW5kXSB8fCBNSU5JTUFMX0NPTU1BTkQ7XG4gICAgcmV0dXJuIHRoaXNbYnVpbGRlckZ1bmN0aW9uXSh7XG4gICAgICAuLi5nZXRQcm90b2NvbENvbW1hbmQoaWQsIGNvbW1hbmQsIG9wdHMpLFxuICAgICAgY29ubklkLFxuICAgICAgYXBwSWRLZXksXG4gICAgICBzZW5kZXJJZCxcbiAgICAgIHBhZ2VJZEtleSxcbiAgICAgIHRhcmdldElkLFxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCB7IFJlbW90ZU1lc3NhZ2VzIH07XG5leHBvcnQgZGVmYXVsdCBSZW1vdGVNZXNzYWdlcztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxJQUFBQSxPQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxTQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFHQSxNQUFNRSxZQUFZLEdBQUcsU0FBUztBQUU5QixNQUFNQyxlQUFlLEdBQUcsbUJBQW1CO0FBQzNDLE1BQU1DLFlBQVksR0FBRyxnQkFBZ0I7QUFDckMsTUFBTUMsY0FBYyxHQUFHLGtCQUFrQjtBQUl6QyxNQUFNQyxRQUFRLEdBQUc7RUFDZixpQkFBaUIsRUFBRUYsWUFBWTtFQUMvQixlQUFlLEVBQUVBLFlBQVk7RUFFN0Isc0JBQXNCLEVBQUVBLFlBQVk7RUFDcEMsd0JBQXdCLEVBQUVBLFlBQVk7RUFDdEMs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